webpackJsonp([12],{"2sQk":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("XLwt"),s={name:"LineChart",props:{id:{type:String},title:{type:String},legendName:{type:String},xAxisData:{type:Array},seriesData:{type:Array},primaryColor:{type:String,default:"#26bba0"},areaColor:{type:String,default:"#38cdb27d"}},data:function(){return{}},methods:{draw:function(e,t){var a=i.init(document.getElementById(this.id)),s={title:{text:this.title,textStyle:{fontSize:14}},tooltip:{trigger:"axis"},color:[this.primaryColor],legend:{selectedMode:!1,x:30,y:8,data:[{name:this.legendName}]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:t},yAxis:{type:"value"},series:[{name:this.legendName,type:"line",smooth:!0,symbolSize:6,label:{normal:{show:!0,position:"top",color:this.primaryColor}},itemStyle:{normal:{color:this.primaryColor,borderWidth:2}},lineStyle:{color:this.primaryColor},areaStyle:{normal:{color:this.areaColor,show:!0,position:"top"}},data:e}]};a.setOption(s)}},watch:{seriesData:function(e){this.draw(e,this.xAxisData)}}},n={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"line-container"},[t("header",[this._t("header")],2),this._v(" "),t("div",{staticClass:"rfd-line-chart",attrs:{id:this.id}})])},staticRenderFns:[]};var l=a("VU/8")(s,n,!1,function(e){a("WpRA")},null,null).exports,o=a("GIAq"),r=a("oAV5"),c={name:"LogInstance",components:{LineChart:l,LineChartTime:l},props:{isAdmin:Boolean,isAddress:Boolean,appType:String},data:function(){return{listId:this.$route.params.listId,month:new Date,xAxisData:[],seriesData:[],active:!0,xAxisTimeData:[],seriesTimeData:[],workFlowTimeActive:!0,workFlowMonth:new Date}},watch:{month:function(e){this.getInstanceStatistics()},workFlowMonth:function(e){this.getWorkFlowTime()}},methods:{getInstanceStatistics:function(e){var t=this,a=t.listId,i=t.month,s=e||(this.active?"week":"day");i=Object(r.b)(i,"yyyy/MM/dd"),Object(o.E)(a,s,i).then(function(e){if(e.list[0]){var a=[],i=[];e.list.map(function(e){a.push(e.xAxis),i.push(e.num)}),t.seriesData=i,t.xAxisData=a}})},getWorkFlowTime:function(e){var t=this,a=t.listId,i=t.workFlowMonth,s=e||(this.workFlowTimeActive?"week":"day");i=Object(r.b)(i,"yyyy/MM/dd"),Object(o.N)(a,s,i).then(function(e){if(e.list[0]){var a=[],i=[];e.list.map(function(e){a.push(e.xAxis),e.num?i.push(e.num):i.push(0)}),t.seriesTimeData=i,t.xAxisTimeData=a}})},selectDataRange:function(e){this.active="week"===e,this.getInstanceStatistics(e)},selectSpendTimeRange:function(e){this.workFlowTimeActive="week"===e,this.getWorkFlowTime(e)}},mounted:function(){this.getInstanceStatistics(),this.getWorkFlowTime()}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return"subject"!==e.appType?a("div",[e._m(0),e._v(" "),a("div",[a("div",{class:{"line-chart-screen":e.isAddress,"line-chart":!0}},[a("line-chart",{attrs:{legendName:"新增实例数",xAxisData:e.xAxisData,seriesData:e.seriesData,id:"instanceLineChart",primaryColor:"#1890ff",areaColor:"#1890ff8c"}},[a("div",{staticClass:"line-chart-header",attrs:{slot:"header"},slot:"header"},[e._v("\n          查看范围:\n          "),a("DatePicker",{staticStyle:{width:"120px","margin-left":"10px"},attrs:{type:"month",placeholder:"选择月份",format:"yyyy-MM",clearable:!1},model:{value:e.month,callback:function(t){e.month=t},expression:"month"}}),e._v(" "),a("div",{staticClass:"select-range"},[a("span",{staticClass:"customs-tag",class:{"customs-tag-active":e.active},on:{click:function(t){e.selectDataRange("week")}}},[e._v("周")]),e._v(" "),a("span",{staticClass:"customs-tag",class:{"customs-tag-active":!e.active},on:{click:function(t){e.selectDataRange("day")}}},[e._v("天")])])],1)])],1),e._v(" "),e.isAddress?e._e():a("div",{staticClass:"line-chart"},[a("line-chart-time",{attrs:{legendName:"实例平均工作流耗用时间周期(小时)",xAxisData:e.xAxisTimeData,seriesData:e.seriesTimeData,id:"spendTimeChart",primaryColor:"#f9499e",areaColor:"#f9499e8c"}},[a("div",{staticClass:"line-chart-header",attrs:{slot:"header"},slot:"header"},[e._v("\n          查看范围:\n          "),a("DatePicker",{staticStyle:{width:"120px","margin-left":"10px"},attrs:{type:"month",placeholder:"选择月份",format:"yyyy-MM",clearable:!1},model:{value:e.workFlowMonth,callback:function(t){e.workFlowMonth=t},expression:"workFlowMonth"}}),e._v(" "),a("div",{staticClass:"select-range"},[a("span",{staticClass:"customs-tag",class:{"customs-tag-active":e.workFlowTimeActive},on:{click:function(t){e.selectSpendTimeRange("week")}}},[e._v("周")]),e._v(" "),a("span",{staticClass:"customs-tag",class:{"customs-tag-active":!e.workFlowTimeActive},on:{click:function(t){e.selectSpendTimeRange("day")}}},[e._v("天")])])],1)])],1)])]):e._e()},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"app-resource-group-title"},[t("h3",[this._v("数据增量分析")])])}]};var h=a("VU/8")(c,d,!1,function(e){a("XgTS")},"data-v-f56d02ea",null).exports,p=a("K4CD"),g={components:{ChangeDetail:a("lZCD").a},data:function(){var e=this;return{fieldDetailColumns:[{title:"版本",key:"version",width:60,align:"center"},{title:"交易号",key:"transCode",align:"center"},{title:"变更时间",key:"modiferTime",align:"center"},{title:"变更者",key:"modiferName",align:"center"},{title:"变更字段",key:"mainTable",align:"center",render:function(e,t){var a=t.row.mainTable,i=(t.row.detailTable,[]);return a.length>0&&a.forEach(function(t){i.push(e("p",{style:{minHeight:"16px"}},t.fieldName))}),t.row.detailTable.length>0&&t.row.detailTable.forEach(function(t,a){i.push(e("p",{style:{height:"16px"}},"明细表"))}),e("div",i)}},{title:"变更前",key:"mainTable",align:"center",render:function(t,a){var i=a.row.mainTable,s=a.row.detailTable,n=[],l=/jpg|jpeg|png/g;return i.length>0&&i.forEach(function(e){l.test(e.fieldOldValue)?n.push(t("img",{attrs:{src:"/H_roleplay-si/ds/download?url="+e.fieldOldValue,style:"width: 30px;height: 30px;border-radius: 2px;"}})):n.push(t("p",{style:{minHeight:"16px",color:"#ee0000"}},e.fieldOldValue?e.fieldOldValue:" "))}),s&&s.length>0&&s.forEach(function(i,l){n.push(t("p",{style:{height:"16px",color:"#1605f3",cursor:"pointer"},on:{click:function(){e.showChangeDetailsModal=!0,e.modiferName=a.row.modiferName,e.modiferTime=a.row.modiferTime,e.addRows=JSON.parse(JSON.parse(s[l].changes).adds),e.deleteRows=JSON.parse(s[l].changes).deletes?JSON.parse(JSON.parse(s[l].changes).deletes):[];var t=JSON.parse(s[l].changes).updates?JSON.parse(JSON.parse(s[l].changes).updates):[],i=JSON.parse(s[l].fieldName);for(var n in i)"ID"===i[n]&&(e.locationField=n);for(var o in e.changeColumns=[{type:"index",width:60,align:"center"}],i)o!==e.locationField&&e.changeColumns.push({title:i[o],key:o,hidden:!0,align:"center"});e.beforeChangeData=JSON.parse(s[l].oldData),e.afterChangeData=JSON.parse(s[l].newData),t.length>0&&t.forEach(function(t){e.afterChangeData.forEach(function(a){if(t.id===a[e.locationField]){var i=t.change;a.cellClassName={};for(var s=0;s<i.length;s++)a.cellClassName[i[s]]="table-column-update"}})})}}},"查看详情"))}),t("div",n)}},{title:"变更后",key:"mainTable",align:"center",render:function(t,a){var i=a.row.mainTable,s=a.row.detailTable,n=[],l=/jpg|jpeg|png/g;return i.length>0&&i.forEach(function(e){l.test(e.fieldNewValue)?n.push(t("img",{attrs:{src:"/H_roleplay-si/ds/download?url="+e.fieldNewValue,style:"width: 30px;height: 30px;border-radius: 2px;"}})):n.push(t("p",{style:{minHeight:"16px",color:"#008000"}},e.fieldNewValue))}),s&&s.length>0&&s.forEach(function(i,l){n.push(t("p",{style:{height:"16px",color:"#1605f3",cursor:"pointer"},on:{click:function(){e.showChangeDetailsModal=!0,e.modiferName=a.row.modiferName,e.modiferTime=a.row.modiferTime,e.addRows=JSON.parse(JSON.parse(s[l].changes).adds),e.deleteRows=JSON.parse(s[l].changes).deletes?JSON.parse(JSON.parse(s[l].changes).deletes):[];var t=JSON.parse(s[l].changes).updates?JSON.parse(JSON.parse(s[l].changes).updates):[],i=JSON.parse(s[l].fieldName);for(var n in i)"ID"===i[n]&&(e.locationField=n);for(var o in e.changeColumns=[{type:"index",width:60,align:"center"}],i)o!==e.locationField&&e.changeColumns.push({title:i[o],key:o,hidden:!0,align:"center"});e.beforeChangeData=JSON.parse(s[l].oldData),e.afterChangeData=JSON.parse(s[l].newData),t.length>0&&t.forEach(function(t){e.afterChangeData.forEach(function(a){if(t.id===a[e.locationField]){var i=t.change;a.cellClassName={};for(var s=0;s<i.length;s++)a.cellClassName[i[s]]="table-column-update"}})})}}},"查看详情"))}),t("div",n)}}],fieldDetail:[],showChangeDetailsModal:!1,beforeChangeData:[],afterChangeData:[],changeColumns:[],modiferName:"",modiferTime:"",addRows:[],deleteRows:[],locationField:"",startDate:"",endDate:"",pageSize:10,pageIndex:1,dataTotal:0}},methods:{addRowClassName:function(e,t){for(var a=0;a<this.addRows.length;a++)if(e[this.locationField]===this.addRows[a])return"table-column-add"},deleteRowClassName:function(e,t){for(var a=0;a<this.deleteRows.length;a++)if(e[this.locationField]===this.deleteRows[a])return"table-column-detele"},dataChange:function(e){e.length>0&&(this.startDate=e[0],this.endDate=e[1]),this.getListChangeHistory()},getListChangeHistory:function(e){var t=this,a={listId:this.$route.params.listId,startDate:this.startDate,endDate:this.endDate,pageIndex:this.pageIndex,pageSize:this.pageSize},i=this.fieldDetailColumns;Object(p.h)(a).then(function(a){t.fieldDetail=a.tableContent,t.dataTotal=a.dataCount;var s=a.tableContent[0].extColumns;s.length>0&&e&&s.forEach(function(e){for(var t in e)i.push({title:t,key:t,align:"center"})})})},onPageSizeChange:function(e){this.pageSize=e,this.getListChangeHistory()},pageChange:function(e){this.pageIndex=e,this.getListChangeHistory()}},filters:{capitalize:function(e){return e?(e=Math.abs(Number(e))).toFixed(2):""}},mounted:function(){this.getListChangeHistory(!0)}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrapper"},[e._m(0),e._v(" "),a("div",{staticClass:"wrapper-body"},[a("div",{staticClass:"search"},[a("DatePicker",{staticStyle:{width:"280px"},attrs:{type:"daterange",editable:!1,placement:"bottom-end",placeholder:"请选择日期范围"},on:{"on-change":e.dataChange}})],1),e._v(" "),a("Table",{attrs:{columns:e.fieldDetailColumns,data:e.fieldDetail}}),e._v(" "),a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticClass:"fr"},[a("Page",{attrs:{total:e.dataTotal,"show-elevator":"","show-sizer":"",current:e.pageIndex,"page-size":e.pageSize,size:"small","show-total":""},on:{"on-page-size-change":e.onPageSizeChange,"on-change":e.pageChange}})],1)])],1),e._v(" "),a("change-detail",{attrs:{title:"变更详情",width:"900",footerHide:!0},model:{value:e.showChangeDetailsModal,callback:function(t){e.showChangeDetailsModal=t},expression:"showChangeDetailsModal"}},[a("div",{staticClass:"detail"},[a("div",{staticClass:"detail-header"},[a("p",[a("label",[e._v("变更者:")]),e._v(" "),a("span",[e._v(e._s(e.modiferName))])]),e._v(" "),a("div",{staticClass:"detail-header-time"},[a("label",[e._v("变更时间:")]),e._v(" "),a("span",[e._v(e._s(e.modiferTime))]),e._v(" "),a("ul",[a("li",[a("div",{staticStyle:{"background-color":"#ffe699"}}),e._v("\n                            已移除\n                        ")]),e._v(" "),a("li",[a("div",{staticStyle:{"background-color":"#c6e0b4"}}),e._v("\n                            新增\n                        ")]),e._v(" "),a("li",[a("div",{staticStyle:{"background-color":"#bdd7ee"}}),e._v("\n                            已修改\n                        ")])])])]),e._v(" "),a("div",{staticClass:"detail-table"},[a("div",{staticClass:"detail-table-before"},[a("div",{staticClass:"detail-table-before-title"},[e._v("更变前")]),e._v(" "),a("Table",{attrs:{"row-class-name":e.deleteRowClassName,columns:e.changeColumns,data:e.beforeChangeData,size:"small",height:"152","disabled-hover":!0}})],1),e._v(" "),a("div",{staticClass:"detail-table-after"},[a("div",{staticClass:"detail-table-after-title"},[e._v("更变后")]),e._v(" "),a("Table",{attrs:{"row-class-name":e.addRowClassName,columns:e.changeColumns,data:e.afterChangeData,size:"small",height:"152","disabled-hover":!0}})],1)])])])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"app-resource-group-title"},[t("h3",[this._v("数据变更分析")])])}]};var m={name:"AnalysisLayout",components:{LogInstance:h,listChangeHistory:a("VU/8")(g,u,!1,function(e){a("2vc8")},"data-v-4c97204a",null).exports},props:{listId:String,appType:String,enabledForbidden:Number,isCompanyAdmin:Boolean,isAdmin:Boolean,isAddress:Boolean}},f={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"analysis-layout"},[t("log-instance",{attrs:{isAdmin:this.isAdmin,isAddress:this.isAddress,appType:this.appType}}),this._v(" "),"subject"!==this.appType?t("list-change-history"):this._e()],1)},staticRenderFns:[]};var v=a("VU/8")(m,f,!1,function(e){a("SYVF")},"data-v-2cad874f",null);t.default=v.exports},"2vc8":function(e,t){},SYVF:function(e,t){},WpRA:function(e,t){},XgTS:function(e,t){}});