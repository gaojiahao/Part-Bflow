webpackJsonp([8],{"3fB+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("GIAq"),s=a("bTqw"),i={name:"permissionSource",components:{},props:{enabledForbidden:Number,isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isEdit:"",actionData:[]}},watch:{enabledForbidden:function(){this.getData()}},methods:{isForbidden:function(e,t){var a=this,s=void 0;s=0===e.permType?-2:0,Object(o.a)(e.id,s).then(function(e){e.success&&(a.$Message.success(e.message),a.getData())})},getData:function(){var e=this,t=this.listId;Object(o.r)(t).then(function(t){e.actionData=t.tableContent,e.actionData.map(function(e){e.desc=s.a[e.resourceName]})})}},created:function(){},mounted:function(){this.getData()}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app"},[a("Row",{staticClass:"app-action"},[a("Row",{staticClass:"app-action-title"},[a("h3",[e._v("动作")]),a("span",{staticClass:"warning-color marlr"},[e._v("勾选以启用或停用应用的动作")])]),e._v(" "),a("div",{staticClass:"app-action-source"},[a("Row",{staticClass:"app-action-source-list"},e._l(e.actionData,function(t,o){return a("Col",{key:o,staticClass:"app-action-source-item",attrs:{span:"6"}},[a("Col",{staticClass:"app-action-source-item-check",attrs:{span:"2"}},[a("Checkbox",{attrs:{disabled:!e.isAdmin,value:0===t.permType},on:{"on-change":function(a){e.isForbidden(t,o)}}})],1),e._v(" "),a("Col",{staticClass:"app-action-source-item-content",attrs:{span:"21"}},[a("h3",[e._v(e._s(t.name))]),e._v(" "),a("div",{staticClass:"app-action-source-item-desc"},[e._v(e._s(t.desc))])])],1)}))],1)],1)],1)},staticRenderFns:[]};var r=a("VU/8")(i,n,!1,function(e){a("xSr9")},"data-v-31c1b46a",null).exports,l=a("Gu7T"),c=a.n(l),d=(a("lZCD"),a("CaXr")),u=a("mvHQ"),h=a.n(u),p={name:"GroupSelector",components:{},props:{showGroupSelector:{type:Boolean}},data:function(){return{searchOrgValue:"",orgTotal:0,orgCurrentPage:1,pageSize:10,orgLoading:!0,showOrgModal:!1,orgColumns:[{type:"selection",width:60,align:"center"},{title:"名称",key:"name"}],orgData:[],orgSelectData:[],orgSelection:[]}},watch:{showGroupSelector:function(e){e&&(this.showOrgModal=e,this.selectOrgModal(),this.orgSelection=[],this.orgSelectData=[])}},methods:{orgFilter:function(){var e=h()([{operator:"like",value:this.searchOrgValue,property:"name"}]);this.selectOrgModal(e,1)},selectOrgModal:function(e,t){var a=this;this.orgLoading=!0,Object(o.q)(t||this.orgCurrentPage,this.pageSize,e).then(function(e){a.orgData=e.tableContent,a.orgTotal=e.dataCount,a.orgLoading=!1,a.orgSelection.length>0&&a.orgData.map(function(e){a.orgSelection.map(function(t){e.id==t.id&&(e._checked=!0)})})})},selectOrgClick:function(e,t){if(0===e.length){var a=this.$refs.orgTable.data,o=this.orgSelection;a.map(function(e){o=o.filter(function(t){return t.id!==e.id})}),this.orgSelection=o}else{var s,i={};(s=this.orgSelection).push.apply(s,c()(e)),this.orgSelection=this.orgSelection.reduce(function(e,t){return!i[t.id]&&(i[t.id]=e.push(t)),e},[])}},onOrgSelectAll:function(e){var t,a={};(t=this.orgSelection).push.apply(t,c()(e)),this.orgSelection=this.orgSelection.reduce(function(e,t){return!a[t.id]&&(a[t.id]=e.push(t)),e},[])},selectOrgCancel:function(e,t){var a=this;this.orgSelection.forEach(function(e,o){e.id===t.id&&a.orgSelection.splice(o,1)})},deleteSelectOrg:function(e,t){var a=this;this.orgSelection.splice(t,1),this.$refs.orgTable.data.forEach(function(t,o){e.id===t.id&&a.$refs.orgTable.toggleSelect(o)})},cancelSelectOrg:function(){this.orgSelection=this.orgSelectData},confirmOrg:function(){var e={};this.orgSelectData=this.orgSelection.reduce(function(t,a){return!e[a.id]&&(e[a.id]=t.push(a)),t},[]),this.$emit("groupModalData",this.orgSelectData)},modalVisibleChange:function(e){e||this.$emit("emitGroupModal",{modal:!1})},onOrgPageChange:function(e){var t=h()([{operator:"like",value:this.searchOrgValue,property:"name"}]);this.orgCurrentPage=e,this.selectOrgModal(t)}},mounted:function(){}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Modal",{attrs:{title:"组织选择","mask-closable":!1,styles:{top:"15px"}},on:{"on-ok":e.confirmOrg,"on-cancel":e.cancelSelectOrg,"on-visible-change":e.modalVisibleChange},model:{value:e.showOrgModal,callback:function(t){e.showOrgModal=t},expression:"showOrgModal"}},[a("div",{staticClass:"app-search"},[a("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"搜索"},on:{"on-search":e.orgFilter},model:{value:e.searchOrgValue,callback:function(t){e.searchOrgValue=t},expression:"searchOrgValue"}}),e._v(" "),a("p",{staticClass:"app-search-icon",on:{click:e.orgFilter}},[a("Button",{attrs:{type:"primary",size:"small"}},[e._v("查询")])],1)],1),e._v(" "),a("Table",{ref:"orgTable",attrs:{height:"400",stripe:"",size:"small",loading:e.orgLoading,columns:e.orgColumns,data:e.orgData},on:{"on-select-cancel":e.selectOrgCancel,"on-select-all":e.onOrgSelectAll,"on-selection-change":e.selectOrgClick}}),e._v(" "),a("div",{staticClass:"user-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:e.orgTotal,current:e.orgCurrentPage,"page-size":e.pageSize,size:"small","show-total":""},on:{"on-change":e.onOrgPageChange}})],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.orgSelection[0],expression:"orgSelection[0] "}],staticClass:"page-selection-warp"},e._l(e.orgSelection,function(t,o){return a("Tag",{key:t.id,attrs:{closable:"",type:"border",color:"primary",size:"small"},on:{"on-close":function(a){e.deleteSelectOrg(t,o)}}},[e._v("\n        "+e._s(t.name)+"\n      ")])}))],1)],1)},staticRenderFns:[]};var f=a("VU/8")(p,m,!1,function(e){a("rcPB")},null,null).exports,g={name:"RoleSelector",components:{},props:{showRoleSelector:{type:Boolean}},data:function(){return{searchDepValue:"",depTotal:0,depCurrentPage:1,pageSize:10,depLoading:!0,showDepartmentModal:!1,departmentColumns:[{type:"selection",width:60,align:"center"},{title:"名称",key:"name"}],departmentData:[],departmentSelectData:[],departmentSelection:[]}},watch:{showRoleSelector:function(e){e&&(this.showDepartmentModal=e,this.selectPositionModal(),this.departmentSelection=[],this.departmentSelectData=[])}},methods:{depFilter:function(){var e=h()([{operator:"like",value:this.searchDepValue,property:"name"}]);this.selectPositionModal(e,1)},selectPositionModal:function(e,t){var a=this;this.depLoading=!0,Object(o.p)(t||this.depCurrentPage,this.pageSize,e).then(function(e){a.departmentData=e.tableContent,a.depTotal=e.dataCount,a.depLoading=!1,a.departmentSelection.length>0&&a.departmentData.map(function(e){a.departmentSelection.map(function(t){e.id==t.id&&(e._checked=!0)})})})},selectDepartmentClick:function(e,t){if(0===e.length){var a=this.$refs.roleTable.data,o=this.departmentSelection;a.map(function(e){o=o.filter(function(t){return t.id!==e.id})}),this.departmentSelection=o}else{var s,i={};(s=this.departmentSelection).push.apply(s,c()(e)),this.departmentSelection=this.departmentSelection.reduce(function(e,t){return!i[t.id]&&(i[t.id]=e.push(t)),e},[])}},onRoleSelectAll:function(e){var t,a={};(t=this.departmentSelection).push.apply(t,c()(e)),this.departmentSelection=this.departmentSelection.reduce(function(e,t){return!a[t.id]&&(a[t.id]=e.push(t)),e},[])},selectDepCancel:function(e,t){var a=this;this.departmentSelection.forEach(function(e,o){e.id===t.id&&a.departmentSelection.splice(o,1)})},deleteSelectRole:function(e,t){var a=this;this.departmentSelection.splice(t,1),this.$refs.roleTable.data.forEach(function(t,o){e.id===t.id&&a.$refs.roleTable.toggleSelect(o)})},cancelSelectDep:function(){this.departmentSelection=this.departmentSelectData},confirmDepartment:function(){var e={};this.departmentSelectData=this.departmentSelection.reduce(function(t,a){return!e[a.id]&&(e[a.id]=t.push(a)),t},[]),this.$emit("roleModalData",this.departmentSelectData)},modalVisibleChange:function(e){e||this.$emit("emitRoleModal",{modal:!1})},onDepPageChange:function(e){var t=h()([{operator:"like",value:this.searchDepValue,property:"name"}]);this.depCurrentPage=e,this.selectPositionModal(t)}},mounted:function(){}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Modal",{attrs:{title:"职位选择","mask-closable":!1,styles:{top:"15px"}},on:{"on-ok":e.confirmDepartment,"on-cancel":e.cancelSelectDep,"on-visible-change":e.modalVisibleChange},model:{value:e.showDepartmentModal,callback:function(t){e.showDepartmentModal=t},expression:"showDepartmentModal"}},[a("div",{staticClass:"app-search"},[a("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"搜索"},on:{"on-search":e.depFilter},model:{value:e.searchDepValue,callback:function(t){e.searchDepValue=t},expression:"searchDepValue"}}),e._v(" "),a("p",{staticClass:"app-search-icon",on:{click:e.depFilter}},[a("Button",{attrs:{type:"primary",size:"small"}},[e._v("查询")])],1)],1),e._v(" "),a("Table",{ref:"roleTable",attrs:{height:"400",stripe:"",size:"small",loading:e.depLoading,columns:e.departmentColumns,data:e.departmentData},on:{"on-select-cancel":e.selectDepCancel,"on-select-all":e.onRoleSelectAll,"on-selection-change":e.selectDepartmentClick}}),e._v(" "),a("div",{staticClass:"user-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:e.depTotal,current:e.depCurrentPage,"page-size":e.pageSize,size:"small","show-total":""},on:{"on-change":e.onDepPageChange}})],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.departmentSelection[0],expression:"departmentSelection[0] "}],staticClass:"page-selection-warp"},e._l(e.departmentSelection,function(t,o){return a("Tag",{key:t.id,attrs:{closable:"",type:"border",color:"primary",size:"small"},on:{"on-close":function(a){e.deleteSelectRole(t,o)}}},[e._v("\n        "+e._s(t.name)+"\n      ")])}))],1)],1)},staticRenderFns:[]};var w=a("VU/8")(g,v,!1,function(e){a("xAJY")},null,null).exports,S={name:"ReportModal",components:{UserSelector:d.a,GroupSelector:f,RoleSelector:w},props:{modalStatis:{type:Boolean},permissionId:{type:[String,Number]},permissionData:{type:Array}},data:function(){return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,userSelectData:[],orgSelectData:[],departmentSelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(e,t){var a=this;this.showPermissionModal=e,this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[],e&&(this.orgSelectData=this.permissionData.filter(function(e){return"group"===e.type}),this.departmentSelectData=this.permissionData.filter(function(e){return"role"===e.type}),this.permissionData.forEach(function(e){"user"===e.type&&a.userSelectData.push({nickname:e.name,userId:e.id,type:e.type})}))},userSelectData:function(e){e.length>0?this.isModalDisabled=!1:this.orgSelectData.length>0||this.departmentSelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(e){e.length>0?this.isModalDisabled=!1:this.departmentSelectData.length>0||this.userSelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(e){e.length>0?this.isModalDisabled=!1:this.orgSelectData.length>0||this.userSelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},getUserModalData:function(e){if(this.userSelectData.length>0){var t,a={};(t=this.userSelectData).push.apply(t,c()(e)),this.userSelectData=this.userSelectData.reduce(function(e,t){return!a[t.userId]&&(a[t.userId]=e.push(t)),e},[])}else this.userSelectData=e},getGroupModalData:function(e){if(this.orgSelectData.length>0){var t,a={};(t=this.orgSelectData).push.apply(t,c()(e)),this.orgSelectData=this.orgSelectData.reduce(function(e,t){return!a[t.id]&&(a[t.id]=e.push(t)),e},[])}else this.orgSelectData=e},getRoleModalData:function(e){if(this.departmentSelectData.length>0){var t,a={};(t=this.departmentSelectData).push.apply(t,c()(e)),this.departmentSelectData=this.departmentSelectData.reduce(function(e,t){return!a[t.id]&&(a[t.id]=e.push(t)),e},[])}else this.departmentSelectData=e},cancelAddPermission:function(){this.showPermissionModal=!1},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},deleteUser:function(e){var t=e.target.parentElement.getAttribute("userid");this.userSelectData=this.userSelectData.filter(function(e){return e.userId!=t}),this.userSelection=this.userSelection.filter(function(e){return e.userId!=t})},deleteOrg:function(e){var t=e.target.parentElement.getAttribute("orgid");this.orgSelectData=this.orgSelectData.filter(function(e){return e.id!=t}),this.orgSelection=this.orgSelection.filter(function(e){return e.id!=t})},deleteDepartment:function(e){var t=e.target.parentElement.getAttribute("depid");this.departmentSelectData=this.departmentSelectData.filter(function(e){return e.id!=t}),this.departmentSelection=this.departmentSelection.filter(function(e){return e.id!=t})},submitPermission:function(){var e=this,t=this.userSelectData.map(function(e){return e.userId}).join(","),a=this.orgSelectData.map(function(e){return e.id}).join(","),s=this.departmentSelectData.map(function(e){return e.id}).join(",");Object(o.X)(this.permissionId,t,a,s).then(function(t){if(t.success){e.showPermissionModal=!1,e.$Message.success(t.message);var a=e.emitChange++;e.$emit("reGetData",a)}else e.$Message.error(t.message)})},modalVisibleChange:function(e){e||this.$emit("emitPermissionModal",{modal:!1})}}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{transfer:!1,title:"视图权限",width:"600","mask-closable":!1},on:{"on-visible-change":e.modalVisibleChange},model:{value:e.showPermissionModal,callback:function(t){e.showPermissionModal=t},expression:"showPermissionModal"}},[a("div",[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Col",{attrs:{span:"8"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectUserModal}},[e._v("选择用户")])],1),e._v(" "),a("Col",{attrs:{span:"8"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectGroupModal}},[e._v("选择组织")])],1),e._v(" "),a("Col",{attrs:{span:"8"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectRoleModal}},[e._v("选择职位")])],1)],1),e._v(" "),a("Row",{attrs:{gutter:8}},[a("Col",{staticClass:"permission-tab",attrs:{span:"24"}},[a("Row",{staticStyle:{"margin-top":"10px"}},[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[e._v("用户")])]),e._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.userSelectData,function(t,o){return a("Tag",{key:o,attrs:{userId:t.userId,closable:"",color:"warning"},on:{"on-close":e.deleteUser}},[e._v("\n          "+e._s(t.nickname)+"\n        ")])}))],1),e._v(" "),a("Row",{staticClass:"permission-line"}),e._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[e._v("组织")])]),e._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.orgSelectData,function(t,o){return a("Tag",{key:o,attrs:{orgId:t.id,closable:"",color:"success"},on:{"on-close":e.deleteOrg}},[e._v("\n          "+e._s(t.name)+"\n        ")])}))],1),e._v(" "),a("Row",{staticClass:"permission-line"}),e._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[e._v("职位")])]),e._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.departmentSelectData,function(t,o){return a("Tag",{key:o,attrs:{depId:t.id,closable:"",color:"primary"},on:{"on-close":e.deleteDepartment}},[e._v("\n          "+e._s(t.name)+"\n        ")])}))],1)],1)],1),e._v(" "),a("user-selector",{attrs:{showUserSelector:e.showSelector.showUserSelector},on:{emitUserModal:e.emitUserModal,userModalData:e.getUserModalData}}),e._v(" "),a("group-selector",{attrs:{showGroupSelector:e.showSelector.showGroupSelector},on:{emitGroupModal:e.emitGroupModal,groupModalData:e.getGroupModalData}}),e._v(" "),a("role-selector",{attrs:{showRoleSelector:e.showSelector.showRoleSelector},on:{emitRoleModal:e.emitRoleModal,roleModalData:e.getRoleModalData}})],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:e.cancelAddPermission}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",disabled:e.isModalDisabled},on:{click:e.submitPermission}},[e._v("确定")])],1)])},staticRenderFns:[]};var b={name:"reportSource",components:{ReportModal:a("VU/8")(S,D,!1,function(e){a("yKKk")},null,null).exports},props:{appType:String,isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,showReportModal:!1,permissionId:"",columns:[],reportSources:[],permissionData:[]}},watch:{isAdmin:function(e){this.setColumns()},deep:!0},methods:{emitPermissionModal:function(){this.showReportModal=!1},goCreateView:function(){window.top.location.href="/Site/index.html#appSetting/"+this.listId+"/"+this.appType+"/viewTypes"},reGetData:function(){this.getViewsData()},getViewsData:function(){var e=this;Object(o.H)(this.listId).then(function(t){t.forEach(function(e){e.users||(e.users=[]),e.roles||(e.roles=[]),e.groups||(e.groups=[]),e.permissionList=[].concat(c()(e.groups),c()(e.roles),c()(e.users))}),e.reportSources=t})},deleteViews:function(e,t){var a=this;if(1===this.reportSources.length)this.$Message.warning("不可删除唯一视图！");else if(1===e.row.isDefault){var s={viewId:e.row.viewId,listId:this.listId};this.$Modal.confirm({title:"确认",content:"确认删除此视图？",onOk:function(){Object(o.h)(s).then(function(e){if(e.success){a.reportSources.splice(t,1);var s={viewId:a.reportSources[0].viewId,listId:a.listId};Object(o.W)(s).then(function(e){e.success&&a.reloadViewData()})}})}})}else{var i={viewId:e.row.viewId,listId:this.listId};this.$Modal.confirm({title:"确认",content:"确认删除此视图？",onOk:function(){Object(o.h)(i).then(function(e){e.success&&(a.reportSources.splice(t,1),a.$Message.success(e.message))})}})}},reloadViewData:function(){var e=this;Object(o.H)(this.listId).then(function(t){t.forEach(function(e){e.permissionList=[].concat(c()(e.groups),c()(e.roles),c()(e.users))}),e.reportSources=t})},onClickDefaultView:function(e){var t=this;this.$Modal.confirm({title:"确认",content:"确认设置此视图为默认视图？",onOk:function(){t.setDefaultViews(e)},onCancel:function(){t.reloadViewData()}})},setDefaultViews:function(e){var t=this,a={viewId:e.row.viewId,listId:this.listId};Object(o.W)(a).then(function(e){e.success&&(t.$Message.success(e.message),t.reloadViewData())})},setColumns:function(){var e=this,t=[{title:"报表名称",key:"title"},{title:"已授权用户、组织或职位",key:"permissionList",render:function(e,t){var a=t.row.permissionList,o=[];if(a.length>0)return a.forEach(function(t,a){var s=e("span",{style:{margin:"0px 5px"}},t.name);o.push(s)}),e("div",o)}}],a=[{title:"默认视图",key:"isDefault",align:"center",render:function(t,a){var o=!1;return 1===a.row.isDefault&&(o=!0),t("Radio",{props:{value:o,disabled:!e.isAdmin},on:{"on-change":function(t){e.onClickDefaultView(a)}}})}}],o=[{title:"操作",key:"list",align:"center",render:function(t,a){return console.log(e.appType),t("div",[t("a",{on:{click:function(){e.deleteViews(a,a.index)}},style:{display:"subject"!==e.appType?"inline-block":"none"}},"删除"),t("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px",display:"subject"!==e.appType?"inline":"none"}}),t("a",{on:{click:function(){var t="/Site/index.html#appSetting/viewConfig/"+e.listId+"/"+a.row.viewId;window.top.location.href=t}},style:{display:"subject"!==e.appType?"inline-block":"none"}},"修改"),t("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px",display:"subject"!==e.appType?"inline":"none"}}),t("a",{on:{click:function(){e.permissionId=a.row.permissionId,e.showReportModal=!0,e.permissionData=a.row.permissionList}}},"授权")])}}];this.isAdmin&&"subject"!==this.appType?this.columns=t.concat(a).concat(o):this.isAdmin?this.columns=t.concat(o):this.columns=t}},mounted:function(){this.setColumns(),this.getViewsData()}},M={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-report"},[a("Row",{staticClass:"app-report-title"},[a("h3",[e._v("报表 "),e.isAdmin&&"subject"!=e.appType?a("a",{on:{click:e.goCreateView}},[e._v("添加报表")]):e._e()]),e._v(" "),a("span",{staticClass:"warning-color marlr"},[e._v("用户默认拥有此应用默认报表的权限")])]),e._v(" "),a("Row",{staticClass:"app-report-table"},[a("Table",{attrs:{columns:e.columns,data:e.reportSources,size:"small"}})],1),e._v(" "),a("report-modal",{attrs:{modalStatis:e.showReportModal,permissionId:e.permissionId,permissionData:e.permissionData},on:{emitPermissionModal:e.emitPermissionModal,reGetData:e.reGetData}})],1)},staticRenderFns:[]};var C=a("VU/8")(b,M,!1,function(e){a("e9eA")},"data-v-a806903c",null).exports,_={name:"formSource",components:{},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId}},methods:{setForm:function(){window.open("/Form/index.html?viewDesign=true&list="+this.listId)}},created:function(){},mounted:function(){}},k={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"app-form"},[t("Row",{staticClass:"app-form-title"},[t("h3",[this._v("表单 "),this.isAdmin?t("a",{on:{click:this.setForm}},[this._v("表单设置")]):this._e()])])],1)},staticRenderFns:[]};var y=a("VU/8")(_,k,!1,function(e){a("FxqG")},"data-v-682736de",null).exports,I=a("bOdI"),R=a.n(I),A={name:"WorkflowModal",props:{modalWorkflowStatus:Boolean,deleteRelationWorkflow:Number},data:function(){var e=this;return{listId:this.$route.params.listId,searchValue:"",showWorkFlow:!1,relativeWorkFlowTotal:0,allWorkFlowTotal:0,allCurrentPage:1,relativeCurrentPage:1,pageSize:10,loadingAll:!0,loadingRelative:!0,allWorkFlowColumns:[{title:"名称",key:"processName"},{title:"查看流程图",key:"action",align:"center",render:function(e,t){return e("a",{props:{type:"default",size:"small"},on:{click:function(){window.open("/myflow/viewProc.html?processId="+t.row.id)}}},"查看")}}],relativeWorkFlowColumns:[{title:"名称",key:"processName"},{title:"配置节点",key:"config",align:"center",render:function(t,a){return t("a",{on:{click:function(){window.open("/myflow/viewFlow.html?processId="+a.row.id+"&listId="+e.listId+"&processCode="+a.row.processCode)}}},"配置")}},{title:"操作",key:"action",align:"center",render:function(t,a){return t("a",{on:{click:function(){e.deleteWorkflow(a.row,a.index)}}},"删除")}}],allWorkFlowData:[],relativeWorkFlowData:[]}},watch:{modalWorkflowStatus:function(e,t){this.showWorkFlow=e},deleteRelationWorkflow:function(){this.getRelativeWorkflowData()}},methods:{workflowFilter:function(){var e=h()([{operator:"like",value:this.searchValue,property:"processName"}]);this.allCurrentPage=1,this.getAllWorkflowData(e)},selectWorkFlow:function(){},getAllWorkflowData:function(e){var t=this;this.loadingAll=!0,Object(o.s)(this.allCurrentPage,this.pageSize,e).then(function(e){t.allWorkFlowData=e.tableContent,t.allWorkFlowTotal=e.dataCount,t.loadingAll=!1})},getRelativeWorkflowData:function(){var e=this;this.loadingRelative=!0,Object(o.I)(this.listId,this.relativeCurrentPage,this.pageSize).then(function(t){e.relativeWorkFlowData=t,e.relativeWorkFlowTotal=t.length,e.loadingRelative=!1})},onPageChange:function(e){this.allCurrentPage=e,this.getAllWorkflowData()},onRelativePageChange:function(e){this.relativeCurrentPage=e,this.getRelativeWorkflowData()},modalVisibleChange:function(e){e||this.$emit("emitWorkFlowModal",{modal:!1})},addWorkflowData:function(e,t){0===this.relativeWorkFlowData.length?this.saveWorkFlow(e):this.$Message.warning("请先删除已关联工作流再添加！")},saveWorkFlow:function(e){var t=this,a={listId:this.listId,procCode:e.processCode,creator:"",list:"list_process_rel",status:1};Object(o.Y)(a).then(function(e){e.success&&(t.$Message.success(e.message),t.getRelativeWorkflowData(),t.$emit("addWorkflow"))})},deleteWorkflow:function(e,t){var a=this,s={ID:e.id,list:"list_process_rel",status:0};Object(o.Y)(s).then(function(e){e.success&&(a.$Message.success(e.message),a.relativeWorkFlowData.splice(t,1),a.$emit("addWorkflow"))})}},mounted:function(){this.getAllWorkflowData(),this.getRelativeWorkflowData()}},P={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{title:"工作流设置",width:"1010","mask-closable":!1,styles:{top:"20px"}},on:{"on-ok":e.selectWorkFlow,"on-visible-change":e.modalVisibleChange},model:{value:e.showWorkFlow,callback:function(t){e.showWorkFlow=t},expression:"showWorkFlow"}},[a("Row",{attrs:{gutter:8}},[a("Col",{attrs:{span:"12"}},[a("h4",{staticClass:"flow-title"},[e._v("所有工作流\n      "),a("div",{staticClass:"app-search"},[a("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"搜索工作流名称"},on:{"on-search":e.workflowFilter},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1)]),e._v(" "),a("Table",{staticStyle:{"margin-top":"15px"},attrs:{loading:e.loadingAll,stripe:"",height:"350",columns:e.allWorkFlowColumns,data:e.allWorkFlowData},on:{"on-row-dblclick":e.addWorkflowData}}),e._v(" "),a("div",{staticClass:"workflow-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:e.allWorkFlowTotal,current:e.allCurrentPage,"page-size":e.pageSize,size:"small","show-total":""},on:{"on-change":e.onPageChange}})],1)])],1),e._v(" "),a("Col",{attrs:{span:"12"}},[a("h4",{staticClass:"flow-title"},[e._v("已关联的工作流")]),e._v(" "),a("Table",{attrs:{loading:e.loadingRelative,stripe:"",height:"350",columns:e.relativeWorkFlowColumns,data:e.relativeWorkFlowData}}),e._v(" "),a("div",{staticClass:"workflow-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:e.relativeWorkFlowTotal,current:e.relativeCurrentPage,"page-size":e.pageSize,size:"small","show-total":""},on:{"on-change":e.onRelativePageChange}})],1)])],1)],1)],1)},staticRenderFns:[]};var O,x={name:"workflowSource",components:{WorkflowModal:a("VU/8")(A,P,!1,function(e){a("ZI4J")},"data-v-37d111d4",null).exports},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isOperationShow:!0,isCreateShow:!0,isUpdateShow:!0,showModal:!1,deleteRelationWorkflow:-1,columns:[],workflows:[]}},watch:{isAdmin:function(e){this.setColumns()}},methods:(O={addWorkflow:function(){this.getRelativeWorkflowData()},emitWorkFlowModal:function(){this.showModal=!1},showWorkflowModal:function(){this.showModal=!0},getRelativeWorkflowData:function(){var e=this;Object(o.I)(this.listId).then(function(t){var a=[];e.workflows=t,e.workflows.length>0&&(e.workflows.forEach(function(e){a.push(e.triggerType)}),/create/.test(a)&&/update/.test(a)?(e.isOperationShow=!0,e.isCreateShow=!0,e.isUpdateShow=!0):/create/.test(a)?(e.isOperationShow=!0,e.isCreateShow=!0,e.isUpdateShow=!1):/update/.test(a)?(e.isOperationShow=!0,e.isCreateShow=!1,e.isUpdateShow=!0):e.isOperationShow=!1)})},deleteWorkflow:function(e,t){var a=this;this.$Modal.confirm({title:"确认",content:"确认删除此工作流？",onOk:function(){Object(o.m)(null,null,e.id).then(function(e){e.success&&(a.$Message.success(e.message),a.getRelativeWorkflowData(),a.deleteRelationWorkflow++)})}})}},R()(O,"addWorkflow",function(){this.getRelativeWorkflowData()}),R()(O,"goCreateWorkflow",function(){window.open("/myflow/createWorkFlow.html?listId="+this.listId+"&triggerType=create")}),R()(O,"updateWorkFlowStaus",function(e){var t=this,a=e.row,s="";s=1===a.status?"确认禁用该工作流？":"确认启用该工作流？",this.$Modal.confirm({title:"系统提示",content:s,onOk:function(){1===a.status?Object(o.m)(null,a.id).then(function(e){e.success&&(t.$Message.success(e.message),t.getRelativeWorkflowData())}):Object(o.m)(a.id).then(function(e){e.success&&(t.$Message.success(e.message),t.getRelativeWorkflowData())})},onCancel:function(){t.getRelativeWorkflowData()}})}),R()(O,"createWorkflow",function(e){window.open("/myflow/createWorkFlow.html?listId="+this.listId+"&triggerType="+e)}),R()(O,"setColumns",function(){var e=this,t=[{title:"工作流名称",key:"processName",align:"left"},{title:"触发动作",key:"triggerType",align:"left",render:function(e,t){return"create"===t.row.triggerType?e("span",{},"创建实例"):e("span",{},"修改实例")}},{title:"启用",key:"status",align:"left",render:function(t,a){return t("Checkbox",{props:{value:1===a.row.status,disabled:!e.isAdmin},on:{"on-change":function(t){e.updateWorkFlowStaus(a)}}})}}],a=[{title:"操作",key:"list",align:"center",render:function(t,a){return t("div",[t("a",{on:{click:function(){e.deleteWorkflow(a.row,a.index)}}},"删除"),t("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px"}}),t("a",{on:{click:function(){window.open("/myflow/viewFlow.html?processId="+a.row.processId+"&listId="+e.listId+"&processCode="+a.row.processCode)}}},"修改")])}}];this.isAdmin?this.columns=t.concat(a):this.columns=t}),O),created:function(){this.setColumns(),this.getRelativeWorkflowData()}},W={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-workflow"},[a("Row",{staticClass:"app-workflow-title"},[a("h3",[e._v("工作流\n        "),e.isAdmin&&0===e.workflows.length?a("span",{staticClass:"app-workflow-create",on:{click:e.goCreateWorkflow}},[e._v("新建")]):e._e(),e._v(" "),e.isAdmin?a("span",{staticClass:"app-workflow-create",on:{click:e.showWorkflowModal}},[e._v("关联")]):e._e()])]),e._v(" "),a("Row",{staticClass:"app-workflow-table"},[a("Table",{attrs:{columns:e.columns,data:e.workflows,size:"small"}})],1),e._v(" "),a("workflow-modal",{attrs:{modalWorkflowStatus:e.showModal,deleteRelationWorkflow:e.deleteRelationWorkflow},on:{emitWorkFlowModal:e.emitWorkFlowModal,addWorkflow:e.addWorkflow}})],1)},staticRenderFns:[]};var j=a("VU/8")(x,W,!1,function(e){a("CWWK")},"data-v-55fff912",null).exports,F={name:"permissionModal",components:{UserSelector:d.a,GroupSelector:f,RoleSelector:w},props:{modalStatis:Boolean,modalName:String},data:function(){return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,allPermissionData:[],permissionSelectDatas:[],allPermissionColumns:[{type:"selection",width:60,align:"center"},{title:"动作名称",key:"name",width:100},{title:"说明",key:"desc"}],userSelectData:[],orgSelectData:[],departmentSelectData:[],companySelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(e,t){this.showPermissionModal=e,this.permissionSelectDatas=[],this.showPermissionModal&&this.getData(),this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[]},permissionSelectDatas:function(e){e.length>0&&(this.userSelectData.length>0||this.orgSelectData.length>0||this.departmentSelectData.length>0||this.companySelectData.length>0)?this.isModalDisabled=!1:this.isModalDisabled=!0},userSelectData:function(e){e.length>0?this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.departmentSelectData.length>0)&&this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(e){e.length>0?this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.userSelectData.length>0||this.departmentSelectData.length>0)&&this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(e){e.length>0?this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.userSelectData.length>0)&&this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},getUserModalData:function(e){if(this.userSelectData.length>0){var t,a={};(t=this.userSelectData).push.apply(t,c()(e)),this.userSelectData=this.userSelectData.reduce(function(e,t){return!a[t.userId]&&(a[t.userId]=e.push(t)),e},[])}else this.userSelectData=e},getGroupModalData:function(e){if(this.orgSelectData.length>0){var t,a={};(t=this.orgSelectData).push.apply(t,c()(e)),this.orgSelectData=this.orgSelectData.reduce(function(e,t){return!a[t.id]&&(a[t.id]=e.push(t)),e},[])}else this.orgSelectData=e},getRoleModalData:function(e){if(this.departmentSelectData.length>0){var t,a={};(t=this.departmentSelectData).push.apply(t,c()(e)),this.departmentSelectData=this.departmentSelectData.reduce(function(e,t){return!a[t.id]&&(a[t.id]=e.push(t)),e},[])}else this.departmentSelectData=e},cancelAddPermission:function(){this.showPermissionModal=!1},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},deleteUser:function(e){var t=this,a=e.target.parentElement.getAttribute("userid"),s=[];this.permissionSelectDatas.forEach(function(e){s.push(e.id)}),Object(o.e)("sys_user_permission",a,s.join(",")).then(function(e){e.success&&(t.userSelectData=t.userSelectData.filter(function(e){return e.userId!=a}),t.userSelection=t.userSelection.filter(function(e){return e.userId!=a}))})},deleteOrg:function(e){var t=this,a=e.target.parentElement.getAttribute("orgid"),s=[];this.permissionSelectDatas.forEach(function(e){s.push(e.id)}),Object(o.e)("sys_group_permission",a,s.join(",")).then(function(e){e.success&&(t.orgSelectData=t.orgSelectData.filter(function(e){return e.id!=a}),t.orgSelection=t.orgSelection.filter(function(e){return e.id!=a}))})},deleteDepartment:function(e,t){var a=this,s=event.target.parentElement.getAttribute("depid"),i=[];this.permissionSelectDatas.forEach(function(e){i.push(e.id)}),Object(o.e)("sys_role_permission",s,i.join(",")).then(function(e){e.success&&(a.departmentSelectData=a.departmentSelectData.filter(function(e){return e.id!=s}),a.departmentSelection=a.departmentSelection.filter(function(e){return e.id!=s}))})},deleteCompany:function(e,t){var a=this,s=event.target.parentElement.getAttribute("comid"),i=[];this.permissionSelectDatas.forEach(function(e){i.push(e.id)}),Object(o.e)("sys_group_permission",s,i.join(",")).then(function(e){e.success&&(a.companySelectData=a.companySelectData.filter(function(e){return e.groupId!=s}),a.companySelectData=a.companySelectData.filter(function(e){return e.groupId!=s}))})},permissionSelectChange:function(e,t){this.permissionSelectDatas=e},submitPermission:function(){var e=this,t=this.userSelectData.map(function(e){return e.userId}),a=this.orgSelectData.map(function(e){return e.id}),s=this.departmentSelectData.map(function(e){return e.id}),i=this.companySelectData.map(function(e){return e.groupId}),n=this.permissionSelectDatas.map(function(e){return e.id}),r={userId:t.join(","),roleId:s.join(","),groupId:a.join(","),companyId:i.join(","),permissionId:n.join(",")};r&&Object(o.b)(r).then(function(t){if(t.success){e.$Message.success(t.message),e.showPermissionModal=!1;var a=e.emitChange++;e.$emit("reGetData",a)}})},modalVisibleChange:function(e){e||this.$emit("emitPermissionModal",{modal:!1})},getData:function(){var e=this.appListId;"action"===this.modalName?this.getActionPerData(e):this.getResPerData(e)},getActionPerData:function(e){var t=this;Object(o.r)(e).then(function(e){t.allPermissionData=e.tableContent,t.allPermissionData.map(function(e){e.desc=s.a[e.resourceName]})})},getResPerData:function(e){var t=this;Object(o.t)(e).then(function(e){t.allPermissionData=e.tableContent,t.allPermissionData.map(function(e){e.desc=s.a[e.resourceName]})})}},mounted:function(){this.getData()}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{transfer:!1,title:"应用权限",width:"1000",styles:{top:"15px"},"mask-closable":!1},on:{"on-visible-change":e.modalVisibleChange},model:{value:e.showPermissionModal,callback:function(t){e.showPermissionModal=t},expression:"showPermissionModal"}},[a("div",[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectUserModal}},[e._v("选择用户")])],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectGroupModal}},[e._v("选择组织")])],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectRoleModal}},[e._v("选择职位")])],1),e._v(" "),e._e()],1),e._v(" "),a("Row",{attrs:{gutter:8}},[a("Col",{staticClass:"permission-tab",attrs:{span:"12"}},[a("Row",{staticStyle:{"margin-top":"10px"}},[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[e._v("用户")])]),e._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.userSelectData,function(t,o){return a("Tag",{key:o,attrs:{userId:t.userId,closable:"",color:"warning"},on:{"on-close":e.deleteUser}},[e._v("\n              "+e._s(t.nickname)+"\n            ")])}))],1),e._v(" "),a("Row",{staticClass:"permission-line"}),e._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[e._v("组织")])]),e._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.orgSelectData,function(t,o){return a("Tag",{key:o,attrs:{orgId:t.id,closable:"",color:"success"},on:{"on-close":e.deleteOrg}},[e._v("\n            "+e._s(t.name)+"\n          ")])}))],1),e._v(" "),a("Row",{staticClass:"permission-line"}),e._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[e._v("职位")])]),e._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.departmentSelectData,function(t,o){return a("Tag",{key:o,attrs:{depId:t.id,closable:"",color:"primary"},on:{"on-close":e.deleteDepartment}},[e._v("\n            "+e._s(t.name)+"\n          ")])}))],1),e._v(" "),e._e()],1),e._v(" "),a("Col",{attrs:{span:"12"}},[a("Table",{ref:"actionRef",attrs:{stripe:"",height:"350",columns:e.allPermissionColumns,size:"small",data:e.allPermissionData},on:{"on-selection-change":e.permissionSelectChange}})],1)],1),e._v(" "),a("user-selector",{attrs:{showUserSelector:e.showSelector.showUserSelector},on:{emitUserModal:e.emitUserModal,userModalData:e.getUserModalData}}),e._v(" "),a("group-selector",{attrs:{showGroupSelector:e.showSelector.showGroupSelector},on:{emitGroupModal:e.emitGroupModal,groupModalData:e.getGroupModalData}}),e._v(" "),a("role-selector",{attrs:{showRoleSelector:e.showSelector.showRoleSelector},on:{emitRoleModal:e.emitRoleModal,roleModalData:e.getRoleModalData}})],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:e.cancelAddPermission}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",disabled:e.isModalDisabled},on:{click:e.submitPermission}},[e._v("确定")])],1)])},staticRenderFns:[]};var T=a("VU/8")(F,$,!1,function(e){a("hROt")},null,null).exports,E={name:"permissionSource",components:{ActionModal:T},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,showActionModal:!1,isModalConfirm:1e3,actionData:[],modalName:"action",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getActionData()},isAdmin:function(e){this.setColumns()}},methods:{reGetData:function(e){this.isModalConfirm=e},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=""},emitPermissionModal:function(){this.showActionModal=!1},getActionData:function(){var e=this;Object(o.w)("action",this.listId).then(function(t){e.userSources=t.tableContent})},deleteAllPermission:function(e,t){var a=this,s=this;s.$Modal.confirm({title:"确认",content:"确认删除此权限？",onOk:function(){var t,i=[],n=[],r=[],l=[],c=[];e.row.action.forEach(function(e){for(var t in e)i.push(t)}),e.row.objNames.forEach(function(e){"user"===e.type?n.push(e.id):"group"===e.type?r.push(e.id):"role"===e.type?l.push(e.id):c.push(e.id)}),t={user:n.join(","),group:r.join(","),role:l.join(","),company:c.join(","),multi:i.join(",")},Object(o.k)(t).then(function(e){e.success&&(s.$Message.success(e.message),a.getActionData())})}})},setColumns:function(){var e=this,t=[{title:"已授权用户、组织或职位",key:"objNames",render:function(e,t){var a=t.row.objNames,o=[];if(a.length>0)return a.forEach(function(t,a){var s;s=e("span",{},t.name+"; "),o.push(s)}),e("div",o)}},{title:"动作",key:"source",render:function(t,a){var s=[],i=[];return a.row.action.forEach(function(e,t){for(var a in e)i.push(a)}),e.actionData.forEach(function(n,r){var l,c=void 0;i.forEach(function(e){e==n.id&&(c=n.id)}),l=t("span",{style:{marginLeft:"5px"}},[t("Checkbox",{props:{value:c,trueValue:n.id,falseValue:n.id+"_false",disabled:!e.isAdmin},on:{"on-change":function(t){var s=void 0,i=void 0,n=void 0,r=void 0,l=void 0;"sys_role_permission"===a.row.list?n=a.row.objId:"sys_user_permission"===a.row.list?s=a.row.objId:"sys_group_permission"===a.row.list?i=a.row.objId:r=a.row.objId,/_/.test(t)?(l=0,t=t.split("_")[0]):l=1,Object(o._4)(s,n,i,r,t,e.listId,l).then(function(t){t.success&&e.$Message.success(t.message)})}}}),t("span",{},n.name)]),s.push(l)}),t("div",s)}}],a=[{title:"操作",key:"list",align:"center",render:function(t,a){return t("div",[t("a",{on:{click:function(){e.deleteAllPermission(a,a.row.list)}}},"删除")])}}];this.isAdmin?this.columns=t.concat(a):this.columns=t}},created:function(){var e=this;Object(o.r)(this.listId).then(function(t){e.actionData=t.tableContent})},mounted:function(){this.setColumns(),this.getActionData()}},U={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[a("Row",{staticClass:"app-action"},[a("Row",{staticClass:"app-action-title"},[a("h3",[e._v("动作"),e.isAdmin?a("a",{staticClass:"app-action-title-add",on:{click:e.showModal}},[e._v("授权")]):e._e()]),e._v(" "),a("span",{staticClass:"warning-color marlr"},[e._v("授予用户、组织或职位当前应用动作的权限")])]),e._v(" "),a("div",{staticClass:"app-action-source"},[a("Row",[a("Table",{attrs:{columns:e.columns,data:e.userSources,size:"small"}})],1)],1)],1),e._v(" "),a("action-modal",{attrs:{modalStatis:e.showActionModal,modalName:e.modalName},on:{reGetData:e.reGetData,emitPermissionModal:e.emitPermissionModal}})],1)},staticRenderFns:[]};var V=a("VU/8")(E,U,!1,function(e){a("v8Y1")},"data-v-59bd22d2",null).exports,G={name:"permissionSourceData",components:{ActionModal:T},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,showActionModal:!1,isModalConfirm:1e3,resourceData:[],modalName:"resource",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getResourceData()},isAdmin:function(e){this.setColumns()}},methods:{reGetData:function(e){this.isModalConfirm=e},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=""},emitPermissionModal:function(){this.showActionModal=!1},getResourceData:function(){var e=this;Object(o.w)("resource",this.listId).then(function(t){e.userSources=t.tableContent})},deleteAllPermission:function(e,t){var a=this,s=this;s.$Modal.confirm({title:"确认",content:"确认删除此权限？",onOk:function(){var t,i=[],n=[],r=[],l=[],c=[];e.row.resource.forEach(function(e){for(var t in e)i.push(t)}),e.row.objNames.forEach(function(e){"user"===e.type?n.push(e.id):"group"===e.type?r.push(e.id):"role"===e.type?l.push(e.id):c.push(e.id)}),t={user:n.join(","),group:r.join(","),role:l.join(","),company:c.join(","),multi:i.join(",")},Object(o.k)(t).then(function(e){e.success&&(s.$Message.success(e.message),a.getResourceData())})}})},setColumns:function(){var e=this,t=[{title:"已授权用户、用户组",key:"objNames",render:function(e,t){var a=t.row.objNames,o=[];if(a.length>0)return a.forEach(function(t,a){var s;s=e("span",{},t.name+"; "),o.push(s)}),e("div",o)}},{title:"数据源",key:"source",render:function(t,a){var s=[],i=[];return a.row.resource.forEach(function(e,t){for(var a in e)i.push(a)}),e.resourceData.forEach(function(n,r){var l,c=void 0;i.forEach(function(e){e==n.id&&(c=n.id)}),l=t("span",{style:{marginLeft:"10px"}},[t("Checkbox",{props:{value:c,trueValue:n.id,falseValue:n.id+"_false",disabled:!e.isAdmin},on:{"on-change":function(t){var s=void 0,i=void 0,n=void 0,r=void 0,l=void 0;"sys_role_permission"===a.row.list?n=a.row.objId:"sys_user_permission"===a.row.list?s=a.row.objId:"sys_group_permission"===a.row.list?i=a.row.objId:r=a.row.objId,/_/.test(t)?(l=0,t=t.split("_")[0]):l=1,Object(o._4)(s,n,i,r,t,e.listId,l).then(function(t){t.success&&e.$Message.success(t.message)})}}}),t("span",{},n.name)]),s.push(l)}),t("div",s)}}],a=[{title:"操作",key:"list",align:"center",render:function(t,a){return t("div",[t("a",{on:{click:function(){e.deleteAllPermission(a,a.row.list)}}},"删除")])}}];this.isAdmin?this.columns=t.concat(a):this.columns=t}},created:function(){var e=this;Object(o.t)(this.listId).then(function(t){e.resourceData=t.tableContent})},mounted:function(){this.setColumns(),this.getResourceData()}},B={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[a("Row",{staticClass:"app-action"},[a("Row",{staticClass:"app-action-title"},[a("h3",[e._v("数据源"),e.isAdmin?a("a",{staticClass:"app-action-title-add",on:{click:e.showModal}},[e._v("授权")]):e._e()]),e._v(" "),a("span",{staticClass:"warning-color marlr"},[e._v("用户默认可查看我创建的实例、我经办的实例、我负责的组织经办的实例")])]),e._v(" "),a("div",{staticClass:"app-action-source"},[a("Row",[a("Table",{attrs:{columns:e.columns,data:e.userSources,size:"small"}})],1)],1)],1),e._v(" "),a("action-modal",{attrs:{modalStatis:e.showActionModal,modalName:e.modalName},on:{reGetData:e.reGetData,emitPermissionModal:e.emitPermissionModal}})],1)},staticRenderFns:[]};var N=a("VU/8")(G,B,!1,function(e){a("8dhD")},"data-v-540991e2",null).exports,z={name:"permissionModal",components:{UserSelector:d.a,GroupSelector:f,RoleSelector:w},props:{modalStatis:Boolean,resourceId:String,isEdit:Boolean},data:function(){var e=this;return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,fieldData:[],allFieldData:[],fieldColumns:[{title:"字段",key:"fieldName",render:function(t,a){var o=[];return e.allFieldData.forEach(function(e){o.push(t("Option",{props:{value:e.fieldCode,parentCode:e.parentCode}},e.fieldName))}),t("div",[t("Select",{props:{value:a.row.fieldCode},on:{"on-change":function(t){e.fieldData[a.index].fieldCode=t}}},o)])}},{title:"规则",key:"rule",render:function(t,a){var o=[];return[{name:"大于",value:"gt"},{name:"小于",value:"lt"},{name:"等于",value:"eq"},{name:"小于等于",value:"le"},{name:"大于等于",value:"ge"},{name:"不等于",value:"ne"},{name:"包含",value:"like"},{name:"不包含",value:"nlike"}].forEach(function(e){o.push(t("Option",{props:{value:e.value}},e.name))}),t("div",[t("Select",{props:{value:a.row.operator},on:{"on-change":function(t){e.fieldData[a.index].operator=t}}},o)])}},{title:"值",key:"value",render:function(t,a){return t("div",[t("Input",{props:{value:a.row.value},on:{"on-blur":function(t){e.fieldData[a.index].value=t.target.value}}})])}},{title:"且/或",key:"or",render:function(t,a){var o=[];return[{name:"且",value:"and"},{name:"或",value:"or"}].forEach(function(e){o.push(t("Option",{props:{value:e.value}},e.name))}),t("div",[t("Select",{props:{value:a.row.logicOperator},on:{"on-change":function(t){e.fieldData[a.index].logicOperator=t}}},o)])}},{title:"操作",key:"list",align:"center",render:function(t,a){return t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.fieldData.splice(a.index,1)}}},"删除")}}],userSelectData:[],orgSelectData:[],departmentSelectData:[],companySelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(e,t){var a=this;this.isEdit?(this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[],Object(o.M)(this.appListId,this.resourceId).then(function(e){a.fieldData=e.resource,e.instance.forEach(function(e){var t={};"U"===e.substanceType?(t.nickname=e.substanceName,t.userId=e.substanceId,a.userSelectData.push(t)):"G"===e.substanceType?(t.name=e.substanceName,t.id=e.substanceId,a.orgSelectData.push(t)):"R"===e.substanceType&&(t.name=e.substanceName,t.id=e.substanceId,a.departmentSelectData.push(t))})})):(this.fieldData=[],this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[]),this.showPermissionModal=e},fieldData:function(e){e.length>0&&(this.userSelectData.length>0||this.orgSelectData.length>0||this.departmentSelectData.length>0||this.companySelectData.length>0)?this.isModalDisabled=!1:this.isModalDisabled=!0},userSelectData:function(e){e.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.departmentSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(e){e.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.userSelectData.length>0||this.departmentSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(e){e.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.userSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},addNewField:function(){this.fieldData.push({fieldName:"",parentCode:"",fieldCode:"",operator:"",value:"",logicOperator:""})},cancelAddPermission:function(){this.showPermissionModal=!1},submitPermission:function(){var e=this,t=this.userSelectData.map(function(e){return e.userId}),a=this.orgSelectData.map(function(e){return e.id}),s=this.departmentSelectData.map(function(e){return e.id}),i=(this.companySelectData.map(function(e){return e.groupId}),{user:t,role:s,group:a,listId:this.appListId,resourceId:this.resourceId,resource:this.fieldData});i&&(this.isEdit?Object(o._3)(h()(i)).then(function(t){if(t.success){e.$Message.success(t.message),e.showPermissionModal=!1;var a=e.emitChange++;e.$emit("reGetData",a)}}).catch(function(t){e.$Message.error(t.data.message)}):Object(o.V)(h()(i)).then(function(t){if(t.success){e.$Message.success(t.message),e.showPermissionModal=!1;var a=e.emitChange++;e.$emit("reGetData",a)}}).catch(function(t){e.$Message.error(t.data.message)}))},modalVisibleChange:function(e){e||this.$emit("emitPermissionModal",{modal:!1})},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},getUserModalData:function(e){if(this.userSelectData.length>0){var t,a={};(t=this.userSelectData).push.apply(t,c()(e)),this.userSelectData=this.userSelectData.reduce(function(e,t){return!a[t.userId]&&(a[t.userId]=e.push(t)),e},[])}else this.userSelectData=e},getGroupModalData:function(e){if(this.orgSelectData.length>0){var t,a={};(t=this.orgSelectData).push.apply(t,c()(e)),this.orgSelectData=this.orgSelectData.reduce(function(e,t){return!a[t.id]&&(a[t.id]=e.push(t)),e},[])}else this.orgSelectData=e},getRoleModalData:function(e){if(this.departmentSelectData.length>0){var t,a={};(t=this.departmentSelectData).push.apply(t,c()(e)),this.departmentSelectData=this.departmentSelectData.reduce(function(e,t){return!a[t.id]&&(a[t.id]=e.push(t)),e},[])}else this.departmentSelectData=e},deleteUser:function(e){var t=e.target.parentElement.getAttribute("userid");this.userSelectData=this.userSelectData.filter(function(e){return e.userId!=t})},deleteOrg:function(e){var t=e.target.parentElement.getAttribute("orgid");this.orgSelectData=this.orgSelectData.filter(function(e){return e.id!=t})},deleteDepartment:function(e,t){var a=event.target.parentElement.getAttribute("depid");this.departmentSelectData=this.departmentSelectData.filter(function(e){return e.id!=a})}},created:function(){var e=this;Object(o.E)(this.appListId).then(function(t){e.allFieldData=t})},mounted:function(){}},L={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{title:"自定义数据源",width:"1000",transfer:!1,styles:{top:"15px"},"mask-closable":!1},on:{"on-visible-change":e.modalVisibleChange},model:{value:e.showPermissionModal,callback:function(t){e.showPermissionModal=t},expression:"showPermissionModal"}},[a("div",[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"info",shape:"circle"},on:{click:e.addNewField}},[e._v("新增字段")]),e._v(" "),a("Table",{ref:"actionRef",attrs:{stripe:"",height:"200",columns:e.fieldColumns,size:"small","no-data-text":"请添加新字段",data:e.fieldData}})],1),e._v(" "),a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectUserModal}},[e._v("选择用户")])],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectGroupModal}},[e._v("选择组织")])],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectRoleModal}},[e._v("选择职位")])],1),e._v(" "),e._e()],1),e._v(" "),a("Row",{attrs:{gutter:8}},[a("Col",{staticClass:"permission-tab",attrs:{span:"24"}},[a("Row",{staticStyle:{"margin-top":"10px"}},[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[e._v("用户")])]),e._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.userSelectData,function(t,o){return a("Tag",{key:o,attrs:{userId:t.userId,closable:"",color:"warning"},on:{"on-close":e.deleteUser}},[e._v("\n              "+e._s(t.nickname)+"\n            ")])}))],1),e._v(" "),a("Row",{staticClass:"permission-line"}),e._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[e._v("组织")])]),e._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.orgSelectData,function(t,o){return a("Tag",{key:o,attrs:{orgId:t.id,closable:"",color:"success"},on:{"on-close":e.deleteOrg}},[e._v("\n            "+e._s(t.name)+"\n          ")])}))],1),e._v(" "),a("Row",{staticClass:"permission-line"}),e._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[e._v("职位")])]),e._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.departmentSelectData,function(t,o){return a("Tag",{key:o,attrs:{depId:t.id,closable:"",color:"primary"},on:{"on-close":e.deleteDepartment}},[e._v("\n            "+e._s(t.name)+"\n          ")])}))],1),e._v(" "),e._e()],1)],1),e._v(" "),a("user-selector",{attrs:{showUserSelector:e.showSelector.showUserSelector},on:{emitUserModal:e.emitUserModal,userModalData:e.getUserModalData}}),e._v(" "),a("group-selector",{attrs:{showGroupSelector:e.showSelector.showGroupSelector},on:{emitGroupModal:e.emitGroupModal,groupModalData:e.getGroupModalData}}),e._v(" "),a("role-selector",{attrs:{showRoleSelector:e.showSelector.showRoleSelector},on:{emitRoleModal:e.emitRoleModal,roleModalData:e.getRoleModalData}})],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:e.cancelAddPermission}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",disabled:e.isModalDisabled},on:{click:e.submitPermission}},[e._v("确定")])],1)])},staticRenderFns:[]};var q={name:"CustomDatasource",components:{CustomDatasourceModal:a("VU/8")(z,L,!1,function(e){a("Xisp")},null,null).exports},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isEdit:!1,resourceId:"",showActionModal:!1,isModalConfirm:1e3,actionData:[],modalName:"action",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getResourceData()},isAdmin:function(e){this.setColumns()}},methods:{reGetData:function(e){this.isModalConfirm=e},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=!1},emitPermissionModal:function(){this.showActionModal=!1},getResourceData:function(){var e=this;Object(o.L)(this.listId).then(function(t){e.userSources=t})},deleteDataSource:function(e){var t=this;this.$Modal.confirm({title:"确认",content:"确认删除此数据源权限？",onOk:function(){Object(o.i)(e).then(function(e){e.success&&(t.$Message.success(e.message),t.getResourceData())})}})},setColumns:function(){var e=this,t=[{title:"字段过滤",key:"expression",render:function(e,t){var a=[];return t.row.expression.split("br").forEach(function(t){a.push(e("div",{},t))}),e("div",a)}},{title:"已授权用户、组织或职位",key:"instance"}],a=[{title:"操作",key:"list",align:"center",render:function(t,a){return t("div",[t("a",{on:{click:function(){e.deleteDataSource(a.row.resourceId)}}},"删除"),t("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px"}}),t("a",{on:{click:function(){e.isEdit=!0,e.resourceId=a.row.resourceId,e.showActionModal=!0}}},"修改")])}}];this.isAdmin?this.columns=t.concat(a):this.columns=t}},created:function(){},mounted:function(){this.setColumns(),this.getResourceData()}},K={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[a("Row",{staticClass:"app-action"},[a("Row",{staticClass:"app-action-title"},[a("h3",[e._v("自定义数据源"),e.isAdmin?a("a",{staticClass:"app-action-title-add",on:{click:e.showModal}},[e._v("添加")]):e._e()]),e._v(" "),a("span",{staticClass:"warning-color marlr"},[e._v("自定义应用字段过滤条件以及授权给用户或用户组")])]),e._v(" "),a("div",{staticClass:"app-action-source"},[a("Row",[a("Table",{attrs:{columns:e.columns,data:e.userSources,size:"small"}})],1)],1)],1),e._v(" "),a("custom-datasource-modal",{attrs:{modalStatis:e.showActionModal,isEdit:e.isEdit,resourceId:e.resourceId},on:{reGetData:e.reGetData,emitPermissionModal:e.emitPermissionModal}})],1)},staticRenderFns:[]};var Y={name:"permissionSource",components:{OperationManage:r,ReportView:C,AppForm:y,WorkFlow:j,ActionManage:V,PermissionDataSource:N,CustomDatasource:a("VU/8")(q,K,!1,function(e){a("oAod")},"data-v-7ba07e2a",null).exports},props:{listId:String,appType:String,enabledForbidden:Number,isAdmin:Boolean,isAddress:Boolean},data:function(){return{}},mounted:function(){}},J={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-permission"},[a("operation-manage",{attrs:{enabledForbidden:e.enabledForbidden,isAdmin:e.isAdmin}}),e._v(" "),a("action-manage",{attrs:{isAdmin:e.isAdmin}}),e._v(" "),"subject"!==e.appType?a("permission-data-source",{attrs:{isAdmin:e.isAdmin}}):e._e(),e._v(" "),a("custom-datasource",{attrs:{isAdmin:e.isAdmin}}),e._v(" "),a("report-view",{attrs:{appType:e.appType,isAdmin:e.isAdmin}}),e._v(" "),e.isAddress||"subject"===e.appType?e._e():a("app-form",{attrs:{isAdmin:e.isAdmin}}),e._v(" "),e.isAddress||"subject"===e.appType?e._e():a("work-flow",{attrs:{isAdmin:e.isAdmin}})],1)},staticRenderFns:[]};var X=a("VU/8")(Y,J,!1,function(e){a("lWOn")},"data-v-dd554cc4",null);t.default=X.exports},"8dhD":function(e,t){},"9bBU":function(e,t,a){a("mClu");var o=a("FeBl").Object;e.exports=function(e,t,a){return o.defineProperty(e,t,a)}},C4MV:function(e,t,a){e.exports={default:a("9bBU"),__esModule:!0}},CWWK:function(e,t){},FxqG:function(e,t){},Xisp:function(e,t){},ZI4J:function(e,t){},bOdI:function(e,t,a){"use strict";t.__esModule=!0;var o,s=a("C4MV"),i=(o=s)&&o.__esModule?o:{default:o};t.default=function(e,t,a){return t in e?(0,i.default)(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}},e9eA:function(e,t){},hROt:function(e,t){},lWOn:function(e,t){},mClu:function(e,t,a){var o=a("kM2E");o(o.S+o.F*!a("+E39"),"Object",{defineProperty:a("evD5").f})},oAod:function(e,t){},rcPB:function(e,t){},v8Y1:function(e,t){},xAJY:function(e,t){},xSr9:function(e,t){},yKKk:function(e,t){}});