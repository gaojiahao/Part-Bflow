webpackJsonp([24],{IM5n:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("ifoU"),o=i.n(n),s=i("K4CD"),d={name:"BusinessModuleGraph",components:{Shape:i("p2vK").a},data:function(){return{moduleId:this.$route.params.moduleId,spinShow:!1,title:"",topSpace:40,graphSpace:30,defaultWidth:130,defaultHeight:140,nodeWidth:80,nodeHeight:40,nodeList:[],stageList:[],positionList:[],svgWidth:0,svgHeight:0,localPoint:{},nodePointAxion:{},polyLineList:[]}},methods:{getBusinessModuleById:function(t){var e=this;Object(s.d)(t).then(function(t){var i=e;i.title=t.title,i.positionList=t.positionList,i.svgHeight=t.positionList.length*i.defaultHeight+40,i.stageList=i.handleProcssData(t.stageList),i.localPoint=i.setLocalPoint(i.stageList,i.positionList),i.nodeList=i.drawNodePoint(t.nodeList),i.drawLine(i.nodeList),window.document.getElementsByClassName("svg-board")[0].style.height=i.svgHeight+20+"px",window.document.getElementsByClassName("svg-board")[0].style.width=i.svgWidth+"px",e.spinShow=!1})},handleEditGraph:function(t){this.$router.push({path:"/BusinessModuleConfig/"+this.moduleId})},handleProcssData:function(t){for(var e=40,i=0;i<t.length;i++)0!=i&&(e=t[i-1].xAxionLine),t[i].xAxion=t[i].length*this.defaultWidth/2+e,t[i].xAxionLine=t[i].length*this.defaultWidth+e,i==t.length-1&&(this.svgWidth=t[i].xAxionLine);return t},setLocalPoint:function(t,e){for(var i={},n=0,o=0,s="",d=0;d<e.length;d++)for(var r=0;r<t.length;r++)s=t[r].columnAnchorPoint+"_"+e[d].rowAnchorPoint,n=t[r].xAxionLine-t[r].length*this.defaultWidth,o=this.topSpace+this.defaultHeight/2*(2*d+1),i[s]=n+","+o;return i},drawNodePoint:function(t){for(var e=this,i={},n=[],o=0;o<t.length;o++){var s=t[o];if(i[s.columnAnchorPoint+"_"+s.rowAnchorPoint])for(var d=0;d<n.length;d++){var r=n[d];if(r.id==s.columnAnchorPoint+"_"+s.rowAnchorPoint){r.arr.push(s);break}}else n.push({id:s.columnAnchorPoint+"_"+s.rowAnchorPoint,arr:[s]}),i[s.columnAnchorPoint+"_"+s.rowAnchorPoint]=s}var a=[],h={},l=this.localPoint,c=0,g=this.stageList[0].columnAnchorPoint,u=!1;return n.forEach(function(t){if(u=!!~t.id.indexOf(g)){var i=t.arr.filter(function(t){return"-2"===t.id});u=i.length>0}t.arr.forEach(function(i,n){var o=l[t.id].split(",");u?(i.xAxion=+o[0]+e.graphSpace*(n+1)+c+(e.graphSpace+e.nodeWidth),i.yAxion=+o[1],c=e.nodeWidth*(n+1),h[i.id]=i.xAxion+","+i.yAxion):(i.xAxion=+o[0]+e.graphSpace*(n+1)+c,i.yAxion=+o[1],c=e.nodeWidth*(n+1),h[i.id]=i.xAxion+","+i.yAxion),a.push(i)}),c=0}),this.nodePointAxion=h,a},drawLine:function(t){var e=this,i=this.nodePointAxion,n=new o.a([[1,function(t,i){var n=+t[0],o=+t[1],s=+i[0],d=+i[1];return Math.abs(n-s)>4*e.graphSpace+e.nodeWidth?n+e.nodeWidth/2+","+(o-e.nodeHeight/2)+" "+(n+e.nodeWidth/2)+","+(o-e.nodeHeight/2-10)+" "+(s+e.nodeWidth/2)+","+(d-e.nodeHeight/2-10)+" "+(s+e.nodeWidth/2)+","+(d-e.nodeHeight/2-3):(n<s?n+e.nodeWidth:n)+","+o+" "+(n<s?s-3:s+e.nodeWidth+3)+","+d}],[2,function(t,i){var n=+t[0],o=+t[1],s=+i[0],d=+i[1];return Math.abs(o-d)>=2*e.defaultHeight?n+","+o+" "+(n-10)+","+o+" "+(s-10)+","+d+" "+(n-3)+","+d:n+e.nodeWidth/2+","+(d<o?o-e.nodeHeight/2:o+e.nodeHeight/2)+" "+(s+e.nodeWidth/2)+","+(d<o?d+e.nodeHeight/2+3:d-e.nodeHeight/2-3)}],[3,function(t,i){var n="0,0,0,0",o=+t[0],s=+t[1],d=+i[0],r=+i[1];return o-d>0&&s-r>0?n=o+e.nodeWidth/2+","+(s-e.nodeHeight/2)+" "+(o+e.nodeWidth/2)+","+(s-e.nodeHeight/2-20)+" "+(d-10)+","+(s-e.nodeHeight/2-20)+" "+(d-10)+","+r+" "+(d-3)+","+r:o-d<0&&s-r<0?n=o+e.nodeWidth/2+","+(s+e.nodeHeight/2)+" "+(o+e.nodeWidth/2)+","+(s+e.nodeHeight/2+20)+" "+(d-20)+","+(s+e.nodeHeight/2+20)+" "+(d-20)+","+r+" "+(d-3)+","+r:o-d<0&&s-r>0?n=o+e.nodeWidth+","+s+" "+(o+e.nodeWidth+10)+","+s+" "+(o+e.nodeWidth+10)+","+r+" "+(d-3)+","+r:o-d>0&&s-r<0&&(n=o+e.nodeWidth/2+","+(s+e.nodeHeight/2)+" "+(o+e.nodeWidth/2)+","+(s+e.nodeHeight/2+20)+" "+(o-20)+","+(s+e.nodeHeight/2+20)+" "+(o-20)+","+(r+e.nodeHeight/2+20)+" "+(d+e.nodeWidth/2)+","+(r+e.nodeHeight/2+20)+" "+(d+e.nodeWidth/2)+","+(r+e.nodeHeight/2+3)),n}]]);t.forEach(function(t){t.nextNodeList&&t.nextNodeList.length>0&&t.nextNodeList.forEach(function(o){var s=i[o.id].split(","),d=i[t.id].split(",");s[0]!=d[0]&&s[1]==d[1]?e.polyLineList.push({id:t.id,value:n.get(1)(d,s)}):s[0]==d[0]&&s[1]!=d[1]?e.polyLineList.push({id:t.id,value:n.get(2)(d,s)}):s[0]!=d[0]&&s[1]!=d[1]&&e.polyLineList.push({id:t.id,value:n.get(3)(d,s)})})})}},watch:{moduleId:function(t){this.getBusinessModuleById(t)}},mounted:function(){this.spinShow=!0,this.getBusinessModuleById(this.moduleId)}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view-container"},[t.spinShow?i("Spin",{attrs:{size:"large",fix:""}}):t._e(),t._v(" "),i("header",{staticClass:"header"},[i("label",[t._v("模板名称:")]),t._v(" "),i("span",[t._v(t._s(t.title))])]),t._v(" "),i("div",{staticClass:"svg-board"},[i("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"}},[i("defs",[i("marker",{attrs:{id:"arrow",markerUnits:"userSpaceOnUse",markerWidth:"15",markerHeight:"15",viewBox:"0 0 15 15",refX:"6",refY:"6",orient:"auto"}},[i("path",{staticStyle:{fill:"#4672c4"},attrs:{d:"M2,0 L10,6 L2,12 L6,6 L2,0"}})])]),t._v(" "),t._l(t.stageList,function(e){return i("g",{key:e.rowAnchorPoint},[i("text",{staticClass:"top-process",attrs:{x:e.xAxion,y:"20"}},[t._v("\n            "+t._s(e.title)+"\n          ")]),t._v(" "),i("line",{staticStyle:{stroke:"#eceef6","stroke-width":"2"},attrs:{x1:e.xAxionLine,y1:"0",x2:e.xAxionLine,y2:t.svgHeight}})])}),t._v(" "),i("line",{staticStyle:{stroke:"#eceef6","stroke-width":"2"},attrs:{x1:"40",y1:"0",x2:"40",y2:t.svgHeight}}),t._v(" "),t._l(t.positionList,function(e,n){return i("g",{key:e.columnAnchorPoint},[i("text",{staticClass:"top-process left-slide",attrs:{x:"30",y:t.topSpace+t.defaultHeight/2*(2*n+1)}},[t._v("\n            "+t._s(e.title.replace(/（/g,"(").split("(")[0])+"\n        ")]),t._v(" "),i("line",{staticStyle:{stroke:"#eceef6","stroke-width":"2"},attrs:{x1:"0",y1:t.topSpace+t.defaultHeight*n,x2:t.topSpace+t.svgWidth,y2:t.topSpace+t.defaultHeight*n}})])}),t._v(" "),i("line",{staticStyle:{stroke:"#eceef6","stroke-width":"2"},attrs:{x1:"0",y1:t.svgHeight,x2:t.topSpace+t.svgWidth,y2:t.svgHeight}}),t._v(" "),t._l(t.nodeList,function(e){return i("g",{key:e.id},["-2"===e.listId||"-3"==e.listId?i("ellipse",{staticStyle:{fill:"#cd5334",stroke:"cd5334","stroke-width":"1"},attrs:{cx:e.xAxion+t.nodeWidth/2,cy:e.yAxion,rx:t.nodeWidth/2,ry:t.nodeHeight/2}}):i("rect",{attrs:{x:e.xAxion,y:e.yAxion-t.nodeHeight/2,width:t.nodeWidth,height:t.nodeHeight,stroke:"#df8931",fill:"#df8931","stroke-width":"1"}}),t._v(" "),i("foreignObject",{attrs:{x:e.xAxion,y:e.yAxion-t.nodeHeight/2,height:t.nodeHeight,width:t.nodeWidth}},[i("body",{staticStyle:{"background-color":"transparent"},attrs:{xmlns:"http://www.w3.org/2000/svg"}},[i("div",{staticStyle:{color:"#fff","font-size":"12px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"100%","text-align":"center"}},[t._v("\n                  "+t._s(e.name)+"\n                ")])])])],1)}),t._v(" "),t._l(t.polyLineList,function(t,e){return i("g",{key:t.id+"_"+e},[i("polyline",{staticStyle:{fill:"none",stroke:"#4672c4","stroke-width":"2"},attrs:{points:t.value,"marker-end":"url(#arrow)"}})])}),t._v("Z\n    ")],2)]),t._v(" "),i("div",{staticClass:"config-action"},[i("input",{staticClass:"config-action-submit",attrs:{type:"submit",value:"编辑"},on:{click:t.handleEditGraph}})])],1)},staticRenderFns:[]};var a=i("VU/8")(d,r,!1,function(t){i("PJIB")},null,null);e.default=a.exports},PJIB:function(t,e){},p2vK:function(t,e,i){"use strict";var n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("svg",[i("circle",{attrs:{cx:t.xAxion,cy:t.yAxion,r:"25",fill:t.color}}),t._v(" "),i("text",{staticClass:"svg-text-common-style",staticStyle:{"font-size":"14px","font-weight":"bold"},attrs:{x:t.xAxion,y:t.yAxion-6,fill:"#fff"}},[t._v("\n            "+t._s(t.text)+"\n    ")])])},staticRenderFns:[]},o=i("VU/8")({props:["xAxion","yAxion","color","text"]},n,!1,null,null,null);e.a=o.exports}});