{"source":"webpackJsonp([13],{JUNF:function(e,t,s){\"use strict\";s.d(t,\"c\",function(){return o}),s.d(t,\"d\",function(){return a}),s.d(t,\"e\",function(){return i}),s.d(t,\"f\",function(){return r}),s.d(t,\"h\",function(){return l}),s.d(t,\"a\",function(){return c}),s.d(t,\"g\",function(){return d}),s.d(t,\"b\",function(){return u});var n=s(\"7B+g\"),o=function(e,t,s){return Object(n.a)(\"/H_roleplay-si/kb/query\",{page:e,limit:t,search:s})},a=function(){return Object(n.a)(\"/H_roleplay-si/base/dict/getListByValue\",{value:\"KnowledgeBaseType\"})},i=function(e){return Object(n.a)(\"/H_roleplay-si/kb/queryById\",{id:e})},r=function(e){return Object(n.a)(\"/H_roleplay-si/kb/save\",{},\"POST\",e)},l=function(e){return Object(n.a)(\"/H_roleplay-si/kb/update\",{},\"POST\",e)},c=function(e){return Object(n.a)(\"/H_roleplay-si/kb/delete\",{},\"POST\",e)},d=function(e){return Object(n.a)(\"/H_roleplay-si/base/dict/saveByValue\",{},\"POST\",e)},u=function(e){return Object(n.a)(\"/H_roleplay-si/base/dict/delete\",{id:e},\"POST\")}},PDH2:function(e,t){e.exports={render:function(){var s=this,e=s.$createElement,n=s._self._c||e;return n(\"div\",{staticClass:\"bg_ff \"},[n(\"Row\",{staticClass:\"comment-knowledge\"},[n(\"div\",{staticClass:\"commnet-title\"},[s._v(\"评论 \\n          \"),n(\"span\",{staticClass:\"fr subscribe-bar\"},[n(\"span\",[1==s.subscribeInfo.isSubscribe&&s.subcribeVisible?n(\"span\",{staticClass:\"subcribeing\",on:{mouseover:function(e){s.unsubcribeVisible=!0,s.subcribeVisible=!1},mouseout:function(e){s.unsubcribeVisible=!1,s.subcribeVisible=!0}}},[n(\"Icon\",{staticClass:\"success-color\",attrs:{type:\"md-checkmark\"}}),s._v(\"正在关注中\\n                  \")],1):s._e(),s._v(\" \"),1==s.subscribeInfo.isSubscribe&&s.unsubcribeVisible?n(\"span\",{staticClass:\"unsubcribe\",on:{click:s.handleUnsubscribeApp,mouseout:function(e){s.unsubcribeVisible=!1,s.subcribeVisible=!0}}},[n(\"Icon\",{staticClass:\"warning-color\",attrs:{type:\"md-close\"}}),s._v(\"取消关注\\n                  \")],1):s._e(),s._v(\" \"),0==s.subscribeInfo.isSubscribe?n(\"span\",{staticClass:\"subcribe\",on:{click:s.handleSubscribeApp}},[s._v(\"关注\")]):s._e(),s._v(\" \"),n(\"span\",[n(\"Icon\",{staticClass:\"success-color\",attrs:{type:\"md-notifications\",size:\"18\"}})],1)]),s._v(\" \"),n(\"span\",[n(\"Dropdown\",{staticClass:\"user-dropdown\",attrs:{trigger:\"click\"},on:{\"on-click\":s.addSubscribeUsers}},[n(\"Icon\",{attrs:{type:\"md-person\",size:\"18\"}}),s._v(\" \"),n(\"b\",[s._v(s._s(s.subscribeInfo.subscribeNum))]),s._v(\" \"),n(\"Icon\",{attrs:{type:\"ios-arrow-down\"}}),s._v(\" \"),n(\"DropdownMenu\",{attrs:{slot:\"list\"},slot:\"list\"},[n(\"DropdownItem\",{attrs:{name:\"add\"}},[s._v(\"\\n                             添加关注者\\n                          \")]),s._v(\" \"),s._l(s.subscribeInfo.subscribeUsers,function(t,e){return n(\"DropdownItem\",{key:e},[s._v(\"\\n                             \"+s._s(t.nickname)+\"\\n                             \"),n(\"span\",{staticClass:\"delete-user\",on:{click:function(e){e.stopPropagation(),s.deleteSubscribeUsers(t.userId,t.nickname)}}},[n(\"Icon\",{attrs:{type:\"md-close\"}})],1)])})],2)],1)],1)])])]),s._v(\" \"),n(\"Row\",{staticClass:\"user-comment\"},[n(\"commentPublish\",{attrs:{handlePublish:s.handlePublish}})],1),s._v(\" \"),n(\"user-selector\",{attrs:{showUserSelector:s.showUserModal,commentData:s.commentData},on:{emitUserModal:s.emitUserModal,userModalData:s.getUserModalData}})],1)},staticRenderFns:[]}},eIY0:function(e,t){},eTsG:function(e,t,s){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(\"woOf\"),o=s.n(n),a=s(\"mvHQ\"),i=s.n(a),r=s(\"Gu7T\"),l=s.n(r),c=s(\"JUNF\"),d=s(\"GIAq\"),u=s(\"U18u\"),m=s(\"bJtM\"),p=s(\"ejmB\"),f=s(\"CaXr\"),h=s(\"bTqw\"),g={name:\"userComments\",components:{comments:m.a,commentPublish:p.a,UserSelector:f.a},props:{listId:{type:String,default:\"\"},type:{type:String,default:\"\"}},data:function(){return{comments:[],commentsCount:0,pageInfo:{limit:10,page:1,total:0},unsubcribeVisible:!1,subcribeVisible:!0,showUserModal:!1,subscribeInfo:{isSubscribe:0,subscribeNum:0,subscribeUsers:[]},commentData:{relationkey:this.listId,type:this.type}}},methods:{emitUserModal:function(){this.showUserModal=!1},getUserModalData:function(e){var t=this,s=[],n={};e.forEach(function(e){s.push(e.userId)}),0<s.length&&(n={relationKey:this.listId,type:this.type,userIds:s.join(\",\")},Object(u.a)(n).then(function(e){e.success&&(t.$Message.success(e.message),t.refreshSubscribeInfo(),t.judgeIsSubscribeByRelationKey())}).catch(function(e){t.$Message.error(e.data.message)}))},addSubscribeUsers:function(e){\"add\"===e&&(this.showUserModal=!0)},deleteSubscribeUsers:function(e,t){var s=this,n={relationKey:this.listId,userIds:e,type:this.type};this.$Modal.confirm({title:\"确认\",content:\"确认退订<b style=color:#e4393c;>\"+t+\"</b>么？\",onOk:function(){Object(u.b)(n).then(function(e){e.success&&(s.$Message.success(e.message),s.refreshSubscribeInfo(),s.judgeIsSubscribeByRelationKey())}).catch(function(e){s.$Message.error(e.data.message)})}})},handlePublish:function(e,t){var s=this,n={type:this.type,content:e,relationKey:this.listId,parentId:-1,commentAndReply:!1,commentAttachments:t};Object(d._9)(n).then(function(e){e.success?s.$emit(\"updateComment\"):s.$Notice.warning({title:\"系统提示\",desc:e.message})})},handleSubscribeApp:function(){var t=this;Object(u.e)({type:this.type,relationKey:this.listId}).then(function(e){t.subscribeInfo.isSubscribe=1,t.refreshSubscribeInfo()})},handleUnsubscribeApp:function(e){var t=this;Object(u.f)({relationKey:this.listId,type:this.type}).then(function(e){t.subscribeInfo.isSubscribe=0,t.refreshSubscribeInfo()})},refreshSubscribeInfo:function(){var t=this;this.$forceUpdate(),Object(u.c)({relationKey:this.listId,type:this.type,limit:1e3,page:1}).then(function(e){t.subscribeInfo.subscribeUsers=e.tableContent,t.subscribeInfo.subscribeNum=e.dataCount})},judgeIsSubscribeByRelationKey:function(e){var t=this;Object(u.d)({relationKey:this.listId,type:this.type}).then(function(e){t.subscribeInfo.isSubscribe=e})}},mounted:function(){this.refreshSubscribeInfo(),this.judgeIsSubscribeByRelationKey()}},b=s(\"PDH2\"),w=s.n(b);var y=function(e){s(\"u/2t\")},v=s(\"VU/8\")(g,w.a,!1,y,\"data-v-2a30a095\",null).exports,k=s(\"sYY+\"),I=s.n(k),_=s(\"uTVu\"),C=s(\"yqpi\"),M={name:\"KnowledgeView\",components:{commentPublish:v,comments:m.a,AddModal:C.a},data:function(){return{knowledgeId:this.$route.params.id,comments:[],pageInfo:{limit:10,page:1,total:0},knowledgeForm:{title:\"\",type:\"\",content:\"\",creator:\"\",crtTime:\"\"}}},watch:{$route:function(e){this.getKnowledgeDataById(e.params.id),this.knowledgeId=e.params.id,this.refreshComments()}},methods:{editUpdate:function(){_.a.$emit(\"refreshList\"),this.getKnowledgeDataById(this.knowledgeId)},updateComment:function(){this.refreshComments()},refreshComments:function(){var t=this,s=[].concat(l()(h.b)),n=/\\[(.+?)\\]/g,e={relationKey:this.knowledgeId,sort:i()([{property:\"crtTime\",direction:\"DESC\"}])};e=o()(e,this.pageInfo),Object(d.K)(e).then(function(e){e.tableContent.forEach(function(e){e.content=e.content.replace(n,function(t){var e=s.findIndex(function(e){return e===t.replace(/(\\[|\\])/g,\"\")});return-1===e?t:'<span class=\"comments-content-item-content-img-emotion\" style=\"background-position: -'+24*e+'px 0;\"></span>'})}),t.comments=e.tableContent,t.pageInfo.total=e.dataCount})},handlePageChange:function(e){this.pageInfo.page=e,this.refreshComments()},errorimg:function(){this.knowledgeForm.photo=\"resources/images/icon/defaultUserPhoto.png\"},goBack:function(){this.$router.push({path:\"/knowledge/list\"})},editKnowledge:function(){this.$router.push({name:\"knowledgeDetail\",path:\"/knowledge/detail/\"+this.$route.params.id,params:{id:this.$route.params.id}})},getKnowledgeDataById:function(e){var t=this;Object(c.e)(e).then(function(e){t.knowledgeForm=e,t.editor=new I.a(t.$refs.toolbar,t.$refs.text),t.editor.create()})},onClickMenu:function(e){\"delete\"===e?this.deleteKnowledge():(this.$refs.addModal.showKnowledgeModal=!0,this.$refs.addModal.getKnowledgeDataById())},deleteKnowledge:function(){var t=this,e=[];this.$Modal.confirm({title:\"确认\",content:\"确认删除当前选择项么？\",onOk:function(){e.push(t.knowledgeId),Object(c.a)(e).then(function(e){e.success&&(t.$Message.success(e.message),_.a.$emit(\"refreshList\"))}).catch(function(e){t.$Message.error(e.data.message)})}})}},created:function(){this.refreshComments(),this.getKnowledgeDataById(this.knowledgeId)}},$=s(\"uUCD\"),S=s.n($);var K=function(e){s(\"gjrm\")},V=s(\"VU/8\")(M,S.a,!1,K,\"data-v-f40a8b96\",null);t.default=V.exports},gjrm:function(e,t){},tiqd:function(e,t){e.exports={render:function(){var n=this,e=n.$createElement,o=n._self._c||e;return o(\"Modal\",{attrs:{fullscreen:\"\",title:n.modalTitle},model:{value:n.showKnowledgeModal,callback:function(e){n.showKnowledgeModal=e},expression:\"showKnowledgeModal\"}},[o(\"div\",{staticClass:\"knowledge\"},[o(\"Row\",{staticClass:\"knowledge-form\"},[o(\"Form\",{ref:\"formValidate\",attrs:{\"label-width\":120,model:n.knowledgeForm,rules:n.ruleValidate}},[o(\"FormItem\",{attrs:{label:\"\"}},[o(\"Row\",[o(\"Col\",{staticStyle:{\"margin-left\":\"-121px\"},attrs:{span:\"12\"}},[o(\"FormItem\",{attrs:{prop:\"title\",label:\"标题:\"}},[o(\"Input\",{staticStyle:{width:\"300px\"},model:{value:n.knowledgeForm.title,callback:function(e){n.$set(n.knowledgeForm,\"title\",e)},expression:\"knowledgeForm.title\"}})],1)],1),n._v(\" \"),o(\"Col\",{attrs:{span:\"12\"}},[o(\"FormItem\",{attrs:{prop:\"type\",label:\"分类:\"}},[o(\"Select\",{ref:\"typeSelect\",staticStyle:{width:\"300px\"},attrs:{transfer:!1},model:{value:n.knowledgeForm.type,callback:function(e){n.$set(n.knowledgeForm,\"type\",e)},expression:\"knowledgeForm.type\"}},[n._l(n.typeList,function(t,s){return o(\"Option\",{key:t.id,attrs:{value:t.value}},[n._v(\"\\n                            \"+n._s(t.name)+\"\\n                            \"),o(\"span\",{staticClass:\"type-edit\",on:{click:function(e){e.stopPropagation(),n.deleteType(t,s)}}},[o(\"Icon\",{attrs:{type:\"md-close\"}})],1)])}),n._v(\" \"),o(\"Option\",{attrs:{value:\"addType\"}},[o(\"span\",{staticClass:\"add-type\",on:{click:n.showAddTypeModal}},[o(\"Icon\",{attrs:{type:\"md-add\"}})],1)])],2)],1)],1)],1)],1),n._v(\" \"),o(\"FormItem\",{staticStyle:{\"margin-bottom\":\"65px\"},attrs:{label:\"内容:\",prop:\"content\"}},[o(\"div\",{ref:\"editor\",staticClass:\"knowledge-editor\"})])],1)],1),n._v(\" \"),o(\"Row\",{staticClass:\"knowledge-save\"},[o(\"span\",{staticClass:\"knowledge-save-btn\",on:{click:function(e){n.saveKnowledge(\"save\")}}},[n._v(\"保存\")]),n._v(\" \"),o(\"span\",{staticClass:\"knowledge-save-btn\",on:{click:n.saveKnowledge}},[n._v(\"保存并继续添加\")])]),n._v(\" \"),o(\"Modal\",{attrs:{title:\"添加分类\",styles:{top:\"20px\"},transfer:!1},model:{value:n.showModal,callback:function(e){n.showModal=e},expression:\"showModal\"}},[o(\"Form\",{ref:\"typeValidate\",attrs:{model:n.typeValidate,rules:n.typeRuleValidate,\"label-width\":80}},[o(\"FormItem\",{attrs:{label:\"名称\",prop:\"name\"}},[o(\"Input\",{attrs:{autofocus:\"\"},model:{value:n.typeValidate.name,callback:function(e){n.$set(n.typeValidate,\"name\",e)},expression:\"typeValidate.name\"}})],1)],1),n._v(\" \"),o(\"div\",{attrs:{slot:\"footer\"},slot:\"footer\"},[o(\"Button\",{attrs:{type:\"primary\"},on:{click:n.confirmAdd}},[n._v(\"确定\")]),n._v(\" \"),o(\"Button\",{attrs:{type:\"default\"},on:{click:n.cancelAdd}},[n._v(\"取消\")])],1)],1)],1),n._v(\" \"),o(\"div\",{attrs:{slot:\"footer\"},slot:\"footer\"})])},staticRenderFns:[]}},\"u/2t\":function(e,t){},uUCD:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"knowledge\"},[s(\"Row\",{staticClass:\"knowledge-header\"},[s(\"div\",{staticClass:\"knowledge-header-drop\"},[s(\"Dropdown\",{attrs:{trigger:\"click\",transfer:\"\"},on:{\"on-click\":e.onClickMenu}},[s(\"a\",{attrs:{href:\"javascript:void(0)\"}},[s(\"Tooltip\",{attrs:{content:\"更多操作\",transfer:\"\",placement:\"left-start\"}},[s(\"b\",{staticClass:\"knowledge-header-point\",attrs:{type:\"ios-arrow-down\"}},[e._v(\"...\")])])],1),e._v(\" \"),s(\"DropdownMenu\",{attrs:{slot:\"list\"},slot:\"list\"},[s(\"DropdownItem\",{attrs:{name:\"edit\"}},[e._v(\"编辑知识\")]),e._v(\" \"),s(\"DropdownItem\",{attrs:{name:\"delete\"}},[e._v(\"删除知识\")])],1)],1)],1)]),e._v(\" \"),s(\"Row\",{staticClass:\"knowledge-content\"},[s(\"Row\",{staticClass:\"knowledge-title\"},[s(\"span\",[e._v(e._s(e.knowledgeForm.title))])]),e._v(\" \"),s(\"Row\",{staticClass:\"knowledge-text\"},[s(\"div\",{ref:\"toolbar\",staticStyle:{display:\"none\"}}),e._v(\" \"),s(\"div\",{ref:\"text\",staticStyle:{display:\"none\"}}),e._v(\" \"),s(\"div\",{staticClass:\"w-e-text\",domProps:{innerHTML:e._s(e.knowledgeForm.content)}}),e._v(\" \"),0<e.comments.length?s(\"div\",{staticClass:\"knowledge-text-comment\"},[s(\"div\",[e._v(\"最新评论(\"+e._s(e.pageInfo.total)+\")\")]),e._v(\" \"),s(\"comments\",{attrs:{comments:e.comments,refreshRootComments:e.refreshComments}}),e._v(\" \"),0<e.pageInfo.total?s(\"Page\",{staticStyle:{\"padding-top\":\"10px\"},attrs:{total:e.pageInfo.total,\"page-size\":e.pageInfo.limit,current:e.pageInfo.page,\"prev-text\":\"上一页\",\"next-text\":\"下一页\"},on:{\"on-change\":e.handlePageChange}}):e._e()],1):e._e()])],1),e._v(\" \"),s(\"Row\",{staticClass:\"knowledge-footer\"},[s(\"div\",{staticStyle:{\"margin-right\":\"260px\"}},[s(\"comment-publish\",{attrs:{listId:e.knowledgeId,type:\"knowledge\"},on:{updateComment:e.updateComment}})],1)]),e._v(\" \"),s(\"add-modal\",{ref:\"addModal\",attrs:{modalTitle:\"编辑知识\",knowledgeId:this.knowledgeId},on:{editUpdate:e.editUpdate}})],1)},staticRenderFns:[]}},yqpi:function(e,t,s){\"use strict\";var n=s(\"JUNF\"),o=s(\"sYY+\"),a=s.n(o),i=s(\"uTVu\"),r={name:\"KnowledgeDetail\",components:{},props:{modalTitle:String,knowledgeId:{type:[String,Boolean]}},data:function(){return{isEdit:!1,showModal:!1,showKnowledgeModal:!1,copyKnowledgeId:this.knowledgeId,typeValidate:{name:\"\",value:\"\"},typeRuleValidate:{name:[{required:!0,message:\"请输入名称\",trigger:\"blur\"}]},knowledgeForm:{title:\"\",type:\"\",content:\"\"},typeList:[],ruleValidate:{title:[{required:!0,message:\"请输入标题\",trigger:\"blur\"}],type:[{required:!0,message:\"请选择分类\",trigger:\"change\"}],content:[{required:!0,message:\" \",trigger:\"blur\"}]}}},methods:{showAddTypeModal:function(){this.showModal=!0,this.$refs.typeValidate.resetFields(),this.typeValidate.edit=!1},cancelAdd:function(){this.showModal=!1},confirmAdd:function(){var t=this,s={};this.$refs.typeValidate.validate(function(e){e&&((s=t.typeValidate.edit?{name:t.typeValidate.name,value:\"KnowledgeBaseType\",id:t.typeValidate.id}:{name:t.typeValidate.name,value:\"KnowledgeBaseType\"})&&Object(n.g)(s).then(function(e){e.success&&(t.$Message.success(e.message),t.getAllKnowledgeTypeData())}).catch(function(e){t.$Message.error(e.data.message)}),t.showModal=!1)})},editType:function(e,t){this.$refs.typeSelect.hideMenu(),this.typeValidate.id=e.id,this.typeValidate.name=e.name,this.typeValidate.edit=!0,this.showModal=!0},deleteType:function(t,e){var s=this;this.$refs.typeSelect.hideMenu(),this.$Modal.confirm({title:\"确认\",content:\"确认删除<b style=color:#e4393c;>\"+t.name+\"</b>么？\",onOk:function(){Object(n.b)(t.id).then(function(e){e.success&&(s.$Message.success(e.message),s.knowledgeForm.type===t.value&&(s.knowledgeForm.type=\"\"),s.getAllKnowledgeTypeData())}).catch(function(e){s.$Message.error(e.data.message)})}})},saveKnowledge:function(t){var s=this;\"<p><br></p>\"===this.editor.txt.html()?this.$Message.error(\"必填项请输入！\"):this.knowledgeForm.content=this.editor.txt.html(),this.$refs.formValidate.validate(function(e){e&&(s.copyKnowledgeId?(s.knowledgeForm.id=s.knowledgeId,Object(n.h)(s.knowledgeForm).then(function(e){e.success&&(s.$Message.success(e.message),s.$emit(\"editUpdate\"),\"save\"===t?s.showKnowledgeModal=!1:(s.copyKnowledgeId=!1,s.knowledgeForm.content=\"\",s.$refs.formValidate.resetFields(),s.editor.txt.html(\"<span></span>\")))}).catch(function(e){s.$Message.error(e.data.message)})):Object(n.f)(s.knowledgeForm).then(function(e){e.success&&(s.$Message.success(e.message),i.a.$emit(\"addUpdate\"),\"save\"===t?s.showKnowledgeModal=!1:(s.knowledgeForm.content=\"\",s.$refs.formValidate.resetFields(),s.editor.txt.html(\"<span></span>\")))}).catch(function(e){s.$Message.error(e.data.message)}))})},getAllKnowledgeTypeData:function(){var t=this;Object(n.d)().then(function(e){t.typeList=e})},getKnowledgeDataById:function(){var t=this;this.knowledgeId&&Object(n.e)(this.knowledgeId).then(function(e){t.knowledgeForm.title=e.title,t.knowledgeForm.type=e.type,t.knowledgeForm.content=e.content,t.createEditor(e.content)})},createEditor:function(e){var t=this,s=e||\"\";this.editor=new a.a(this.$refs.editor),this.editor.customConfig.onchange=function(e){t.knowledgeForm.content=e},this.editor.customConfig.uploadImgShowBase64=!0,this.editor.customConfig.zIndex=100,this.editor.create(),this.editor.$textContainerElem[0].style.height=\"400px\",this.editor.txt.html(\"<span>\"+s+\"</span>\")}},mounted:function(){this.createEditor()},created:function(){this.getAllKnowledgeTypeData(),this.getKnowledgeDataById()}},l=s(\"tiqd\"),c=s.n(l);var d=function(e){s(\"eIY0\")},u=s(\"VU/8\")(r,c.a,!1,d,null,null);t.a=u.exports}});"}