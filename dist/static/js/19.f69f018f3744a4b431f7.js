webpackJsonp([19],{"8NPY":function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=e("GIAq"),n=e("sYY+"),a=e.n(n),o={name:"admintrstorAssessment",components:{AssessModal:e("lZCD").a},props:{isAdmin:{type:Boolean}},data:function(){return{listId:this.$route.params.listId,showAssessModal:!1,isPage:!0,isEdit:"",IsEditId:"",changeResult:"",page:{total:0,current:1,pageSize:10},adminAssessData:{duringDate:"",result:"",opportunity:""},ruleValidate:{duringDate:[{type:"date",required:!0,message:"不允许为空"}],result:[{required:!0,message:" "}],opportunity:[{required:!0,message:" "}]},assessments:[]}},methods:{addAssess:function(){this.showAssessModal=!0,this.$refs.formValidate.resetFields()},submitAdminAssess:function(){var t=this;"<span></span>"===this.opporeditor.txt.html()?this.$Message.error("必填项请输入！"):"<span></span>"===this.resulteditor.txt.html()?this.$Message.error("必填项请输入！"):(this.adminAssessData.opportunity=this.opporeditor.txt.html(),this.adminAssessData.result=this.resulteditor.txt.html());var s={listId:this.listId,chance:this.adminAssessData.opportunity,achievement:this.adminAssessData.result,date:this.formatDate(this.adminAssessData.duringDate)};"edit"===this.isEdit&&(s.id=this.IsEditId);var e=!1;this.$refs.formValidate.validate(function(t){e=t}),e&&Object(i.X)(s).then(function(s){s.success?(t.$Message.success(s.message),t.getAssessmentData(),t.showAssessModal=!1,t.$refs.formValidate.resetFields(),t.resulteditor.txt.html("<span></span>"),t.opporeditor.txt.html("<span></span>"),t.isEdit=""):t.$Message.error(s.message)})},getAssessmentData:function(t){var s=this;Object(i.z)(this.listId,this.page.pageSize,t).then(function(t){s.assessments=t.tableContent,s.page.total=t.dataCount,0===t.tableContent.length?s.isPage=!1:s.isPage=!0,s.resulteditor||s.createEditor()})},onPageChange:function(t){this.getAssessmentData(t)},formatDate:function(t,s){var e=new Date(t),i=e.getFullYear(),n=e.getMonth()+1;return n>=1&&n<=9&&(n="0"+n),s?i+"-"+n:i+"-"+n+"-1"},createEditor:function(){var t=this;this.resulteditor=new a.a(this.$refs.resulteditor),this.resulteditor.customConfig.onchange=function(s){t.modalFormData.content=s},this.resulteditor.customConfig.zIndex=100,this.resulteditor.customConfig.menus=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","code","undo","redo"],this.resulteditor.create(),this.resulteditor.txt.html("<span></span>"),this.opporeditor=new a.a(this.$refs.opporeditor),this.opporeditor.customConfig.onchange=function(s){t.modalFormData.content=s},this.opporeditor.customConfig.zIndex=100,this.opporeditor.customConfig.menus=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","code","undo","redo"],this.opporeditor.create(),this.opporeditor.txt.html("<span></span>")}},created:function(){this.getAssessmentData(this.page.current)}},r={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"bg_ff",staticStyle:{"margin-bottom":"10px"}},[e("div",[e("Row",{staticClass:"app-resource-group-title"},[e("h3",[t._v("管理员自评\n      ")])]),t._v(" "),t.isAdmin?e("Row",{staticClass:"assessmentForm pad15"},[e("Form",{ref:"formValidate",attrs:{"label-width":150,model:t.adminAssessData,rules:t.ruleValidate}},[e("FormItem",{attrs:{label:"期间（月份）:",prop:"duringDate"}},[e("DatePicker",{staticStyle:{width:"200px"},attrs:{format:"yyyy-MM",type:"month",placeholder:"选择日期"},model:{value:t.adminAssessData.duringDate,callback:function(s){t.$set(t.adminAssessData,"duringDate",s)},expression:"adminAssessData.duringDate"}})],1),t._v(" "),e("FormItem",{staticStyle:{"margin-bottom":"65px"},attrs:{label:"效率与成本改进成果:",prop:"result"}},[e("div",{ref:"resulteditor"})]),t._v(" "),e("FormItem",{staticStyle:{"margin-bottom":"40px"},attrs:{label:"效率与成本改进机会:",prop:"opportunity"}},[e("div",{ref:"opporeditor"})])],1),t._v(" "),e("div",{staticStyle:{"text-align":"right","margin-bottom":"5px"}},[e("Button",{staticClass:"radius0",staticStyle:{"background-color":"rgb(0, 150, 136) !important",color:"#fff","margin-top":"5px"},on:{click:t.submitAdminAssess}},[t._v("提交")])],1)],1):t._e(),t._v(" "),t._l(t.assessments,function(s,i){return e("div",{key:i,staticClass:"pad10 bg_ff assessmentItem"},[e("img",{staticClass:"user-icon",attrs:{src:s.photo?s.photo:"resources/images/icon/contactor.png"}}),t._v(" "),e("div",{staticClass:"font14 content"},[e("div",[e("h4",[t._v(t._s(s.creator)+"\n            "),e("span",{staticClass:"fr"},[t._v(t._s(t.formatDate(s.date,!0)))])])]),t._v(" "),e("div",{staticClass:"assessment-info"},[e("div",[e("span",{staticStyle:{color:"#a06970"}},[t._v("改进成果:")]),t._v(" "),e("div",{staticClass:"assessment-info-text",domProps:{innerHTML:t._s(s.achievement)}})]),t._v(" "),e("div",[e("span",{staticStyle:{color:"#a06970"}},[t._v("改进机会:")]),t._v(" "),e("div",{staticClass:"assessment-info-text",domProps:{innerHTML:t._s(s.chance)}})])])])])}),t._v(" "),0===t.assessments.length?e("div",{staticClass:"pad10 bg_ff assessmentItem"},[t._v("暂无数据")]):t._e(),t._v(" "),t.isPage?e("div",{staticClass:"pad20 bg_ff assessmentItem"},[e("Page",{attrs:{total:t.page.total,current:t.page.current,"page-size":t.page.pageSize,"prev-text":"上一页","next-text":"下一页"},on:{"on-change":t.onPageChange}})],1):t._e()],2)])},staticRenderFns:[]};var c=e("VU/8")(o,r,!1,function(t){e("AD9U")},"data-v-45be7890",null).exports,l=e("woOf"),u=e.n(l),d=e("mvHQ"),m=e.n(d),p=e("U18u"),h=e("bJtM"),b=e("ejmB"),f=e("CaXr"),g={name:"userComments",components:{comments:h.a,commentPublish:b.a,UserSelector:f.a},props:{},data:function(){return{listId:this.$route.params.listId,type:"list",comments:[],commentsCount:0,pageInfo:{limit:10,page:1,total:0},unsubcribeVisible:!1,subcribeVisible:!0,showUserModal:!1,subscribeInfo:{isSubscribe:0,subscribeNum:0,subscribeUsers:[]}}},methods:{emitUserModal:function(){this.showUserModal=!1},getUserModalData:function(t){var s=this,e=[],i={};t.forEach(function(t){e.push(t.userId)}),e.length>0&&(i={relationKey:this.listId,type:this.type,userIds:e.join(",")},Object(p.a)(i).then(function(t){t.success&&(s.$Message.success(t.message),s.refreshSubscribeInfo())}).catch(function(t){s.$Message.error(t.data.message)}))},addSubscribeUsers:function(t){"add"===t&&(this.showUserModal=!0)},deleteSubscribeUsers:function(t,s){var e=this,i={relationKey:this.listId,userIds:t,type:this.type};this.$Modal.confirm({title:"确认",content:"确认退订<b style=color:#e4393c;>"+s+"</b>么？",onOk:function(){Object(p.b)(i).then(function(t){t.success&&(e.$Message.success(t.message),e.refreshSubscribeInfo())}).catch(function(t){e.$Message.error(t.data.message)})}})},handlePublish:function(t,s){var e=this,n={type:this.type,content:t,relationKey:this.listId,parentId:-1,commentAndReply:!1,commentAttachments:s};Object(i.Y)(n).then(function(t){t.success?e.refreshComments():e.$Notice.warning({title:"系统提示",desc:"添加评论失败,请联系企业管理员!"})})},refreshComments:function(){var t=this,s={relationKey:this.listId,sort:m()([{property:"crtTime",direction:"DESC"}])};s=u()(s,this.pageInfo),Object(i.D)(s).then(function(s){t.comments=s.tableContent,t.pageInfo.total=s.dataCount})},handlePageChange:function(t){this.pageInfo.page=t,this.refreshComments()},handleSubscribeApp:function(){var t=this;Object(p.e)({type:"list",relationKey:this.listId}).then(function(s){t.subscribeInfo.isSubscribe=1,t.refreshSubscribeInfo()})},handleUnsubscribeApp:function(t){var s=this;Object(p.f)({relationKey:this.listId,type:this.type}).then(function(t){s.subscribeInfo.isSubscribe=0,s.refreshSubscribeInfo()})},refreshSubscribeInfo:function(){var t=this;this.$forceUpdate(),Object(p.c)({relationKey:this.listId,type:this.type,limit:10,page:1}).then(function(s){t.subscribeInfo.subscribeUsers=s.tableContent,t.subscribeInfo.subscribeNum=s.dataCount})},judgeIsSubscribeByRelationKey:function(t){var s=this;Object(p.d)({relationKey:this.listId,type:this.type}).then(function(t){s.subscribeInfo.isSubscribe=t})}},mounted:function(){this.refreshComments(),this.refreshSubscribeInfo(),this.judgeIsSubscribeByRelationKey()}},v={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"bg_ff "},[e("Row",{staticClass:"app-resource-group-title"},[e("h3",[t._v("评论 \n          "),e("b",{staticClass:"fr subscribe-bar"},[e("span",[1==t.subscribeInfo.isSubscribe&&t.subcribeVisible?e("span",{staticClass:"subcribeing",on:{mouseover:function(s){t.unsubcribeVisible=!0,t.subcribeVisible=!1},mouseout:function(s){t.unsubcribeVisible=!1,t.subcribeVisible=!0}}},[e("Icon",{staticClass:"success-color",attrs:{type:"md-checkmark"}}),t._v("正在关注中\n                  ")],1):t._e(),t._v(" "),1==t.subscribeInfo.isSubscribe&&t.unsubcribeVisible?e("span",{staticClass:"unsubcribe",on:{click:t.handleUnsubscribeApp,mouseout:function(s){t.unsubcribeVisible=!1,t.subcribeVisible=!0}}},[e("Icon",{staticClass:"warning-color",attrs:{type:"md-close"}}),t._v("取消关注\n                  ")],1):t._e(),t._v(" "),0==t.subscribeInfo.isSubscribe?e("span",{staticClass:"subcribe",on:{click:t.handleSubscribeApp}},[t._v("关注")]):t._e(),t._v(" "),e("span",[e("Icon",{staticClass:"success-color",attrs:{type:"md-notifications",size:"18"}})],1)]),t._v(" "),e("span",[e("Dropdown",{staticStyle:{"margin-left":"20px"},attrs:{trigger:"click"},on:{"on-click":t.addSubscribeUsers}},[e("Icon",{attrs:{type:"md-person",size:"18"}}),t._v(" "+t._s(t.subscribeInfo.subscribeNum)+"\n                       "),e("Icon",{attrs:{type:"ios-arrow-down"}}),t._v(" "),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{name:"add"}},[t._v("\n                             添加关注者\n                          ")]),t._v(" "),t._l(t.subscribeInfo.subscribeUsers,function(s,i){return e("DropdownItem",{key:i},[t._v("\n                             "+t._s(s.nickname)+"\n                             "),e("span",{staticClass:"delete-user",on:{click:function(e){e.stopPropagation(),t.deleteSubscribeUsers(s.userId,s.nickname)}}},[e("Icon",{attrs:{type:"md-close"}})],1)])})],2)],1)],1)])])]),t._v(" "),e("Row",{staticClass:"user-comment"},[e("commentPublish",{attrs:{handlePublish:t.handlePublish}}),t._v(" "),t.comments.length>0?e("div",{staticClass:"user-comment-header"},[e("strong",[t._v("最新评论("+t._s(t.pageInfo.total)+")")])]):t._e(),t._v(" "),e("comments",{attrs:{comments:t.comments,refreshRootComments:t.refreshComments}}),t._v(" "),t.pageInfo.total>0?e("Page",{staticClass:"pad20",attrs:{total:t.pageInfo.total,"page-size":t.pageInfo.limit,current:t.pageInfo.page,"prev-text":"上一页","next-text":"下一页"},on:{"on-change":t.handlePageChange}}):t._e()],1),t._v(" "),e("user-selector",{attrs:{showUserSelector:t.showUserModal},on:{emitUserModal:t.emitUserModal,userModalData:t.getUserModalData}})],1)},staticRenderFns:[]};var I={name:"InteractionLayout",components:{AdmintrstorAssessment:c,UserComments:e("VU/8")(g,v,!1,function(t){e("jOIa")},"data-v-0b6bcd21",null).exports},props:{isAdmin:{type:Boolean,default:!1}}},_={render:function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"interaction-layout"},[s("admintrstor-assessment",{attrs:{isAdmin:this.isAdmin}}),this._v(" "),s("user-comments")],1)},staticRenderFns:[]};var y=e("VU/8")(I,_,!1,function(t){e("kRSs")},"data-v-62f5d8ff",null);s.default=y.exports},AD9U:function(t,s){},jOIa:function(t,s){},kRSs:function(t,s){}});