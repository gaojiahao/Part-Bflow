webpackJsonp([3],{"0rwx":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("GIAq"),i={name:"permissionModal",components:{},props:{appListId:String,modalPermissionStatus:Boolean},data:function(){return{selectUser:"",selectOrg:"",selectPosition:"",searchValue:"",tableSize:"small",emitChange:0,showUserModal:!1,showOrgModal:!1,showDepartmentModal:!1,showPermissionModal:!1,sameUserData:[],userSelectData:[],orgSelectData:[],departmentSelectData:[],userColumns:[],userData:[],orgColumns:[],orgData:[],departmentColumns:[],departmentData:[],allPermissionData:[],permissionSelectDatas:[],allPermissionColumns:[{type:"selection",width:60,align:"center"},{title:"类型",key:"type"},{title:"资源",key:"name"}],userSelection:[],orgSelection:[],departmentSelection:[]}},watch:{modalPermissionStatus:function(t,e){this.showPermissionModal=t,this.getData(),this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[],this.userSelection=[],this.orgSelection=[],this.departmentSelection=[]},searchValue:function(t){var e=[];t?(this.sameUserData.forEach(function(a,s){(a.nickname.indexOf(t)>-1||a.userCode.indexOf(t)>-1)&&e.push(a)}),this.userData=e):this.userData=this.sameUserData}},methods:{confirmMember:function(){},selectUserModal:function(){var t=this;this.showUserModal=!0,this.userColumns=[{type:"selection",width:60,align:"center"},{title:"姓名",key:"nickname"},{title:"工号",key:"userCode"}],Object(s.k)().then(function(e){t.userData=e.tableContent,t.sameUserData=e.tableContent})},selectOrgModal:function(){var t=this;this.showOrgModal=!0,this.orgColumns=[{type:"selection",width:60,align:"center"},{title:"名称",key:"name"}],Object(s.h)().then(function(e){t.orgData=e.tableContent})},selectPositionModal:function(){var t=this;this.showDepartmentModal=!0,this.departmentColumns=[{type:"selection",width:60,align:"center"},{title:"名称",key:"name"}],Object(s.g)().then(function(e){t.departmentData=e.tableContent})},selectUserClick:function(t,e){var a=this;this.userSelection.length>0?t.forEach(function(t,e){a.userSelection.push(t)}):this.userSelection=t},selectOrgClick:function(t,e){var a=this;this.orgSelection.length>0?t.forEach(function(t,e){a.orgSelection.push(t)}):this.orgSelection=t},selectDepartmentClick:function(t,e){var a=this;this.departmentSelection.length>0?t.forEach(function(t,e){a.departmentSelection.push(t)}):this.departmentSelection=t},deleteUser:function(t){this.userSelectData.splice(t,1)},deleteOrg:function(t){this.orgSelectData.splice(t,1)},deleteDepartment:function(t){this.departmentSelectData.splice(t,1)},permissionSelectData:function(t,e){this.permissionSelectDatas=t},confirmUser:function(){var t={};this.userSelectData=this.userSelection.reduce(function(e,a){return!t[a.userId]&&(t[a.userId]=e.push(a)),e},[])},confirmOrg:function(){var t={};this.orgSelectData=this.orgSelection.reduce(function(e,a){return!t[a.id]&&(t[a.id]=e.push(a)),e},[])},confirmDepartment:function(){var t={};this.departmentSelectData=this.departmentSelection.reduce(function(e,a){return!t[a.id]&&(t[a.id]=e.push(a)),e},[])},submitPermission:function(){var t=this,e=this.userSelectData.map(function(t){return t.userId}),a=this.orgSelectData.map(function(t){return t.id}),i=this.departmentSelectData.map(function(t){return t.id}),n=this.permissionSelectDatas.map(function(t){return t.id}),o={userId:e.join(","),roleId:i.join(","),groupId:a.join(","),permissionId:n.join(",")};o&&Object(s.a)(o).then(function(e){if(e.success){t.$Message.success(e.message);var a=t.emitChange++;t.$emit("reGetData",a)}})},getData:function(){var t=this,e={listId:this.appListId};Object(s.i)(e).then(function(e){t.allPermissionData=e.tableContent})},modalVisibleChange:function(t){t||this.$emit("emitPermissionModal",{modal:!1})}},mounted:function(){this.getData()}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{title:"应用权限",width:"1000","mask-closable":!1},on:{"on-ok":t.submitPermission,"on-visible-change":t.modalVisibleChange},model:{value:t.showPermissionModal,callback:function(e){t.showPermissionModal=e},expression:"showPermissionModal"}},[a("div",[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Col",{attrs:{span:"8"}},[a("label",[t._v("用户")]),t._v(" "),a("Input",{staticStyle:{width:"200px"},attrs:{icon:"arrow-down-b"},on:{"on-click":t.selectUserModal},model:{value:t.selectUser,callback:function(e){t.selectUser=e},expression:"selectUser"}})],1),t._v(" "),a("Col",{attrs:{span:"8"}},[a("label",[t._v("组织")]),t._v(" "),a("Input",{staticStyle:{width:"200px"},attrs:{icon:"arrow-down-b"},on:{"on-click":t.selectOrgModal},model:{value:t.selectOrg,callback:function(e){t.selectOrg=e},expression:"selectOrg"}})],1),t._v(" "),a("Col",{attrs:{span:"8"}},[a("label",[t._v("职位")]),t._v(" "),a("Input",{staticStyle:{width:"200px"},attrs:{icon:"arrow-down-b"},on:{"on-click":t.selectPositionModal},model:{value:t.selectPosition,callback:function(e){t.selectPosition=e},expression:"selectPosition"}})],1)],1),t._v(" "),a("Row",{attrs:{gutter:8}},[a("Col",{staticClass:"permission-tab",attrs:{span:"12"}},[a("Row",{staticStyle:{"margin-top":"10px"}},[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("用户")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.userSelectData,function(e,s){return a("Tag",{key:s,attrs:{type:"border",closable:"",color:"yellow"},on:{"on-close":function(e){t.deleteUser(s)}}},[t._v("\n            "+t._s(e.nickname)+"\n          ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("组织")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.orgSelectData,function(e,s){return a("Tag",{key:s,attrs:{type:"border",closable:"",color:"green"},on:{"on-close":function(e){t.deleteOrg(s)}}},[t._v("\n            "+t._s(e.name)+"\n          ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("职位")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.departmentSelectData,function(e,s){return a("Tag",{key:s,attrs:{type:"border",closable:"",color:"blue"},on:{"on-close":function(e){t.deleteDepartment(s)}}},[t._v("\n            "+t._s(e.name)+"\n          ")])}))],1)],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Table",{attrs:{stripe:"",height:"350",columns:t.allPermissionColumns,data:t.allPermissionData},on:{"on-select":t.permissionSelectData}})],1)],1),t._v(" "),a("Modal",{attrs:{title:"用户选择","mask-closable":!1,transfer:!1},on:{"on-ok":t.confirmUser},model:{value:t.showUserModal,callback:function(e){t.showUserModal=e},expression:"showUserModal"}},[a("div",{staticClass:"app-search"},[a("Icon",{staticClass:"app-search-icon",attrs:{type:"search"}}),t._v(" "),a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"搜索"},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}})],1),t._v(" "),a("Table",{attrs:{height:"400",stripe:"",size:"small",columns:t.userColumns,data:t.userData},on:{"on-select":t.selectUserClick,"on-select-all":t.selectUserClick}})],1),t._v(" "),a("Modal",{attrs:{title:"组织选择","mask-closable":!1,transfer:!1},on:{"on-ok":t.confirmOrg},model:{value:t.showOrgModal,callback:function(e){t.showOrgModal=e},expression:"showOrgModal"}},[a("Table",{attrs:{height:"400",stripe:"",size:"small",columns:t.orgColumns,data:t.orgData},on:{"on-select":t.selectOrgClick,"on-select-all":t.selectOrgClick}})],1),t._v(" "),a("Modal",{attrs:{title:"职位选择","mask-closable":!1,transfer:!1},on:{"on-ok":t.confirmDepartment},model:{value:t.showDepartmentModal,callback:function(e){t.showDepartmentModal=e},expression:"showDepartmentModal"}},[a("Table",{attrs:{height:"400",stripe:"",size:t.tableSize,columns:t.departmentColumns,data:t.departmentData},on:{"on-select":t.selectDepartmentClick,"on-select-all":t.selectDepartmentClick}})],1)],1)])},staticRenderFns:[]};var o=a("VU/8")(i,n,!1,function(t){a("F9h3")},"data-v-726dfe3a",null).exports,l={name:"WorkflowModal",props:{modalWorkflowStatus:Boolean,listId:String},data:function(){var t=this;return{showWorkFlow:!1,relativeWorkFlowTotal:0,allWorkFlowTotal:0,allCurrentPage:1,relativeCurrentPage:1,pageSize:10,loadingAll:!0,loadingRelative:!0,allWorkFlowColumns:[{title:"名称",key:"processName"},{title:"编码",key:"processCode"},{title:"查看流程图",key:"action",align:"center",render:function(t,e){return t("a",{props:{type:"default",size:"small"},on:{click:function(){window.open("/myflow/viewProc.html?processId="+e.row.id)}}},"查看")}}],relativeWorkFlowColumns:[{title:"名称",key:"processName"},{title:"编码",key:"processCode"},{title:"配置节点",key:"action",align:"center",render:function(e,a){return e("a",{props:{type:"default",size:"small"},on:{click:function(){window.open("/myflow/viewFlow.html?processId="+a.row.id+"&listId="+t.listId+"&processCode="+a.row.processCode)}}},"配置")}}],allWorkFlowData:[],relativeWorkFlowData:[]}},watch:{modalWorkflowStatus:function(t,e){this.showWorkFlow=t}},methods:{selectWorkFlow:function(){},getAllWorkflowData:function(){var t=this,e={page:this.allCurrentPage,limit:this.pageSize};this.loadingAll=!0,Object(s.j)(e).then(function(e){t.allWorkFlowData=e.tableContent,t.allWorkFlowTotal=e.dataCount,t.loadingAll=!1})},getRelativeWorkflowData:function(){var t=this,e={page:this.relativeCurrentPage,limit:this.pageSize,listId:this.listId};this.loadingRelative=!0,Object(s.s)(e).then(function(e){t.relativeWorkFlowData=e,t.relativeWorkFlowTotal=e.length,t.loadingRelative=!1})},onPageChange:function(t){this.allCurrentPage=t,this.getAllWorkflowData()},onRelativePageChange:function(t){this.relativeCurrentPage=t,this.getRelativeWorkflowData()},modalVisibleChange:function(t){t||this.$emit("emitWorkFlowModal",{modal:!1})},addWorkflow:function(t,e){if(0===this.relativeWorkFlowData.length)this.saveWorkFlow(t);else for(var a=0;a<this.relativeWorkFlowData.length;a++){if(t.id===this.relativeWorkFlowData[a].id){this.$Message.warning("已有选择的工作流！");break}this.saveWorkFlow(t);break}},saveWorkFlow:function(t){var e=this,a={listId:this.listId,procCode:t.processCode,creator:"",list:"list_process_rel",status:1};Object(s.x)(a).then(function(t){t.success&&(e.$Message.success(t.message),e.getRelativeWorkflowData())})},deleteWorkflow:function(t,e){var a=this,i={ID:t.id,list:"list_process_rel",status:0};Object(s.x)(i).then(function(t){t.success&&(a.$Message.success(t.message),a.relativeWorkFlowData.splice(e,1))})},createWorkflow:function(){window.open("/myflow/createWorkFlow.html?listId="+this.listId)}},mounted:function(){this.getAllWorkflowData(),this.getRelativeWorkflowData()}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{title:"工作流设置",width:"1010","mask-closable":!1},on:{"on-ok":t.selectWorkFlow,"on-visible-change":t.modalVisibleChange},model:{value:t.showWorkFlow,callback:function(e){t.showWorkFlow=e},expression:"showWorkFlow"}},[a("Row",{attrs:{gutter:8}},[a("Col",{attrs:{span:"12"}},[a("h4",{staticClass:"flow-title"},[t._v("所有工作流\n      "),a("Button",{staticClass:"create-button",on:{click:t.createWorkflow}},[t._v("创建工作流")])],1),t._v(" "),a("Table",{attrs:{loading:t.loadingAll,stripe:"",height:"350",columns:t.allWorkFlowColumns,data:t.allWorkFlowData},on:{"on-row-dblclick":t.addWorkflow}}),t._v(" "),a("div",{staticClass:"workflow-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.allWorkFlowTotal,current:t.allCurrentPage,"page-size":t.pageSize,size:"small","show-total":""},on:{"on-change":t.onPageChange}})],1)])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("h4",{staticClass:"flow-title"},[t._v("已关联的工作流\n      "),a("Button",{staticClass:"create-button",on:{click:t.createWorkflow}},[t._v("创建工作流")])],1),t._v(" "),a("Table",{attrs:{loading:t.loadingRelative,stripe:"",height:"350",columns:t.relativeWorkFlowColumns,data:t.relativeWorkFlowData},on:{"on-row-dblclick":t.deleteWorkflow}}),t._v(" "),a("div",{staticClass:"workflow-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.relativeWorkFlowTotal,current:t.relativeCurrentPage,"page-size":t.pageSize,size:"small","show-total":""},on:{"on-change":t.onRelativePageChange}})],1)])],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(l,r,!1,function(t){a("un1E")},"data-v-989a7102",null).exports,d=a("mvHQ"),p=a.n(d),u={name:"navModal",props:{modalNavStatus:Boolean,listId:String},data:function(){return{showNav:!1,viewId:"",navData:[],selectedNode:{}}},watch:{modalNavStatus:function(t,e){this.showNav=t,t&&(this.navData=[],this.getNavData())}},methods:{modalVisibleChange:function(t){t||this.$emit("emitNavModal",{modal:!1})},publishApp:function(){var t=this;this.selectedNode&&Object(s.t)(this.selectedNode).then(function(e){e.success&&(t.$Message.success(e.message),t.$emit("hasPublished","已发布"))})},getNodeSelectedData:function(t,e){var a=this,i={filter:p()([{operator:"eq",value:this.listId,property:"uniqueId"},{operator:"eq",value:1,property:"listViewStatus"}])},n={};Object(s.o)(i).then(function(s){for(var i=0;i<s.tableContent.length;i++){if(1===s.tableContent[i].isDefault){a.viewId=s.tableContent[i].viewId;break}a.viewId=s.tableContent[0].viewId}n={id:e.id,listId:a.listId,parentId:e.parentId},t.target.style.backgroundColor?(t.target.style.backgroundColor="#fff",t.target.style.padding="0px",t.target.style.color="#333"):(t.target.style.backgroundColor="rgba(242, 157, 30, 0.9)",t.target.style.padding="3px",t.target.style.color="#fff",a.selectedNode=n)})},getNavData:function(){var t=this;Object(s.r)({parentId:"root"}).then(function(e){e.forEach(function(e,a){1===e.leaf?t.navData.push({title:e.text,id:e.id,parentId:e.parentId,url:e.url,icon:e.icon,render:function(t,e){e.root,e.node;var a=e.data;return t("span",{style:{display:"inline-block",width:"100%"}},[t("span",[t("Icon",{props:{type:"ios-folder-outline"},style:{marginRight:"8px",color:"#FF8F59",fontSize:"1rem"}}),t("span",a.title)])])}}):t.navData.push({title:e.text,id:e.id,parentId:e.parentId,url:e.url,icon:e.icon,loading:!1,children:[],render:function(e,a){a.root,a.node;var s=a.data;return e("span",{style:{display:"inline-block",width:"100%"}},[e("span",[e("Icon",{props:{type:"folder"},style:{marginRight:"8px",color:"#39f",fontSize:"1.2rem"}}),e("span",{style:{cursor:"pointer"},on:{click:function(e){t.getNodeSelectedData(e,s)}}},s.title)])])}})})})},loadData:function(t,e){var a=this,i={parentId:t.id};Object(s.r)(i).then(function(t){var s=[];t.forEach(function(t){1===t.leaf?s.push({title:t.text,id:t.id,parentId:t.parentId,url:t.url,icon:t.icon,render:function(t,e){e.root,e.node;var a=e.data;return t("span",{style:{display:"inline-block",width:"100%"}},[t("span",[t("Icon",{props:{type:"ios-folder-outline"},style:{marginRight:"8px",color:"#FF8F59",fontSize:"1rem"}}),t("span",a.title)])])}}):s.push({title:t.text,id:t.id,parentId:t.parentId,url:t.url,icon:t.icon,loading:!1,children:[],render:function(t,e){e.root,e.node;var s=e.data;return t("span",{style:{display:"inline-block",width:"100%"}},[t("span",[t("Icon",{props:{type:"folder"},style:{marginRight:"8px",color:"#39f",fontSize:"1.2rem"}}),t("span",{style:{cursor:"pointer"},on:{click:function(t){a.getNodeSelectedData(t,s)}}},s.title)])])}})}),e(s)})},renewChildRender:function(){},renewParentRender:function(){}},mounted:function(){}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{title:"导航",width:"300","mask-closable":!1},on:{"on-ok":t.publishApp,"on-visible-change":t.modalVisibleChange},model:{value:t.showNav,callback:function(e){t.showNav=e},expression:"showNav"}},[a("Tree",{staticClass:"nav-tree",attrs:{data:t.navData,"load-data":t.loadData}})],1)},staticRenderFns:[]};var m=a("VU/8")(u,h,!1,function(t){a("b7Wz")},"data-v-1fd23c0a",null).exports,v=a("woOf"),f=a.n(v),g={props:{value:{type:Boolean,default:!1},width:{type:[Number,String],default:520},styles:{type:Object},maskClosable:{type:Boolean,default:!0},footerBtnAlign:{type:String,default:"right"},title:{type:String}},data:function(){return{visible:this.value}},computed:{mainStyles:function(){var t={},e=parseInt(this.width),a={width:e<=100?e+"%":e+"px"},s=this.styles?this.styles:{};return f()(t,a,s),t},inputAlign:function(){return"input-align-"+this.footerBtnAlign}},methods:{close:function(){this.visible=!1,this.$emit("on-cancel")},mask:function(){this.maskClosable&&this.close()},handleWrapClick:function(t){var e=t.target.getAttribute("class");e&&e.indexOf("rfd-modal-warp")>-1&&this.mask()},cancel:function(){this.close()},ok:function(){this.$emit("on-ok")}},watch:{value:function(t){this.visible=t},visible:function(t){this.$emit("onVisibleChange",t)}}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"rfd-modal-mask",on:{click:t.mask}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"rfd-modal-warp",on:{click:t.handleWrapClick}},[a("div",{staticClass:"rfd-modal",style:t.mainStyles},[a("div",{staticClass:"rfd-modal-content"},[a("header",[a("div",{staticClass:"modal-content-header"},[t._t("header",[a("span",{staticClass:"modal-content-header-title"},[t._v(t._s(t.title))]),t._v(" "),a("i",{staticClass:"iconfont modal-content-header-close",on:{click:t.close}},[t._v("")])])],2)]),t._v(" "),a("main",[a("div",{staticClass:"modal-content-body"},[t._t("default")],2)]),t._v(" "),a("footer",{staticClass:"modal-content-footer",class:t.inputAlign},[t._t("footer",[a("input",{staticClass:"input-submit-common",attrs:{type:"submit",value:"取消"},on:{click:function(e){return e.preventDefault(),t.cancel(e)}}}),t._v(" "),a("input",{staticClass:"input-submit-common",attrs:{type:"submit",value:"确定"},on:{click:function(e){return e.preventDefault(),t.ok(e)}}})])],2)])])])])},staticRenderFns:[]};var b={name:"appSetting",components:{PermissionModal:o,WorkflowModal:c,NavModal:m,CustomModal:a("VU/8")(g,w,!1,function(t){a("XbZ/")},"data-v-8684806a",null).exports},props:["listId"],data:function(){return{showPermissionModal:!1,showWorkFlow:!1,showNav:!1,visible:!1,logData:{scope:[],spendTime:0,content:""},ruleValidate:{scope:[{required:!0,message:"Please select the city",trigger:"change"}],spendTime:[{required:!0,message:"不允许为空",trigger:"blur"}],content:[{required:!0,message:"不允许为空",trigger:"blur"}]}}},methods:{showAppLog:function(){this.visible=!0},modalVisibleChange:function(t){this.visible=t,t||this.$refs.formValidate.resetFields()},submitLog:function(t){var e=this;this.$refs.formValidate.validate(function(t){});var a={listId:this.listId,scope:this.logData.scope.join(","),spendTime:this.logData.spendTime,content:this.logData.content};Object(s.v)(a).then(function(t){t.success&&(e.$Message.success(t.message),e.visible=!1,e.$emit("callTimeLineRefesh",!0))})},emitPermissionModal:function(){this.showPermissionModal=!1},emitWorkFlowModal:function(){this.showWorkFlow=!1},emitNavModal:function(){this.showNav=!1},showNavModal:function(){this.showNav=!0},hasPublished:function(t){this.$emit("childHasPublished",t)},showPermissionApp:function(){this.showPermissionModal=!0},submitPermission:function(){},showWorkFlowModal:function(){this.showWorkFlow=!0},goForm:function(){window.open("/Form/index.html?viewDesign=true&list="+this.listId)},reGetData:function(t){this.$emit("getData",t)}},mounted:function(){}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",[a("div",{staticClass:"app-card"},[a("Col",{attrs:{span:"6"}},[a("Row",{staticClass:"app-body-card"},[a("ul",[a("li",[a("b",[t._v("表单设置")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",[t._v("部件内部数据源过滤")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",[t._v("部件之间数据过滤")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",[t._v("科目分录设置")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",{on:{click:t.goForm}},[t._v("表单设置")])])])])],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Row",{staticClass:"app-body-card"},[a("ul",[a("li",[a("b",[t._v("工作流设置")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",[t._v("一般工作流图")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",{on:{click:t.showWorkFlowModal}},[t._v("工作流设置")])])])])],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Row",{staticClass:"app-body-card"},[a("p",{staticClass:"app-title",attrs:{slot:"title"},slot:"title"},[t._v("报表设置")]),t._v(" "),a("ul",[a("li",[a("b",[t._v("报表设置")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",[t._v("对象查阅项")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",[t._v("报表权限")])])])])],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Row",{staticClass:"app-body-card"},[a("ul",[a("li",[a("b",[t._v("相关应用设置")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",[t._v("应用信息设置")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",{on:{click:t.showPermissionApp}},[t._v("权限设置")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",{on:{click:t.showAppLog}},[t._v("更新日志")])]),t._v(" "),a("li",[a("b",{staticClass:"app-setting-dot"},[t._v("●")]),t._v(" "),a("a",{on:{click:t.showNavModal}},[t._v("导航")])])])])],1)],1)]),t._v(" "),a("custom-modal",{attrs:{width:"600",footerBtnAlign:"right",title:"更新日志"},on:{onVisibleChange:t.modalVisibleChange,"on-ok":t.submitLog},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("div",{staticStyle:{margin:"20px auto",width:"80%"}},[a("Form",{ref:"formValidate",attrs:{"label-width":95,model:t.logData,rules:t.ruleValidate}},[a("FormItem",{attrs:{label:"更新范围:",prop:"scope"}},[a("Select",{attrs:{multiple:""},model:{value:t.logData.scope,callback:function(e){t.$set(t.logData,"scope",e)},expression:"logData.scope"}},[a("Option",{attrs:{value:"表单"}},[t._v("表单")]),t._v(" "),a("Option",{attrs:{value:"科目关系"}},[t._v("科目关系")]),t._v(" "),a("Option",{attrs:{value:"报表"}},[t._v("报表")]),t._v(" "),a("Option",{attrs:{value:"工作流"}},[t._v("工作流")]),t._v(" "),a("Option",{attrs:{value:"权限"}},[t._v("权限")])],1)],1),t._v(" "),a("FormItem",{attrs:{label:"耗用小时数:",prop:"spendTime"}},[a("InputNumber",{model:{value:t.logData.spendTime,callback:function(e){t.$set(t.logData,"spendTime",e)},expression:"logData.spendTime"}}),t._v(" "),a("span",{staticStyle:{color:"#ddd","margin-left":"10px"}},[t._v("单位/分")])],1),t._v(" "),a("FormItem",{attrs:{label:"更新内容:",prop:"content"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5}},model:{value:t.logData.content,callback:function(e){t.$set(t.logData,"content",e)},expression:"logData.content"}})],1)],1)],1)]),t._v(" "),a("nav-modal",{attrs:{listId:t.listId,modalNavStatus:t.showNav},on:{emitNavModal:t.emitNavModal,hasPublished:t.hasPublished}}),t._v(" "),a("workflow-modal",{attrs:{modalWorkflowStatus:t.showWorkFlow,listId:t.listId},on:{emitWorkFlowModal:t.emitWorkFlowModal}}),t._v(" "),a("permission-modal",{attrs:{modalPermissionStatus:t.showPermissionModal,appListId:t.listId},on:{emitPermissionModal:t.emitPermissionModal,reGetData:t.reGetData}})],1)},staticRenderFns:[]};var C=a("VU/8")(b,_,!1,function(t){a("vB+K")},"data-v-af376e36",null).exports,k={name:"appView",components:{},props:{listId:String,appType:String},data:function(){var t=this;return{columns:[{title:"视图名称",key:"title",render:function(e,a){return e("a",{on:{click:function(){var e="/Site/index.html#appSetting/viewConfig/"+t.listId+"/"+a.row.viewId;window.top.location.href=e}}},a.row.title)}},{title:"创建时间",key:"crtTime"},{title:"创建者",key:"creator"},{title:"默认视图",key:"isDefault",width:100,align:"center",render:function(e,a){var s=!1;return 1===a.row.isDefault&&(s=!0),e("Radio",{props:{value:s},on:{"on-change":function(e){t.onClickDefaultView(a)}}})}},{title:"操作",key:"action",width:150,align:"center",render:function(e,a){return e("Button",{props:{type:"error",size:"small"},on:{click:function(e){t.deleteViews(a,a.index)}}},"删除")}}],tableData:[]}},methods:{getViewsData:function(){var t=this,e={filter:p()([{operator:"eq",value:this.listId,property:"uniqueId"},{operator:"eq",value:1,property:"listViewStatus"}])};Object(s.o)(e).then(function(e){t.tableData=e.tableContent})},setDefaultViews:function(t){var e=this,a={viewId:t.row.viewId,listId:this.listId};Object(s.w)(a).then(function(t){t.success&&e.reloadViewData()})},reloadViewData:function(){var t=this,e={filter:p()([{operator:"eq",value:this.listId,property:"uniqueId"},{operator:"eq",value:1,property:"listViewStatus"}])};Object(s.o)(e).then(function(e){t.tableData=e.tableContent,t.reRenderDefaultView(),t.$Message.success(e.message)})},deleteViews:function(t,e){var a=this;if(1===this.tableData.length)this.$Message.warning("不可删除唯一视图！");else if(1===t.row.isDefault){var i={viewId:t.row.viewId,listId:this.listId};Object(s.d)(i).then(function(t){if(t.success){a.tableData.splice(e,1);var i={viewId:a.tableData[0].viewId,listId:a.listId};Object(s.w)(i).then(function(t){t.success&&a.reloadViewData()})}})}else{var n={viewId:t.row.viewId,listId:this.listId};Object(s.d)(n).then(function(t){t.success&&(a.tableData.splice(e,1),a.$Message.success(t.message))})}},goCreateView:function(){window.top.location.href="/Site/index.html#appSetting/"+this.listId+"/"+this.appType+"/viewTypes"},onClickDefaultView:function(t){var e=this;this.$Modal.confirm({title:"确认",content:"你确定将此视图设为默认视图？",onOk:function(){e.setDefaultViews(t)},onCancel:function(){e.reRenderDefaultView()}})},reRenderDefaultView:function(){var t=this;this.columns[3].render=function(e,a){var s=!1;return 1===a.row.isDefault&&(s=!0),e("Radio",{props:{value:s},on:{"on-change":function(){t.onClickDefaultView(a)}}})}}},created:function(){this.getViewsData()},mounted:function(){}},D={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"app-card"},[e("Row",{staticStyle:{margin:"10px 15px"}},[e("b",{staticClass:"app-name"},[this._v(" 报表视图")]),this._v(" "),e("a",{staticClass:"create-view",on:{click:this.goCreateView}},[this._v("创建视图")])]),this._v(" "),e("Row",[e("Table",{attrs:{columns:this.columns,data:this.tableData}})],1)],1)},staticRenderFns:[]};var y=a("VU/8")(k,D,!1,function(t){a("vOS8")},"data-v-508f93e2",null).exports,I={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"app-card"},[e("Row",{staticStyle:{margin:"10px 15px"}},[e("b",{staticClass:"app-name"},[this._v("科目关系")])]),this._v(" "),e("Table",{attrs:{columns:this.columns,data:this.tableData}})],1)},staticRenderFns:[]};var S=a("VU/8")({name:"appSubject",components:{},data:function(){return{columns:[{title:"名称",key:"name"},{title:"分类",key:"type"},{title:"启用",key:"defaultView",width:150,align:"center",render:function(t,e){return t("Checkbox",{props:{value:!0}})}}],tableData:[{name:"存货",type:"计划类"},{name:"费用",type:"会计类"}]}},methods:{},mounted:function(){}},I,!1,function(t){a("h15+")},"data-v-6de4c216",null).exports,M={name:"appPermission",components:{},props:{listId:String,regetData:Number},data:function(){var t=this;return{isUserEdit:!1,isOrgEdit:!1,isDepEdit:!1,userColumns:[{title:"姓名",key:"objName",width:200,hidden:!0},{title:"资源",key:"resource",align:"center",render:function(e,a){var s=[],i=JSON.parse(a.row.resource);if(i.length>0)return i.forEach(function(i,n){var o=void 0,l=function(s){o=e("Tag",{props:{closable:!0,color:"yellow"},on:{"on-close":function(e){t.deleteOnlyPermission(e,a,s,a.row.list)}}},i[s])};for(var r in i)l(r);s.push(o)}),e("div",s)}},{title:"查看范围",key:"scope",render:function(e,a){var s=[],i=JSON.parse(a.row.scope);if(i.length>0)return i.forEach(function(i,n){var o=void 0,l=function(s){o=e("Tag",{props:{closable:!0,color:"green"},on:{"on-close":function(e){t.deleteOnlyPermission(e,a,s,a.row.list)}}},i[s])};for(var r in i)l(r);s.push(o)}),e("div",s)}},{title:"动作",key:"action",render:function(e,a){var s=[],i=JSON.parse(a.row.action);if(i.length>0)return i.forEach(function(i,n){var o=void 0,l=function(s){o=e("Tag",{props:{closable:!0,color:"blue"},on:{"on-close":function(e){t.deleteOnlyPermission(e,a,s,a.row.list)}}},i[s])};for(var r in i)l(r);s.push(o)}),e("div",s)}},{title:"操作",key:"delete",render:function(e,a){return e("a",{on:{click:function(e){t.deleteAllPermission(e,a,a.row.list)}}},"删除")}}],userData:[],authorityList:{},appItem:[{title:"用户",type:"sys_user_permission"},{title:"组织",type:"sys_group_permission"},{title:"职位",type:"sys_role_permission"}]}},watch:{regetData:function(t){this.getAllData()}},methods:{deleteAllPermission:function(t,e,a){var i=this;i.$Modal.confirm({title:"确认",content:"确认删除此用户权限？",onOk:function(){var n,o=[];JSON.parse(e.row.action).forEach(function(t){for(var e in t)o.push(e)}),JSON.parse(e.row.resource).forEach(function(t){for(var e in t)o.push(e)}),JSON.parse(e.row.scope).forEach(function(t){for(var e in t)o.push(e)}),n={list:a,single:e.row.objId,multi:o.join(",")},Object(s.e)(n).then(function(e){e.success&&(i.$Message.success(e.message),t.target.parentElement.parentElement.parentElement.style.display="none")})}})},deleteOnlyPermission:function(t,e,a,i){var n=this,o=e.row.leaf?"确认删除此权限？":'<b style="color:red;">注意</b>：这个操作会将<b>'+e.row.objName+"</b>从该列表中移除(如果<b>"+e.row.objName+"</b>没有其他权限的话)";n.$Modal.confirm({title:"确认",content:o,onOk:function(){var o={list:i,single:e.row.objId,multi:a};o&&Object(s.e)(o).then(function(e){e.success&&(n.$Message.success(e.message),t.target.parentElement.style.display="none")})}})},getAllData:function(){var t=this;Object(s.m)(this.listId).then(function(e){e.tableContent[0]&&(t.authorityList=e.tableContent.reduce(function(t,e,a){return t[e.list]=t[e.list]||[],t[e.list].push(e),t},{}))})}},created:function(){this.getAllData()}},O={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-card"},t._l(t.appItem,function(e){return a("Row",{key:e.type},[a("Row",{staticStyle:{margin:"10px 15px"}},[a("b",{staticClass:"app-card-item-title"},[t._v(t._s(e.title))]),t._v(" "),a("span",{staticClass:"user-permission-desc",domProps:{innerHTML:t._s("设置"+e.title+"相对于当前应用的权限")}})]),t._v(" "),a("Row",[a("Col",{attrs:{span:"24"}},[a("Table",{staticClass:"user-table",attrs:{height:"200",columns:t.userColumns,data:t.authorityList[e.type]}})],1)],1)],1)}))},staticRenderFns:[]};var x=a("VU/8")(M,O,!1,function(t){a("vVSs")},"data-v-687251ae",null).exports,P={name:"TimeLine",props:{data:{type:Array,default:[]}}},A={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.data.length,expression:"data.length===0?false:true"}],staticClass:"timeline-box",attrs:{fix:""}},[a("h2",[t._v("变更日志")]),t._v(" "),a("Timeline",{staticClass:"timeline-list",attrs:{pending:""}},t._l(t.data,function(e){return a("TimelineItem",{key:e.VERSION},[a("p",{staticClass:"time"},[t._v(t._s(e.VERSION))]),t._v(" "),a("ul",{staticClass:"timeline-item-content-ul"},[a("li",[a("span",[t._v(t._s(e.CREATOR_NAME))]),t._v(" "),a("span",[t._v(t._s(e.CRT_TIME))]),t._v(" "),a("span",[t._v("耗用时间:"+t._s(e.TIME_CONSUMING))])]),t._v(" "),a("li",[a("span",[t._v("更新范围:")]),t._v(" "),t._l(e.CHANGE_RANGE,function(e,s){return a("span",{key:s,staticClass:"customs-tag"},[t._v(t._s(e))])})],2),t._v(" "),a("li",[a("span",[t._v("备注:"+t._s(e.CONTENT))])])])])}))],1)},staticRenderFns:[]};var F={name:"detail",components:{AppSetting:C,AppView:y,AppSubject:S,AppPermission:x,TimeLine:a("VU/8")(P,A,!1,function(t){a("Cgfy")},null,null).exports},data:function(){return{appData:{},appBigType:"",regetData:1e3,showEditAppInfo:!0,showPermission:!1,showSubjectView:!1,selectModel:"",showAdminModal:!1,selector:"",searchValue:"",hasPublishStatus:"已发布",notPublishStatus:"未发布",notAppStatusColor:"blue",hasAppStatusColor:"green",adminColumns:[{title:"工号",key:"userCode"},{title:"姓名",key:"nickname"}],adminData:[],sameAdminData:[],selectAdminData:{},timeLineData:[]}},watch:{searchValue:function(t){var e=[];t?(this.sameAdminData.forEach(function(a,s){(a.nickname.indexOf(t)>-1||a.userCode.indexOf(t)>-1)&&e.push(a)}),this.adminData=e):this.adminData=this.sameAdminData}},methods:{childHasPublished:function(t){this.appData.publish=1},editAppinfo:function(){var t=this;if(this.showEditAppInfo=!this.showEditAppInfo,this.showEditAppInfo){var e={list:"list",uniqueId:this.appData.uniqueId,title:this.appData.title,administrator:this.appData.userId,comment:this.appData.comment};Object(s.u)(e).then(function(e){e.success&&t.$Message.success(e.message)})}},showPermissionApp:function(){this.showPermission=!0},selectAdminModal:function(){this.showAdminModal=!0},confirmModal:function(){this.appData.administrator=this.selectAdminData.nickname,this.appData.userId=this.selectAdminData.userId},selectAdmin:function(t,e){this.selectAdminData=t},brotherGetData:function(t){this.regetData=t},getAdmintrstorData:function(){var t=this;Object(s.f)({groupId:347}).then(function(e){t.adminData=e.tableContent,t.sameAdminData=e.tableContent})},getChangeLog:function(){var t=this,e={listId:this.$route.params.listId};Object(s.p)(e).then(function(e){e.tableContent&&(e.tableContent.map(function(t){t.CHANGE_RANGE&&(t.CHANGE_RANGE=t.CHANGE_RANGE.split(","))}),t.timeLineData=e.tableContent)})},callTimeLineRefesh:function(){this.getChangeLog()}},created:function(){this.getChangeLog()},mounted:function(){var t=this,e={uniqueId:this.$route.params.listId};this.getAdmintrstorData(),Object(s.q)(e).then(function(e){t.appData=e[0],"business"===t.appData.type?(t.showSubjectView=!0,t.appBigType="业务应用"):"obj"===t.appData.type?t.appBigType="基础对象":t.appBigType="科目应用"})}},R={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-details"},[a("div",[a("header",{staticClass:"app-header"},[a("Breadcrumb",[a("BreadcrumbItem",{attrs:{to:"/"}},[t._v("首页")]),t._v(" "),a("BreadcrumbItem",{attrs:{to:"/app/list"}},[t._v("应用列表")]),t._v(" "),a("BreadcrumbItem",[t._v(t._s(t.appData.title))])],1)],1),t._v(" "),a("div",{staticClass:"app-main"},[a("img",{attrs:{src:t.appData.icon}}),t._v(" "),a("div",{staticClass:"app-main-content"},[t.showEditAppInfo?a("h3",[t._v(t._s(t.appData.title))]):a("Input",{staticStyle:{width:"200px"},model:{value:t.appData.title,callback:function(e){t.$set(t.appData,"title",e)},expression:"appData.title"}}),t._v(" "),a("b",{on:{click:t.editAppinfo}},[a("Tooltip",{attrs:{content:"编辑",placement:"top"}},[a("Icon",{staticClass:"app-edit-icon",attrs:{type:"compose"}})],1)],1),t._v(" "),a("section",{staticClass:"app-section"},[a("div",{staticClass:"app-content-section"},[a("label",[t._v("管理员：")]),t._v(" "),t.showEditAppInfo?a("span",[t._v(t._s(t.appData.administrator))]):a("Input",{staticStyle:{width:"100px"},attrs:{icon:"arrow-down-b"},on:{"on-click":t.selectAdminModal},model:{value:t.appData.administrator,callback:function(e){t.$set(t.appData,"administrator",e)},expression:"appData.administrator"}})],1),t._v(" "),a("div",{staticClass:"app-content-section"},[a("label",[t._v("状态：")]),t._v(" "),a("Tag",{attrs:{color:0===t.appData.publish?t.notAppStatusColor:t.hasAppStatusColor}},[t._v(t._s(0===t.appData.publish?t.notPublishStatus:t.hasPublishStatus))])],1),t._v(" "),a("div",{staticClass:"app-content-section"},[a("label",[t._v("创建时间：")]),t._v(" "),a("span",[t._v(t._s(t.appData.crtTime))])])]),t._v(" "),a("section",{staticClass:"app-section"},[t._m(0),t._v(" "),a("div",{staticClass:"app-content-section"},[a("label",[t._v("类型：")]),t._v(" "),a("span",[t._v(t._s(t.appData.transType))])]),t._v(" "),a("div",{staticClass:"app-content-section"},[a("label",[t._v("创建者：")]),t._v(" "),a("span",[t._v(t._s(t.appData.modifer))])])]),t._v(" "),a("section",{staticClass:"app-section"},[a("div",{staticClass:"app-content-section"},[a("label",[t._v("应用大类：")]),t._v(" "),a("span",[t._v(t._s(t.appBigType))])]),t._v(" "),a("div",{staticClass:"app-content-comment"},[a("label",[t._v("说明：")]),t._v(" "),t.showEditAppInfo?a("span",[t._v(t._s(t.appData.comment))]):a("Input",{staticStyle:{width:"350px"},model:{value:t.appData.comment,callback:function(e){t.$set(t.appData,"comment",e)},expression:"appData.comment"}})],1)])],1)])]),t._v(" "),a("app-setting",{attrs:{listId:this.$route.params.listId},on:{showPermissionApp:t.showPermissionApp,childHasPublished:t.childHasPublished,getData:t.brotherGetData,callTimeLineRefesh:t.callTimeLineRefesh}}),t._v(" "),a("app-permission",{attrs:{listId:this.$route.params.listId,regetData:t.regetData}}),t._v(" "),a("app-view",{attrs:{listId:this.$route.params.listId,appType:t.appData.type}}),t._v(" "),a("app-subject"),t._v(" "),a("time-line",{attrs:{data:t.timeLineData}}),t._v(" "),a("Modal",{attrs:{title:"请选择"},on:{"on-ok":t.confirmModal},model:{value:t.showAdminModal,callback:function(e){t.showAdminModal=e},expression:"showAdminModal"}},[a("div",{staticClass:"app-search"},[a("Icon",{staticClass:"app-search-icon",attrs:{type:"search"}}),t._v(" "),a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"搜索"},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}})],1),t._v(" "),a("Table",{attrs:{"highlight-row":!0,height:"400",stripe:"",columns:t.adminColumns,size:"small",data:t.adminData},on:{"on-row-click":t.selectAdmin}})],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"app-content-section"},[e("label",[this._v("实例数：")]),this._v(" "),e("span",[this._v("2000")])])}]};var V=a("VU/8")(F,R,!1,function(t){a("a4II")},"data-v-2f750cbd",null);e.default=V.exports},Cgfy:function(t,e){},F9h3:function(t,e){},"XbZ/":function(t,e){},a4II:function(t,e){},b7Wz:function(t,e){},"h15+":function(t,e){},mvHQ:function(t,e,a){t.exports={default:a("qkKv"),__esModule:!0}},qkKv:function(t,e,a){var s=a("FeBl"),i=s.JSON||(s.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}},un1E:function(t,e){},"vB+K":function(t,e){},vOS8:function(t,e){},vVSs:function(t,e){}});
//# sourceMappingURL=3.422265434e8bad050d1b.js.map