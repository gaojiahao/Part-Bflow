webpackJsonp([37],{"5Lfs":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=e("GIAq"),l=e("oAV5"),o={name:"TaskLog",components:{},props:{listId:{type:String}},data:function(){return{transCode:"",projectTaskId:"",logData:[],modalFormData:{logTitle:"",taskDate:Object(l.b)(new Date,"yyyy-MM-dd"),logDeclarationHours:1,comments:""},ruleValidate:{logTitle:[{required:!0,message:"不允许为空"}],logDeclarationHours:[{required:!0,message:"不允许为空",type:"number"}],taskDate:[{required:!0,message:"不允许为空"}]},currentPage:1,pageTotal:0,pageSize:6}},methods:{submitLog:function(t){var a=this,e=void 0;if(this.$refs.formValidate.validate(function(t){e=t}),e){var o=this.$currentUser,s={listId:"ee4ff0a1-c612-419d-afd7-471913d57a2a",wfParam:null,formData:{baseinfo:{handlerName:o.nickname,handlerUnitName:o.depts?o.depts[0].name:"",handlerRoleName:o.isSysRoleList[0].name,handler:o.userId,handlerUnit:o.depts?o.depts[0].id:"",handlerRole:o.isSysRoleList[0].id,creator:o.userId,modifer:o.userId,id:"",handlerEntity:o.entityId,biProcessStatus:null},jobLog:{logTitle:this.modalFormData.logTitle,taskDate:Object(l.b)(this.modalFormData.taskDate,"yyyy-MM-dd"),logDeclarationHours:this.modalFormData.logDeclarationHours,projectTaskId:this.projectTaskId},comment:{biComment:this.modalFormData.comments}}};Object(r._10)(s).then(function(t){t.success?(window.top.Ext.toast(t.message),a.modalFormData.logTitle="",a.modalFormData.comments="",a.getTaskLog(a.transCode)):window.top.Ext.toast(t.message)})}},getTaskLog:function(){var a=this;Object(r.Y)(this.transCode,this.currentPage,this.pageSize).then(function(t){a.pageTotal=t.dataCount,a.logData=t.tableContent}).then(function(t){window.top.setTaskLogIframeHeight()})},changeCurrentPage:function(t){this.currentPage=t,this.getTaskLog()}},created:function(){this.transCode=this.$route.params.transCode,this.projectTaskId=this.$route.params.projectTaskId,this.getTaskLog()}},s=e("wHcf"),n=e.n(s);var i=function(t){e("OwRp")},m=e("VU/8")(o,n.a,!1,i,"data-v-74fb57ea",null);a.default=m.exports},OwRp:function(t,a){},wHcf:function(t,a){t.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"timeline-box"},[e._m(0),e._v(" "),o("div",{staticClass:"timeline-box-form"},[o("Form",{ref:"formValidate",attrs:{"label-width":120,model:e.modalFormData,rules:e.ruleValidate}},[o("FormItem",{attrs:{label:"标题:",prop:"logTitle",width:"300"}},[o("Input",{attrs:{placeholder:"请输入任务日志标题"},model:{value:e.modalFormData.logTitle,callback:function(t){e.$set(e.modalFormData,"logTitle",t)},expression:"modalFormData.logTitle"}})],1),e._v(" "),o("FormItem",{attrs:{label:"日期",prop:"taskDate"}},[o("DatePicker",{attrs:{type:"date",format:"yyyy-MM-dd"},model:{value:e.modalFormData.taskDate,callback:function(t){e.$set(e.modalFormData,"taskDate",t)},expression:"modalFormData.taskDate"}})],1),e._v(" "),o("FormItem",{attrs:{label:"工时:",prop:"logDeclarationHours"}},[o("InputNumber",{attrs:{min:.1,step:.1},model:{value:e.modalFormData.logDeclarationHours,callback:function(t){e.$set(e.modalFormData,"logDeclarationHours",t)},expression:"modalFormData.logDeclarationHours"}}),e._v(" "),o("span",{staticStyle:{"margin-left":"10px"}},[e._v("单位/时")])],1),e._v(" "),o("FormItem",{attrs:{label:"描述:",prop:"comments"}},[o("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5}},model:{value:e.modalFormData.comments,callback:function(t){e.$set(e.modalFormData,"comments",t)},expression:"modalFormData.comments"}})],1),e._v(" "),o("FormItem",[o("input",{staticClass:"timeline-box-form-submit",attrs:{type:"button",value:"提交"},on:{click:e.submitLog}})])],1)],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:0!==e.logData.length,expression:"logData.length===0?false:true"}],staticClass:"timeline-box-log"},[e._l(e.logData,function(t,a){return o("ul",{key:a,staticClass:"timeline-box-log-item"},[o("img",{staticClass:"head-portrait",attrs:{src:t.photo?t.photo:"resources/images/icon/defaultUserPhoto.png"}}),e._v(" "),o("ul",{staticClass:"timeline-item-content-ul"},[o("li",[o("span",[e._v(e._s(t.handlerName))]),e._v(" "),o("span",[e._v(e._s(t.taskDate))]),e._v(" "),o("span",{domProps:{innerHTML:e._s(t.logDeclarationHours+" 小时")}})]),e._v(" "),o("li",[o("span",{staticStyle:{"font-weight":"600"}},[e._v(e._s(t.logTitle))])]),e._v(" "),o("li",[o("span",{domProps:{innerHTML:e._s(t.comment)}})])])])}),e._v(" "),o("div",{staticClass:"loading-more"},[o("Page",{attrs:{total:e.pageTotal,current:e.currentPage,"page-size":e.pageSize,"prev-text":"上一页","next-text":"下一页",size:"small"},on:{"on-change":e.changeCurrentPage}})],1)],2)])},staticRenderFns:[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"app-resource-group-title"},[e("h3",[t._v("任务日志")])])}]}}});