{"source":"webpackJsonp([7],{\"4TdE\":function(e,t,o){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=o(\"Gu7T\"),a=o.n(n),i=o(\"mvHQ\"),l=o.n(i),s=o(\"lZCD\"),r=o(\"K4CD\"),d={name:\"BusinessModuleConfig\",components:{AddJobsModal:s.a,AddProcessModal:s.a,AddNodeModal:s.a},data:function(){var n=this;return{isShowAddJobsModal:!1,isShowAddProcessModal:!1,isShowAddNodeModal:!1,drawerVisable:!1,moduleId:\"\",moduleFromItem:{moduleName:\"\"},ruleValidate:{moduleName:[{required:!0,message:\"请输入应用模板名称\",trigger:\"blur\"}]},NodeDetailFrom:{uniqueId:\"\",title:\"\",nextNode:[]},jobsFormItem:{id:[],name:[]},processFormItem:{title:\"\",key:\"\"},searchValue:\"\",appListLoading:!1,appListColumns:[{type:\"selection\",width:60,align:\"center\"},{title:\"id\",key:\"id\"},{title:\"应用名称\",key:\"title\"},{title:\"创建时间\",key:\"crtTime\"}],appListData:[],appListPageTotal:0,appListCurrentPage:1,pageSize:8,withoutListId:\"\",onPageSelection:[],nodePositionId:\"\",nodeProcssId:\"\",columns:[{title:\" \",key:\"positionName\",columnId:\"cacf-ool4-jbpj-wkx5-slj9-013e-psir-ak24\",align:\"center\",fixed:\"left\",render:function(e,o){return e(\"div\",[e(\"span\",o.row.positionName),e(\"Icon\",{class:\"column-icon-delete\",props:{type:\"md-trash\"},on:{click:function(){var e=o.row.positionId,t=o.row.jobId;n.handleRowDelete(e,t)}}})])}}],columnDatas:[],appNodes:{},joblist:[]}},methods:{getRandomCode:function(){for(var e=[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\",\"s\",\"t\",\"u\",\"v\",\"w\",\"x\",\"y\",\"z\"],t=\"\",o=1;o<=32;o++){t+=e[parseInt(35*Math.random())],o%4==0&&32!=o&&(t+=\"-\")}return t},handleSubmitBoxs:function(e){var t=e.target||e.srcElement;if(\"input\"===t.nodeName.toLocaleLowerCase())switch(t.id){case\"addJob\":this.isShowAddJobsModal=!0,this.jobsFormItem.name=[],this.jobsFormItem.id=[];break;case\"addProcess\":this.isShowAddProcessModal=!0,this.$refs.processFormItem.resetFields();break;case\"save\":this.saveAppConfig();break;case\"back\":this.$router.push({path:\"/BusinessModuleGraph/\"+this.moduleId})}},saveAppConfig:function(){var d=this;this.$refs.moduleFromItem.validate(function(e){if(e){var t={},o=[],n=[],s=[];d.columns.forEach(function(e,t){if(\"positionName\"!==e.key){var o=e.columnId,n=e.key,i=e.title,a=e.editId;a?s.push({id:a,title:i,key:n,sort:t,columnAnchorPoint:o}):s.push({title:i,key:n,sort:t,columnAnchorPoint:o})}}),d.columnDatas.forEach(function(e,t){e.id?n.push({title:e.positionName,rowAnchorPoint:e.positionId,sort:t,id:e.id}):n.push({title:e.positionName,rowAnchorPoint:e.positionId,sort:t})});var i=function(e){var t=[];d.appNodes[e].nextNode&&0<d.appNodes[e].nextNode.length&&d.appNodes[e].nextNode.forEach(function(e){t.push(e.id)}),d.appNodes[e].editId?o.push({id:d.appNodes[e].editId,name:d.appNodes[e].title,listKey:d.appNodes[e].id,nextNode:t.join(\",\"),listId:d.appNodes[e].uniqueId,rowAnchorPoint:d.appNodes[e].rowId,columnAnchorPoint:d.appNodes[e].columnId}):o.push({name:d.appNodes[e].title,listKey:d.appNodes[e].id,nextNode:t.join(\",\"),listId:d.appNodes[e].uniqueId,rowAnchorPoint:d.appNodes[e].rowId,columnAnchorPoint:d.appNodes[e].columnId})};for(var a in d.appNodes)i(a);t.nodeList=o,t.stageList=s,t.positionList=n,t.title=d.moduleFromItem.moduleName,t.configColumns=l()(d.columns.slice(1)),t.configColumnDatas=l()(d.columnDatas),d.moduleId&&(t.id=d.moduleId),Object(r.t)(t).then(function(e){if(e.success){setTimeout(function(){d.$router.push({path:\"/BusinessModuleGraph/\"+e.moduleId})},5e3),d.$Message.success({content:e.message+\", 5秒后将自动离开当前页面\",duration:1})}}).catch(function(e){d.$Message.error(e.data.message)})}})},columnTemplate:function(e,t,o){var a=this;return{columnId:e,key:t,title:o,align:\"center\",renderHeader:function(e,t){return e(\"div\",[e(\"span\",t.column.title.trim()),e(\"Icon\",{class:\"column-icon-delete\",props:{type:\"md-trash\"},on:{click:function(){var e=t.column.columnId;a.handleColumnDelete(e)}}})])},render:function(o,i){var n=[];return i.row[i.column.key]&&0<i.row[i.column.key].length&&i.row[i.column.key].forEach(function(e){var t=o(\"Tag\",{attrs:{uniqueId:e.uniqueId,rowId:e.rowId,columnId:e.columnId},props:{color:\"primary\",closable:!0},on:{\"on-close\":function(e){var t=e.target.parentNode||e.srcElement.parentNode;a.handleDeleteNode(t.getAttribute(\"uniqueId\"),t.getAttribute(\"rowId\"),t.getAttribute(\"columnId\"))}}},[o(\"span\",{on:{click:function(e){e.preventDefault();var t=e.target.parentNode.parentNode.getAttribute(\"uniqueId\");a.handleEditNode(t)}}},e.title)]);n.push(t)}),n.push(o(\"a\",{on:{click:function(e){var t=a,o=[];for(var n in t.nodePositionId=i.row.positionId,t.nodeProcssId=i.column.columnId,t.isShowAddNodeModal=!0,t.onPageSelection=[],t.searchValue=\"\",t.appNodes)o.push(t.appNodes[n].id);t.withoutListId=o.join(\",\"),t.getAllAppList(t.appListCurrentPage,t.pageSize,t.withoutListId)}}},\"添加\")),o(\"div\",n)}}},handleAddNode:function(e){var n=this,i=this.columns.filter(function(e){return e.columnId===n.nodeProcssId})[0].key;this.columnDatas.forEach(function(e){if(e.positionId===n.nodePositionId){var t=[],o=[];e[i]&&0<e[i].length?0<n.onPageSelection.length&&(n.onPageSelection.forEach(function(e){o.push({title:e.title,id:e.id,uniqueId:e.uniqueId,rowId:n.nodePositionId,columnId:n.nodeProcssId}),n.appNodes[e.uniqueId]={title:e.title,id:e.id,uniqueId:e.uniqueId,rowId:n.nodePositionId,columnId:n.nodeProcssId}}),t=[].concat(a()(e[i]),o)):0<n.onPageSelection.length&&n.onPageSelection.forEach(function(e){t.push({title:e.title,id:e.id,uniqueId:e.uniqueId,rowId:n.nodePositionId,columnId:n.nodeProcssId}),n.appNodes[e.uniqueId]={title:e.title,id:e.id,uniqueId:e.uniqueId,rowId:n.nodePositionId,columnId:n.nodeProcssId}}),n.$set(e,i,t)}}),this.isShowAddNodeModal=!1},addJobsZColumn:function(){for(var o=this,e=this.jobsFormItem.name,n=this.jobsFormItem.id,t=function(t){o.columnDatas.push({jobId:n[t],positionId:o.getRandomCode(),positionName:e[t]}),o.joblist.forEach(function(e){e.id===n[t]&&o.$set(e,\"disabled\",!0)})},i=0;i<n.length;i++)t(i);this.isShowAddJobsModal=!1},handleJobModalNameChage:function(e){if(e){var t=[];e.map(function(e){t.push(e.label)}),this.jobsFormItem.name=t}},addProcssColumn:function(){var e=this.processFormItem.title,t=\"column_\"+this.getRandomCode(),o=this.columnTemplate(this.getRandomCode(),t,e,this);this.columns.push(o),this.isShowAddProcessModal=!1},handleRowDelete:function(t,o){var n=this,e=this.columnDatas.filter(function(e){return e.positionId!=t});this.columnDatas=e,this.joblist.forEach(function(e){e.id===o&&n.$set(e,\"disabled\",!1)});var i=[];for(var a in this.appNodes){this.appNodes[a].rowId===t&&(i.push(this.appNodes[a].uniqueId),delete this.appNodes[a])}0<i.length&&function(){var t=i.join(\",\");for(var e in n.appNodes){var o=n.appNodes[e].nextNode;o&&0<o.length&&(n.appNodes[e].nextNode=o.filter(function(e){return!~t.indexOf(e.uniqueId)}))}}()},handleColumnDelete:function(t){var n=this,e=this.columns.filter(function(e){return e.columnId!=t});this.columns=e;var i=[];for(var o in this.appNodes){this.appNodes[o].columnId===t&&(i.push(this.appNodes[o].uniqueId),delete this.appNodes[o])}0<i.length&&function(){var t=i.join(\",\");for(var e in n.appNodes){var o=n.appNodes[e].nextNode;o&&0<o.length&&(n.appNodes[e].nextNode=o.filter(function(e){return!~t.indexOf(e.uniqueId)}))}}()},handleDeleteNode:function(o,n,t){var i=this,a=this.columns.filter(function(e){return e.columnId===t})[0].key;this.columnDatas.forEach(function(e){if(e.positionId==n){if(e[a]&&0<e[a].length){var t=e[a].filter(function(e){return e.uniqueId!=o});i.$set(e,a,t)}}}),delete this.appNodes[o]&&this.$Message.success(\"删除成功!\")},handleEditNode:function(e){var t=this;this.drawerVisable=!0;var o=this.appNodes[e];this.NodeDetailFrom.uniqueId=o.uniqueId,this.NodeDetailFrom.title=o.title,this.NodeDetailFrom.nextNode=[],o.nextNode&&0<o.nextNode.length&&o.nextNode.map(function(e){t.NodeDetailFrom.nextNode.push(e.uniqueId)})},handleSaveNodeDetail:function(e){var t=this,o=t.NodeDetailFrom.uniqueId;t.appNodes[o].nextNode=[],t.NodeDetailFrom.nextNode[0]&&t.NodeDetailFrom.nextNode.forEach(function(e){t.appNodes[o].nextNode.push(t.appNodes[e])}),this.$Message.success(\"保存成功!\"),this.drawerVisable=!1},handleAppNameFilter:function(e){this.getAllAppList(this.appListCurrentPage,this.pageSize,\"\",this.searchValue)},onSelectAll:function(e){var t,o={};(t=this.onPageSelection).push.apply(t,a()(e)),this.onPageSelection=this.onPageSelection.reduce(function(e,t){return!o[t.uniqueId]&&(o[t.uniqueId]=e.push(t)),e},[])},handerSelectionChange:function(e){if(0===e.length){var t=this.$refs.selection.data,o=this.onPageSelection;t.map(function(t){o=o.filter(function(e){return e.uniqueId!==t.uniqueId})}),this.onPageSelection=o}else{var n,i={};(n=this.onPageSelection).push.apply(n,a()(e)),this.onPageSelection=this.onPageSelection.reduce(function(e,t){return!i[t.uniqueId]&&(i[t.uniqueId]=e.push(t)),e},[])}},onSelectCancel:function(e,t){this.onPageSelection=this.onPageSelection.filter(function(e){return e.uniqueId!==t.uniqueId})},deletePageSelection:function(){var o=this,n=event.target.parentElement.getAttribute(\"uniqueId\");this.onPageSelection=this.onPageSelection.filter(function(e){return e.uniqueId!==n}),this.$refs.selection.data.forEach(function(e,t){n===e.uniqueId&&o.$refs.selection.toggleSelect(t)})},appListChangePage:function(e){this.getAllAppList(e,this.pageSize,this.withoutListId,this.searchValue)},getAllAppList:function(e,t,o,n){var i=this;this.appListLoading=!0,o=o||\"-1\",Object(r.b)(e,this.pageSize,o,n).then(function(e){i.appListPageTotal=e.dataCount,i.appListData=e.tableContent,0<i.onPageSelection.length&&i.appListData.map(function(t){i.onPageSelection.map(function(e){t.uniqueId===e.uniqueId&&(t._checked=!0)})}),i.appListLoading=!1}).catch(function(e){i.$Message.error(e.message)})},getAllRoleData:function(){var o=this;Object(r.c)().then(function(e){o.joblist=e.tableContent,0<o.columnDatas.length&&o.columnDatas.forEach(function(t){o.joblist.forEach(function(e){t.positionName===e.name&&o.$set(e,\"disabled\",!0)})})})}},mounted:function(){var a=this;this.moduleId=this.$route.params.moduleId,this.moduleId?Object(r.e)(this.moduleId).then(function(n){JSON.parse(n.configColumns).forEach(function(t){var e=\"\";t.editId||(e=n.stageList.filter(function(e){return e.columnAnchorPoint===t.columnId})[0].id),a.columns.push({align:t.align,columnId:t.columnId,key:t.key,title:t.title,editId:t.editId?t.editId:e,renderHeader:function(e,t){return e(\"div\",[e(\"span\",t.column.title.trim()),e(\"Icon\",{class:\"column-icon-delete\",props:{type:\"md-trash\"},on:{click:function(){var e=t.column.columnId;a.handleColumnDelete(e)}}})])},render:function(o,i){var n=[];return i.row[i.column.key]&&0<i.row[i.column.key].length&&i.row[i.column.key].forEach(function(e){var t=o(\"Tag\",{attrs:{uniqueId:e.uniqueId,rowId:e.rowId,columnId:e.columnId},props:{color:\"primary\",closable:!0},on:{\"on-close\":function(e){var t=e.target.parentNode||e.srcElement.parentNode;a.handleDeleteNode(t.getAttribute(\"uniqueId\"),t.getAttribute(\"rowId\"),t.getAttribute(\"columnId\"))}}},[o(\"span\",{on:{click:function(e){e.preventDefault();var t=e.target.parentNode.parentNode.getAttribute(\"uniqueId\");a.handleEditNode(t)}}},e.title)]);n.push(t)}),n.push(o(\"a\",{on:{click:function(e){var t=a,o=[];for(var n in t.nodePositionId=i.row.positionId,t.nodeProcssId=i.column.columnId,t.isShowAddNodeModal=!0,t.onPageSelection=[],t.searchValue=\"\",t.appNodes)o.push(t.appNodes[n].id);t.withoutListId=o.join(\",\"),t.getAllAppList(t.appListCurrentPage,t.pageSize,t.withoutListId)}}},\"添加\")),o(\"div\",n)}})}),n.nodeList.forEach(function(e){var o=[];e.nextNode&&e.nextNode.split(\",\").forEach(function(t){var e=n.nodeList.filter(function(e){return e.listKey===t});1===e.length&&o.push({title:e[0].name,id:e[0].listKey,uniqueId:e[0].listId,rowId:e[0].rowAnchorPoint,columnId:e[0].columnAnchorPoint})}),a.appNodes[e.listId]={title:e.name,id:e.listKey,uniqueId:e.listId,rowId:e.rowAnchorPoint,columnId:e.columnAnchorPoint,nextNode:o,editId:e.id}}),a.columnDatas=JSON.parse(n.configColumnDatas),a.moduleFromItem.moduleName=n.title,a.getAllRoleData()}):this.getAllRoleData()}},u=o(\"rZ/c\"),c=o.n(u);var p=function(e){o(\"RIkY\")},m=o(\"VU/8\")(d,c.a,!1,p,null,null);t.default=m.exports},RIkY:function(e,t){},\"rZ/c\":function(e,t){e.exports={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o(\"div\",[o(\"div\",{staticStyle:{padding:\"20px\",\"background-color\":\"#fff\"}},[o(\"div\",{staticStyle:{\"font-size\":\"16px\",width:\"30%\"}},[o(\"Form\",{ref:\"moduleFromItem\",attrs:{model:t.moduleFromItem,rules:t.ruleValidate,labelWidth:100}},[o(\"FormItem\",{staticStyle:{\"font-size\":\"16px\"},attrs:{label:\"业务模块名称\",prop:\"moduleName\"}},[o(\"Input\",{model:{value:t.moduleFromItem.moduleName,callback:function(e){t.$set(t.moduleFromItem,\"moduleName\",e)},expression:\"moduleFromItem.moduleName\"}})],1)],1)],1),t._v(\" \"),o(\"div\",[o(\"Table\",{attrs:{columns:t.columns,data:t.columnDatas,size:\"small\",border:\"\"}})],1)]),t._v(\" \"),o(\"div\",{staticClass:\"config-action\",on:{click:t.handleSubmitBoxs}},[o(\"input\",{staticClass:\"config-action-submit\",attrs:{type:\"submit\",value:\"添加职位\",id:\"addJob\"}}),t._v(\" \"),o(\"input\",{staticClass:\"config-action-submit\",attrs:{type:\"submit\",value:\"添加阶段\",id:\"addProcess\"}}),t._v(\" \"),o(\"input\",{staticClass:\"config-action-submit\",staticStyle:{\"background-color\":\"rgb(0, 150, 136)\"},attrs:{type:\"submit\",value:\"保存\",id:\"save\"}}),t._v(\" \"),t.moduleId?o(\"input\",{staticClass:\"config-action-submit\",staticStyle:{\"background-color\":\"rgb(0, 150, 136)\"},attrs:{type:\"submit\",value:\"返回\",id:\"back\"}}):t._e()]),t._v(\" \"),o(\"Drawer\",{attrs:{title:\"节点详情\",transfer:\"\"},model:{value:t.drawerVisable,callback:function(e){t.drawerVisable=e},expression:\"drawerVisable\"}},[o(\"Form\",{ref:\"NodeDetailFrom\",attrs:{model:t.NodeDetailFrom,labelWidth:60}},[o(\"FormItem\",{staticStyle:{\"font-size\":\"16px\"},attrs:{label:\"名称:\",prop:\"title\"}},[o(\"Input\",{attrs:{disabled:\"\"},model:{value:t.NodeDetailFrom.title,callback:function(e){t.$set(t.NodeDetailFrom,\"title\",e)},expression:\"NodeDetailFrom.title\"}})],1),t._v(\" \"),o(\"FormItem\",{attrs:{label:\"下级节点\",labelWidth:60,prop:\"nextNode\"}},[o(\"Select\",{attrs:{multiple:\"\",clearable:\"\"},model:{value:t.NodeDetailFrom.nextNode,callback:function(e){t.$set(t.NodeDetailFrom,\"nextNode\",e)},expression:\"NodeDetailFrom.nextNode\"}},t._l(t.appNodes,function(e){return e.uniqueId!==t.NodeDetailFrom.uniqueId?o(\"Option\",{key:e.uniqueId,attrs:{value:e.uniqueId}},[t._v(\"\\n              \"+t._s(e.title)+\"\\n            \")]):t._e()}))],1)],1),t._v(\" \"),o(\"div\",[o(\"input\",{staticClass:\"drawer-detail-save-submit\",attrs:{type:\"submit\",value:\"保存\"},on:{click:t.handleSaveNodeDetail}})])],1),t._v(\" \"),o(\"add-jobs-modal\",{attrs:{width:\"360\",footerBtnAlign:\"right\",title:\"添加职位\"},on:{\"on-ok\":t.addJobsZColumn},model:{value:t.isShowAddJobsModal,callback:function(e){t.isShowAddJobsModal=e},expression:\"isShowAddJobsModal\"}},[o(\"div\",{staticStyle:{\"margin-top\":\"10px\"}},[o(\"Form\",{ref:\"jobsFormItem\",attrs:{model:t.jobsFormItem,labelWidth:60,prop:\"id\"}},[o(\"FormItem\",{staticStyle:{\"font-size\":\"16px\"},attrs:{label:\"名称:\"}},[o(\"Select\",{attrs:{\"label-in-value\":!0,multiple:\"\",clearable:\"\",transfer:\"\"},on:{\"on-change\":t.handleJobModalNameChage},model:{value:t.jobsFormItem.id,callback:function(e){t.$set(t.jobsFormItem,\"id\",e)},expression:\"jobsFormItem.id\"}},t._l(t.joblist,function(e){return o(\"Option\",{key:e.id,attrs:{value:e.id,label:e.name,disabled:!!e.disabled}},[t._v(t._s(e.name))])}))],1)],1)],1)]),t._v(\" \"),o(\"add-process-modal\",{attrs:{width:\"360\",footerBtnAlign:\"right\",title:\"添加阶段\"},on:{\"on-ok\":t.addProcssColumn},model:{value:t.isShowAddProcessModal,callback:function(e){t.isShowAddProcessModal=e},expression:\"isShowAddProcessModal\"}},[o(\"div\",{staticStyle:{\"margin-top\":\"10px\"}},[o(\"Form\",{ref:\"processFormItem\",attrs:{model:t.processFormItem,labelWidth:60}},[o(\"FormItem\",{staticStyle:{\"font-size\":\"16px\"},attrs:{label:\"名称:\",prop:\"title\"}},[o(\"Input\",{model:{value:t.processFormItem.title,callback:function(e){t.$set(t.processFormItem,\"title\",e)},expression:\"processFormItem.title\"}})],1)],1)],1)]),t._v(\" \"),o(\"add-node-modal\",{attrs:{width:\"720\",footerBtnAlign:\"right\",title:\"添加应用\"},on:{\"on-ok\":t.handleAddNode},model:{value:t.isShowAddNodeModal,callback:function(e){t.isShowAddNodeModal=e},expression:\"isShowAddNodeModal\"}},[o(\"div\",{staticStyle:{\"margin-top\":\"10px\"}},[o(\"div\",{staticClass:\"app-search\"},[o(\"Input\",{staticStyle:{width:\"300px\"},attrs:{search:!0,placeholder:\"搜索应用名称\"},on:{\"on-search\":t.handleAppNameFilter},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:\"searchValue\"}}),t._v(\" \"),o(\"a\",{staticClass:\"app-search-icon\"},[o(\"Button\",{attrs:{type:\"primary\",size:\"small\"},on:{click:t.handleAppNameFilter}},[t._v(\"查询\")])],1)],1),t._v(\" \"),o(\"Table\",{ref:\"selection\",attrs:{loading:t.appListLoading,columns:t.appListColumns,data:t.appListData,size:\"small\"},on:{\"on-select-all\":t.onSelectAll,\"on-selection-change\":t.handerSelectionChange,\"on-select-cancel\":t.onSelectCancel}}),t._v(\" \"),o(\"div\",{staticStyle:{margin:\"10px\",overflow:\"hidden\"}},[o(\"div\",{staticStyle:{float:\"right\"}},[o(\"Page\",{attrs:{total:t.appListPageTotal,current:t.appListCurrentPage,\"page-size\":t.pageSize,size:\"small\",\"show-total\":\"\",\"show-elevator\":\"\"},on:{\"on-change\":t.appListChangePage}})],1)])],1),t._v(\" \"),o(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.onPageSelection[0],expression:\"onPageSelection[0] \"}],staticClass:\"page-selection-warp\"},t._l(t.onPageSelection,function(e){return o(\"Tag\",{key:e.uniqueId,attrs:{uniqueId:e.uniqueId,type:\"border\",color:\"primary\",size:\"small\",closable:!0},on:{\"on-close\":t.deletePageSelection}},[t._v(\"\\n              \"+t._s(e.title)+\"\\n          \")])}))])],1)},staticRenderFns:[]}}});"}