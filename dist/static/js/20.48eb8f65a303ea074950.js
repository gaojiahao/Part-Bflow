webpackJsonp([20],{OsRJ:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("eV/a"),n=s("Edqs"),o=s.n(n),r=s("3SZ7"),a=s.n(r),c=s("GIAq"),u=s("U18u"),b=s("bJtM"),d=s("ejmB"),l={name:"WorkComments",components:{comments:b.a,commentPublish:d.a},props:{},data:function(){return{workGuideId:this.$route.params.id,type:"workGuide",comments:[],commentsCount:0,pageInfo:{limit:10,page:1,total:0},unsubcribeVisible:!1,subcribeVisible:!0,subscribeInfo:{isSubscribe:0,subscribeNum:0,subscribeUsers:[]}}},methods:{handlePublish:function(t,e){var s=this,i={type:this.type,content:t,relationKey:this.workGuideId,parentId:-1,commentAndReply:!1,commentAttachments:e};Object(c.U)(i).then(function(t){t.success?s.refreshComments():s.$Notice.warning({title:"系统提示",desc:"添加评论失败,请联系企业管理员!"})})},refreshComments:function(){var t=this,e={relationKey:this.workGuideId,sort:a()([{property:"crtTime",direction:"DESC"}])};e=o()(e,this.pageInfo),Object(c.C)(e).then(function(e){t.comments=e.tableContent,t.pageInfo.total=e.dataCount})},handlePageChange:function(t){this.pageInfo.page=t,this.refreshComments()},handleSubscribeApp:function(){var t=this;Object(u.c)({type:"workGuide",relationKey:this.workGuideId}).then(function(e){t.subscribeInfo.isSubscribe=1,t.refreshSubscribeInfo()})},handleUnsubscribeApp:function(t){var e=this;Object(u.d)({relationKey:this.workGuideId}).then(function(t){e.subscribeInfo.isSubscribe=0,e.refreshSubscribeInfo()})},refreshSubscribeInfo:function(){var t=this;this.$forceUpdate(),Object(u.a)({relationKey:this.workGuideId,limit:10,page:1}).then(function(e){t.subscribeInfo.subscribeUsers=e.tableContent,t.subscribeInfo.subscribeNum=e.dataCount})},judgeIsSubscribeByRelationKey:function(t){var e=this;Object(u.b)({relationKey:this.workGuideId}).then(function(t){e.subscribeInfo.isSubscribe=t})}},mounted:function(){this.refreshComments(),this.refreshSubscribeInfo(),this.judgeIsSubscribeByRelationKey()}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bg_ff "},[s("Row",{staticClass:"app-resource-group-title"},[s("h3",[t._v("评论 \n          "),s("b",{staticClass:"fr subscribe-bar"},[s("span",[1==t.subscribeInfo.isSubscribe&&t.subcribeVisible?s("span",{staticClass:"subcribeing",on:{mouseover:function(e){t.unsubcribeVisible=!0,t.subcribeVisible=!1},mouseout:function(e){t.unsubcribeVisible=!1,t.subcribeVisible=!0}}},[s("Icon",{staticClass:"success-color",attrs:{type:"md-checkmark"}}),t._v("正在关注中\n                  ")],1):t._e(),t._v(" "),1==t.subscribeInfo.isSubscribe&&t.unsubcribeVisible?s("span",{staticClass:"unsubcribe",on:{click:t.handleUnsubscribeApp,mouseout:function(e){t.unsubcribeVisible=!1,t.subcribeVisible=!0}}},[s("Icon",{staticClass:"warning-color",attrs:{type:"md-close"}}),t._v("取消关注\n                  ")],1):t._e(),t._v(" "),0==t.subscribeInfo.isSubscribe?s("span",{staticClass:"subcribe",on:{click:t.handleSubscribeApp}},[t._v("关注")]):t._e(),t._v(" "),s("span",[s("Icon",{staticClass:"success-color",attrs:{type:"md-notifications",size:"18"}})],1)]),t._v(" "),s("span",[s("Dropdown",{staticStyle:{"margin-left":"20px"},attrs:{placement:"bottom-end",trigger:"click"}},[s("Icon",{attrs:{type:"md-person",size:"18"}}),t._v(" "+t._s(t.subscribeInfo.subscribeNum)+"\n                      "),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.subscribeInfo.subscribeUsers,function(e,i){return s("DropdownItem",{key:i},[t._v("\n                             "+t._s(e.nickname)+"\n                          ")])}))],1)],1)])])]),t._v(" "),s("Row",{staticClass:"user-comment"},[s("commentPublish",{attrs:{handlePublish:t.handlePublish}}),t._v(" "),t.comments.length>0?s("div",{staticClass:"user-comment-header"},[s("strong",[t._v("最新评论("+t._s(t.pageInfo.total)+")")])]):t._e(),t._v(" "),s("comments",{attrs:{comments:t.comments,refreshRootComments:t.refreshComments}}),t._v(" "),t.pageInfo.total>0?s("Page",{staticClass:"pad20",attrs:{total:t.pageInfo.total,"page-size":t.pageInfo.limit,current:t.pageInfo.page,"prev-text":"上一页","next-text":"下一页"},on:{"on-change":t.handlePageChange}}):t._e()],1)],1)},staticRenderFns:[]};var p={name:"wokdGuideView",components:{WorkComments:s("D8HT")(l,m,!1,function(t){s("wSH7")},"data-v-41fa64d4",null).exports},data:function(){return{workguideId:this.$route.params.id,workguideData:{}}},methods:{getWorkGuideDataById:function(){var t=this;Object(i.c)(this.$route.params.id).then(function(e){t.workguideData=e}).catch(function(e){t.$Message.error(e.data.message)})}},created:function(){this.getWorkGuideDataById()}},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"workguide"},[s("Row",{staticClass:"workguide-title"},[s("h2",[t._v(t._s(t.workguideData.title))])]),t._v(" "),s("Row",{staticClass:"workguide-type"},[s("img",{attrs:{src:t.workguideData.creatorImage}}),t._v(" "),s("span",{staticClass:"workguide-type-worktype"},[t._v(t._s(t.workguideData.creatorName))]),t._v(" "),s("span",{staticClass:"workguide-type-crtTime"},[t._v(t._s(t.workguideData.crtTime))])]),t._v(" "),s("Row",{staticClass:"workguide-desc"},[s("p",[t._v(t._s(t.workguideData.comment))])]),t._v(" "),s("Row",{staticClass:"workguide-read"},[t._l(t.workguideData.workStepList,function(t,e){return s("img",{key:e,attrs:{src:t.image}})}),t._v(" "),s("router-link",{attrs:{to:{name:"wokdGuideStep",params:{id:t.workguideData.id}}}},[s("div",{staticClass:"workguide-read-go"},[t._v("\n                步骤阅读"),s("Icon",{staticStyle:{"font-size":"23px","margin-bottom":"4px"},attrs:{type:"ios-arrow-forward"}})],1)])],2),t._v(" "),s("Row",{staticClass:"workguide-content"},[s("Timeline",t._l(t.workguideData.workStepList,function(e,i){return s("TimelineItem",{key:i},[s("div",{staticClass:"step-num",attrs:{slot:"dot"},slot:"dot"},[t._v(t._s(i+1))]),t._v(" "),s("div",{staticClass:"step-detail"},[s("h2",[t._v(t._s(e.title))]),t._v(" "),s("div",{staticClass:"step-detail-comment"},[t._v(t._s(e.comment))]),t._v(" "),s("img",{attrs:{src:e.image}})])])})),t._v(" "),s("work-comments")],1),t._v(" "),s("Row",{staticClass:"workguide-toolbar"},[s("router-link",{attrs:{to:{name:"wokdGuideDetail",params:{id:t.workguideData.id}}}},[s("span",{staticClass:"workguide-toolbar-btn"},[t._v("编辑")])]),t._v(" "),s("router-link",{attrs:{to:{name:"wokdGuideList"}}},[s("span",{staticClass:"workguide-toolbar-btn"},[t._v("返回")])])],1)],1)},staticRenderFns:[]};var h=s("D8HT")(p,f,!1,function(t){s("UGWO")},"data-v-04a381a1",null);e.default=h.exports},UGWO:function(t,e){},wSH7:function(t,e){}});