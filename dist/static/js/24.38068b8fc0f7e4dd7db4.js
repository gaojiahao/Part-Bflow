webpackJsonp([24],{L7gP:function(e,t){},OsRJ:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("eV/a"),o=s("woOf"),r=s.n(o),n=s("mvHQ"),a=s.n(n),c=s("GIAq"),u=s("U18u"),d=s("bJtM"),b=s("ejmB"),l=s("CaXr"),m={name:"WorkComments",components:{comments:d.a,commentPublish:b.a,UserSelector:l.a},props:{},data:function(){return{workGuideId:this.$route.params.id,type:"workGuide",comments:[],commentsCount:0,pageInfo:{limit:10,page:1,total:0},unsubcribeVisible:!1,subcribeVisible:!0,showUserModal:!1,subscribeInfo:{isSubscribe:0,subscribeNum:0,subscribeUsers:[]}}},methods:{emitUserModal:function(){this.showUserModal=!1},getUserModalData:function(e){var t=this,s=[],i={};e.forEach(function(e){s.push(e.userId)}),s.length>0&&(i={relationKey:this.workGuideId,type:this.type,userIds:s.join(",")},Object(u.a)(i).then(function(e){e.success&&(t.$Message.success(e.message),t.refreshSubscribeInfo())}).catch(function(e){t.$Message.error(e.data.message)}))},addSubscribeUsers:function(e){"add"===e&&(this.showUserModal=!0)},deleteSubscribeUsers:function(e,t){var s=this,i={relationKey:this.workGuideId,userIds:e};this.$Modal.confirm({title:"确认",content:"确认退订<b style=color:#e4393c;>"+t+"</b>么？",onOk:function(){Object(u.b)(i).then(function(e){e.success&&(s.$Message.success(e.message),s.refreshSubscribeInfo())}).catch(function(e){s.$Message.error(e.data.message)})}})},handlePublish:function(e,t){var s=this,i={type:this.type,content:e,relationKey:this.workGuideId,parentId:-1,commentAndReply:!1,commentAttachments:t};Object(c.U)(i).then(function(e){e.success?s.refreshComments():s.$Notice.warning({title:"系统提示",desc:"添加评论失败,请联系企业管理员!"})})},refreshComments:function(){var e=this,t={relationKey:this.workGuideId,sort:a()([{property:"crtTime",direction:"DESC"}])};t=r()(t,this.pageInfo),Object(c.C)(t).then(function(t){e.comments=t.tableContent,e.pageInfo.total=t.dataCount})},handlePageChange:function(e){this.pageInfo.page=e,this.refreshComments()},handleSubscribeApp:function(){var e=this;Object(u.e)({type:"workGuide",relationKey:this.workGuideId}).then(function(t){e.subscribeInfo.isSubscribe=1,e.refreshSubscribeInfo()})},handleUnsubscribeApp:function(e){var t=this;Object(u.f)({relationKey:this.workGuideId}).then(function(e){t.subscribeInfo.isSubscribe=0,t.refreshSubscribeInfo()})},refreshSubscribeInfo:function(){var e=this;this.$forceUpdate(),Object(u.c)({relationKey:this.workGuideId,limit:10,page:1}).then(function(t){e.subscribeInfo.subscribeUsers=t.tableContent,e.subscribeInfo.subscribeNum=t.dataCount})},judgeIsSubscribeByRelationKey:function(e){var t=this;Object(u.d)({relationKey:this.workGuideId}).then(function(e){t.subscribeInfo.isSubscribe=e})}},mounted:function(){this.refreshComments(),this.refreshSubscribeInfo(),this.judgeIsSubscribeByRelationKey()}},f={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"bg_ff "},[s("Row",{staticClass:"app-resource-group-title"},[s("h3",[e._v("评论 \n          "),s("b",{staticClass:"fr subscribe-bar"},[s("span",[1==e.subscribeInfo.isSubscribe&&e.subcribeVisible?s("span",{staticClass:"subcribeing",on:{mouseover:function(t){e.unsubcribeVisible=!0,e.subcribeVisible=!1},mouseout:function(t){e.unsubcribeVisible=!1,e.subcribeVisible=!0}}},[s("Icon",{staticClass:"success-color",attrs:{type:"md-checkmark"}}),e._v("正在关注中\n                  ")],1):e._e(),e._v(" "),1==e.subscribeInfo.isSubscribe&&e.unsubcribeVisible?s("span",{staticClass:"unsubcribe",on:{click:e.handleUnsubscribeApp,mouseout:function(t){e.unsubcribeVisible=!1,e.subcribeVisible=!0}}},[s("Icon",{staticClass:"warning-color",attrs:{type:"md-close"}}),e._v("取消关注\n                  ")],1):e._e(),e._v(" "),0==e.subscribeInfo.isSubscribe?s("span",{staticClass:"subcribe",on:{click:e.handleSubscribeApp}},[e._v("关注")]):e._e(),e._v(" "),s("span",[s("Icon",{staticClass:"success-color",attrs:{type:"md-notifications",size:"18"}})],1)]),e._v(" "),s("span",[s("Dropdown",{staticStyle:{"margin-left":"20px"},attrs:{trigger:"click"},on:{"on-click":e.addSubscribeUsers}},[s("Icon",{attrs:{type:"md-person",size:"18"}}),e._v(" "+e._s(e.subscribeInfo.subscribeNum)+"\n                       "),s("Icon",{attrs:{type:"ios-arrow-down"}}),e._v(" "),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[s("DropdownItem",{attrs:{name:"add"}},[e._v("\n                             添加关注者\n                          ")]),e._v(" "),e._l(e.subscribeInfo.subscribeUsers,function(t,i){return s("DropdownItem",{key:i},[e._v("\n                             "+e._s(t.nickname)+"\n                             "),s("span",{staticClass:"delete-user",on:{click:function(s){s.stopPropagation(),e.deleteSubscribeUsers(t.userId,t.nickname)}}},[s("Icon",{attrs:{type:"md-close"}})],1)])})],2)],1)],1)])])]),e._v(" "),s("Row",{staticClass:"user-comment"},[s("commentPublish",{attrs:{handlePublish:e.handlePublish}}),e._v(" "),e.comments.length>0?s("div",{staticClass:"user-comment-header"},[s("strong",[e._v("最新评论("+e._s(e.pageInfo.total)+")")])]):e._e(),e._v(" "),s("comments",{attrs:{comments:e.comments,refreshRootComments:e.refreshComments}}),e._v(" "),e.pageInfo.total>0?s("Page",{staticClass:"pad20",attrs:{total:e.pageInfo.total,"page-size":e.pageInfo.limit,current:e.pageInfo.page,"prev-text":"上一页","next-text":"下一页"},on:{"on-change":e.handlePageChange}}):e._e()],1),e._v(" "),s("user-selector",{attrs:{showUserSelector:e.showUserModal},on:{emitUserModal:e.emitUserModal,userModalData:e.getUserModalData}})],1)},staticRenderFns:[]};var h={name:"wokdGuideView",components:{WorkComments:s("VU/8")(m,f,!1,function(e){s("RIEe")},"data-v-d72f5448",null).exports},data:function(){return{workguideId:this.$route.params.id,workguideData:{}}},methods:{getWorkGuideDataById:function(){var e=this;Object(i.c)(this.$route.params.id).then(function(t){e.workguideData=t}).catch(function(t){e.$Message.error(t.data.message)})}},created:function(){this.getWorkGuideDataById()}},p={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"workguide"},[s("Row",{staticClass:"workguide-title"},[s("h2",[e._v(e._s(e.workguideData.title))])]),e._v(" "),s("Row",{staticClass:"workguide-type"},[s("img",{attrs:{src:e.workguideData.creatorImage}}),e._v(" "),s("span",{staticClass:"workguide-type-worktype"},[e._v(e._s(e.workguideData.creatorName))]),e._v(" "),s("span",{staticClass:"workguide-type-crtTime"},[e._v(e._s(e.workguideData.crtTime))])]),e._v(" "),s("Row",{staticClass:"workguide-desc"},[s("p",[e._v(e._s(e.workguideData.comment))])]),e._v(" "),s("Row",{staticClass:"workguide-read"},[e._l(e.workguideData.workStepList,function(e,t){return s("img",{key:t,attrs:{src:e.image}})}),e._v(" "),s("router-link",{attrs:{to:{name:"wokdGuideStep",params:{id:e.workguideData.id}}}},[s("div",{staticClass:"workguide-read-go"},[e._v("\n                步骤阅读"),s("Icon",{staticStyle:{"font-size":"23px","margin-bottom":"4px"},attrs:{type:"ios-arrow-forward"}})],1)])],2),e._v(" "),s("Row",{staticClass:"workguide-content"},[s("Timeline",e._l(e.workguideData.workStepList,function(t,i){return s("TimelineItem",{key:i},[s("div",{staticClass:"step-num",attrs:{slot:"dot"},slot:"dot"},[e._v(e._s(i+1))]),e._v(" "),s("div",{staticClass:"step-detail"},[s("h2",[e._v(e._s(t.title))]),e._v(" "),s("div",{staticClass:"step-detail-comment"},[e._v(e._s(t.comment))]),e._v(" "),s("img",{attrs:{src:t.image}})])])})),e._v(" "),s("work-comments")],1),e._v(" "),s("Row",{staticClass:"workguide-toolbar"},[s("router-link",{attrs:{to:{name:"wokdGuideDetail",params:{id:e.workguideData.id}}}},[s("span",{staticClass:"workguide-toolbar-btn"},[e._v("编辑")])]),e._v(" "),s("router-link",{attrs:{to:{name:"wokdGuideList"}}},[s("span",{staticClass:"workguide-toolbar-btn"},[e._v("返回")])])],1)],1)},staticRenderFns:[]};var g=s("VU/8")(h,p,!1,function(e){s("L7gP")},"data-v-04a381a1",null);t.default=g.exports},RIEe:function(e,t){}});