webpackJsonp([5],{"3Jlf":function(t,e){t.exports={render:function(){var o=this,t=o.$createElement,n=o._self._c||t;return n("div",{staticClass:"workguide"},[n("Row",{staticClass:"workguide-title"},[n("span",[n("b",{staticStyle:{color:"#e4393c","margin-left":"-9px"}},[o._v("*")]),o._v("标题：")]),o._v(" "),n("Input",{staticStyle:{width:"300px"},model:{value:o.workGuideData.title,callback:function(t){o.$set(o.workGuideData,"title",t)},expression:"workGuideData.title"}})],1),o._v(" "),this.$route.params.id?n("Row",{staticClass:"workguide-type"},[n("img",{attrs:{src:o.workGuideData.creatorImage}}),o._v(" "),n("span",{staticClass:"workguide-type-worktype"},[o._v(o._s(o.workGuideData.creatorName))]),o._v(" "),n("span",{staticClass:"workguide-type-crtTime"},[o._v(o._s(o.workGuideData.crtTime))])]):o._e(),o._v(" "),n("Row",{staticClass:"workguide-desc"},[n("span",[o._v("描述：")]),o._v(" "),n("Input",{attrs:{type:"textarea"},model:{value:o.workGuideData.comment,callback:function(t){o.$set(o.workGuideData,"comment",t)},expression:"workGuideData.comment"}})],1),o._v(" "),n("Row",{staticClass:"workguide-read"},o._l(o.workGuideData.workStepList,function(t,e){return n("img",{key:e,attrs:{src:t.image},on:{click:function(t){o.goAnchor(e)}}})})),o._v(" "),n("Row",{staticClass:"workguide-content"},[n("div",{staticClass:"workguide-content-add"},[n("span",{staticClass:"workguide-content-add-btn",on:{click:o.addStep}},[o._v("添加步骤")]),o._v(" "),n("b",{directives:[{name:"show",rawName:"v-show",value:0<o.workGuideData.workStepList.length,expression:"workGuideData.workStepList.length>0"}]},[o._v("拖动下方列表可排序")])]),o._v(" "),n("Timeline",[n("draggable",{attrs:{options:o.dragOptions,move:o.onMove},model:{value:o.workGuideData.workStepList,callback:function(t){o.$set(o.workGuideData,"workStepList",t)},expression:"workGuideData.workStepList"}},o._l(o.workGuideData.workStepList,function(e,i){return n("TimelineItem",{key:i,attrs:{id:"anchor"+i}},[n("div",{class:{"step-num":!0,"step-num-anchor":i===o.isAnchor},attrs:{slot:"dot"},slot:"dot"},[o._v(o._s(i+1))]),o._v(" "),n("div",{staticClass:"step-detail"},[n("i",{}),o._v(" "),n("h4",[o._v(o._s(e.title))]),o._v(" "),n("div",{staticClass:"workguide-content-delete",on:{click:function(t){o.deleteStep(e,i)}}},[o._v("删除")]),o._v(" "),n("div",{staticClass:"workguide-content-delete",on:{click:function(t){o.editStep(e,i)}}},[o._v("修改")]),o._v(" "),n("div",{staticClass:"step-detail-comment"},[o._v(o._s(e.comment))]),o._v(" "),n("img",{attrs:{src:e.image}})])])}))],1)],1),o._v(" "),n("Row",{staticClass:"workguide-toolbar"},[n("span",{staticClass:"workguide-toolbar-btn",on:{click:function(t){o.saveWorkguide("save")}}},[o._v("保存")]),o._v(" "),n("span",{staticClass:"workguide-toolbar-btn",on:{click:o.saveWorkguide}},[o._v("保存并继续添加")]),o._v(" "),n("router-link",{attrs:{to:{name:"wokdGuideList"}}},[n("span",{staticClass:"workguide-toolbar-btn"},[o._v("返回")])])],1),o._v(" "),n("Modal",{attrs:{transfer:!1,title:"添加步骤"},model:{value:o.showModal,callback:function(t){o.showModal=t},expression:"showModal"}},[n("Form",{ref:"formValidate",attrs:{model:o.formValidate,rules:o.ruleValidate,"label-width":80}},[n("FormItem",{attrs:{label:"标题",prop:"title"}},[n("Input",{model:{value:o.formValidate.title,callback:function(t){o.$set(o.formValidate,"title",t)},expression:"formValidate.title"}})],1),o._v(" "),n("FormItem",{attrs:{label:"描述"}},[n("Input",{attrs:{type:"textarea"},model:{value:o.formValidate.comment,callback:function(t){o.$set(o.formValidate,"comment",t)},expression:"formValidate.comment"}})],1),o._v(" "),n("FormItem",{attrs:{label:"图片：","label-width":91}},[n("Upload",{ref:"upload",staticClass:"upload-img",attrs:{"show-upload-list":!1,"on-success":o.handleSuccess,format:["jpg","jpeg","png"],"max-size":2048,"on-format-error":o.handleFormatError,"on-exceeded-size":o.handleMaxSize,type:"drag",action:"/H_roleplay-si/ds/upload",headers:o.httpHeaders}},[o.formValidate.logo?o._e():n("div",{staticClass:"upload-img-first"},[o.formValidate.logo?n("img",{attrs:{src:o.formValidate.logo}}):o._e(),o._v(" "),o.formValidate.logo?o._e():n("i",{staticClass:"iconfont"},[o._v("")])]),o._v(" "),o.formValidate.logo?n("div",{staticClass:"demo-upload-list"},[n("img",{attrs:{src:o.formValidate.logo}}),o._v(" "),n("div",{staticClass:"demo-upload-list-cover"},[n("Icon",{attrs:{type:"ios-eye-outline",color:"#fff",size:"30"},on:{click:function(t){return t.stopPropagation(),o.handleView(t)}}}),o._v(" "),n("Icon",{attrs:{type:"ios-trash-outline",color:"#fff",size:"30"},on:{click:function(t){return t.stopPropagation(),o.handleRemove(t)}}})],1)]):o._e()]),o._v(" "),n("Modal",{attrs:{title:"查看头像"},model:{value:o.visible,callback:function(t){o.visible=t},expression:"visible"}},[o.visible?n("img",{staticStyle:{width:"100%"},attrs:{src:o.formValidate.logo}}):o._e(),o._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"})])],1)],1),o._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"primary"},on:{click:o.confirmAdd}},[o._v("确定")]),o._v(" "),n("Button",{attrs:{type:"default"},on:{click:o.cancelAdd}},[o._v("取消")])],1)],1)],1)},staticRenderFns:[]}},DAYN:function(i,t,o){"use strict";var c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t};function u(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}!function(){function t(o){function n(t){t.parentElement.removeChild(t)}function a(t,e,i){var o=0===i?t.children[0]:t.children[i-1].nextSibling;t.insertBefore(e,o)}function r(t,e){var i=this;this.$nextTick(function(){return i.$emit(t.toLowerCase(),e)})}var s=["Start","Add","Remove","Update","End"],l=["Choose","Sort","Filter","Clone"],i=["Move"].concat(s,l).map(function(t){return"on"+t}),d=null;return{name:"draggable",props:{options:Object,list:{type:Array,required:!1,default:null},value:{type:Array,required:!1,default:null},noTransitionOnDrag:{type:Boolean,default:!1},clone:{type:Function,default:function(t){return t}},element:{type:String,default:"div"},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},data:function(){return{transitionMode:!1,noneFunctionalComponentMode:!1,init:!1}},render:function(t){var e=this.$slots.default;if(e&&1===e.length){var i=e[0];i.componentOptions&&"transition-group"===i.componentOptions.tag&&(this.transitionMode=!0)}var o=e,n=this.$slots.footer;n&&(o=e?[].concat(u(e),u(n)):[].concat(u(n)));var a=null,r=function(t,e){var i,o,n;i=a,o=t,null==(n=e)||((i=null==i?{}:i)[o]=n),a=i};if(r("attrs",this.$attrs),this.componentData){var s=this.componentData,l=s.on,d=s.props;r("on",l),r("props",d)}return t(this.element,a,o)},mounted:function(){var i=this;if(this.noneFunctionalComponentMode=this.element.toLowerCase()!==this.$el.nodeName.toLowerCase(),this.noneFunctionalComponentMode&&this.transitionMode)throw new Error("Transition-group inside component is not supported. Please alter element value or remove transition-group. Current element value: "+this.element);var e={};s.forEach(function(t){e["on"+t]=function(e){var i=this;return function(t){null!==i.realList&&i["onDrag"+e](t),r.call(i,e,t)}}.call(i,t)}),l.forEach(function(t){e["on"+t]=r.bind(i,t)});var t=c({},this.options,e,{onMove:function(t,e){return i.onDragMove(t,e)}});!("draggable"in t)&&(t.draggable=">*"),this._sortable=new o(this.rootContainer,t),this.computeIndexes()},beforeDestroy:function(){this._sortable.destroy()},computed:{rootContainer:function(){return this.transitionMode?this.$el.children[0]:this.$el},isCloning:function(){return!!this.options&&!!this.options.group&&"clone"===this.options.group.pull},realList:function(){return this.list?this.list:this.value}},watch:{options:{handler:function(t){for(var e in t)-1==i.indexOf(e)&&this._sortable.option(e,t[e])},deep:!0},realList:function(){this.computeIndexes()}},methods:{getChildrenNodes:function(){if(this.init||(this.noneFunctionalComponentMode=this.noneFunctionalComponentMode&&1==this.$children.length,this.init=!0),this.noneFunctionalComponentMode)return this.$children[0].$slots.default;var t=this.$slots.default;return this.transitionMode?t[0].child.$slots.default:t},computeIndexes:function(){var t=this;this.$nextTick(function(){t.visibleIndexes=function(t,e,i){if(!t)return[];var o=t.map(function(t){return t.elm}),n=[].concat(u(e)).map(function(t){return o.indexOf(t)});return i?n.filter(function(t){return-1!==t}):n}(t.getChildrenNodes(),t.rootContainer.children,t.transitionMode)})},getUnderlyingVm:function(t){var e,i,o=(e=this.getChildrenNodes()||[],i=t,e.map(function(t){return t.elm}).indexOf(i));return-1===o?null:{index:o,element:this.realList[o]}},getUnderlyingPotencialDraggableComponent:function(t){var e=t.__vue__;return e&&e.$options&&"transition-group"===e.$options._componentTag?e.$parent:e},emitChanges:function(t){var e=this;this.$nextTick(function(){e.$emit("change",t)})},alterList:function(t){if(this.list)t(this.list);else{var e=[].concat(u(this.value));t(e),this.$emit("input",e)}},spliceList:function(){var e=arguments,t=function(t){return t.splice.apply(t,e)};this.alterList(t)},updatePosition:function(e,i){var t=function(t){return t.splice(i,0,t.splice(e,1)[0])};this.alterList(t)},getRelatedContextFromMoveEvent:function(t){var e=t.to,i=t.related,o=this.getUnderlyingPotencialDraggableComponent(e);if(!o)return{component:o};var n=o.realList,a={list:n,component:o};if(e!==i&&n&&o.getUnderlyingVm){var r=o.getUnderlyingVm(i);if(r)return c(r,a)}return a},getVmIndex:function(t){var e=this.visibleIndexes,i=e.length;return i-1<t?i:e[t]},getComponent:function(){return this.$slots.default[0].componentInstance},resetTransitionData:function(t){if(this.noTransitionOnDrag&&this.transitionMode){this.getChildrenNodes()[t].data=null;var e=this.getComponent();e.children=[],e.kept=void 0}},onDragStart:function(t){this.context=this.getUnderlyingVm(t.item),t.item._underlying_vm_=this.clone(this.context.element),d=t.item},onDragAdd:function(t){var e=t.item._underlying_vm_;if(void 0!==e){n(t.item);var i=this.getVmIndex(t.newIndex);this.spliceList(i,0,e),this.computeIndexes();var o={element:e,newIndex:i};this.emitChanges({added:o})}},onDragRemove:function(t){if(a(this.rootContainer,t.item,t.oldIndex),this.isCloning)n(t.clone);else{var e=this.context.index;this.spliceList(e,1);var i={element:this.context.element,oldIndex:e};this.resetTransitionData(e),this.emitChanges({removed:i})}},onDragUpdate:function(t){n(t.item),a(t.from,t.item,t.oldIndex);var e=this.context.index,i=this.getVmIndex(t.newIndex);this.updatePosition(e,i);var o={element:this.context.element,oldIndex:e,newIndex:i};this.emitChanges({moved:o})},computeFutureIndex:function(t,e){if(!t.element)return 0;var i=[].concat(u(e.to.children)).filter(function(t){return"none"!==t.style.display}),o=i.indexOf(e.related),n=t.component.getVmIndex(o);return-1!=i.indexOf(d)||!e.willInsertAfter?n:n+1},onDragMove:function(t,e){var i=this.move;if(!i||!this.realList)return!0;var o=this.getRelatedContextFromMoveEvent(t),n=this.context,a=this.computeFutureIndex(o,t);return c(n,{futureIndex:a}),c(t,{relatedContext:o,draggedContext:n}),i(t,e)},onDragEnd:function(t){this.computeIndexes(),d=null}}}}Array.from||(Array.from=function(t){return[].slice.call(t)});var e=o("Lokx");i.exports=t(e)}()},KisX:function(t,e){},"x4+L":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("eV/a"),n=i("oAV5"),a=i("DAYN"),r={name:"wokdGuideDetail",components:{draggable:i.n(a).a},data:function(){return{workguideId:this.$route.params.id,showModal:!1,visible:!1,isAnchor:-1,httpHeaders:{Authorization:Object(n.c)()},formValidate:{title:"",comment:"",logo:""},ruleValidate:{title:[{required:!0,message:"请输入标题",trigger:"blur"}]},workGuideData:{title:"",comment:"",workStepList:[]}}},computed:{dragOptions:function(){return{animation:500,group:"description",disabled:!1,handle:".step-detail",ghostClass:"ghost"}}},methods:{onMove:function(t){var e=t.relatedContext,i=t.draggedContext,o=e.element,n=i.element;return!(o&&o.fixed||n.fixed)},saveWorkguide:function(e){var i=this;this.workguideId?""===this.workGuideData.title?this.$Message.error("请输入标题！"):Object(o.e)(this.workGuideData).then(function(t){t.success&&(i.$Message.success(t.message),"save"===e?i.$router.push({path:"/wokdGuide/list"}):(i.$router.push({path:"/wokdGuide/add"}),window.location.reload()))}).catch(function(t){i.$Message.error(t.data.message)}):""===this.workGuideData.title?this.$Message.error("请输入标题！"):Object(o.d)(this.workGuideData).then(function(t){t.success&&(i.$Message.success(t.message),"save"===e?i.$router.push({path:"/wokdGuide/list"}):i.workGuideData={title:"",comment:"",workStepList:[]})}).catch(function(t){i.$Message.error(t.data.message)})},getKnowledgeDataById:function(){var e=this;getKnowledgeTypeDataById(this.knowledgeId).then(function(t){e.knowledgeForm=t}).catch(function(t){e.$Message.error(t.data.message)})},addStep:function(){this.showModal=!0,this.$refs.formValidate.resetFields(),this.formValidate.logo="",this.formValidate.comment="",this.formValidate.edit=!1},deleteStep:function(t,e){this.workGuideData.workStepList.splice(e,1)},editStep:function(t,e){this.showModal=!0,this.formValidate.title=t.title,this.formValidate.comment=t.comment,this.formValidate.logo=t.image,this.formValidate.currentIndex=e,this.formValidate.edit=!0},cancelAdd:function(){this.showModal=!1},confirmAdd:function(){var e=this;this.$refs.formValidate.validate(function(t){t&&(e.formValidate.edit?(e.workGuideData.workStepList[e.formValidate.currentIndex].title=e.formValidate.title,e.workGuideData.workStepList[e.formValidate.currentIndex].comment=e.formValidate.comment,e.workGuideData.workStepList[e.formValidate.currentIndex].image=e.formValidate.logo):e.workGuideData.workStepList.push({title:e.formValidate.title,comment:e.formValidate.comment,image:e.formValidate.logo}),e.showModal=!1)})},handleSuccess:function(t,e){this.formValidate.logo="/H_roleplay-si/ds/download?width=300&height=300&url="+t.data[0].attacthment},handleMaxSize:function(t){this.$Notice.warning({title:"文件大小超出范围",desc:"文件大小最大为2M"})},handleFormatError:function(t){this.$Notice.warning({title:"文件格式不对",desc:"请上传格式为png 或者 jpg 的图片"})},handleView:function(){this.visible=!0},handleRemove:function(){this.formValidate.logo="",this.$refs.upload.fileList.splice(0,this.$refs.upload.fileList.length)},getWorkGuideDataById:function(){var e=this;Object(o.c)(this.$route.params.id).then(function(t){e.workGuideData=t}).catch(function(t){e.$Message.error(t.data.message)})},goAnchor:function(t){this.isAnchor=t,document.querySelector(".workguide").scrollTop=this.$el.querySelector("#anchor"+t).offsetTop}},created:function(){this.$route.params.id&&this.getWorkGuideDataById()}},s=i("3Jlf"),l=i.n(s);var d=function(t){i("KisX")},c=i("VU/8")(r,l.a,!1,d,"data-v-7837cdce",null);e.default=c.exports}});