{"source":"webpackJsonp([26],{\"8ozC\":function(e,t){},\"9Qvy\":function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var o=n(\"Gu7T\"),s=n.n(o),a=n(\"mvHQ\"),i=n.n(a),c=n(\"UzZq\"),l={name:\"FlowtaskToDo\",data:function(){var n=this;return{columns:[{type:\"selection\",width:60,align:\"center\",key:\"unableEdit\"},{title:\"任务编号\",key:\"taskId\",width:90,render:function(e,t){return e(\"div\",[e(\"Badge\",{props:{dot:!0},style:{marginRight:\"5px\",paddingBottom:\"8px\"}}),e(\"span\",{},t.row.taskId)])}},{title:\"交易号\",slot:\"businessKey\",width:165},{title:\"往来\",key:\"dealerName\",width:140},{title:\"操作名称\",key:\"nodeName\",width:165},{title:\"应用名称\",key:\"title\",width:165},{title:\"发起人\",key:\"crtName\",width:80},{title:\"待办创建时间\",key:\"crtTime\",width:150},{title:\"已过小时数\",key:\"pastTimeHour\",width:120,sortable:\"custom\",render:function(e,t){return e(\"span\",{},n.calcLeadTime(t.row.crtTime,!0))}},{title:\"已过时间\",key:\"crtTime\",width:150,render:function(e,t){return e(\"span\",{},n.calcLeadTime(t.row.crtTime))}}],data:[],pageInfo:{limit:30,page:1,total:0,filter:[]},searchkeywords:\"\",tableHeight:1,loading:!1,sortColumn:null,onPageSelection:[],batchComment:\"\"}},methods:{onSortChange:function(e){\"normal\"===e.order?(delete this.pageInfo.sort,this.sortColumn=null):this.sortColumn=[{property:e.key,direction:e.order}],this.getFlowTodoTasks()},getFlowTodoTasks:function(){var n=this;this.pageInfo.filter=i()([{link:\"or\",operator_1:\"like\",value_1:this.searchkeywords,property_1:\"businessKey\",operator_2:\"like\",value_2:this.searchkeywords,property_2:\"dealerName\"}]),this.sortColumn&&(this.pageInfo.sort=i()(this.sortColumn)),this.loading=!0,Object(c.h)(this.pageInfo).then(function(e){n.data=e.tableContent,n.pageInfo.total=e.dataCount,n.data.forEach(function(t){0<n.onPageSelection.length&&n.onPageSelection.forEach(function(e){e.taskId===t.taskId&&(t._checked=!0)}),t.unableEdit||(t._disabled=!0)}),n.loading=!1})},handlePageChange:function(e){this.pageInfo.page=e,this.getFlowTodoTasks()},handlePageSizeChange:function(e){this.pageInfo.limit=e,this.getFlowTodoTasks()},handleSearch:function(){this.pageInfo.page=1,this.getFlowTodoTasks()},calcLeadTime:function(e,t){var n=new Date(e.replace(/-/g,\"/\")),o=(new Date).getTime()-n.getTime(),a=Math.floor(o/864e5),s=o%864e5,i=Math.floor(s/36e5),c=s%36e5,l=Math.floor(c/6e4),r=c%6e4,h=Math.round(r/1e3);return t?24*a+i+\"小时\":a+\"天\"+i+\"时\"+l+\"分\"+h+\"秒\"},subscribeMessage:function(){var t=this;this.$deepstream.event.subscribe(\"taskChange/\"+this.$currentUser.userId,function(e){t.getFlowTodoTasks()})},handleBatchApproval:function(){var n=this;this.batchComment=\"\",this.$Modal.confirm({title:\"系统提示\",content:\"<p>审批意见</p>\",closable:!0,okText:\"同意\",cancelText:\"不同意\",render:function(e){return e(\"div\",[e(\"label\",\"审批意见: \"),e(\"Input\",{props:{value:n.batchComment,autofocus:!0},style:{width:\"75%\",marginLeft:\"10px\"},on:{input:function(e){n.batchComment=e}}})])},onOk:function(){var e=n.onPageSelection,t=[];e.forEach(function(e){t.push({taskId:e.taskId,transCode:e.businessKey,result:1,comment:n.batchComment})}),Object(c.a)(t).then(function(e){e.success?(n.getFlowTodoTasks(),n.onPageSelection=[],n.$Notice.success({title:\"提示\",desc:e.message})):n.$Notice.error({title:\"提示\",desc:e.message})})},onCancel:function(){var e=n.onPageSelection,t=[];e.forEach(function(e){t.push({taskId:e.taskId,transCode:e.businessKey,result:0,comment:n.batchComment})}),Object(c.a)(t).then(function(e){e.success?(n.getFlowTodoTasks(),n.onPageSelection=[],n.$Notice.success({title:\"提示\",desc:e.message})):n.$Notice.error({title:\"提示\",desc:e.message})})}})},onSelectAll:function(e){var t,n={};(t=this.onPageSelection).push.apply(t,s()(e)),this.onPageSelection=this.onPageSelection.reduce(function(e,t){return!n[t.taskId]&&(n[t.taskId]=e.push(t)),e},[])},handerSelectionChange:function(e){if(0===e.length){var t=this.$refs.selection.data,n=this.onPageSelection;t.map(function(t){n=n.filter(function(e){return e.taskId!==t.taskId})}),this.onPageSelection=n}else{var o,a={};(o=this.onPageSelection).push.apply(o,s()(e)),this.onPageSelection=this.onPageSelection.reduce(function(e,t){return!a[t.taskId]&&(a[t.taskId]=e.push(t)),e},[])}},onSelectCancel:function(e,t){this.onPageSelection=this.onPageSelection.filter(function(e){return e.taskId!==t.taskId})}},mounted:function(){var e=this;this.getFlowTodoTasks(),this.subscribeMessage(),this.tableHeight=document.body.clientHeight-200,window.onresize=function(){e.tableHeight=document.body.clientHeight-200}}},r=n(\"Gv6/\"),h=n.n(r);var d=function(e){n(\"8ozC\")},u=n(\"VU/8\")(l,h.a,!1,d,\"data-v-ebc2d3f0\",null);t.default=u.exports},\"Gv6/\":function(e,t){e.exports={render:function(){var n=this,e=n.$createElement,o=n._self._c||e;return o(\"div\",{staticClass:\"todotask\"},[o(\"div\",{staticClass:\"todotask-header\"},[n._v(\"\\n        我的待办\\n    \")]),n._v(\" \"),o(\"div\",{staticClass:\"todotask-content\"},[o(\"div\",{staticClass:\"todotask-content-container shadow\"},[o(\"div\",{staticClass:\"todotask-content-container-toolbar\"},[o(\"Input\",{staticClass:\"todotask-content-container-toolbar-search\",attrs:{search:\"\",placeholder:\"输入交易号或往来对象查询\"},on:{\"on-enter\":n.handleSearch,\"on-change\":n.handleSearch},model:{value:n.searchkeywords,callback:function(e){n.searchkeywords=e},expression:\"searchkeywords\"}}),n._v(\" \"),o(\"Button\",{staticStyle:{float:\"right\",height:\"29px\"},attrs:{type:\"primary\",disabled:0===n.onPageSelection.length},on:{click:n.handleBatchApproval}},[n._v(\"\\n                    批量审批\\n                \")])],1),n._v(\" \"),o(\"Table\",{ref:\"selection\",staticClass:\"todotask-content-table\",attrs:{loading:n.loading,columns:n.columns,data:n.data,height:n.tableHeight},on:{\"on-sort-change\":n.onSortChange,\"on-select-all\":n.onSelectAll,\"on-selection-change\":n.handerSelectionChange,\"on-select-cancel\":n.onSelectCancel},scopedSlots:n._u([{key:\"businessKey\",fn:function(e){var t=e.row;return[o(\"a\",{attrs:{href:\"/Form/index.html?data=\"+t.businessKey,target:\"_blank\"}},[n._v(n._s(t.businessKey))])]}}])}),n._v(\" \"),o(\"Page\",{staticClass:\"todotask-content-page\",attrs:{total:n.pageInfo.total,\"page-size\":n.pageInfo.limit,current:n.pageInfo.page,\"show-total\":\"\",size:\"small\",\"show-elevator\":\"\",\"show-sizer\":\"\",\"prev-text\":\"上一页\",\"next-text\":\"下一页\"},on:{\"on-page-size-change\":n.handlePageSizeChange,\"on-change\":n.handlePageChange}}),n._v(\" \"),o(\"i\",{staticClass:\"iconfont icon-refresh\",on:{click:n.getFlowTodoTasks}},[n._v(\"\")])],1)])])},staticRenderFns:[]}}});"}