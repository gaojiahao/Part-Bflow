webpackJsonp([9],{"3OkL":function(t,e){},"3bCP":function(t,e){},"3fB+":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("GIAq"),o=a("bTqw"),i={name:"permissionSource",components:{},props:{enabledForbidden:Number,isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isEdit:"",actionData:[]}},watch:{enabledForbidden:function(){this.getData()}},methods:{isForbidden:function(t,e){var a=this,o=void 0;o=0===t.permType?-2:0,Object(s.a)(t.id,o).then(function(t){t.success&&(a.$Message.success(t.message),a.getData())})},getData:function(){var t=this,e=this.listId;Object(s.s)(e).then(function(e){t.actionData=e.tableContent,t.actionData.map(function(t){t.desc=o.a[t.resourceName]})})}},created:function(){},mounted:function(){this.getData()}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app"},[a("Row",{staticClass:"app-action"},[a("Row",{staticClass:"app-action-title"},[a("h3",[t._v("动作")]),a("span",{staticClass:"warning-color marlr"},[t._v("勾选以启用或停用应用的动作")])]),t._v(" "),a("div",{staticClass:"app-action-source"},[a("Row",{staticClass:"app-action-source-list"},t._l(t.actionData,function(e,s){return a("Col",{key:s,staticClass:"app-action-source-item",attrs:{span:"6"}},[a("Col",{staticClass:"app-action-source-item-check",attrs:{span:"2"}},[a("Checkbox",{attrs:{disabled:!t.isAdmin,value:0===e.permType},on:{"on-change":function(a){t.isForbidden(e,s)}}})],1),t._v(" "),a("Col",{staticClass:"app-action-source-item-content",attrs:{span:"21"}},[a("h3",[t._v(t._s(e.name))]),t._v(" "),a("div",{staticClass:"app-action-source-item-desc"},[t._v(t._s(e.desc))])])],1)}))],1)],1)],1)},staticRenderFns:[]};var l=a("D8HT")(i,n,!1,function(t){a("zRAR")},"data-v-31c1b46a",null).exports,r=a("Sxqw"),c=a.n(r),d=(a("lZCD"),a("CaXr")),u=a("3SZ7"),h=a.n(u),p={name:"GroupSelector",components:{},props:{showGroupSelector:{type:Boolean}},data:function(){return{searchOrgValue:"",orgTotal:0,orgCurrentPage:1,pageSize:10,orgLoading:!0,showOrgModal:!1,orgColumns:[{type:"selection",width:60,align:"center"},{title:"名称",key:"name"}],orgData:[],orgSelectData:[],orgSelection:[]}},watch:{showGroupSelector:function(t){t&&(this.showOrgModal=t,this.selectOrgModal(),this.orgSelection=[],this.orgSelectData=[],this.searchOrgValue="")}},methods:{orgFilter:function(){var t=h()([{operator:"like",value:this.searchOrgValue,property:"name"}]);this.selectOrgModal(t,1)},selectOrgModal:function(t,e){var a=this;this.orgLoading=!0,Object(s.r)(e||this.orgCurrentPage,this.pageSize,t).then(function(t){a.orgData=t.tableContent,a.orgTotal=t.dataCount,a.orgLoading=!1,a.orgSelection.length>0&&a.orgData.map(function(t){a.orgSelection.map(function(e){t.id==e.id&&(t._checked=!0)})})})},selectOrgClick:function(t,e){if(0===t.length){var a=this.$refs.orgTable.data,s=this.orgSelection;a.map(function(t){s=s.filter(function(e){return e.id!==t.id})}),this.orgSelection=s}else{var o,i={};(o=this.orgSelection).push.apply(o,c()(t)),this.orgSelection=this.orgSelection.reduce(function(t,e){return!i[e.id]&&(i[e.id]=t.push(e)),t},[])}},onOrgSelectAll:function(t){var e,a={};(e=this.orgSelection).push.apply(e,c()(t)),this.orgSelection=this.orgSelection.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])},selectOrgCancel:function(t,e){var a=this;this.orgSelection.forEach(function(t,s){t.id===e.id&&a.orgSelection.splice(s,1)})},deleteSelectOrg:function(t,e){var a=this;this.orgSelection.splice(e,1),this.$refs.orgTable.data.forEach(function(e,s){t.id===e.id&&a.$refs.orgTable.toggleSelect(s)})},cancelSelectOrg:function(){this.orgSelection=this.orgSelectData},confirmOrg:function(){var t={};this.orgSelectData=this.orgSelection.reduce(function(e,a){return!t[a.id]&&(t[a.id]=e.push(a)),e},[]),this.$emit("groupModalData",this.orgSelectData)},modalVisibleChange:function(t){t||this.$emit("emitGroupModal",{modal:!1})},onOrgPageChange:function(t){var e=h()([{operator:"like",value:this.searchOrgValue,property:"name"}]);this.orgCurrentPage=t,this.selectOrgModal(e)}},mounted:function(){}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{attrs:{title:"组织选择","mask-closable":!1,styles:{top:"15px"}},on:{"on-ok":t.confirmOrg,"on-cancel":t.cancelSelectOrg,"on-visible-change":t.modalVisibleChange},model:{value:t.showOrgModal,callback:function(e){t.showOrgModal=e},expression:"showOrgModal"}},[a("div",{staticClass:"app-search"},[a("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"搜索"},on:{"on-search":t.orgFilter},model:{value:t.searchOrgValue,callback:function(e){t.searchOrgValue=e},expression:"searchOrgValue"}}),t._v(" "),a("p",{staticClass:"app-search-icon",on:{click:t.orgFilter}},[a("Button",{attrs:{type:"primary",size:"small"}},[t._v("查询")])],1)],1),t._v(" "),a("Table",{ref:"orgTable",attrs:{height:"400",stripe:"",size:"small",loading:t.orgLoading,columns:t.orgColumns,data:t.orgData},on:{"on-select-cancel":t.selectOrgCancel,"on-select-all":t.onOrgSelectAll,"on-selection-change":t.selectOrgClick}}),t._v(" "),a("div",{staticClass:"user-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.orgTotal,current:t.orgCurrentPage,"page-size":t.pageSize,size:"small","show-total":""},on:{"on-change":t.onOrgPageChange}})],1)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.orgSelection[0],expression:"orgSelection[0] "}],staticClass:"page-selection-warp"},t._l(t.orgSelection,function(e,s){return a("Tag",{key:e.id,attrs:{closable:"",type:"border",color:"primary",size:"small"},on:{"on-close":function(a){t.deleteSelectOrg(e,s)}}},[t._v("\n        "+t._s(e.name)+"\n      ")])}))],1)],1)},staticRenderFns:[]};var f=a("D8HT")(p,m,!1,function(t){a("oG9O")},null,null).exports,g={name:"RoleSelector",components:{},props:{showRoleSelector:{type:Boolean}},data:function(){return{searchDepValue:"",depTotal:0,depCurrentPage:1,pageSize:10,depLoading:!0,showDepartmentModal:!1,departmentColumns:[{type:"selection",width:60,align:"center"},{title:"名称",key:"name"}],departmentData:[],departmentSelectData:[],departmentSelection:[]}},watch:{showRoleSelector:function(t){t&&(this.showDepartmentModal=t,this.selectPositionModal(),this.departmentSelection=[],this.departmentSelectData=[],this.searchDepValue="")}},methods:{depFilter:function(){var t=h()([{operator:"like",value:this.searchDepValue,property:"name"}]);this.selectPositionModal(t,1)},selectPositionModal:function(t,e){var a=this;this.depLoading=!0,Object(s.q)(e||this.depCurrentPage,this.pageSize,t).then(function(t){a.departmentData=t.tableContent,a.depTotal=t.dataCount,a.depLoading=!1,a.departmentSelection.length>0&&a.departmentData.map(function(t){a.departmentSelection.map(function(e){t.id==e.id&&(t._checked=!0)})})})},selectDepartmentClick:function(t,e){if(0===t.length){var a=this.$refs.roleTable.data,s=this.departmentSelection;a.map(function(t){s=s.filter(function(e){return e.id!==t.id})}),this.departmentSelection=s}else{var o,i={};(o=this.departmentSelection).push.apply(o,c()(t)),this.departmentSelection=this.departmentSelection.reduce(function(t,e){return!i[e.id]&&(i[e.id]=t.push(e)),t},[])}},onRoleSelectAll:function(t){var e,a={};(e=this.departmentSelection).push.apply(e,c()(t)),this.departmentSelection=this.departmentSelection.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])},selectDepCancel:function(t,e){var a=this;this.departmentSelection.forEach(function(t,s){t.id===e.id&&a.departmentSelection.splice(s,1)})},deleteSelectRole:function(t,e){var a=this;this.departmentSelection.splice(e,1),this.$refs.roleTable.data.forEach(function(e,s){t.id===e.id&&a.$refs.roleTable.toggleSelect(s)})},cancelSelectDep:function(){this.departmentSelection=this.departmentSelectData},confirmDepartment:function(){var t={};this.departmentSelectData=this.departmentSelection.reduce(function(e,a){return!t[a.id]&&(t[a.id]=e.push(a)),e},[]),this.$emit("roleModalData",this.departmentSelectData)},modalVisibleChange:function(t){t||this.$emit("emitRoleModal",{modal:!1})},onDepPageChange:function(t){var e=h()([{operator:"like",value:this.searchDepValue,property:"name"}]);this.depCurrentPage=t,this.selectPositionModal(e)}},mounted:function(){}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{attrs:{title:"职位选择","mask-closable":!1,styles:{top:"15px"}},on:{"on-ok":t.confirmDepartment,"on-cancel":t.cancelSelectDep,"on-visible-change":t.modalVisibleChange},model:{value:t.showDepartmentModal,callback:function(e){t.showDepartmentModal=e},expression:"showDepartmentModal"}},[a("div",{staticClass:"app-search"},[a("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"搜索"},on:{"on-search":t.depFilter},model:{value:t.searchDepValue,callback:function(e){t.searchDepValue=e},expression:"searchDepValue"}}),t._v(" "),a("p",{staticClass:"app-search-icon",on:{click:t.depFilter}},[a("Button",{attrs:{type:"primary",size:"small"}},[t._v("查询")])],1)],1),t._v(" "),a("Table",{ref:"roleTable",attrs:{height:"400",stripe:"",size:"small",loading:t.depLoading,columns:t.departmentColumns,data:t.departmentData},on:{"on-select-cancel":t.selectDepCancel,"on-select-all":t.onRoleSelectAll,"on-selection-change":t.selectDepartmentClick}}),t._v(" "),a("div",{staticClass:"user-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.depTotal,current:t.depCurrentPage,"page-size":t.pageSize,size:"small","show-total":""},on:{"on-change":t.onDepPageChange}})],1)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.departmentSelection[0],expression:"departmentSelection[0] "}],staticClass:"page-selection-warp"},t._l(t.departmentSelection,function(e,s){return a("Tag",{key:e.id,attrs:{closable:"",type:"border",color:"primary",size:"small"},on:{"on-close":function(a){t.deleteSelectRole(e,s)}}},[t._v("\n        "+t._s(e.name)+"\n      ")])}))],1)],1)},staticRenderFns:[]};var D=a("D8HT")(g,v,!1,function(t){a("Rklg")},null,null).exports,w={name:"ReportModal",components:{UserSelector:d.a,GroupSelector:f,RoleSelector:D},props:{modalStatis:{type:Boolean},permissionId:{type:[String,Number]},permissionData:{type:Array}},data:function(){return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,userSelectData:[],orgSelectData:[],departmentSelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(t,e){var a=this;this.showPermissionModal=t,this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[],t&&(this.orgSelectData=this.permissionData.filter(function(t){return"group"===t.type}),this.departmentSelectData=this.permissionData.filter(function(t){return"role"===t.type}),this.permissionData.forEach(function(t){"user"===t.type&&a.userSelectData.push({nickname:t.name,userId:t.id,type:t.type})}))},userSelectData:function(t){t.length>0?this.isModalDisabled=!1:this.orgSelectData.length>0||this.departmentSelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(t){t.length>0?this.isModalDisabled=!1:this.departmentSelectData.length>0||this.userSelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(t){t.length>0?this.isModalDisabled=!1:this.orgSelectData.length>0||this.userSelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},getUserModalData:function(t){if(this.userSelectData.length>0){var e,a={};(e=this.userSelectData).push.apply(e,c()(t)),this.userSelectData=this.userSelectData.reduce(function(t,e){return!a[e.userId]&&(a[e.userId]=t.push(e)),t},[])}else this.userSelectData=t},getGroupModalData:function(t){if(this.orgSelectData.length>0){var e,a={};(e=this.orgSelectData).push.apply(e,c()(t)),this.orgSelectData=this.orgSelectData.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])}else this.orgSelectData=t},getRoleModalData:function(t){if(this.departmentSelectData.length>0){var e,a={};(e=this.departmentSelectData).push.apply(e,c()(t)),this.departmentSelectData=this.departmentSelectData.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])}else this.departmentSelectData=t},cancelAddPermission:function(){this.showPermissionModal=!1},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},deleteUser:function(t){var e=t.target.parentElement.getAttribute("userid");this.userSelectData=this.userSelectData.filter(function(t){return t.userId!=e}),this.userSelection=this.userSelection.filter(function(t){return t.userId!=e})},deleteOrg:function(t){var e=t.target.parentElement.getAttribute("orgid");this.orgSelectData=this.orgSelectData.filter(function(t){return t.id!=e}),this.orgSelection=this.orgSelection.filter(function(t){return t.id!=e})},deleteDepartment:function(t){var e=t.target.parentElement.getAttribute("depid");this.departmentSelectData=this.departmentSelectData.filter(function(t){return t.id!=e}),this.departmentSelection=this.departmentSelection.filter(function(t){return t.id!=e})},submitPermission:function(){var t=this,e=this.userSelectData.map(function(t){return t.userId}).join(","),a=this.orgSelectData.map(function(t){return t.id}).join(","),o=this.departmentSelectData.map(function(t){return t.id}).join(",");Object(s._2)(this.permissionId,e,a,o).then(function(e){if(e.success){t.showPermissionModal=!1,t.$Message.success(e.message);var a=t.emitChange++;t.$emit("reGetData",a)}else t.$Message.error(e.message)})},modalVisibleChange:function(t){t||this.$emit("emitPermissionModal",{modal:!1})}}},S={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{transfer:!1,title:"视图权限",width:"600","mask-closable":!1},on:{"on-visible-change":t.modalVisibleChange},model:{value:t.showPermissionModal,callback:function(e){t.showPermissionModal=e},expression:"showPermissionModal"}},[a("div",[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Col",{attrs:{span:"8"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectUserModal}},[t._v("选择用户")])],1),t._v(" "),a("Col",{attrs:{span:"8"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectGroupModal}},[t._v("选择组织")])],1),t._v(" "),a("Col",{attrs:{span:"8"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectRoleModal}},[t._v("选择职位")])],1)],1),t._v(" "),a("Row",{attrs:{gutter:8}},[a("Col",{staticClass:"permission-tab",attrs:{span:"24"}},[a("Row",{staticStyle:{"margin-top":"10px"}},[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("用户")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.userSelectData,function(e,s){return a("Tag",{key:s,attrs:{userId:e.userId,closable:"",color:"warning"},on:{"on-close":t.deleteUser}},[t._v("\n          "+t._s(e.nickname)+"\n        ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("组织")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.orgSelectData,function(e,s){return a("Tag",{key:s,attrs:{orgId:e.id,closable:"",color:"success"},on:{"on-close":t.deleteOrg}},[t._v("\n          "+t._s(e.name)+"\n        ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("职位")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.departmentSelectData,function(e,s){return a("Tag",{key:s,attrs:{depId:e.id,closable:"",color:"primary"},on:{"on-close":t.deleteDepartment}},[t._v("\n          "+t._s(e.name)+"\n        ")])}))],1)],1)],1),t._v(" "),a("user-selector",{attrs:{showUserSelector:t.showSelector.showUserSelector},on:{emitUserModal:t.emitUserModal,userModalData:t.getUserModalData}}),t._v(" "),a("group-selector",{attrs:{showGroupSelector:t.showSelector.showGroupSelector},on:{emitGroupModal:t.emitGroupModal,groupModalData:t.getGroupModalData}}),t._v(" "),a("role-selector",{attrs:{showRoleSelector:t.showSelector.showRoleSelector},on:{emitRoleModal:t.emitRoleModal,roleModalData:t.getRoleModalData}})],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:t.cancelAddPermission}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",disabled:t.isModalDisabled},on:{click:t.submitPermission}},[t._v("确定")])],1)])},staticRenderFns:[]};var b={name:"reportSource",components:{ReportModal:a("D8HT")(w,S,!1,function(t){a("iWrO")},null,null).exports},props:{appType:String,isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,showReportModal:!1,permissionId:"",columns:[],reportSources:[],permissionData:[]}},watch:{isAdmin:function(t){this.setColumns()},deep:!0},methods:{emitPermissionModal:function(){this.showReportModal=!1},goCreateView:function(){window.top.location.href="/Site/index.html#appSetting/"+this.listId+"/"+this.appType+"/viewTypes"},reGetData:function(){this.getViewsData()},getViewsData:function(){var t=this;Object(s.L)(this.listId).then(function(e){e.forEach(function(t){t.users||(t.users=[]),t.roles||(t.roles=[]),t.groups||(t.groups=[]),t.permissionList=[].concat(c()(t.groups),c()(t.roles),c()(t.users))}),t.reportSources=e})},deleteViews:function(t,e){var a=this;if(1===this.reportSources.length)this.$Message.warning("不可删除唯一视图！");else if(1===t.row.isDefault){var o={viewId:t.row.viewId,listId:this.listId};this.$Modal.confirm({title:"确认",content:"确认删除此视图？",onOk:function(){Object(s.h)(o).then(function(t){if(t.success){a.reportSources.splice(e,1);var o={viewId:a.reportSources[0].viewId,listId:a.listId};Object(s._0)(o).then(function(t){t.success&&a.reloadViewData()})}})}})}else{var i={viewId:t.row.viewId,listId:this.listId};this.$Modal.confirm({title:"确认",content:"确认删除此视图？",onOk:function(){Object(s.h)(i).then(function(t){t.success&&(a.reportSources.splice(e,1),a.$Message.success(t.message))})}})}},reloadViewData:function(){var t=this;Object(s.L)(this.listId).then(function(e){e.forEach(function(t){t.permissionList=[].concat(c()(t.groups),c()(t.roles),c()(t.users))}),t.reportSources=e})},onClickDefaultView:function(t){var e=this;this.$Modal.confirm({title:"确认",content:"确认设置此视图为默认视图？",onOk:function(){e.setDefaultViews(t)},onCancel:function(){e.reloadViewData()}})},setDefaultViews:function(t){var e=this,a={viewId:t.row.viewId,listId:this.listId};Object(s._0)(a).then(function(t){t.success&&(e.$Message.success(t.message),e.reloadViewData())})},setColumns:function(){var t=this,e=[{title:"报表名称",key:"title"},{title:"已授权用户、组织或职位",key:"permissionList",render:function(t,e){var a=e.row.permissionList,s=[];if(a.length>0)return a.forEach(function(e,a){var o=t("span",{style:{margin:"0px 5px"}},e.name);s.push(o)}),t("div",s)}}],a=[{title:"默认视图",key:"isDefault",align:"center",render:function(e,a){var s=!1;return 1===a.row.isDefault&&(s=!0),e("Radio",{props:{value:s,disabled:!t.isAdmin},on:{"on-change":function(e){t.onClickDefaultView(a)}}})}}],s=[{title:"操作",key:"list",align:"center",render:function(e,a){return console.log(t.appType),e("div",[e("a",{on:{click:function(){t.deleteViews(a,a.index)}},style:{display:"subject"!==t.appType?"inline-block":"none"}},"删除"),e("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px",display:"subject"!==t.appType?"inline":"none"}}),e("a",{on:{click:function(){var e="/Site/index.html#appSetting/viewConfig/"+t.listId+"/"+a.row.viewId;window.top.location.href=e}},style:{display:"subject"!==t.appType?"inline-block":"none"}},"修改"),e("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px",display:"subject"!==t.appType?"inline":"none"}}),e("a",{on:{click:function(){t.permissionId=a.row.permissionId,t.showReportModal=!0,t.permissionData=a.row.permissionList}}},"授权")])}}];this.isAdmin&&"subject"!==this.appType?this.columns=e.concat(a).concat(s):this.isAdmin?this.columns=e.concat(s):this.columns=e}},mounted:function(){this.setColumns(),this.getViewsData()}},M={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-report"},[a("Row",{staticClass:"app-report-title"},[a("h3",[t._v("报表 "),t.isAdmin&&"subject"!=t.appType?a("a",{on:{click:t.goCreateView}},[t._v("添加报表")]):t._e()]),t._v(" "),a("span",{staticClass:"warning-color marlr"},[t._v("用户默认拥有此应用默认报表的权限")])]),t._v(" "),a("Row",{staticClass:"app-report-table"},[a("Table",{attrs:{columns:t.columns,data:t.reportSources,size:"small"}})],1),t._v(" "),a("report-modal",{attrs:{modalStatis:t.showReportModal,permissionId:t.permissionId,permissionData:t.permissionData},on:{emitPermissionModal:t.emitPermissionModal,reGetData:t.reGetData}})],1)},staticRenderFns:[]};var _=a("D8HT")(b,M,!1,function(t){a("kAzu")},"data-v-a806903c",null).exports,C={name:"formSource",components:{},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId}},methods:{setForm:function(){window.open("/Form/index.html?viewDesign=true&list="+this.listId)}},created:function(){},mounted:function(){}},k={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"app-form"},[e("Row",{staticClass:"app-form-title"},[e("h3",[this._v("表单 "),this.isAdmin?e("a",{on:{click:this.setForm}},[this._v("表单设置")]):this._e()])])],1)},staticRenderFns:[]};var y=a("D8HT")(C,k,!1,function(t){a("3bCP")},"data-v-682736de",null).exports,R=a("WxFH"),I=a.n(R),A={name:"WorkflowModal",props:{modalWorkflowStatus:Boolean,deleteRelationWorkflow:Number},data:function(){var t=this;return{listId:this.$route.params.listId,searchValue:"",showWorkFlow:!1,relativeWorkFlowTotal:0,allWorkFlowTotal:0,allCurrentPage:1,relativeCurrentPage:1,pageSize:10,loadingAll:!0,loadingRelative:!0,allWorkFlowColumns:[{title:"名称",key:"processName"},{title:"查看流程图",key:"action",align:"center",render:function(t,e){return t("a",{props:{type:"default",size:"small"},on:{click:function(){window.open("/myflow/viewProc.html?processId="+e.row.id)}}},"查看")}}],relativeWorkFlowColumns:[{title:"名称",key:"processName"},{title:"配置节点",key:"config",align:"center",render:function(e,a){return e("a",{on:{click:function(){window.open("/myflow/viewFlow.html?processId="+a.row.id+"&listId="+t.listId+"&processCode="+a.row.processCode)}}},"配置")}},{title:"操作",key:"action",align:"center",render:function(e,a){return e("a",{on:{click:function(){t.deleteWorkflow(a.row,a.index)}}},"删除")}}],allWorkFlowData:[],relativeWorkFlowData:[]}},watch:{modalWorkflowStatus:function(t,e){this.showWorkFlow=t},deleteRelationWorkflow:function(){this.getRelativeWorkflowData()}},methods:{workflowFilter:function(){var t=h()([{operator:"like",value:this.searchValue,property:"processName"}]);this.allCurrentPage=1,this.getAllWorkflowData(t)},selectWorkFlow:function(){},getAllWorkflowData:function(t){var e=this;this.loadingAll=!0,Object(s.t)(this.allCurrentPage,this.pageSize,t).then(function(t){e.allWorkFlowData=t.tableContent,e.allWorkFlowTotal=t.dataCount,e.loadingAll=!1})},getRelativeWorkflowData:function(){var t=this;this.loadingRelative=!0,Object(s.M)(this.listId,this.relativeCurrentPage,this.pageSize).then(function(e){t.relativeWorkFlowData=e,t.relativeWorkFlowTotal=e.length,t.loadingRelative=!1})},onPageChange:function(t){var e=h()([{operator:"like",value:this.searchValue,property:"processName"}]);this.allCurrentPage=t,this.getAllWorkflowData(e)},onRelativePageChange:function(t){this.relativeCurrentPage=t,this.getRelativeWorkflowData()},modalVisibleChange:function(t){t||this.$emit("emitWorkFlowModal",{modal:!1})},addWorkflowData:function(t,e){0===this.relativeWorkFlowData.length?this.saveWorkFlow(t):this.$Message.warning("请先删除已关联工作流再添加！")},saveWorkFlow:function(t){var e=this,a={listId:this.listId,procCode:t.processCode,creator:"",list:"list_process_rel",status:1};Object(s._3)(a).then(function(t){t.success&&(e.$Message.success(t.message),e.getRelativeWorkflowData(),e.$emit("addWorkflow"))})},deleteWorkflow:function(t,e){var a=this,o={ID:t.id,list:"list_process_rel",status:0};Object(s._3)(o).then(function(t){t.success&&(a.$Message.success(t.message),a.relativeWorkFlowData.splice(e,1),a.$emit("addWorkflow"))})}},mounted:function(){this.getAllWorkflowData(),this.getRelativeWorkflowData()}},P={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{title:"工作流设置",width:"1010","mask-closable":!1,styles:{top:"20px"}},on:{"on-ok":t.selectWorkFlow,"on-visible-change":t.modalVisibleChange},model:{value:t.showWorkFlow,callback:function(e){t.showWorkFlow=e},expression:"showWorkFlow"}},[a("Row",{attrs:{gutter:8}},[a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"flow-title"},[a("b",[t._v("所有工作流")]),t._v(" "),a("div",{staticClass:"app-search"},[a("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"搜索工作流名称"},on:{"on-search":t.workflowFilter},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}})],1)]),t._v(" "),a("Table",{attrs:{loading:t.loadingAll,stripe:"",height:"350",columns:t.allWorkFlowColumns,data:t.allWorkFlowData},on:{"on-row-dblclick":t.addWorkflowData}}),t._v(" "),a("div",{staticClass:"workflow-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.allWorkFlowTotal,current:t.allCurrentPage,"page-size":t.pageSize,size:"small","show-total":""},on:{"on-change":t.onPageChange}})],1)])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"flow-title"},[a("b",[t._v("已关联的工作流")])]),t._v(" "),a("Table",{attrs:{loading:t.loadingRelative,stripe:"",height:"350",columns:t.relativeWorkFlowColumns,data:t.relativeWorkFlowData}}),t._v(" "),a("div",{staticClass:"workflow-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.relativeWorkFlowTotal,current:t.relativeCurrentPage,"page-size":t.pageSize,size:"small","show-total":""},on:{"on-change":t.onRelativePageChange}})],1)])],1)],1)],1)},staticRenderFns:[]};var O,x={name:"workflowSource",components:{WorkflowModal:a("D8HT")(A,P,!1,function(t){a("dzMx")},"data-v-7ef1ad3c",null).exports},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isOperationShow:!0,isCreateShow:!0,isUpdateShow:!0,showModal:!1,deleteRelationWorkflow:-1,columns:[],workflows:[]}},watch:{isAdmin:function(t){this.setColumns()}},methods:(O={addWorkflow:function(){this.getRelativeWorkflowData()},emitWorkFlowModal:function(){this.showModal=!1},showWorkflowModal:function(){this.showModal=!0},getRelativeWorkflowData:function(){var t=this;Object(s.M)(this.listId).then(function(e){var a=[];t.workflows=e,t.workflows.length>0&&(t.workflows.forEach(function(t){a.push(t.triggerType)}),/create/.test(a)&&/update/.test(a)?(t.isOperationShow=!0,t.isCreateShow=!0,t.isUpdateShow=!0):/create/.test(a)?(t.isOperationShow=!0,t.isCreateShow=!0,t.isUpdateShow=!1):/update/.test(a)?(t.isOperationShow=!0,t.isCreateShow=!1,t.isUpdateShow=!0):t.isOperationShow=!1)})},deleteWorkflow:function(t,e){var a=this;this.$Modal.confirm({title:"确认",content:"确认删除此工作流？",onOk:function(){Object(s.n)(null,null,t.id).then(function(t){t.success&&(a.$Message.success(t.message),a.getRelativeWorkflowData(),a.deleteRelationWorkflow++)})}})}},I()(O,"addWorkflow",function(){this.getRelativeWorkflowData()}),I()(O,"goCreateWorkflow",function(){window.open("/myflow/createWorkFlow.html?listId="+this.listId+"&triggerType=create")}),I()(O,"updateWorkFlowStaus",function(t){var e=this,a=t.row,o="";o=1===a.status?"确认禁用该工作流？":"确认启用该工作流？",this.$Modal.confirm({title:"系统提示",content:o,onOk:function(){1===a.status?Object(s.n)(null,a.id).then(function(t){t.success&&(e.$Message.success(t.message),e.getRelativeWorkflowData())}):Object(s.n)(a.id).then(function(t){t.success&&(e.$Message.success(t.message),e.getRelativeWorkflowData())})},onCancel:function(){e.getRelativeWorkflowData()}})}),I()(O,"createWorkflow",function(t){window.open("/myflow/createWorkFlow.html?listId="+this.listId+"&triggerType="+t)}),I()(O,"setColumns",function(){var t=this,e=[{title:"工作流名称",key:"processName",align:"left"},{title:"触发动作",key:"triggerType",align:"left",render:function(t,e){return"create"===e.row.triggerType?t("span",{},"创建实例"):t("span",{},"修改实例")}},{title:"启用",key:"status",align:"left",render:function(e,a){return e("Checkbox",{props:{value:1===a.row.status,disabled:!t.isAdmin},on:{"on-change":function(e){t.updateWorkFlowStaus(a)}}})}}],a=[{title:"操作",key:"list",align:"center",render:function(e,a){return e("div",[e("a",{on:{click:function(){t.deleteWorkflow(a.row,a.index)}}},"删除"),e("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px"}}),e("a",{on:{click:function(){window.open("/myflow/viewFlow.html?processId="+a.row.processId+"&listId="+t.listId+"&processCode="+a.row.processCode)}}},"修改")])}}];this.isAdmin?this.columns=e.concat(a):this.columns=e}),O),created:function(){this.setColumns(),this.getRelativeWorkflowData()}},F={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-workflow"},[a("Row",{staticClass:"app-workflow-title"},[a("h3",[t._v("工作流\n        "),t.isAdmin&&0===t.workflows.length?a("span",{staticClass:"app-workflow-create",on:{click:t.goCreateWorkflow}},[t._v("新建")]):t._e(),t._v(" "),t.isAdmin?a("span",{staticClass:"app-workflow-create",on:{click:t.showWorkflowModal}},[t._v("关联")]):t._e()])]),t._v(" "),a("Row",{staticClass:"app-workflow-table"},[a("Table",{attrs:{columns:t.columns,data:t.workflows,size:"small"}})],1),t._v(" "),a("workflow-modal",{attrs:{modalWorkflowStatus:t.showModal,deleteRelationWorkflow:t.deleteRelationWorkflow},on:{emitWorkFlowModal:t.emitWorkFlowModal,addWorkflow:t.addWorkflow}})],1)},staticRenderFns:[]};var j=a("D8HT")(x,F,!1,function(t){a("aWvF")},"data-v-55fff912",null).exports,T={name:"permissionModal",components:{UserSelector:d.a,GroupSelector:f,RoleSelector:D},props:{modalStatis:Boolean,modalName:String},data:function(){return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,allPermissionData:[],permissionSelectDatas:[],allPermissionColumns:[],userSelectData:[],orgSelectData:[],departmentSelectData:[],companySelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(t,e){this.showPermissionModal=t,this.permissionSelectDatas=[],this.showPermissionModal&&this.getData(),this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[]},permissionSelectDatas:function(t){t.length>0&&(this.userSelectData.length>0||this.orgSelectData.length>0||this.departmentSelectData.length>0||this.companySelectData.length>0)?this.isModalDisabled=!1:this.isModalDisabled=!0},userSelectData:function(t){t.length>0?this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.departmentSelectData.length>0)&&this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(t){t.length>0?this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.userSelectData.length>0||this.departmentSelectData.length>0)&&this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(t){t.length>0?this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.userSelectData.length>0)&&this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},getUserModalData:function(t){if(this.userSelectData.length>0){var e,a={};(e=this.userSelectData).push.apply(e,c()(t)),this.userSelectData=this.userSelectData.reduce(function(t,e){return!a[e.userId]&&(a[e.userId]=t.push(e)),t},[])}else this.userSelectData=t},getGroupModalData:function(t){if(this.orgSelectData.length>0){var e,a={};(e=this.orgSelectData).push.apply(e,c()(t)),this.orgSelectData=this.orgSelectData.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])}else this.orgSelectData=t},getRoleModalData:function(t){if(this.departmentSelectData.length>0){var e,a={};(e=this.departmentSelectData).push.apply(e,c()(t)),this.departmentSelectData=this.departmentSelectData.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])}else this.departmentSelectData=t},cancelAddPermission:function(){this.showPermissionModal=!1},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},deleteUser:function(t){var e=this,a=t.target.parentElement.getAttribute("userid"),o=[];this.permissionSelectDatas.forEach(function(t){o.push(t.id)}),Object(s.e)("sys_user_permission",a,o.join(",")).then(function(t){t.success&&(e.userSelectData=e.userSelectData.filter(function(t){return t.userId!=a}),e.userSelection=e.userSelection.filter(function(t){return t.userId!=a}))})},deleteOrg:function(t){var e=this,a=t.target.parentElement.getAttribute("orgid"),o=[];this.permissionSelectDatas.forEach(function(t){o.push(t.id)}),Object(s.e)("sys_group_permission",a,o.join(",")).then(function(t){t.success&&(e.orgSelectData=e.orgSelectData.filter(function(t){return t.id!=a}),e.orgSelection=e.orgSelection.filter(function(t){return t.id!=a}))})},deleteDepartment:function(t,e){var a=this,o=event.target.parentElement.getAttribute("depid"),i=[];this.permissionSelectDatas.forEach(function(t){i.push(t.id)}),Object(s.e)("sys_role_permission",o,i.join(",")).then(function(t){t.success&&(a.departmentSelectData=a.departmentSelectData.filter(function(t){return t.id!=o}),a.departmentSelection=a.departmentSelection.filter(function(t){return t.id!=o}))})},deleteCompany:function(t,e){var a=this,o=event.target.parentElement.getAttribute("comid"),i=[];this.permissionSelectDatas.forEach(function(t){i.push(t.id)}),Object(s.e)("sys_group_permission",o,i.join(",")).then(function(t){t.success&&(a.companySelectData=a.companySelectData.filter(function(t){return t.groupId!=o}),a.companySelectData=a.companySelectData.filter(function(t){return t.groupId!=o}))})},permissionSelectChange:function(t,e){this.permissionSelectDatas=t},submitPermission:function(){var t=this,e=this.userSelectData.map(function(t){return t.userId}),a=this.orgSelectData.map(function(t){return t.id}),o=this.departmentSelectData.map(function(t){return t.id}),i=this.companySelectData.map(function(t){return t.groupId}),n=this.permissionSelectDatas.map(function(t){return t.id}),l={userId:e.join(","),roleId:o.join(","),groupId:a.join(","),companyId:i.join(","),permissionId:n.join(",")};l&&Object(s.b)(l).then(function(e){if(e.success){t.$Message.success(e.message),t.showPermissionModal=!1;var a=t.emitChange++;t.$emit("reGetData",a)}})},modalVisibleChange:function(t){t||this.$emit("emitPermissionModal",{modal:!1})},getData:function(){var t=this.appListId;"action"===this.modalName?(this.allPermissionColumns=[{type:"selection",width:60,align:"center"},{title:"动作名称",key:"name",width:100},{title:"说明",key:"desc"}],this.getActionPerData(t)):(this.allPermissionColumns=[{type:"selection",width:60,align:"center"},{title:"数据源名称",key:"name",width:100},{title:"说明",key:"desc"}],this.getResPerData(t))},getActionPerData:function(t){var e=this;Object(s.s)(t).then(function(t){e.allPermissionData=t.tableContent,e.allPermissionData.map(function(t){t.desc=o.a[t.resourceName]})})},getResPerData:function(t){var e=this;Object(s.u)(t).then(function(t){e.allPermissionData=t.tableContent,e.allPermissionData.map(function(t){t.desc=o.a[t.resourceName]})})}},mounted:function(){this.getData()}},W={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{transfer:!1,title:"应用权限",width:"1000",styles:{top:"15px"},"mask-closable":!1},on:{"on-visible-change":t.modalVisibleChange},model:{value:t.showPermissionModal,callback:function(e){t.showPermissionModal=e},expression:"showPermissionModal"}},[a("div",[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectUserModal}},[t._v("选择用户")])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectGroupModal}},[t._v("选择组织")])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectRoleModal}},[t._v("选择职位")])],1),t._v(" "),t._e()],1),t._v(" "),a("Row",{attrs:{gutter:8}},[a("Col",{staticClass:"permission-tab",attrs:{span:"12"}},[a("Row",{staticStyle:{"margin-top":"10px"}},[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("用户")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.userSelectData,function(e,s){return a("Tag",{key:s,attrs:{userId:e.userId,closable:"",color:"warning"},on:{"on-close":t.deleteUser}},[t._v("\n              "+t._s(e.nickname)+"\n            ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("组织")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.orgSelectData,function(e,s){return a("Tag",{key:s,attrs:{orgId:e.id,closable:"",color:"success"},on:{"on-close":t.deleteOrg}},[t._v("\n            "+t._s(e.name)+"\n          ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("职位")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.departmentSelectData,function(e,s){return a("Tag",{key:s,attrs:{depId:e.id,closable:"",color:"primary"},on:{"on-close":t.deleteDepartment}},[t._v("\n            "+t._s(e.name)+"\n          ")])}))],1),t._v(" "),t._e()],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Table",{ref:"actionRef",attrs:{stripe:"",height:"350",columns:t.allPermissionColumns,size:"small",data:t.allPermissionData},on:{"on-selection-change":t.permissionSelectChange}})],1)],1),t._v(" "),a("user-selector",{attrs:{showUserSelector:t.showSelector.showUserSelector},on:{emitUserModal:t.emitUserModal,userModalData:t.getUserModalData}}),t._v(" "),a("group-selector",{attrs:{showGroupSelector:t.showSelector.showGroupSelector},on:{emitGroupModal:t.emitGroupModal,groupModalData:t.getGroupModalData}}),t._v(" "),a("role-selector",{attrs:{showRoleSelector:t.showSelector.showRoleSelector},on:{emitRoleModal:t.emitRoleModal,roleModalData:t.getRoleModalData}})],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:t.cancelAddPermission}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",disabled:t.isModalDisabled},on:{click:t.submitPermission}},[t._v("确定")])],1)])},staticRenderFns:[]};var $=a("D8HT")(T,W,!1,function(t){a("CjwN")},null,null).exports,G={name:"permissionSource",components:{ActionModal:$},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,showActionModal:!1,isModalConfirm:1e3,actionData:[],modalName:"action",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getActionData()},isAdmin:function(t){this.setColumns()}},methods:{reGetData:function(t){this.isModalConfirm=t},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=""},emitPermissionModal:function(){this.showActionModal=!1},getActionData:function(){var t=this;Object(s.x)("action",this.listId).then(function(e){t.userSources=e.tableContent})},deleteAllPermission:function(t,e){var a=this,o=this;o.$Modal.confirm({title:"确认",content:"确认删除此权限？",onOk:function(){var e,i=[],n=[],l=[],r=[],c=[];t.row.action.forEach(function(t){for(var e in t)i.push(e)}),t.row.objNames.forEach(function(t){"user"===t.type?n.push(t.id):"group"===t.type?l.push(t.id):"role"===t.type?r.push(t.id):c.push(t.id)}),e={user:n.join(","),group:l.join(","),role:r.join(","),company:c.join(","),multi:i.join(",")},Object(s.l)(e).then(function(t){t.success&&(o.$Message.success(t.message),a.getActionData())})}})},setColumns:function(){var t=this,e=[{title:"已授权用户、组织或职位",key:"objNames",render:function(t,e){var a=e.row.objNames,s=[];if(a.length>0)return a.forEach(function(e,a){var o;o=t("span",{},e.name+"; "),s.push(o)}),t("div",s)}},{title:"动作",key:"source",render:function(e,a){var o=[],i=[];return a.row.action.forEach(function(t,e){for(var a in t)i.push(a)}),t.actionData.forEach(function(n,l){var r,c=void 0;i.forEach(function(t){t==n.id&&(c=n.id)}),r=e("span",{style:{marginLeft:"5px"}},[e("Checkbox",{props:{value:c,trueValue:n.id,falseValue:n.id+"_false",disabled:!t.isAdmin},on:{"on-change":function(e){var o=void 0,i=void 0,n=void 0,l=void 0,r=void 0;"sys_role_permission"===a.row.list?n=a.row.objId:"sys_user_permission"===a.row.list?o=a.row.objId:"sys_group_permission"===a.row.list?i=a.row.objId:l=a.row.objId,/_/.test(e)?(r=0,e=e.split("_")[0]):r=1,Object(s._10)(o,n,i,l,e,t.listId,r).then(function(e){e.success&&t.$Message.success(e.message)})}}}),e("span",{},n.name)]),o.push(r)}),e("div",o)}}],a=[{title:"操作",key:"list",align:"center",render:function(e,a){return e("div",[e("a",{on:{click:function(){t.deleteAllPermission(a,a.row.list)}}},"删除")])}}];this.isAdmin?this.columns=e.concat(a):this.columns=e}},created:function(){var t=this;Object(s.s)(this.listId).then(function(e){t.actionData=e.tableContent})},mounted:function(){this.setColumns(),this.getActionData()}},E={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[a("Row",{staticClass:"app-action"},[a("Row",{staticClass:"app-action-title"},[a("h3",[t._v("动作"),t.isAdmin?a("a",{staticClass:"app-action-title-add",on:{click:t.showModal}},[t._v("授权")]):t._e()]),t._v(" "),a("span",{staticClass:"warning-color marlr"},[t._v("授予用户、组织或职位当前应用动作的权限")])]),t._v(" "),a("div",{staticClass:"app-action-source"},[a("Row",[a("Table",{attrs:{columns:t.columns,data:t.userSources,size:"small"}})],1)],1)],1),t._v(" "),a("action-modal",{attrs:{modalStatis:t.showActionModal,modalName:t.modalName},on:{reGetData:t.reGetData,emitPermissionModal:t.emitPermissionModal}})],1)},staticRenderFns:[]};var U=a("D8HT")(G,E,!1,function(t){a("r0Eq")},"data-v-59bd22d2",null).exports,B={name:"permissionSourceData",components:{ActionModal:$},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,showActionModal:!1,isModalConfirm:1e3,resourceData:[],modalName:"resource",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getResourceData()},isAdmin:function(t){this.setColumns()}},methods:{reGetData:function(t){this.isModalConfirm=t},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=""},emitPermissionModal:function(){this.showActionModal=!1},getResourceData:function(){var t=this;Object(s.x)("resource",this.listId).then(function(e){t.userSources=e.tableContent})},deleteAllPermission:function(t,e){var a=this,o=this;o.$Modal.confirm({title:"确认",content:"确认删除此权限？",onOk:function(){var e,i=[],n=[],l=[],r=[],c=[];t.row.resource.forEach(function(t){for(var e in t)i.push(e)}),t.row.objNames.forEach(function(t){"user"===t.type?n.push(t.id):"group"===t.type?l.push(t.id):"role"===t.type?r.push(t.id):c.push(t.id)}),e={user:n.join(","),group:l.join(","),role:r.join(","),company:c.join(","),multi:i.join(",")},Object(s.l)(e).then(function(t){t.success&&(o.$Message.success(t.message),a.getResourceData())})}})},setColumns:function(){var t=this,e=[{title:"已授权用户、用户组",key:"objNames",render:function(t,e){var a=e.row.objNames,s=[];if(a.length>0)return a.forEach(function(e,a){var o;o=t("span",{},e.name+"; "),s.push(o)}),t("div",s)}},{title:"数据源",key:"source",render:function(e,a){var o=[],i=[];return a.row.resource.forEach(function(t,e){for(var a in t)i.push(a)}),t.resourceData.forEach(function(n,l){var r,c=void 0;i.forEach(function(t){t==n.id&&(c=n.id)}),r=e("span",{style:{marginLeft:"10px"}},[e("Checkbox",{props:{value:c,trueValue:n.id,falseValue:n.id+"_false",disabled:!t.isAdmin},on:{"on-change":function(e){var o=void 0,i=void 0,n=void 0,l=void 0,r=void 0;"sys_role_permission"===a.row.list?n=a.row.objId:"sys_user_permission"===a.row.list?o=a.row.objId:"sys_group_permission"===a.row.list?i=a.row.objId:l=a.row.objId,/_/.test(e)?(r=0,e=e.split("_")[0]):r=1,Object(s._10)(o,n,i,l,e,t.listId,r).then(function(e){e.success&&t.$Message.success(e.message)})}}}),e("span",{},n.name)]),o.push(r)}),e("div",o)}}],a=[{title:"操作",key:"list",align:"center",render:function(e,a){return e("div",[e("a",{on:{click:function(){t.deleteAllPermission(a,a.row.list)}}},"删除")])}}];this.isAdmin?this.columns=e.concat(a):this.columns=e}},created:function(){var t=this;Object(s.u)(this.listId).then(function(e){t.resourceData=e.tableContent})},mounted:function(){this.setColumns(),this.getResourceData()}},V={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[a("Row",{staticClass:"app-action"},[a("Row",{staticClass:"app-action-title"},[a("h3",[t._v("数据源"),t.isAdmin?a("a",{staticClass:"app-action-title-add",on:{click:t.showModal}},[t._v("授权")]):t._e()]),t._v(" "),a("span",{staticClass:"warning-color marlr"},[t._v("用户默认可查看我创建的实例、我经办的实例、我负责的组织经办的实例")])]),t._v(" "),a("div",{staticClass:"app-action-source"},[a("Row",[a("Table",{attrs:{columns:t.columns,data:t.userSources,size:"small"}})],1)],1)],1),t._v(" "),a("action-modal",{attrs:{modalStatis:t.showActionModal,modalName:t.modalName},on:{reGetData:t.reGetData,emitPermissionModal:t.emitPermissionModal}})],1)},staticRenderFns:[]};var N=a("D8HT")(B,V,!1,function(t){a("6MbG")},"data-v-540991e2",null).exports,z={name:"permissionModal",components:{UserSelector:d.a,GroupSelector:f,RoleSelector:D},props:{modalStatis:Boolean,resourceId:String,isEdit:Boolean},data:function(){var t=this;return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,fieldData:[],allFieldData:[],fieldColumns:[{title:"字段",key:"fieldName",render:function(e,a){var s=[];return t.allFieldData.forEach(function(t){s.push(e("Option",{props:{value:t.fieldCode,parentCode:t.parentCode}},t.fieldName))}),e("div",[e("Select",{props:{value:a.row.fieldCode},on:{"on-change":function(e){t.fieldData[a.index].fieldCode=e}}},s)])}},{title:"规则",key:"rule",render:function(e,a){var s=[];return[{name:"大于",value:"gt"},{name:"小于",value:"lt"},{name:"等于",value:"eq"},{name:"小于等于",value:"le"},{name:"大于等于",value:"ge"},{name:"不等于",value:"ne"},{name:"包含",value:"like"},{name:"不包含",value:"nlike"}].forEach(function(t){s.push(e("Option",{props:{value:t.value}},t.name))}),e("div",[e("Select",{props:{value:a.row.operator},on:{"on-change":function(e){t.fieldData[a.index].operator=e}}},s)])}},{title:"值",key:"value",render:function(e,a){return e("div",[e("Input",{props:{value:a.row.value},on:{"on-blur":function(e){t.fieldData[a.index].value=e.target.value}}})])}},{title:"且/或",key:"or",render:function(e,a){var s=[];return[{name:"且",value:"and"},{name:"或",value:"or"}].forEach(function(t){s.push(e("Option",{props:{value:t.value}},t.name))}),e("div",[e("Select",{props:{value:a.row.logicOperator},on:{"on-change":function(e){t.fieldData[a.index].logicOperator=e}}},s)])}},{title:"操作",key:"list",align:"center",render:function(e,a){return e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.fieldData.splice(a.index,1)}}},"删除")}}],userSelectData:[],orgSelectData:[],departmentSelectData:[],companySelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(t,e){var a=this;this.isEdit?(this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[],Object(s.Q)(this.appListId,this.resourceId).then(function(t){a.fieldData=t.resource,t.instance.forEach(function(t){var e={};"U"===t.substanceType?(e.nickname=t.substanceName,e.userId=t.substanceId,a.userSelectData.push(e)):"G"===t.substanceType?(e.name=t.substanceName,e.id=t.substanceId,a.orgSelectData.push(e)):"R"===t.substanceType&&(e.name=t.substanceName,e.id=t.substanceId,a.departmentSelectData.push(e))})})):(this.fieldData=[],this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[]),this.showPermissionModal=t},fieldData:function(t){t.length>0&&(this.userSelectData.length>0||this.orgSelectData.length>0||this.departmentSelectData.length>0||this.companySelectData.length>0)?this.isModalDisabled=!1:this.isModalDisabled=!0},userSelectData:function(t){t.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.departmentSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(t){t.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.userSelectData.length>0||this.departmentSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(t){t.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.userSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},addNewField:function(){this.fieldData.push({fieldName:"",parentCode:"",fieldCode:"",operator:"",value:"",logicOperator:""})},cancelAddPermission:function(){this.showPermissionModal=!1},submitPermission:function(){var t=this,e=this.userSelectData.map(function(t){return t.userId}),a=this.orgSelectData.map(function(t){return t.id}),o=this.departmentSelectData.map(function(t){return t.id}),i=(this.companySelectData.map(function(t){return t.groupId}),{user:e,role:o,group:a,listId:this.appListId,resourceId:this.resourceId,resource:this.fieldData});i&&(this.isEdit?Object(s._8)(h()(i)).then(function(e){if(e.success){t.$Message.success(e.message),t.showPermissionModal=!1;var a=t.emitChange++;t.$emit("reGetData",a)}}).catch(function(e){t.$Message.error(e.data.message)}):Object(s.Z)(h()(i)).then(function(e){if(e.success){t.$Message.success(e.message),t.showPermissionModal=!1;var a=t.emitChange++;t.$emit("reGetData",a)}}).catch(function(e){t.$Message.error(e.data.message)}))},modalVisibleChange:function(t){t||this.$emit("emitPermissionModal",{modal:!1})},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},getUserModalData:function(t){if(this.userSelectData.length>0){var e,a={};(e=this.userSelectData).push.apply(e,c()(t)),this.userSelectData=this.userSelectData.reduce(function(t,e){return!a[e.userId]&&(a[e.userId]=t.push(e)),t},[])}else this.userSelectData=t},getGroupModalData:function(t){if(this.orgSelectData.length>0){var e,a={};(e=this.orgSelectData).push.apply(e,c()(t)),this.orgSelectData=this.orgSelectData.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])}else this.orgSelectData=t},getRoleModalData:function(t){if(this.departmentSelectData.length>0){var e,a={};(e=this.departmentSelectData).push.apply(e,c()(t)),this.departmentSelectData=this.departmentSelectData.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])}else this.departmentSelectData=t},deleteUser:function(t){var e=t.target.parentElement.getAttribute("userid");this.userSelectData=this.userSelectData.filter(function(t){return t.userId!=e})},deleteOrg:function(t){var e=t.target.parentElement.getAttribute("orgid");this.orgSelectData=this.orgSelectData.filter(function(t){return t.id!=e})},deleteDepartment:function(t,e){var a=event.target.parentElement.getAttribute("depid");this.departmentSelectData=this.departmentSelectData.filter(function(t){return t.id!=a})}},created:function(){var t=this;Object(s.F)(this.appListId).then(function(e){t.allFieldData=e})},mounted:function(){}},L={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{title:"自定义数据源",width:"1000",transfer:!1,styles:{top:"15px"},"mask-closable":!1},on:{"on-visible-change":t.modalVisibleChange},model:{value:t.showPermissionModal,callback:function(e){t.showPermissionModal=e},expression:"showPermissionModal"}},[a("div",[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"info",shape:"circle"},on:{click:t.addNewField}},[t._v("新增字段")]),t._v(" "),a("Table",{ref:"actionRef",attrs:{stripe:"",height:"200",columns:t.fieldColumns,size:"small","no-data-text":"请添加新字段",data:t.fieldData}})],1),t._v(" "),a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectUserModal}},[t._v("选择用户")])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectGroupModal}},[t._v("选择组织")])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectRoleModal}},[t._v("选择职位")])],1),t._v(" "),t._e()],1),t._v(" "),a("Row",{attrs:{gutter:8}},[a("Col",{staticClass:"permission-tab",attrs:{span:"24"}},[a("Row",{staticStyle:{"margin-top":"10px"}},[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("用户")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.userSelectData,function(e,s){return a("Tag",{key:s,attrs:{userId:e.userId,closable:"",color:"warning"},on:{"on-close":t.deleteUser}},[t._v("\n              "+t._s(e.nickname)+"\n            ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("组织")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.orgSelectData,function(e,s){return a("Tag",{key:s,attrs:{orgId:e.id,closable:"",color:"success"},on:{"on-close":t.deleteOrg}},[t._v("\n            "+t._s(e.name)+"\n          ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("职位")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.departmentSelectData,function(e,s){return a("Tag",{key:s,attrs:{depId:e.id,closable:"",color:"primary"},on:{"on-close":t.deleteDepartment}},[t._v("\n            "+t._s(e.name)+"\n          ")])}))],1),t._v(" "),t._e()],1)],1),t._v(" "),a("user-selector",{attrs:{showUserSelector:t.showSelector.showUserSelector},on:{emitUserModal:t.emitUserModal,userModalData:t.getUserModalData}}),t._v(" "),a("group-selector",{attrs:{showGroupSelector:t.showSelector.showGroupSelector},on:{emitGroupModal:t.emitGroupModal,groupModalData:t.getGroupModalData}}),t._v(" "),a("role-selector",{attrs:{showRoleSelector:t.showSelector.showRoleSelector},on:{emitRoleModal:t.emitRoleModal,roleModalData:t.getRoleModalData}})],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:t.cancelAddPermission}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",disabled:t.isModalDisabled},on:{click:t.submitPermission}},[t._v("确定")])],1)])},staticRenderFns:[]};var H={name:"CustomDatasource",components:{CustomDatasourceModal:a("D8HT")(z,L,!1,function(t){a("ckS/")},null,null).exports},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isEdit:!1,resourceId:"",showActionModal:!1,isModalConfirm:1e3,actionData:[],modalName:"action",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getResourceData()},isAdmin:function(t){this.setColumns()}},methods:{reGetData:function(t){this.isModalConfirm=t},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=!1},emitPermissionModal:function(){this.showActionModal=!1},getResourceData:function(){var t=this;Object(s.P)(this.listId).then(function(e){t.userSources=e})},deleteDataSource:function(t){var e=this;this.$Modal.confirm({title:"确认",content:"确认删除此数据源权限？",onOk:function(){Object(s.i)(t).then(function(t){t.success&&(e.$Message.success(t.message),e.getResourceData())})}})},setColumns:function(){var t=this,e=[{title:"字段过滤",key:"expression",render:function(t,e){var a=[];return e.row.expression.split("br").forEach(function(e){a.push(t("div",{},e))}),t("div",a)}},{title:"已授权用户、组织或职位",key:"instance"}],a=[{title:"操作",key:"list",align:"center",render:function(e,a){return e("div",[e("a",{on:{click:function(){t.deleteDataSource(a.row.resourceId)}}},"删除"),e("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px"}}),e("a",{on:{click:function(){t.isEdit=!0,t.resourceId=a.row.resourceId,t.showActionModal=!0}}},"修改")])}}];this.isAdmin?this.columns=e.concat(a):this.columns=e}},created:function(){},mounted:function(){this.setColumns(),this.getResourceData()}},q={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[a("Row",{staticClass:"app-action"},[a("Row",{staticClass:"app-action-title"},[a("h3",[t._v("自定义数据源"),t.isAdmin?a("a",{staticClass:"app-action-title-add",on:{click:t.showModal}},[t._v("添加")]):t._e()]),t._v(" "),a("span",{staticClass:"warning-color marlr"},[t._v("自定义应用字段过滤条件以及授权给用户或用户组")])]),t._v(" "),a("div",{staticClass:"app-action-source"},[a("Row",[a("Table",{attrs:{columns:t.columns,data:t.userSources,size:"small"}})],1)],1)],1),t._v(" "),a("custom-datasource-modal",{attrs:{modalStatis:t.showActionModal,isEdit:t.isEdit,resourceId:t.resourceId},on:{reGetData:t.reGetData,emitPermissionModal:t.emitPermissionModal}})],1)},staticRenderFns:[]};var Q=a("D8HT")(H,q,!1,function(t){a("OU82")},"data-v-7ba07e2a",null).exports,Z={name:"FieldModal",components:{UserSelector:d.a,GroupSelector:f,RoleSelector:D},props:{modalStatis:Boolean,resourceId:String,isEdit:Boolean},data:function(){var t=this;return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,isBlack:!0,fieldData:[],allFieldData:[],fieldColumns:[{title:"字段",key:"fieldName",render:function(e,a){var s=[];return t.allFieldData.forEach(function(t){s.push(e("Option",{props:{value:t.fieldCode,parentCode:t.parentCode}},t.fieldName))}),e("div",[e("Select",{props:{value:a.row.fieldCode},on:{"on-change":function(e){t.fieldData[a.index].fieldCode=e}}},s)])}},{title:"操作",key:"list",align:"center",render:function(e,a){return e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.fieldData.splice(a.index,1)}}},"删除")}}],userSelectData:[],orgSelectData:[],departmentSelectData:[],companySelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(t,e){var a=this;this.isEdit?(this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[],Object(s.G)(this.appListId,this.resourceId).then(function(t){a.fieldData=t.resource,t.instance.forEach(function(t){var e={};"U"===t.substanceType?(e.nickname=t.substanceName,e.userId=t.substanceId,a.userSelectData.push(e)):"G"===t.substanceType?(e.name=t.substanceName,e.id=t.substanceId,a.orgSelectData.push(e)):"R"===t.substanceType&&(e.name=t.substanceName,e.id=t.substanceId,a.departmentSelectData.push(e))})})):(this.fieldData=[],this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[]),this.showPermissionModal=t},fieldData:function(t){t.length>0?(this.isBlack=t[0].isBlacklist,this.userSelectData.length>0||this.orgSelectData.length>0||this.departmentSelectData.length>0||this.companySelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0):(this.isBlack=!0,this.isModalDisabled=!0)},userSelectData:function(t){t.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.departmentSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(t){t.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.userSelectData.length>0||this.departmentSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(t){t.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.userSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},addNewField:function(){this.fieldData.push({fieldName:"",isBlacklist:this.isBlack,fieldCode:""})},cancelAddPermission:function(){this.showPermissionModal=!1},changeBlackWhiteList:function(t){t?this.fieldData.forEach(function(t){t.isBlacklist=!0}):this.fieldData.forEach(function(t){t.isBlacklist=!1})},submitPermission:function(){var t=this,e=this.userSelectData.map(function(t){return t.userId}),a=this.orgSelectData.map(function(t){return t.id}),o=this.departmentSelectData.map(function(t){return t.id}),i=(this.companySelectData.map(function(t){return t.groupId}),{user:e,role:o,group:a,listId:this.appListId,resourceId:this.resourceId,resource:this.fieldData});i&&(this.isEdit?Object(s._9)(h()(i)).then(function(e){if(e.success){t.$Message.success(e.message),t.showPermissionModal=!1;var a=t.emitChange++;t.$emit("reGetData",a)}}).catch(function(e){t.$Message.error(e.data.message)}):Object(s._1)(h()(i)).then(function(e){if(e.success){t.$Message.success(e.message),t.showPermissionModal=!1;var a=t.emitChange++;t.$emit("reGetData",a)}}).catch(function(e){t.$Message.error(e.data.message)}))},modalVisibleChange:function(t){t||this.$emit("emitPermissionModal",{modal:!1})},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},getUserModalData:function(t){if(this.userSelectData.length>0){var e,a={};(e=this.userSelectData).push.apply(e,c()(t)),this.userSelectData=this.userSelectData.reduce(function(t,e){return!a[e.userId]&&(a[e.userId]=t.push(e)),t},[])}else this.userSelectData=t},getGroupModalData:function(t){if(this.orgSelectData.length>0){var e,a={};(e=this.orgSelectData).push.apply(e,c()(t)),this.orgSelectData=this.orgSelectData.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])}else this.orgSelectData=t},getRoleModalData:function(t){if(this.departmentSelectData.length>0){var e,a={};(e=this.departmentSelectData).push.apply(e,c()(t)),this.departmentSelectData=this.departmentSelectData.reduce(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])}else this.departmentSelectData=t},deleteUser:function(t){var e=t.target.parentElement.getAttribute("userid");this.userSelectData=this.userSelectData.filter(function(t){return t.userId!=e})},deleteOrg:function(t){var e=t.target.parentElement.getAttribute("orgid");this.orgSelectData=this.orgSelectData.filter(function(t){return t.id!=e})},deleteDepartment:function(t,e){var a=event.target.parentElement.getAttribute("depid");this.departmentSelectData=this.departmentSelectData.filter(function(t){return t.id!=a})}},created:function(){var t=this;Object(s.I)(this.appListId).then(function(e){t.allFieldData=e})},mounted:function(){}},J={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{title:"字段权限",width:"1000",transfer:!1,styles:{top:"15px"},"mask-closable":!1},on:{"on-visible-change":t.modalVisibleChange},model:{value:t.showPermissionModal,callback:function(e){t.showPermissionModal=e},expression:"showPermissionModal"}},[a("div",[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("div",{staticClass:"field-toolbar"},[a("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"info",shape:"circle"},on:{click:t.addNewField}},[t._v("新增字段")]),t._v(" "),a("i-switch",{staticClass:"black-white",attrs:{size:"large"},on:{"on-change":t.changeBlackWhiteList},model:{value:t.isBlack,callback:function(e){t.isBlack=e},expression:"isBlack"}},[a("span",{attrs:{slot:"close"},slot:"close"},[t._v("白名单")]),t._v(" "),a("span",{attrs:{slot:"open"},slot:"open"},[t._v("黑名单")])])],1),t._v(" "),a("Table",{ref:"actionRef",attrs:{stripe:"",height:"200",columns:t.fieldColumns,size:"small","no-data-text":"请添加新字段",data:t.fieldData}})],1),t._v(" "),a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectUserModal}},[t._v("选择用户")])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectGroupModal}},[t._v("选择组织")])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{type:"info",shape:"circle"},on:{click:t.selectRoleModal}},[t._v("选择职位")])],1),t._v(" "),t._e()],1),t._v(" "),a("Row",{attrs:{gutter:8}},[a("Col",{staticClass:"permission-tab",attrs:{span:"24"}},[a("Row",{staticStyle:{"margin-top":"10px"}},[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("用户")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.userSelectData,function(e,s){return a("Tag",{key:s,attrs:{userId:e.userId,closable:"",color:"warning"},on:{"on-close":t.deleteUser}},[t._v("\n              "+t._s(e.nickname)+"\n            ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("组织")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.orgSelectData,function(e,s){return a("Tag",{key:s,attrs:{orgId:e.id,closable:"",color:"success"},on:{"on-close":t.deleteOrg}},[t._v("\n            "+t._s(e.name)+"\n          ")])}))],1),t._v(" "),a("Row",{staticClass:"permission-line"}),t._v(" "),a("Row",[a("Col",{attrs:{span:"3"}},[a("b",{staticClass:"permission-title"},[t._v("职位")])]),t._v(" "),a("Col",{staticClass:"member-body",attrs:{span:"21"}},t._l(t.departmentSelectData,function(e,s){return a("Tag",{key:s,attrs:{depId:e.id,closable:"",color:"primary"},on:{"on-close":t.deleteDepartment}},[t._v("\n            "+t._s(e.name)+"\n          ")])}))],1),t._v(" "),t._e()],1)],1),t._v(" "),a("user-selector",{attrs:{showUserSelector:t.showSelector.showUserSelector},on:{emitUserModal:t.emitUserModal,userModalData:t.getUserModalData}}),t._v(" "),a("group-selector",{attrs:{showGroupSelector:t.showSelector.showGroupSelector},on:{emitGroupModal:t.emitGroupModal,groupModalData:t.getGroupModalData}}),t._v(" "),a("role-selector",{attrs:{showRoleSelector:t.showSelector.showRoleSelector},on:{emitRoleModal:t.emitRoleModal,roleModalData:t.getRoleModalData}})],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:t.cancelAddPermission}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",disabled:t.isModalDisabled},on:{click:t.submitPermission}},[t._v("确定")])],1)])},staticRenderFns:[]};var X={name:"FieldPermission",components:{FieldModal:a("D8HT")(Z,J,!1,function(t){a("ho3Q")},null,null).exports},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isEdit:!1,resourceId:"",showActionModal:!1,isModalConfirm:1e3,actionData:[],modalName:"action",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getFieldListData()},isAdmin:function(t){this.setColumns()}},methods:{reGetData:function(t){this.isModalConfirm=t},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=!1},emitPermissionModal:function(){this.showActionModal=!1},getFieldListData:function(){var t=this;Object(s.H)(this.listId).then(function(e){t.userSources=e})},deleteDataSource:function(t){var e=this;this.$Modal.confirm({title:"确认",content:"确认删除此数据源权限？",onOk:function(){Object(s.j)(t).then(function(t){t.success&&(e.$Message.success(t.message),e.getFieldListData())})}})},setColumns:function(){var t=this,e=[{title:"字段",key:"fields",render:function(t,e){return t("div",{},e.row.fields)}},{title:"已授权用户、组织或职位",key:"instance"}],a=[{title:"操作",key:"list",align:"center",render:function(e,a){return e("div",[e("a",{on:{click:function(){t.deleteDataSource(a.row.resourceId)}}},"删除"),e("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px"}}),e("a",{on:{click:function(){t.isEdit=!0,t.resourceId=a.row.resourceId,t.showActionModal=!0}}},"修改")])}}];this.isAdmin?this.columns=e.concat(a):this.columns=e}},created:function(){},mounted:function(){this.setColumns(),this.getFieldListData()}},K={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[a("Row",{staticClass:"app-action"},[a("Row",{staticClass:"app-action-title"},[a("h3",[t._v("字段"),t.isAdmin?a("a",{staticClass:"app-action-title-add",on:{click:t.showModal}},[t._v("添加")]):t._e()]),t._v(" "),a("span",{staticClass:"warning-color marlr"},[t._v("应用字段授权给用户或用户组")])]),t._v(" "),a("div",{staticClass:"app-action-source"},[a("Row",[a("Table",{attrs:{columns:t.columns,data:t.userSources,size:"small"}})],1)],1)],1),t._v(" "),a("field-modal",{attrs:{modalStatis:t.showActionModal,isEdit:t.isEdit,resourceId:t.resourceId},on:{reGetData:t.reGetData,emitPermissionModal:t.emitPermissionModal}})],1)},staticRenderFns:[]};var Y={name:"permissionSource",components:{OperationManage:l,ReportView:_,AppForm:y,WorkFlow:j,ActionManage:U,PermissionDataSource:N,CustomDatasource:Q,FieldPermission:a("D8HT")(X,K,!1,function(t){a("3OkL")},"data-v-09aeaa9e",null).exports},props:{listId:String,appType:String,enabledForbidden:Number,isAdmin:Boolean,isAddress:Boolean},data:function(){return{}},mounted:function(){}},tt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-permission"},[a("operation-manage",{attrs:{enabledForbidden:t.enabledForbidden,isAdmin:t.isAdmin}}),t._v(" "),a("action-manage",{attrs:{isAdmin:t.isAdmin}}),t._v(" "),"subject"!==t.appType?a("permission-data-source",{attrs:{isAdmin:t.isAdmin}}):t._e(),t._v(" "),a("custom-datasource",{attrs:{isAdmin:t.isAdmin}}),t._v(" "),a("field-permission",{attrs:{isAdmin:t.isAdmin}}),t._v(" "),a("report-view",{attrs:{appType:t.appType,isAdmin:t.isAdmin}}),t._v(" "),t.isAddress||"subject"===t.appType?t._e():a("app-form",{attrs:{isAdmin:t.isAdmin}}),t._v(" "),t.isAddress||"subject"===t.appType?t._e():a("work-flow",{attrs:{isAdmin:t.isAdmin}})],1)},staticRenderFns:[]};var et=a("D8HT")(Y,tt,!1,function(t){a("b/c0")},"data-v-5aac42e7",null);e.default=et.exports},"6MbG":function(t,e){},CjwN:function(t,e){},OU82:function(t,e){},Rklg:function(t,e){},WxFH:function(t,e,a){"use strict";e.__esModule=!0;var s,o=a("HmUy"),i=(s=o)&&s.__esModule?s:{default:s};e.default=function(t,e,a){return e in t?(0,i.default)(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}},aWvF:function(t,e){},"b/c0":function(t,e){},"ckS/":function(t,e){},dzMx:function(t,e){},ho3Q:function(t,e){},iWrO:function(t,e){},kAzu:function(t,e){},oG9O:function(t,e){},r0Eq:function(t,e){},zRAR:function(t,e){}});