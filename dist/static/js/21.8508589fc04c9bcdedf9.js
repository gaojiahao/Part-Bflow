webpackJsonp([21],{CwxW:function(e,t,o){"use strict";var r={name:"ProgressRing",props:{radius:Number,progress:Number,strokeWidth:Number,bottomColor:{default:function(){return"#f0f0f0"}},progressColor:{default:function(e){return"green"}}},computed:{strokeDashoffset:function(){return this.circumference-this.percent/100*this.circumference}},watch:{progress:function(){var e=this;if(this.percent=0,this.progress)var t=setInterval(function(){e.percent+=1,e.progress===e.percent?clearInterval(t):0===e.progress&&clearInterval(t)},10);else this.progress=0}},data:function(){var e=this.radius-2*this.strokeWidth;return{normalizedRadius:e,circumference:2*e*Math.PI,percent:0}},mounted:function(){var e=this;this.percent=0;var t=setInterval(function(){e.percent+=1,e.progress===e.percent?clearInterval(t):0===e.progress&&clearInterval(t)},10)}},a={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("svg",{attrs:{height:2*e.radius,width:2*e.radius}},[o("circle",{attrs:{stroke:e.bottomColor,fill:"transparent","stroke-width":e.strokeWidth,r:e.normalizedRadius,cx:e.radius,cy:e.radius}}),e._v(" "),o("circle",{style:{strokeDashoffset:e.strokeDashoffset},attrs:{stroke:e.progressColor,fill:"transparent","stroke-dasharray":e.circumference+" "+e.circumference,"stroke-width":e.strokeWidth+1,r:e.normalizedRadius,cx:e.radius,cy:e.radius}}),e._v(" "),o("text",{staticStyle:{fill:"gray","font-weight":"600","text-anchor":"middle","baseline-shift":"sub","font-family":"sans-serif"},attrs:{x:e.radius,dy:e.radius-3}},[e._v(e._s(e.progress)+"%")])])},staticRenderFns:[]},i=o("D8HT")(r,a,!1,null,null,null).exports;t.a=i},JIcW:function(e,t){},TRIB:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("Sxqw"),a=o.n(r),i=o("cfvZ"),n=o.n(i),s=o("3SZ7"),d=o.n(s),l=o("0Uea"),c=o.n(l),u=o("p2vK"),h=o("CwxW"),p=o("lZCD"),f=o("pX3c"),g=o("K4CD"),m={name:"TechnologyGraph",components:{Shape:u.a,TaskDetailModal:p.a,CustomTable:f.a,ProgressRing:h.a},data:function(){return{showTechnology:!1,prefixCls:"rfd-technology",processRouteCode:this.$route.params.processRouteCode,spinShow:!1,screenWidth:document.body.clientWidth,xAxion:50,yAxion:80,pointList:[],ProcessAndProcedureData:[],defaultxAxion:40,defaultyAxion:80,graphSpace:160,defaultShapeWidth:50,showNumber:9,radioGroupLabel:"mytask",rodioGroupDoOrNot:"todo",defaultDisplayTask:{},percent:{},taskType:"mytask",taskStatus:"todo",type:"myTodo",visible:!1,ordersLoading:!1,searchValue:"",orderCode:"",columnData:[],columns:[{title:"交易号",key:"transCode",align:"center"},{title:"创建者",key:"creatorName",align:"center",width:80},{title:"创建时间",key:"crtTime",align:"center"},{title:"生效时间",key:"effectiveTime",align:"center"}],pageTotal:0,currentPage:1,ordersPageSize:6,modalVisable:!1,taskTableLoading:!1,taskTableColumns:[],todoColumns:[{title:"任务单号",key:"transCode",align:"center",render:function(e,t){return e("a",{attrs:{href:"/Form/index.html?data="+t.row.transCode,target:"_blank"}},t.row.transCode)}},{title:"执行者",key:"worker",align:"center"},{title:"任务数量",key:"todonum",align:"center"},{title:"创建时间",key:"crtTime",align:"center"}],doneColumns:[{title:"任务单号",key:"transCode",align:"center",render:function(e,t){return e("a",{attrs:{href:"/Form/index.html?data="+t.row.transCode,target:"_blank"}},t.row.transCode)}},{title:"执行者",key:"worker",width:75},{title:"验收单号",align:"center",key:"checkCode",render:function(e,t){return e("a",{attrs:{href:"/Form/index.html?data="+t.row.checkCode,target:"_blank"}},t.row.checkCode)}},{title:"验收者",key:"checker",width:75},{title:"验收数量",key:"donenum",align:"center",width:85},{title:"创建时间",key:"crtTime",align:"center",width:150}],taskTableData:[],taskModalPage:{pageTotal:0,currentPage:1,pageSize:6,procedureCode:""}}},watch:{screenWidth:function(e){this.screenWidth=e,this.showNumber=Math.floor(e/(this.defaultShapeWidth+this.graphSpace)),this.pointList=[],this.drawGraph()}},methods:{drawGraph:function(){var e=this,t=this.graphSpace,o=this.defaultShapeWidth,r=0,a=0,i={},n=void 0,s=void 0,d=void 0,l=this.ProcessAndProcedureData;if("start"!==l[0].procedureCode){var c={procedureCode:"start",procedureName:"开始",procedureStatus:1,underProcedure:l[0].procedureCode,sort:"0",myTodo:0,start:1};l.unshift(c)}if("end"!==l[l.length-1].procedureCode){var u={procedureCode:"end",procedureName:"结束",procedureStatus:1,myTodo:0,sort:l.length,start:1};l[l.length-1].underProcedure="end",l.push(u)}for(var h=0;h<l.length;h++)h%this.showNumber==0&&0!==h&&r++,r%2==0?(l[h].pointX=this.defaultxAxion+a*(t+o),l[h].pointY=this.defaultyAxion+(this.defaultShapeWidth+t)*r,i[l[h].procedureCode]=l[h].pointX+","+l[h].pointY,a++):(l[h].procedureCode,l[h].pointX=this.defaultxAxion+(a-1)*(t+o),l[h].pointY=this.defaultyAxion+(this.defaultShapeWidth+t)*r,i[l[h].procedureCode]=l[h].pointX+","+l[h].pointY,a--),this.defaultDisplayTask[l[h].procedureCode]=l[h].myTodo;l.forEach(function(t,r){t.underProcedure&&t.underProcedure in i&&(n=i[t.underProcedure].split(","),s=Number(n[0]),d=Number(n[1]),s===t.pointX&&e.pointList.push({id:t.procedureCode,value:t.pointX+o/2+","+(t.pointY+e.defaultShapeWidth+20)+" "+(s+o/2)+","+(d-4)}),s<t.pointX&&d===t.pointY&&("end"===t.underProcedure?e.pointList.push({id:t.procedureCode,value:t.pointX+","+(t.pointY+e.defaultShapeWidth/2)+" "+(s+o+4)+","+(d+e.defaultShapeWidth/2)}):e.pointList.push({id:t.procedureCode,value:t.pointX+","+(t.pointY+e.defaultShapeWidth/2)+" "+(s+o+4+75)+","+(d+e.defaultShapeWidth/2)})),s>t.pointX&&d===t.pointY&&e.pointList.push({id:t.procedureCode,value:t.pointX+e.defaultShapeWidth+65+","+(t.pointY+e.defaultShapeWidth/2)+" "+(s-4)+","+(d+e.defaultShapeWidth/2)}))})},getProcessAndProcedure:function(e){var t=this,o={};this.spinShow=!0,Object(g.n)(e).then(function(e){if(e[0]){var r=t.showNumber;220*Math.ceil((e.length+2)/r)>document.body.clientHeight-45&&(window.document.getElementsByClassName("rfd-technology-wrap-main")[0].style.height=220*Math.ceil((e.length+2)/r)+"px"),t.ProcessAndProcedureData=e,e.forEach(function(e){0===e.mytask?o[e.procedureCode]=0:o[e.procedureCode]=Math.round(e.myTodo/e.mytask*100)}),t.percent=o,t.showTechnology=!1,t.drawGraph()}else t.showTechnology=!0;t.spinShow=!1}).catch(function(e){t.$Message.error(e)})},radioGroupChange:function(e){this.taskType=e;var t=new c.a([["teamtask_done",function(){return"teamDone"}],["teamtask_todo",function(){return"teamTodo"}],["mytask_done",function(){return"myDone"}],["mytask_todo",function(){return"myTodo"}]]);this.type=t.get(e+"_"+this.taskStatus)(),this.getTaskCountFilter(this.type,this.orderCode)},radioGroupChangeDoneOrTodo:function(e){this.taskStatus=e;var t=new c.a([["teamtask_done",function(){return"teamDone"}],["teamtask_todo",function(){return"teamTodo"}],["mytask_done",function(){return"myDone"}],["mytask_todo",function(){return"myTodo"}]]);this.type=t.get(this.taskType+"_"+e)(),this.getTaskCountFilter(this.type,this.orderCode)},getTaskCountFilter:function(e,t){var o=this,r=void 0;t&&(r=d()([{property:"a.orderCode",value:t,operator:"eq"}])),Object(g.t)(e,this.processRouteCode,r).then(function(t){var r="",a={},i={};t[0]&&n()(t[0]).forEach(function(t){~e.toLowerCase().indexOf(t)&&(r=t)}),t.forEach(function(e){var t=e.todo+e.done;a[e.procedureCode]=0===t?0:Math.round(e[r]/t*100),i[e.procedureCode]=e[r]}),o.percent=a,o.defaultDisplayTask=i})},getSaleOrderList:function(){var e=this;this.searchValue="",this.currentPage=1,this.ordersLoading=!0,Object(g.m)(this.currentPage).then(function(t){e.pageTotal=t.dataCount,e.columnData=t.tableContent,e.ordersLoading=!1})},onHandleClearOrderTag:function(){this.orderCode="",this.getTaskCountFilter(this.type,this.orderCode)},onHandleFilterByCode:function(){var e=this,t=[];this.searchValue&&(t=d()([{operator:"like",value:this.searchValue,property:"transCode"}])),this.currentPage=1,this.ordersLoading=!0,Object(g.m)(this.currentPage,t).then(function(t){e.pageTotal=t.dataCount,e.columnData=t.tableContent,e.ordersLoading=!1})},handleDblclick:function(e,t){var o=this,r=this.type;this.orderCode=e.transCode,this.visible=!1;var a=d()([{property:"a.orderCode",value:e.transCode,operator:"eq"}]);Object(g.t)(r,this.processRouteCode,a).then(function(e){var t="",a={},i={};e[0]&&n()(e[0]).forEach(function(e){~r.toLowerCase().indexOf(e)&&(t=e)}),e.forEach(function(e){var o=e.todo+e.done;a[e.procedureCode]=0===o?0:Math.round(e[t]/o*100),i[e.procedureCode]=e[t]}),o.percent=a,o.defaultDisplayTask=i})},orderPageChange:function(e){var t=this,o=[];this.searchValue&&(o=d()([{operator:"like",value:this.searchValue,property:"transCode"}])),this.currentPage=e,this.ordersLoading=!0,Object(g.m)(this.currentPage,o).then(function(e){t.pageTotal=e.dataCount,t.columnData=e.tableContent,t.ordersLoading=!1})},openTask:function(e){var t=this,o=this.type,r="";this.modalVisable=!0,this.taskTableLoading=!0,this.taskModalPage.procedureCode=e.procedureCode,~o.toLowerCase().indexOf("todo")?this.taskTableColumns=[].concat(a()(this.todoColumns)):this.taskTableColumns=[].concat(a()(this.doneColumns)),this.orderCode&&(r=d()([{operator:"eq",value:this.orderCode,property:"a.orderCode"}])),Object(g.o)(e.procedureCode,this.processRouteCode,this.type,this.taskModalPage.currentPage,this.taskModalPage.pageSize,r).then(function(e){t.taskTableLoading=!1,t.taskModalPage.pageTotal=e.dataCount,t.taskTableData=e.tableContent})},changeCurrentPage:function(e){var t=this;this.taskModalPage.currentPage=e,this.taskTableLoading=!0,Object(g.o)(this.taskModalPage.procedureCode,this.processRouteCode,this.type,this.taskModalPage.currentPage,this.taskModalPage.pageSize).then(function(e){t.taskTableLoading=!1,t.taskModalPage.pageTotal=e.dataCount,t.taskTableData=e.tableContent})}},mounted:function(){var e=this,t=document.body.clientHeight-45;window.document.getElementsByClassName("rfd-technology-wrap-main")[0].style.height=t+"px",this.showNumber=Math.floor(document.body.clientWidth/(this.defaultShapeWidth+this.graphSpace)),window.onresize=function(){return window.screenWidth=document.body.clientWidth,void(e.screenWidth=window.screenWidth)},this.getProcessAndProcedure(this.processRouteCode)}},v={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{class:[e.prefixCls+"-wrap"]},[e.spinShow?o("Spin",{attrs:{size:"large",fix:""}}):e._e(),e._v(" "),o("header",{class:[e.prefixCls+"-wrap-header"]},[o("RadioGroup",{attrs:{size:"large"},on:{"on-change":e.radioGroupChange},model:{value:e.radioGroupLabel,callback:function(t){e.radioGroupLabel=t},expression:"radioGroupLabel"}},[o("Radio",{attrs:{label:"mytask"}},[o("span",[e._v("我的任务")])]),e._v(" "),o("Radio",{attrs:{label:"teamtask"}},[o("span",[e._v("团队任务")])]),e._v(" "),o("i",{staticClass:"vertical-divide"})],1),e._v(" "),o("RadioGroup",{attrs:{size:"large"},on:{"on-change":e.radioGroupChangeDoneOrTodo},model:{value:e.rodioGroupDoOrNot,callback:function(t){e.rodioGroupDoOrNot=t},expression:"rodioGroupDoOrNot"}},[o("Radio",{attrs:{label:"todo"}},[o("span",[e._v("未完成")])]),e._v(" "),o("Radio",{attrs:{label:"done"}},[o("span",[e._v("已完成")])])],1),e._v(" "),o("div",{class:[e.prefixCls+"-dropdown-select"]},[o("Poptip",{attrs:{content:"content",width:"560"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[o("span",{class:[e.prefixCls+"dropdown-select-item"],staticStyle:{"margin-left":"10px"},on:{click:e.getSaleOrderList}},[o("Tag",{attrs:{closable:"",color:"primary"},on:{"on-close":e.onHandleClearOrderTag}},[e._v(e._s(e.orderCode?e.orderCode:"销售订单"))]),e._v(" "),o("Icon",{attrs:{type:"ios-arrow-down"}})],1),e._v(" "),o("div",{attrs:{slot:"content"},slot:"content"},[o("div",{class:[e.prefixCls+"dropdown-select-search"]},[o("Input",{staticStyle:{width:"300px","margin-bottom":"5px"},attrs:{placeholder:"请输入交易号",icon:"ios-close-circle"},on:{"on-enter":e.onHandleFilterByCode,"on-click":e.getSaleOrderList},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),e._v(" "),o("Button",{attrs:{type:"primary",size:"small"},on:{click:e.onHandleFilterByCode}},[e._v("查询")])],1),e._v(" "),o("Table",{attrs:{columns:e.columns,data:e.columnData,loading:e.ordersLoading,size:"small"},on:{"on-row-dblclick":e.handleDblclick}}),e._v(" "),o("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[o("div",{staticStyle:{float:"right"}},[o("Page",{attrs:{total:e.pageTotal,current:e.currentPage,size:"small","page-size":e.ordersPageSize,"show-total":"","show-elevator":""},on:{"on-change":e.orderPageChange}})],1)])],1)])],1)],1),e._v(" "),o("main",{class:[e.prefixCls+"-wrap-main"]},[o("div",{staticClass:"svg-container"},[o("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1"}},[o("defs",[o("filter",{attrs:{id:"f1",x:"0",y:"0",width:"200%",height:"200%"}},[o("feOffset",{attrs:{result:"offOut",in:"SourceGraphic",dx:"0",dy:"0"}}),e._v(" "),o("feColorMatrix",{attrs:{result:"matrixOut",in:"offOut",type:"matrix",values:"0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"}}),e._v(" "),o("feGaussianBlur",{attrs:{result:"blurOut",in:"matrixOut",stdDeviation:"5"}}),e._v(" "),o("feBlend",{attrs:{in:"SourceGraphic",in2:"blurOut",mode:"normal"}})],1)]),e._v(" "),o("defs",[o("marker",{attrs:{id:"arrow",markerUnits:"userSpaceOnUse",markerWidth:"15",markerHeight:"15",viewBox:"0 0 15 15",refX:"6",refY:"6",orient:"auto"}},[o("path",{staticStyle:{fill:"#00ae9d"},attrs:{d:"M2,0 L10,6 L2,12 L6,6 L2,0"}})])]),e._v(" "),o("defs",[o("marker",{attrs:{id:"arrow1",markerUnits:"userSpaceOnUse",markerWidth:"15",markerHeight:"15",viewBox:"0 0 15 15",refX:"6",refY:"6",orient:"auto"}},[o("path",{staticStyle:{fill:"#9cd3d3"},attrs:{d:"M2,0 L10,6 L2,12 L6,6 L2,0"}})])]),e._v(" "),o("defs",[o("marker",{attrs:{id:"arrow_hight_color",markerUnits:"userSpaceOnUse",markerWidth:"15",markerHeight:"15",viewBox:"0 0 15 15",refX:"6",refY:"6",orient:"auto"}},[o("path",{staticStyle:{fill:"red"},attrs:{d:"M2,0 L10,6 L2,12 L6,6 L2,0"}})])]),e._v(" "),o("defs",[o("linearGradient",{attrs:{id:"orange_red",x1:"0%",y1:"0%",x2:"0%",y2:"100%"}},[o("stop",{staticStyle:{"stop-color":"#ffdfd9","stop-opacity":"1"},attrs:{offset:"0%"}}),e._v(" "),o("stop",{staticStyle:{"stop-color":"#ff8069 stop-opacity:1"},attrs:{offset:"100%"}})],1)],1),e._v(" "),e._l(e.ProcessAndProcedureData,function(t){return o("g",{key:t.procedureCode},["start"===t.procedureCode?o("g",[o("shape",{attrs:{xAxion:t.pointX+80,yAxion:t.pointY+25,color:"#7da87b",text:t.procedureName}})],1):"end"===t.procedureCode?o("g",[o("shape",{attrs:{xAxion:t.pointX+25,yAxion:t.pointY+25,color:"#ff0000",text:t.procedureName}})],1):o("g",[o("ProgressRing",{attrs:{x:t.pointX+60,y:t.pointY,radius:25,progress:e.percent[t.procedureCode],strokeWidth:2,progressColor:"#9C27B0"}}),e._v(" "),o("image",{attrs:{x:t.pointX,y:t.pointY,width:e.defaultShapeWidth,height:e.defaultShapeWidth,"xlink:href":"/H_roleplay-si/ds/download?url="+t.photo,rx:"25"}}),e._v(" "),o("text",{staticClass:"svg-text-common-style",staticStyle:{"font-size":"14px"},attrs:{x:t.pointX+e.defaultShapeWidth/2,y:t.pointY+e.defaultShapeWidth+5,fill:"#000"}},[e._v("\n              "+e._s(t.procedureName)+"\n            ")])],1),e._v(" "),e.defaultDisplayTask[t.procedureCode]>0?o("g",[o("circle",{attrs:{cx:t.pointX,cy:t.pointY,r:"12","stroke-width":"1",fill:"red"}}),e._v(" "),o("text",{staticClass:"svg-text-common-style",staticStyle:{"font-size":"10px","font-weight":"bold"},attrs:{x:t.pointX,y:t.pointY-4,fill:"#fff"},on:{click:function(o){e.openTask(t)}}},[e._v("\n              "+e._s(e.defaultDisplayTask[t.procedureCode])+"\n            ")])]):e._e()])}),e._v(" "),e._l(e.pointList,function(e,t){return o("g",{key:t},[o("polyline",{staticStyle:{fill:"none",stroke:"#9cd3d3","stroke-width":"2"},attrs:{points:e.value,"marker-end":"url(#arrow1)"}})])})],2),e._v(" "),e.showTechnology?o("span",{staticClass:"no-technology"},[e._v("暂无工序...")]):e._e()])]),e._v(" "),o("task-detail-modal",{attrs:{width:"721",footerBtnAlign:"right",title:"任务列表",footerHide:!0},model:{value:e.modalVisable,callback:function(t){e.modalVisable=t},expression:"modalVisable"}},[o("div",{staticStyle:{"margin-top":"10px"}},[o("Table",{attrs:{loading:e.taskTableLoading,data:e.taskTableData,columns:e.taskTableColumns,size:"small",stripe:""}}),e._v(" "),o("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[o("div",{staticStyle:{float:"right"}},[o("Page",{attrs:{total:e.taskModalPage.pageTotal,current:e.taskModalPage.currentPage,"page-size":e.taskModalPage.pageSize,size:"small","show-total":"","show-elevator":""},on:{"on-change":e.changeCurrentPage}})],1)])],1)])],1)},staticRenderFns:[]};var y=o("D8HT")(m,v,!1,function(e){o("JIcW")},"data-v-c616b040",null);t.default=y.exports},p2vK:function(e,t,o){"use strict";var r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("svg",[o("circle",{attrs:{cx:e.xAxion,cy:e.yAxion,r:"25",fill:e.color}}),e._v(" "),o("text",{staticClass:"svg-text-common-style",staticStyle:{"font-size":"14px","font-weight":"bold"},attrs:{x:e.xAxion,y:e.yAxion-6,fill:"#fff"}},[e._v("\n            "+e._s(e.text)+"\n    ")])])},staticRenderFns:[]},a=o("D8HT")({props:["xAxion","yAxion","color","text"]},r,!1,null,null,null);t.a=a.exports}});