webpackJsonp([22],{"6LBl":function(e,t){},g6Ys:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s("JUNF"),o=s("woOf"),i=s.n(o),c=s("mvHQ"),a=s.n(c),r=s("GIAq"),l=s("U18u"),b=s("bJtM"),u=s("ejmB"),d={name:"KnowledgeComments",components:{comments:b.a,commentPublish:u.a},props:{},data:function(){return{knowledgeId:this.$route.params.id,type:"knowledge",comments:[],commentsCount:0,pageInfo:{limit:10,page:1,total:0},unsubcribeVisible:!1,subcribeVisible:!0,subscribeInfo:{isSubscribe:0,subscribeNum:0,subscribeUsers:[]}}},methods:{handlePublish:function(e,t){var s=this,n={type:this.type,content:e,relationKey:this.knowledgeId,parentId:-1,commentAndReply:!1,commentAttachments:t};Object(r.U)(n).then(function(e){e.success?s.refreshComments():s.$Notice.warning({title:"系统提示",desc:"添加评论失败,请联系企业管理员!"})})},refreshComments:function(){var e=this,t={relationKey:this.knowledgeId,sort:a()([{property:"crtTime",direction:"DESC"}])};t=i()(t,this.pageInfo),Object(r.C)(t).then(function(t){e.comments=t.tableContent,e.pageInfo.total=t.dataCount})},handlePageChange:function(e){this.pageInfo.page=e,this.refreshComments()},handleSubscribeApp:function(){var e=this;Object(l.c)({type:"knowledge",relationKey:this.knowledgeId}).then(function(t){e.subscribeInfo.isSubscribe=1,e.refreshSubscribeInfo()})},handleUnsubscribeApp:function(e){var t=this;Object(l.d)({relationKey:this.knowledgeId}).then(function(e){t.subscribeInfo.isSubscribe=0,t.refreshSubscribeInfo()})},refreshSubscribeInfo:function(){var e=this;this.$forceUpdate(),Object(l.a)({relationKey:this.knowledgeId,limit:10,page:1}).then(function(t){e.subscribeInfo.subscribeUsers=t.tableContent,e.subscribeInfo.subscribeNum=t.dataCount})},judgeIsSubscribeByRelationKey:function(e){var t=this;Object(l.b)({relationKey:this.knowledgeId}).then(function(e){t.subscribeInfo.isSubscribe=e})}},mounted:function(){this.refreshComments(),this.refreshSubscribeInfo(),this.judgeIsSubscribeByRelationKey()}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"bg_ff "},[s("Row",{staticClass:"app-resource-group-title"},[s("h3",[e._v("评论 \n          "),s("b",{staticClass:"fr subscribe-bar"},[s("span",[1==e.subscribeInfo.isSubscribe&&e.subcribeVisible?s("span",{staticClass:"subcribeing",on:{mouseover:function(t){e.unsubcribeVisible=!0,e.subcribeVisible=!1},mouseout:function(t){e.unsubcribeVisible=!1,e.subcribeVisible=!0}}},[s("Icon",{staticClass:"success-color",attrs:{type:"md-checkmark"}}),e._v("正在关注中\n                  ")],1):e._e(),e._v(" "),1==e.subscribeInfo.isSubscribe&&e.unsubcribeVisible?s("span",{staticClass:"unsubcribe",on:{click:e.handleUnsubscribeApp,mouseout:function(t){e.unsubcribeVisible=!1,e.subcribeVisible=!0}}},[s("Icon",{staticClass:"warning-color",attrs:{type:"md-close"}}),e._v("取消关注\n                  ")],1):e._e(),e._v(" "),0==e.subscribeInfo.isSubscribe?s("span",{staticClass:"subcribe",on:{click:e.handleSubscribeApp}},[e._v("关注")]):e._e(),e._v(" "),s("span",[s("Icon",{staticClass:"success-color",attrs:{type:"md-notifications",size:"18"}})],1)]),e._v(" "),s("span",[s("Dropdown",{staticStyle:{"margin-left":"20px"},attrs:{placement:"bottom-end",trigger:"click"}},[s("Icon",{attrs:{type:"md-person",size:"18"}}),e._v(" "+e._s(e.subscribeInfo.subscribeNum)+"\n                      "),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},e._l(e.subscribeInfo.subscribeUsers,function(t,n){return s("DropdownItem",{key:n},[e._v("\n                             "+e._s(t.nickname)+"\n                          ")])}))],1)],1)])])]),e._v(" "),s("Row",{staticClass:"user-comment"},[s("commentPublish",{attrs:{handlePublish:e.handlePublish}}),e._v(" "),e.comments.length>0?s("div",{staticClass:"user-comment-header"},[s("strong",[e._v("最新评论("+e._s(e.pageInfo.total)+")")])]):e._e(),e._v(" "),s("comments",{attrs:{comments:e.comments,refreshRootComments:e.refreshComments}}),e._v(" "),e.pageInfo.total>0?s("Page",{staticClass:"pad20",attrs:{total:e.pageInfo.total,"page-size":e.pageInfo.limit,current:e.pageInfo.page,"prev-text":"上一页","next-text":"下一页"},on:{"on-change":e.handlePageChange}}):e._e()],1)],1)},staticRenderFns:[]};var p={name:"KnowledgeView",components:{KnowledgeComments:s("VU/8")(d,m,!1,function(e){s("6LBl")},"data-v-61d2c97a",null).exports},data:function(){return{knowledgeId:this.$route.params.id,knowledgeForm:{title:"",type:"",content:"",creator:"",crtTime:""}}},methods:{goBack:function(){this.$router.push({path:"/knowledge/list"})},editKnowledge:function(){this.$router.push({name:"knowledgeDetail",path:"/knowledge/detail/"+this.$route.params.id,params:{id:this.$route.params.id}})},getKnowledgeDataById:function(){var e=this;Object(n.e)(this.knowledgeId).then(function(t){e.knowledgeForm=t})}},created:function(){this.getKnowledgeDataById()}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"knowledge"},[s("Row",{staticClass:"knowledge-title"},[s("span",[e._v(e._s(e.knowledgeForm.title))])]),e._v(" "),s("Row",{staticClass:"knowledge-desc"},[s("img",{attrs:{src:e.knowledgeForm.photo}}),e._v(" "),s("span",{staticClass:"knowledge-desc-type"},[e._v(e._s(e.knowledgeForm.typeName))]),e._v(" "),s("span",{staticClass:"knowledge-desc-creator"},[e._v(e._s(e.knowledgeForm.creator))]),e._v(" "),s("span",{staticClass:"knowledge-desc-crtTime"},[e._v(e._s(e.knowledgeForm.crtTime))])]),e._v(" "),s("Row",{staticClass:"knowledge-content"},[s("div",{staticClass:"knowledge-content-desc",domProps:{innerHTML:e._s(e.knowledgeForm.content)}}),e._v(" "),s("knowledge-comments")],1),e._v(" "),s("Row",{staticClass:"knowledge-toolbar"},[s("span",{staticClass:"knowledge-toolbar-btn",on:{click:e.editKnowledge}},[e._v("编辑")]),e._v(" "),s("span",{staticClass:"knowledge-toolbar-btn",on:{click:e.goBack}},[e._v("返回")])])],1)},staticRenderFns:[]};var f=s("VU/8")(p,g,!1,function(e){s("qkle")},"data-v-0ee2cb92",null);t.default=f.exports},qkle:function(e,t){}});