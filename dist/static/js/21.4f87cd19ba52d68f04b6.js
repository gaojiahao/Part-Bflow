webpackJsonp([21],{"3nRU":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=a("mvHQ"),s=a.n(c),i=a("p1MO"),n={name:"checkSheet",components:{},data:function(){return{checkSheetId:this.$route.params.id,total:0,currentPage:1,pageSize:10,checkSheetName:"",checkSheetDesc:"",searchValue:"",showModal:!1,columns:[{type:"index",width:80},{title:"检查项目",key:"title"},{title:"检查内容",key:"content",width:400}],data:[],formValidate:{name:"",content:""},ruleValidate:{name:[{required:!0,message:"请输入检查项目名称",trigger:"blur"}],content:[{required:!0,message:"请输入检查内容",trigger:"blur"}]}}},methods:{checkSheetItemFilter:function(){var e=s()([{operator:"like",value:this.searchValue,property:"title"}]);this.getCheckSheetItemData(e)},onPageChange:function(e){var t=s()([{operator:"like",value:this.searchValue,property:"title"}]);this.currentPage=e,this.getCheckSheetItemData(t)},onPageSizeChange:function(e){var t=s()([{operator:"like",value:this.searchValue,property:"title"}]);this.pageSize=e,this.getCheckSheetItemData(t)},goCheckSheet:function(){this.$router.push({path:"/checkSheet/list"})},addCheckItem:function(){this.showModal=!0,this.$refs.formValidate.resetFields(),this.formValidate.edit=!1},cancelAdd:function(){this.showModal=!1},confirmAdd:function(){var e=this;this.$refs.formValidate.validate(function(t){t&&(e.formValidate.edit?(e.data[e.formValidate.currentIndex].title=e.formValidate.name,e.data[e.formValidate.currentIndex].content=e.formValidate.content):e.data.push({title:e.formValidate.name,content:e.formValidate.content}),e.showModal=!1)})},saveCheckSheet:function(){var e=this;if(this.checkSheetName)if(this.data.length>0){var t=void 0;this.checkSheetId?(t={id:this.checkSheetId,name:this.checkSheetName,comment:this.checkSheetDesc,jopCheckItemList:this.data},Object(i.e)(t).then(function(t){t.success&&(e.$Message.success(t.message),e.$router.push({path:"/checkSheet/list"}))}).catch(function(t){e.$Message.error(t.data.message)})):(t={name:this.checkSheetName,comment:this.checkSheetDesc,jopCheckItemList:this.data},Object(i.d)(t).then(function(t){t.success&&(e.$Message.success(t.message),e.$router.push({path:"/checkSheet/list"}))}).catch(function(t){e.$Message.error(t.data.message)}))}else this.$Message.error("请至少添加一条检查项目！");else this.$Message.error("请输入点检表名称！")},saveAndAddCheckSheet:function(){var e=this;if(this.checkSheetName)if(this.data.length>0){var t=void 0;this.checkSheetId?(t={id:this.checkSheetId,name:this.checkSheetName,comment:this.checkSheetDesc,jopCheckItemList:this.data},Object(i.e)(t).then(function(t){t.success&&(e.$Message.success(t.message),e.checkSheetName="",e.checkSheetDesc="",e.data=[])}).catch(function(t){e.$Message.error(t.data.message)})):(t={name:this.checkSheetName,comment:this.checkSheetDesc,jopCheckItemList:this.data},Object(i.d)(t).then(function(t){t.success&&(e.$Message.success(t.message),e.checkSheetName="",e.checkSheetDesc="",e.data=[])}).catch(function(t){e.$Message.error(t.data.message)}))}else this.$Message.error("请至少添加一条检查项目！");else this.$Message.error("请输入点检表名称！")},getCheckSheetItemData:function(e){var t=this;Object(i.b)(this.checkSheetId,this.currentPage,this.pageSize,e).then(function(e){t.data=e.tableContent,t.total=e.dataCount,t.checkSheetDesc=e.checkTableComment,t.checkSheetName=e.checkTableName})}},mounted:function(){var e,t=this,a=[{title:"修改者",key:"menderName"},{title:"修改时间",key:"modTime"}],c={title:"操作",key:"action",render:function(e,a){return e("div",[e("a",{on:{click:function(){t.data.splice(a.index,1)}}},"删除"),e("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px"}}),e("a",{on:{click:function(){t.formValidate.name=a.row.title,t.formValidate.content=a.row.content,t.formValidate.currentIndex=a.index,t.formValidate.edit=!0,t.showModal=!0}}},"修改")])}};this.checkSheetId?(a.push(c),(e=this.columns).push.apply(e,a),this.getCheckSheetItemData()):this.columns.push(c)}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"check-detail"},[a("Row",{staticClass:"check-detail-bread"},[a("h3",[a("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){return t.stopPropagation(),e.goCheckSheet(t)}}},[e._v("点检表")]),e._v("\n            / "+e._s(e.checkSheetName))])]),e._v(" "),a("Row",{staticClass:"check-detail-title"},[a("span",[a("b",{staticStyle:{color:"#e4393c"}},[e._v("*")]),e._v("点检表名称：")]),e._v(" "),a("Input",{staticStyle:{width:"200px","font-size":"14px"},attrs:{autofocus:!0,placeholder:"请输入点检表名称"},model:{value:e.checkSheetName,callback:function(t){e.checkSheetName=t},expression:"checkSheetName"}})],1),e._v(" "),a("Row",{staticClass:"check-detail-desc"},[a("span",[e._v("点检表描述：")]),e._v(" "),a("Input",{attrs:{type:"textarea"},model:{value:e.checkSheetDesc,callback:function(t){e.checkSheetDesc=t},expression:"checkSheetDesc"}})],1),e._v(" "),a("Row",{staticClass:"check-detail-table"},[a("span",{staticClass:"check-detail-btn",on:{click:e.addCheckItem}},[e._v("新增")]),e._v(" "),a("div",{staticClass:"app-search"},[a("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"搜索检查项目名称"},on:{"on-search":e.checkSheetItemFilter},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1),e._v(" "),a("Table",{staticStyle:{"margin-top":"5px"},attrs:{columns:e.columns,data:e.data,size:"small"}}),e._v(" "),a("div",{staticClass:"user-page"},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:e.total,current:e.currentPage,"page-size":e.pageSize,size:"small","show-elevator":"","show-sizer":""},on:{"on-page-size-change":e.onPageSizeChange,"on-change":e.onPageChange}})],1)])],1),e._v(" "),a("Row",{staticClass:"check-detail-save"},[a("span",{staticClass:"check-detail-save-btn",on:{click:e.saveCheckSheet}},[e._v("保存")]),e._v(" "),a("span",{staticClass:"check-detail-save-btn",on:{click:e.saveAndAddCheckSheet}},[e._v("保存并继续添加")])]),e._v(" "),a("Modal",{attrs:{title:"新增检查项目"},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":80}},[a("FormItem",{attrs:{label:"检查项目",prop:"name"}},[a("Input",{model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name",t)},expression:"formValidate.name"}})],1),e._v(" "),a("FormItem",{attrs:{label:"检查内容",prop:"content"}},[a("Input",{attrs:{type:"textarea"},model:{value:e.formValidate.content,callback:function(t){e.$set(e.formValidate,"content",t)},expression:"formValidate.content"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:e.confirmAdd}},[e._v("确定")]),e._v(" "),a("Button",{attrs:{type:"default"},on:{click:e.cancelAdd}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(n,h,!1,function(e){a("cvnN")},"data-v-49315afb",null);t.default=o.exports},cvnN:function(e,t){},p1MO:function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"b",function(){return i}),a.d(t,"d",function(){return n}),a.d(t,"e",function(){return h}),a.d(t,"a",function(){return o});var c=a("7B+g"),s=function(e,t,a){return Object(c.a)("/H_roleplay-si/check/listCheckTable",{page:e,limit:t,filter:a})},i=function(e,t,a,s){return Object(c.a)("/H_roleplay-si/check/listCheckItem",{checkTableId:e,page:t,limit:a,filter:s})},n=function(e){return Object(c.a)("/H_roleplay-si/check/saveCheckTableAndCheckItem",{},"POST",e)},h=function(e){return Object(c.a)("/H_roleplay-si/check/updateCheckTableAndCheckItem",{},"POST",e)},o=function(e){return Object(c.a)("/H_roleplay-si/check/deleteCheckTable",{checkTableId:e},"POST")}}});