webpackJsonp([34],{"+OKa":function(e,s){},c72o:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("woOf"),i=t.n(n),o=t("mvHQ"),r=t.n(o),c=t("GIAq"),a=t("U18u"),u=t("bJtM"),b=t("ejmB"),l={name:"userComments",components:{comments:u.a,commentPublish:b.a},props:{},data:function(){return{transCode:this.$route.params.transCode,selectusers:"",type:"instance",comments:[],commentsCount:0,pageInfo:{limit:10,page:1,total:0},unsubcribeVisible:!1,subcribeVisible:!0,showUserModal:!1,isInstance:!1,subscribeInfo:{isSubscribe:0,subscribeNum:0,subscribeUsers:[]}}},watch:{selectusers:function(e){console.log(JSON.parse(e)),this.addUserData(JSON.parse(e))}},methods:{addUserData:function(e){var s=this,t=[],n={};e.forEach(function(e){t.push(e.userId)}),t.length>0&&(n={relationKey:this.transCode,type:this.type,userIds:t.join(",")},Object(a.a)(n).then(function(e){e.success&&(s.$Message.success(e.message),s.refreshSubscribeInfo())}).catch(function(e){s.$Message.error(e.data.message)}))},addSubUsers:function(e){"add"===e&&window.top.viewInsCommentsUserModal&&window.top.viewInsCommentsUserModal()},deleteSubscribeUsers:function(e,s){var t=this,n={relationKey:this.transCode,userIds:e};this.$Modal.confirm({title:"确认",content:"确认退订<b style=color:#e4393c;>"+s+"</b>么？",onOk:function(){Object(a.b)(n).then(function(e){e.success&&(t.$Message.success(e.message),t.refreshSubscribeInfo())}).catch(function(e){t.$Message.error(e.data.message)})}})},handlePublish:function(e,s){var t=this,n={type:this.type,content:e,relationKey:this.transCode,parentId:-1,commentAndReply:!1,commentAttachments:s};Object(c.U)(n).then(function(e){e.success?t.refreshComments():t.$Notice.warning({title:"系统提示",desc:"添加评论失败,请联系企业管理员!"})})},refreshComments:function(){var e=this,s={relationKey:this.transCode,sort:r()([{property:"crtTime",direction:"DESC"}])};s=i()(s,this.pageInfo),Object(c.C)(s).then(function(s){e.comments=s.tableContent,e.pageInfo.total=s.dataCount}).then(function(e){window.top.setInstaceCommentsIframeHeight()})},handlePageChange:function(e){this.pageInfo.page=e,this.refreshComments()},handleSubscribeApp:function(){var e=this;Object(a.e)({type:"instance",relationKey:this.transCode}).then(function(s){e.subscribeInfo.isSubscribe=1,e.refreshSubscribeInfo()})},handleUnsubscribeApp:function(e){var s=this;Object(a.f)({relationKey:this.transCode}).then(function(e){s.subscribeInfo.isSubscribe=0,s.refreshSubscribeInfo()})},refreshSubscribeInfo:function(){var e=this;this.$forceUpdate(),Object(a.c)({relationKey:this.transCode,limit:10,page:1}).then(function(s){e.subscribeInfo.subscribeUsers=s.tableContent,e.subscribeInfo.subscribeNum=s.dataCount})},judgeIsSubscribeByRelationKey:function(e){var s=this;Object(a.d)({relationKey:this.transCode}).then(function(e){s.subscribeInfo.isSubscribe=e})}},mounted:function(){this.refreshComments(),this.refreshSubscribeInfo(),this.judgeIsSubscribeByRelationKey(),window.top.addUserData=this.addUserData}},f={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"bg_ff "},[t("Row",{staticClass:"app-resource-group-title"},[t("h3",[e._v("评论 \n              "),t("b",{staticClass:"fr subscribe-bar"},[t("span",[1==e.subscribeInfo.isSubscribe&&e.subcribeVisible?t("span",{staticClass:"subcribeing",on:{mouseover:function(s){e.unsubcribeVisible=!0,e.subcribeVisible=!1},mouseout:function(s){e.unsubcribeVisible=!1,e.subcribeVisible=!0}}},[t("Icon",{staticClass:"success-color",attrs:{type:"md-checkmark"}}),e._v("正在关注中\n                      ")],1):e._e(),e._v(" "),1==e.subscribeInfo.isSubscribe&&e.unsubcribeVisible?t("span",{staticClass:"unsubcribe",on:{click:e.handleUnsubscribeApp,mouseout:function(s){e.unsubcribeVisible=!1,e.subcribeVisible=!0}}},[t("Icon",{staticClass:"warning-color",attrs:{type:"md-close"}}),e._v("取消关注\n                      ")],1):e._e(),e._v(" "),0==e.subscribeInfo.isSubscribe?t("span",{staticClass:"subcribe",on:{click:e.handleSubscribeApp}},[e._v("关注")]):e._e(),e._v(" "),t("span",[t("Icon",{staticClass:"success-color",attrs:{type:"md-notifications",size:"18"}})],1)]),e._v(" "),t("span",[t("Dropdown",{staticStyle:{"margin-left":"20px"},attrs:{trigger:"click"},on:{"on-click":e.addSubUsers}},[t("Icon",{attrs:{type:"md-person",size:"18"}}),e._v(" "+e._s(e.subscribeInfo.subscribeNum)+"\n                       "),t("Icon",{attrs:{type:"ios-arrow-down"}}),e._v(" "),t("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t("DropdownItem",{attrs:{name:"add"}},[e._v("\n                             添加关注者\n                          ")]),e._v(" "),e._l(e.subscribeInfo.subscribeUsers,function(s,n){return t("DropdownItem",{key:n},[e._v("\n                             "+e._s(s.nickname)+"\n                             "),t("span",{staticClass:"delete-user",on:{click:function(t){t.stopPropagation(),e.deleteSubscribeUsers(s.userId,s.nickname)}}},[t("Icon",{attrs:{type:"md-close"}})],1)])})],2)],1)],1)])])]),e._v(" "),t("Row",{staticClass:"comments"},[t("commentPublish",{attrs:{handlePublish:e.handlePublish}}),e._v(" "),e.comments.length>0?t("div",{staticClass:"comments-header martop10"},[t("strong",[e._v("最新评论("+e._s(e.pageInfo.total)+")")])]):e._e(),e._v(" "),t("comments",{attrs:{isInIframe:!0,comments:e.comments,refreshRootComments:e.refreshComments}}),e._v(" "),e.pageInfo.total>0?t("Page",{staticClass:"pad20",attrs:{total:e.pageInfo.total,"page-size":e.pageInfo.limit,current:e.pageInfo.page,"prev-text":"上一页","next-text":"下一页"},on:{"on-change":e.handlePageChange}}):e._e()],1)],1)},staticRenderFns:[]};var m=t("VU/8")(l,f,!1,function(e){t("+OKa")},"data-v-9edb016c",null);s.default=m.exports}});