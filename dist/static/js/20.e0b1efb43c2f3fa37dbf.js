webpackJsonp([20],{BLn5:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("Gu7T"),n=e.n(s),a=e("mvHQ"),o=e.n(a),c={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"msg-comment"},[e("div",{staticClass:"msg-comment-title"},[e("Icon",{attrs:{type:"ios-notifications-outline",size:18,color:"red"}}),t._v(" "),"taskCreate"==t.data.noticeSource?e("span",[t._v(" 工作流-新任务通知")]):t._e(),t._v(" "),"taskTransfer"==t.data.noticeSource?e("span",[t._v("工作流-转办任务通知")]):t._e(),t._v(" "),"taskComplete"==t.data.noticeSource?e("span",[t._v("工作流-任务已办通知")]):t._e(),t._v(" "),"taskRetract"==t.data.noticeSource||"taskStop"==t.data.noticeSource?e("span",[t._v("工作流-任务取消通知")]):t._e()],1),t._v(" "),e("div",{staticClass:"msg-comment-content"},[e("p",[t._v("实例编码:"+t._s(t.data.tempContent.transCode))]),t._v(" "),e("p",[t._v("任务名称:"+t._s(t.data.tempContent.name))]),t._v(" "),e("p",[t._v("任务状态:"+t._s(t.data.tempContent.status))]),t._v(" "),e("p",[t._v("操作名称:"+t._s(t.data.tempContent.operation))]),t._v(" "),e("p",[t._v("任务编码:"+t._s(t.data.relationKey))]),t._v(" "),e("p",[t._v("执行者:"+t._s(t.data.tempContent.executor))]),t._v(" "),e("p",[t._v("实例创建者:"+t._s(t.data.tempContent.starter))]),t._v(" "),e("p",[t._v("任务创建时间:"+t._s(t.data.tempContent.crtTime))]),t._v(" "),e("p",[t._v("实例创建时间:"+t._s(t.data.tempContent.startTime))])]),t._v(" "),e("div",{staticClass:"msg-comment-href"},[e("a",[t._v("详情 "),e("Icon",{staticClass:"fr",attrs:{type:"ios-arrow-forward"}})],1)])])},staticRenderFns:[]},r=e("VU/8")({name:"flowTaskNotice",props:{data:{}},mounted:function(){}},c,!1,null,null,null).exports,l={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"msg-comment"},[e("div",{staticClass:"msg-comment-title"},[e("Icon",{attrs:{type:"ios-notifications-outline",size:18,color:"#3AA373"}}),t._v(" "),"praise"==t.data.noticeSource?e("span",[t._v("评论点赞通知")]):t._e(),t._v(" "),t.data.noticeSource.includes("commentlist")||t.data.noticeSource.includes("subscribe")?e("span",[t._v("应用评论通知")]):t._e(),t._v(" "),"replyComment"==t.data.noticeSource?e("span",[t._v("评论回复通知")]):t._e(),t._v(" "),"instanceComment"==t.data.noticeSource?e("span",[t._v("实例评论通知")]):t._e()],1),t._v(" "),e("div",{staticClass:"msg-comment-content"},["commentlist"==t.data.noticeSource?e("span",[t._v("@"+t._s(t.data.creatorName)+"发表评论:")]):t._e(),t._v(" "),"replyComment"==t.data.noticeSource?e("span",[t._v("@"+t._s(t.data.creatorName)+"回复了您:")]):t._e(),t._v(" "),"praise"==t.data.noticeSource?e("p",[t._v(t._s(t.data.creatorName)+":对你的评论发表了态度\n           "),e("span",[e("Icon",{attrs:{type:"md-thumbs-up",color:"#FF5722"}})],1)]):t._e(),t._v(" "),"praise"==t.data.noticeSource?e("span",[t._v("@我")]):t._e(),t._v(" "),e("div",{staticStyle:{display:"-webkit-inline-box",padding:"5px","border-radius":"5px"},domProps:{innerHTML:t._s(t.data.tempContent)}})]),t._v(" "),e("div",{staticClass:"msg-comment-href"},[e("a",[t._v("详情 "),e("Icon",{staticClass:"fr",attrs:{type:"ios-arrow-forward"}})],1)])])},staticRenderFns:[]},d=e("VU/8")({name:"commentNoticeTpl",props:{data:{}},mounted:function(){},beforeMount:function(){}},l,!1,null,null,null).exports,f=e("7B+g"),v=function(t){return Object(f.a)("/H_roleplay-si/comment/getAttachmentByListId",t)},u={name:"notifilist",components:{flowTaskTpl:r,commentNoticeTpl:d},props:{list:"",listId:{type:String,default:""}},watch:{listId:{handler:function(t,i){this.refreshNotifics()},deep:!0}},data:function(){return{params:{page:1,limit:10,filter:[]},notifications:[],isRolling:!1}},methods:{hanleWindowNotification:function(t){var i=function(){var i=new Notification("Roletask【路塔】",{body:t,icon:"static/favicon.ico"});i.onclick=function(){console.log("点击"),window.self.focus(),i.close()}};if(window.Notification){var e=navigator.userAgent.toLowerCase();-1!=e.indexOf("safari")&&(e.indexOf("chrome")>-1?Notification.requestPermission().then(function(t){"granted"==t?i():(Notification.requestPermission(),console.log("没有权限,用户拒绝:Notification"))}):Notification.requestPermission(function(t){"granted"==t||(Notification.requestPermission(),console.log("没有权限,用户拒绝:Notification"))}))}else console.log("不支持Notification")},subscribeMessage:function(){var t=this,i=this.$deepstream,e=this.$currentUser.userId;i.event.subscribe("commentMessage/"+e,function(i){t.refreshNotifics(),t.hanleWindowNotification("您有"+i.dataCount+"未读消息"),t.formatNotifications()})},handleScroll:function(){var t=document.getElementById("msgList"),i=this,e=void 0;t.addEventListener("scroll",function(){e=t.scrollTop,t.scrollHeight===t.clientHeight+e&&(i.params.page++,i.isRolling=!0,i.refreshNotifics())})},refreshNotifics:function(){var t,i=this,e=[{property:"listid",value:this.listId,operator:"eq"}];this.params.filter=o()(e),(t=this.params,Object(f.a)("/H_roleplay-si/comment/getCommentMessage",t)).then(function(t){var e;i.isRolling?(e=i.notifications).unshift.apply(e,n()(t.tableContent)):i.notifications=t.tableContent;i.formatNotifications()})},formatNotifications:function(){this.notifications.map(function(t){"comment"===t.type||"praise"===t.type?t.tempContent=JSON.parse(t.content).content:t.tempContent=JSON.parse(t.content)})}},mounted:function(){this.handleScroll(),this.refreshNotifics()}},m={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"notificas-layout-content-notificwin-msg-list notificasscrollbar",attrs:{id:"msgList"}},t._l(t.notifications,function(i,s){return e("div",{key:s,staticClass:"notificas-layout-content-notificwin-msg-list-item"},["praise"==i.type||"comment"==i.type?e("comment-notice-tpl",{attrs:{data:i}}):t._e(),t._v(" "),"flowTask"==i.type?e("flow-task-tpl",{attrs:{data:i}}):t._e()],1)}))},staticRenderFns:[]},p=e("VU/8")(u,m,!1,null,null,null).exports,_={name:"notifiLayoutSider",props:{handleAvtiveNav:Function},data:function(){return{navs:{},params:{page:1,limit:10,filter:""}}},methods:{hanleWindowNotification:function(t){var i=function(){var i=new Notification("Roletask【路塔】",{body:t,icon:"static/favicon.ico"});i.onclick=function(){console.log("点击"),window.self.focus(),i.close()}};if(window.Notification){var e=navigator.userAgent.toLowerCase();-1!=e.indexOf("safari")&&(e.indexOf("chrome")>-1?Notification.requestPermission().then(function(t){"granted"==t?i():(Notification.requestPermission(),console.log("没有权限,用户拒绝:Notification"))}):Notification.requestPermission(function(t){"granted"==t||(Notification.requestPermission(),console.log("没有权限,用户拒绝:Notification"))}))}else console.log("不支持Notification")},refreshNavListByMessage:function(){var t,i=this;(t=this.params,Object(f.a)("/H_roleplay-si/comment/getNavListByMessage",t)).then(function(t){i.navs=t.tableContent,t.dataCount>0&&(i.avtiveNav=i.navs[0],i.navs[0].isActive=!0,i.handleAvtiveNav(i.navs[0]))})},handleReadNotice:function(t){var i;this.$forceUpdate(),this.avtiveNav=t,this.navs.map(function(t){t.isActive=!1}),(i=t.listId,Object(f.a)("/H_roleplay-si/comment/readNotice",{listId:i},"POST")).then(function(i){t.unreadNum=0}),t.isActive=!0,this.handleAvtiveNav(t)},subscribeMessage:function(){var t=this,i=this.$deepstream,e=this.$currentUser.userId;i.event.subscribe("commentMessage/"+e,function(i){t.refreshNavListByMessage(),t.hanleWindowNotification("您有"+i.dataCount+"未读消息")})}},mounted:function(){this.refreshNavListByMessage(),this.subscribeMessage()}},h={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticStyle:{height:"100%"}},[e("div",{staticClass:"notificas-layout-sider-search"},[e("Input",{attrs:{search:"",placeholder:"搜索"}})],1),t._v(" "),e("div",{staticClass:"notificas-layout-sider-navs notificasscrollbar"},[0==t.navs.length?e("div",{staticClass:"notificas-layout-sider-item"},[e("img",{attrs:{width:"50",src:"static/favicon.ico"}}),t._v(" "),t._m(0)]):t._e(),t._v(" "),t._l(t.navs,function(i,s){return e("div",{key:s,staticClass:"notificas-layout-sider-item",class:{active:i.isActive},on:{click:function(e){t.handleReadNotice(i)}}},[e("img",{attrs:{width:"50",src:i.icon}}),t._v(" "),e("div",{staticClass:"notificas-layout-sider-item-describe"},[e("div",{staticClass:"notificas-layout-sider-item-describe-title"},[t._v(t._s(i.listName))]),t._v(" "),e("div",{staticClass:"notificas-layout-sider-item-describe-txt"},[e("p",{domProps:{innerHTML:t._s(i.comment)}})])]),t._v(" "),i.unreadNum>0?e("div",{staticClass:"notificas-layout-sider-item-msgcount"},[t._v(t._s(i.unreadNum))]):t._e()])})],2)])},staticRenderFns:[function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"notificas-layout-sider-item-describe"},[i("div",{staticClass:"notificas-layout-sider-item-describe-title"},[this._v("\n                    Roletask团队\n                ")]),this._v(" "),i("div",{staticClass:"notificas-layout-sider-item-describe-txt"},[i("p",[this._v("暂无通知...")])])])}]},g=e("VU/8")(_,h,!1,null,null,null).exports,y={name:"notifiHistory",props:{list:"",listId:{type:String,default:""},expendVisbible:{type:Boolean,default:!1}},data:function(){return{images:[],imgName:"",imgModalVisible:!1,files:[]}},watch:{listId:{handler:function(t,i){this.refreshImages(),this.refreshFiles()},deep:!0},expendVisbible:{handler:function(t,i){this.refreshImages(),this.refreshFiles()},deep:!0}},methods:{refreshAllWorkFlowTasks:function(){var t,i=[{property:"listid",value:this.listId,operator:"eq"}];this.notiParams.filter=o()(i),(t=this.notiParams,Object(f.a)("/H_roleplay-si/ds/getMyTasks",t)).then(function(t){})},refreshFiles:function(){var t=this,i={page:1,limit:10,listId:this.listId,type:"file"};v(i).then(function(i){t.files=i.tableContent})},refreshImages:function(){var t=this,i={page:1,limit:10,listId:this.listId,type:"image"};v(i).then(function(i){t.images=i.tableContent})},handleViewImg:function(t){this.imgName=t,this.imgModalVisible=!0}}},N={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("Tabs",[e("TabPane",{attrs:{label:"文档"}},t._l(t.files,function(i,s){return e("div",{key:s},[e("a",[t._v(t._s(i.attachmentName))])])})),t._v(" "),e("TabPane",{attrs:{label:"图片"}},t._l(t.images,function(i,s){return e("div",{key:s,staticClass:"comimg"},[e("img",{attrs:{width:"80",src:i.attachment}}),t._v(" "),e("div",{staticClass:"comimg-cover"},[e("Icon",{attrs:{type:"ios-eye-outline"},nativeOn:{click:function(e){t.handleViewImg(i.attachment)}}})],1)])}))],1),t._v(" "),e("Modal",{attrs:{title:"查看图片"},model:{value:t.imgModalVisible,callback:function(i){t.imgModalVisible=i},expression:"imgModalVisible"}},[t.imgModalVisible?e("img",{staticStyle:{width:"100%"},attrs:{src:t.imgName}}):t._e()])],1)},staticRenderFns:[]},b=e("VU/8")(y,N,!1,null,null,null).exports,C={name:"notificationsHeader",props:{nav:{type:Object,default:function(){return{}}},handleExpendHistory:{type:Function}},methods:{handleExpend:function(){this.expend=!this.expend,this.handleExpendHistory(this.expend)}},data:function(){return{expend:!1}}},w={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"notificas-layout-content-header"},[e("div",[e("b",[t._v(t._s(t.nav.listName))]),t._v(" \n        【"+t._s(t.nav.transName)+"】管理员:"+t._s(t.nav.administratorName)+"\n            "),e("Icon",{staticClass:"fr",staticStyle:{"font-size":"40px",cursor:"pointer"},attrs:{type:"ios-more",size:"40"},on:{click:t.handleExpend}})],1),t._v(" "),e("p",{staticStyle:{"font-size":"12px",color:"rgb(146, 154, 171)",height:"20px"},domProps:{innerHTML:t._s(t.nav.comment)}})])},staticRenderFns:[]},x={name:"notifications",components:{notifilist:p,notifiLayoutSider:g,notifiHistory:b,notificationsHeader:e("VU/8")(C,w,!1,null,null,null).exports},data:function(){return{avtiveNav:{},expendHistoryVisbible:!1}},methods:{handleAvtiveNav:function(t){this.avtiveNav=t},handleExpendHistory:function(t){this.expendHistoryVisbible=t}},mounted:function(){}},I={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"notificas"},[e("Row",{staticClass:"notificas-content notificas-layout",attrs:{type:"flex",justify:"center"}},[e("Col",{staticClass:"bg_ff notificas-layout-sider ",attrs:{span:"4"}},[e("notifi-layout-sider",{attrs:{handleAvtiveNav:t.handleAvtiveNav}})],1),t._v(" "),e("Col",{staticClass:"notificas-list bg_ff notificas-layout-content",attrs:{span:"16"}},[t.avtiveNav.listName?e("notifications-header",{attrs:{nav:t.avtiveNav,handleExpendHistory:t.handleExpendHistory}}):t._e(),t._v(" "),e("Row",{staticClass:"notificas-layout-content-notificwin"},[e("Col",{staticClass:"notificas-layout-content-notificwin-msg",attrs:{span:t.expendHistoryVisbible?"16":"24"}},[t.avtiveNav.listId?e("notifilist",{ref:"notifilist",attrs:{listId:t.avtiveNav.listId}}):t._e()],1),t._v(" "),t.expendHistoryVisbible?e("Col",{staticClass:"notificas-layout-content-notificwin-orderlist",attrs:{span:"8"}},[t.avtiveNav.listId?e("notifi-history",{attrs:{listId:t.avtiveNav.listId,expendVisbible:t.expendHistoryVisbible}}):t._e()],1):t._e()],1)],1)],1)],1)},staticRenderFns:[]};var S=e("VU/8")(x,I,!1,function(t){e("Mvo6")},null,null);i.default=S.exports},Mvo6:function(t,i){}});
//# sourceMappingURL=20.e0b1efb43c2f3fa37dbf.js.map