webpackJsonp([23],{IM5n:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("ifoU"),d=i.n(n),o=i("K4CD"),s={name:"BusinessModuleGraph",components:{Shape:i("p2vK").a},data:function(){return{moduleId:this.$route.params.moduleId,spinShow:!1,title:"",topSpace:40,graphSpace:30,defaultWidth:130,defaultHeight:140,nodeWidth:80,nodeHeight:40,nodeList:[],stageList:[],positionList:[],svgWidth:0,svgHeight:0,localPoint:{},nodePointAxion:{},polyLineList:[]}},methods:{getBusinessModuleById:function(t){var i=this;Object(o.e)(t).then(function(t){var e=i;e.title=t.title,e.positionList=t.positionList,e.svgHeight=t.positionList.length*e.defaultHeight+40,e.stageList=e.handleProcssData(t.stageList),e.localPoint=e.setLocalPoint(e.stageList,e.positionList),e.nodeList=e.drawNodePoint(t.nodeList),e.drawLine(e.nodeList),window.document.getElementsByClassName("svg-board")[0].style.height=e.svgHeight+20+"px",window.document.getElementsByClassName("svg-board")[0].style.width=e.svgWidth+"px",i.spinShow=!1})},handleEditGraph:function(t){this.$router.push({path:"/BusinessModuleConfig/"+this.moduleId})},handleProcssData:function(t){for(var e=40,i=0;i<t.length;i++)0!=i&&(e=t[i-1].xAxionLine),t[i].xAxion=t[i].length*this.defaultWidth/2+e,t[i].xAxionLine=t[i].length*this.defaultWidth+e,i==t.length-1&&(this.svgWidth=t[i].xAxionLine);return t},setLocalPoint:function(t,e){for(var i={},n=0,o=0,s="",d=0;d<e.length;d++)for(var r=0;r<t.length;r++)s=t[r].columnAnchorPoint+"_"+e[d].rowAnchorPoint,n=t[r].xAxionLine-t[r].length*this.defaultWidth,o=this.topSpace+this.defaultHeight/2*(2*d+1),i[s]=n+","+o;return i},drawNodePoint:function(t){for(var o=this,e={},i=[],n=0;n<t.length;n++){var s=t[n];if(e[s.columnAnchorPoint+"_"+s.rowAnchorPoint])for(var d=0;d<i.length;d++){var r=i[d];if(r.id==s.columnAnchorPoint+"_"+s.rowAnchorPoint){r.arr.push(s);break}}else i.push({id:s.columnAnchorPoint+"_"+s.rowAnchorPoint,arr:[s]}),e[s.columnAnchorPoint+"_"+s.rowAnchorPoint]=s}var a=[],h={},l=this.localPoint,c=0,u=this.stageList[0].columnAnchorPoint,g=!1;return i.forEach(function(n){if(g=!!~n.id.indexOf(u)){var t=n.arr.filter(function(t){return"-2"===t.id});g=0<t.length}n.arr.forEach(function(t,e){var i=l[n.id].split(",");t.xAxion=g?+i[0]+o.graphSpace*(e+1)+c+(o.graphSpace+o.nodeWidth):+i[0]+o.graphSpace*(e+1)+c,t.yAxion=+i[1],c=o.nodeWidth*(e+1),h[t.id]=t.xAxion+","+t.yAxion,a.push(t)}),c=0}),this.nodePointAxion=h,a},drawLine:function(t){var r=this,o=this.nodePointAxion,s=new d.a([[1,function(t,e){var i=+t[0],n=+t[1],o=+e[0],s=+e[1];return Math.abs(i-o)>4*r.graphSpace+r.nodeWidth?i+r.nodeWidth/2+","+(n-r.nodeHeight/2)+" "+(i+r.nodeWidth/2)+","+(n-r.nodeHeight/2-10)+" "+(o+r.nodeWidth/2)+","+(s-r.nodeHeight/2-10)+" "+(o+r.nodeWidth/2)+","+(s-r.nodeHeight/2-3):(i<o?i+r.nodeWidth:i)+","+n+" "+(i<o?o-3:o+r.nodeWidth+3)+","+s}],[2,function(t,e){var i=+t[0],n=+t[1],o=+e[0],s=+e[1];return Math.abs(n-s)>=2*r.defaultHeight?i+","+n+" "+(i-10)+","+n+" "+(o-10)+","+s+" "+(i-3)+","+s:i+r.nodeWidth/2+","+(s<n?n-r.nodeHeight/2:n+r.nodeHeight/2)+" "+(o+r.nodeWidth/2)+","+(s<n?s+r.nodeHeight/2+3:s-r.nodeHeight/2-3)}],[3,function(t,e){var i="0,0,0,0",n=+t[0],o=+t[1],s=+e[0],d=+e[1];return 0<n-s&&0<o-d?i=n+r.nodeWidth/2+","+(o-r.nodeHeight/2)+" "+(n+r.nodeWidth/2)+","+(o-r.nodeHeight/2-20)+" "+(s-10)+","+(o-r.nodeHeight/2-20)+" "+(s-10)+","+d+" "+(s-3)+","+d:n-s<0&&o-d<0?i=n+r.nodeWidth/2+","+(o+r.nodeHeight/2)+" "+(n+r.nodeWidth/2)+","+(o+r.nodeHeight/2+20)+" "+(s-20)+","+(o+r.nodeHeight/2+20)+" "+(s-20)+","+d+" "+(s-3)+","+d:n-s<0&&0<o-d?i=n+r.nodeWidth+","+o+" "+(n+r.nodeWidth+10)+","+o+" "+(n+r.nodeWidth+10)+","+d+" "+(s-3)+","+d:0<n-s&&o-d<0&&(i=n+r.nodeWidth/2+","+(o+r.nodeHeight/2)+" "+(n+r.nodeWidth/2)+","+(o+r.nodeHeight/2+20)+" "+(n-20)+","+(o+r.nodeHeight/2+20)+" "+(n-20)+","+(d+r.nodeHeight/2+20)+" "+(s+r.nodeWidth/2)+","+(d+r.nodeHeight/2+20)+" "+(s+r.nodeWidth/2)+","+(d+r.nodeHeight/2+3)),i}]]);t.forEach(function(n){n.nextNodeList&&0<n.nextNodeList.length&&n.nextNodeList.forEach(function(t){var e=o[t.id].split(","),i=o[n.id].split(",");e[0]!=i[0]&&e[1]==i[1]?r.polyLineList.push({id:n.id,value:s.get(1)(i,e)}):e[0]==i[0]&&e[1]!=i[1]?r.polyLineList.push({id:n.id,value:s.get(2)(i,e)}):e[0]!=i[0]&&e[1]!=i[1]&&r.polyLineList.push({id:n.id,value:s.get(3)(i,e)})})})}},watch:{moduleId:function(t){this.getBusinessModuleById(t)}},mounted:function(){this.spinShow=!0,this.getBusinessModuleById(this.moduleId)}},r=i("eiJN"),a=i.n(r);var h=function(t){i("QV3L")},l=i("VU/8")(s,a.a,!1,h,null,null);e.default=l.exports},QV3L:function(t,e){},eOwd:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("svg",[i("circle",{attrs:{cx:t.xAxion,cy:t.yAxion,r:"25",fill:t.color}}),t._v(" "),i("text",{staticClass:"svg-text-common-style",staticStyle:{"font-size":"14px","font-weight":"bold"},attrs:{x:t.xAxion,y:t.yAxion-6,fill:"#fff"}},[t._v("\n            "+t._s(t.text)+"\n    ")])])},staticRenderFns:[]}},eiJN:function(t,e){t.exports={render:function(){var i=this,t=i.$createElement,n=i._self._c||t;return n("div",{staticClass:"view-container"},[i.spinShow?n("Spin",{attrs:{size:"large",fix:""}}):i._e(),i._v(" "),n("header",{staticClass:"header"},[n("label",[i._v("模板名称:")]),i._v(" "),n("span",[i._v(i._s(i.title))])]),i._v(" "),n("div",{staticClass:"svg-board"},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"}},[n("defs",[n("marker",{attrs:{id:"arrow",markerUnits:"userSpaceOnUse",markerWidth:"15",markerHeight:"15",viewBox:"0 0 15 15",refX:"6",refY:"6",orient:"auto"}},[n("path",{staticStyle:{fill:"#4672c4"},attrs:{d:"M2,0 L10,6 L2,12 L6,6 L2,0"}})])]),i._v(" "),i._l(i.stageList,function(t){return n("g",{key:t.rowAnchorPoint},[n("text",{staticClass:"top-process",attrs:{x:t.xAxion,y:"20"}},[i._v("\n            "+i._s(t.title)+"\n          ")]),i._v(" "),n("line",{staticStyle:{stroke:"#eceef6","stroke-width":"2"},attrs:{x1:t.xAxionLine,y1:"0",x2:t.xAxionLine,y2:i.svgHeight}})])}),i._v(" "),n("line",{staticStyle:{stroke:"#eceef6","stroke-width":"2"},attrs:{x1:"40",y1:"0",x2:"40",y2:i.svgHeight}}),i._v(" "),i._l(i.positionList,function(t,e){return n("g",{key:t.columnAnchorPoint},[n("text",{staticClass:"top-process left-slide",attrs:{x:"30",y:i.topSpace+i.defaultHeight/2*(2*e+1)}},[i._v("\n            "+i._s(t.title.replace(/（/g,"(").split("(")[0])+"\n        ")]),i._v(" "),n("line",{staticStyle:{stroke:"#eceef6","stroke-width":"2"},attrs:{x1:"0",y1:i.topSpace+i.defaultHeight*e,x2:i.topSpace+i.svgWidth,y2:i.topSpace+i.defaultHeight*e}})])}),i._v(" "),n("line",{staticStyle:{stroke:"#eceef6","stroke-width":"2"},attrs:{x1:"0",y1:i.svgHeight,x2:i.topSpace+i.svgWidth,y2:i.svgHeight}}),i._v(" "),i._l(i.nodeList,function(t){return n("g",{key:t.id},["-2"===t.listId||"-3"==t.listId?n("ellipse",{staticStyle:{fill:"#cd5334",stroke:"cd5334","stroke-width":"1"},attrs:{cx:t.xAxion+i.nodeWidth/2,cy:t.yAxion,rx:i.nodeWidth/2,ry:i.nodeHeight/2}}):n("rect",{attrs:{x:t.xAxion,y:t.yAxion-i.nodeHeight/2,width:i.nodeWidth,height:i.nodeHeight,stroke:"#df8931",fill:"#df8931","stroke-width":"1"}}),i._v(" "),n("foreignObject",{attrs:{x:t.xAxion,y:t.yAxion-i.nodeHeight/2,height:i.nodeHeight,width:i.nodeWidth}},[n("body",{staticStyle:{"background-color":"transparent"},attrs:{xmlns:"http://www.w3.org/2000/svg"}},[n("div",{staticStyle:{color:"#fff","font-size":"12px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"100%","text-align":"center"}},[i._v("\n                  "+i._s(t.name)+"\n                ")])])])],1)}),i._v(" "),i._l(i.polyLineList,function(t,e){return n("g",{key:t.id+"_"+e},[n("polyline",{staticStyle:{fill:"none",stroke:"#4672c4","stroke-width":"2"},attrs:{points:t.value,"marker-end":"url(#arrow)"}})])}),i._v("Z\n    ")],2)]),i._v(" "),n("div",{staticClass:"config-action"},[n("input",{staticClass:"config-action-submit",attrs:{type:"submit",value:"编辑"},on:{click:i.handleEditGraph}})])],1)},staticRenderFns:[]}},p2vK:function(t,e,i){"use strict";var n=i("eOwd"),o=i.n(n),s=i("VU/8")({props:["xAxion","yAxion","color","text"]},o.a,!1,null,null,null);e.a=s.exports}});