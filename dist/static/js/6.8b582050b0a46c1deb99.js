webpackJsonp([6],{"3fB+":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("GIAq"),o=s("bTqw"),i={name:"permissionSource",components:{},props:{enabledForbidden:Number,isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isEdit:"",actionData:[]}},watch:{enabledForbidden:function(){this.getData()}},methods:{isForbidden:function(e,t){var s=this,o=void 0;o=0===e.permType?-2:0,Object(a.a)(e.id,o).then(function(e){e.success&&(s.$Message.success(e.message),s.getData())})},getData:function(){var e=this,t=this.listId;Object(a.r)(t).then(function(t){e.actionData=t.tableContent,e.actionData.map(function(e){e.desc=o.a[e.resourceName]})})}},created:function(){},mounted:function(){this.getData()}},n={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app"},[s("Row",{staticClass:"app-action"},[s("Row",{staticClass:"app-action-title"},[s("h3",[e._v("动作")]),s("span",{staticClass:"warning-color marlr"},[e._v("勾选以启用或停用应用的动作")])]),e._v(" "),s("div",{staticClass:"app-action-source"},[s("Row",{staticClass:"app-action-source-list"},e._l(e.actionData,function(t,a){return s("Col",{key:a,staticClass:"app-action-source-item",attrs:{span:"6"}},[s("Col",{staticClass:"app-action-source-item-check",attrs:{span:"2"}},[s("Checkbox",{attrs:{disabled:!e.isAdmin,value:0===t.permType},on:{"on-change":function(s){e.isForbidden(t,a)}}})],1),e._v(" "),s("Col",{staticClass:"app-action-source-item-content",attrs:{span:"21"}},[s("h3",[e._v(e._s(t.name))]),e._v(" "),s("div",{staticClass:"app-action-source-item-desc"},[e._v(e._s(t.desc))])])],1)}))],1)],1)],1)},staticRenderFns:[]};var r=s("VU/8")(i,n,!1,function(e){s("xSr9")},"data-v-31c1b46a",null).exports,l=s("Gu7T"),c=s.n(l),u=(s("lZCD"),s("mvHQ")),d=s.n(u),h={name:"UserSelector",components:{},props:{showUserSelector:{type:Boolean}},data:function(){return{searchUserValue:"",userTotal:0,userCurrentPage:1,pageSize:10,userLoading:!0,showUserModal:!1,userColumns:[{type:"selection",width:60,align:"center"},{title:"头像",key:"photo",width:80,render:function(e,t){return e("div",[e("img",{attrs:{src:t.row.photo?t.row.photo:"/resources/images/icon/defaultUserPhoto.jpg"},style:{borderRadius:"50%",height:"32px",width:"32px"}})])}},{title:"姓名",key:"nickname"},{title:"工号",key:"userCode"},{title:"手机",key:"mobile"},{title:"邮箱",key:"email"}],userData:[],userSelectData:[],userSelection:[]}},watch:{showUserSelector:function(e){e&&(this.showUserModal=e,this.selectUserModal(),this.userSelection=[],this.userSelectData=[])}},methods:{userFilter:function(){var e=d()([{operator_1:"like",value_1:this.searchUserValue,property_1:"nickname",link:"or",operator_2:"like",value_2:this.searchUserValue,property_2:"userCode"}]);this.selectUserModal(e,1)},selectUserModal:function(e,t){var s=this;this.userLoading=!0,Object(a.t)(t||this.userCurrentPage,this.pageSize,e).then(function(e){s.userData=e.tableContent,s.userTotal=e.dataCount,s.userLoading=!1,s.userSelection.length>0&&s.userData.map(function(e){s.userSelection.map(function(t){e.userId==t.userId&&(e._checked=!0)})})})},selectUserClick:function(e,t){if(0===e.length){var s=this.$refs.userTable.data,a=this.userSelection;s.map(function(e){a=a.filter(function(t){return t.userId!==e.userId})}),this.userSelection=a}else{var o,i={};(o=this.userSelection).push.apply(o,c()(e)),this.userSelection=this.userSelection.reduce(function(e,t){return!i[t.userId]&&(i[t.userId]=e.push(t)),e},[])}},onUserSelectAll:function(e){var t,s={};(t=this.userSelection).push.apply(t,c()(e)),this.userSelection=this.userSelection.reduce(function(e,t){return!s[t.userId]&&(s[t.userId]=e.push(t)),e},[])},selectUserCancel:function(e,t){var s=this;this.userSelection.forEach(function(e,a){e.userId===t.userId&&s.userSelection.splice(a,1)})},deleteSelectUser:function(e,t){var s=this;this.userSelection.splice(t,1),this.$refs.userTable.data.forEach(function(t,a){e.userId===t.userId&&s.$refs.userTable.toggleSelect(a)})},cancelSelectUser:function(){this.userSelection=this.userSelectData},confirmUser:function(){var e={};this.userSelectData=this.userSelection.reduce(function(t,s){return!e[s.userId]&&(e[s.userId]=t.push(s)),t},[]),this.$emit("userModalData",this.userSelectData)},modalVisibleChange:function(e){e||this.$emit("emitUserModal",{modal:!1})},onUserPageChange:function(e){var t=d()([{operator_1:"like",value_1:this.searchUserValue,property_1:"nickname",link:"or",operator_2:"like",value_2:this.searchUserValue,property_2:"userCode"}]);this.userCurrentPage=e,this.selectUserModal(t)}},mounted:function(){}},p={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Modal",{attrs:{title:"用户选择","mask-closable":!1,width:"800",styles:{top:"15px"}},on:{"on-ok":e.confirmUser,"on-cancel":e.cancelSelectUser,"on-visible-change":e.modalVisibleChange},model:{value:e.showUserModal,callback:function(t){e.showUserModal=t},expression:"showUserModal"}},[s("div",{staticClass:"app-search"},[s("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"名称或工号搜索"},on:{"on-search":e.userFilter},model:{value:e.searchUserValue,callback:function(t){e.searchUserValue=t},expression:"searchUserValue"}}),e._v(" "),s("p",{staticClass:"app-search-icon",on:{click:e.userFilter}},[s("Button",{attrs:{type:"primary",size:"small"}},[e._v("查询")])],1)],1),e._v(" "),s("Table",{ref:"userTable",attrs:{height:"400",stripe:"",size:"small",loading:e.userLoading,columns:e.userColumns,data:e.userData},on:{"on-select-cancel":e.selectUserCancel,"on-select-all":e.onUserSelectAll,"on-selection-change":e.selectUserClick}}),e._v(" "),s("div",{staticClass:"user-page"},[s("div",{staticStyle:{float:"right"}},[s("Page",{attrs:{total:e.userTotal,current:e.userCurrentPage,"page-size":e.pageSize,size:"small","show-total":""},on:{"on-change":e.onUserPageChange}})],1)]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.userSelection[0],expression:"userSelection[0] "}],staticClass:"page-selection-warp"},e._l(e.userSelection,function(t,a){return s("Tag",{key:t.userId,attrs:{userId:t.userId,closable:"",type:"border",color:"primary",size:"small"},on:{"on-close":function(s){e.deleteSelectUser(t,a)}}},[e._v("\n        "+e._s(t.nickname)+"\n      ")])}))],1)],1)},staticRenderFns:[]};var m=s("VU/8")(h,p,!1,function(e){s("btsz")},null,null).exports,f={name:"GroupSelector",components:{},props:{showGroupSelector:{type:Boolean}},data:function(){return{searchOrgValue:"",orgTotal:0,orgCurrentPage:1,pageSize:10,orgLoading:!0,showOrgModal:!1,orgColumns:[{type:"selection",width:60,align:"center"},{title:"名称",key:"name"}],orgData:[],orgSelectData:[],orgSelection:[]}},watch:{showGroupSelector:function(e){e&&(this.showOrgModal=e,this.selectOrgModal(),this.orgSelection=[],this.orgSelectData=[])}},methods:{orgFilter:function(){var e=d()([{operator:"like",value:this.searchOrgValue,property:"name"}]);this.selectOrgModal(e,1)},selectOrgModal:function(e,t){var s=this;this.orgLoading=!0,Object(a.q)(t||this.orgCurrentPage,this.pageSize,e).then(function(e){s.orgData=e.tableContent,s.orgTotal=e.dataCount,s.orgLoading=!1,s.orgSelection.length>0&&s.orgData.map(function(e){s.orgSelection.map(function(t){e.id==t.id&&(e._checked=!0)})})})},selectOrgClick:function(e,t){if(0===e.length){var s=this.$refs.orgTable.data,a=this.orgSelection;s.map(function(e){a=a.filter(function(t){return t.id!==e.id})}),this.orgSelection=a}else{var o,i={};(o=this.orgSelection).push.apply(o,c()(e)),this.orgSelection=this.orgSelection.reduce(function(e,t){return!i[t.id]&&(i[t.id]=e.push(t)),e},[])}},onOrgSelectAll:function(e){var t,s={};(t=this.orgSelection).push.apply(t,c()(e)),this.orgSelection=this.orgSelection.reduce(function(e,t){return!s[t.id]&&(s[t.id]=e.push(t)),e},[])},selectOrgCancel:function(e,t){var s=this;this.orgSelection.forEach(function(e,a){e.id===t.id&&s.orgSelection.splice(a,1)})},deleteSelectOrg:function(e,t){var s=this;this.orgSelection.splice(t,1),this.$refs.orgTable.data.forEach(function(t,a){e.id===t.id&&s.$refs.orgTable.toggleSelect(a)})},cancelSelectOrg:function(){this.orgSelection=this.orgSelectData},confirmOrg:function(){var e={};this.orgSelectData=this.orgSelection.reduce(function(t,s){return!e[s.id]&&(e[s.id]=t.push(s)),t},[]),this.$emit("groupModalData",this.orgSelectData)},modalVisibleChange:function(e){e||this.$emit("emitGroupModal",{modal:!1})},onOrgPageChange:function(e){var t=d()([{operator:"like",value:this.searchOrgValue,property:"name"}]);this.orgCurrentPage=e,this.selectOrgModal(t)}},mounted:function(){}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Modal",{attrs:{title:"组织选择","mask-closable":!1,styles:{top:"15px"}},on:{"on-ok":e.confirmOrg,"on-cancel":e.cancelSelectOrg,"on-visible-change":e.modalVisibleChange},model:{value:e.showOrgModal,callback:function(t){e.showOrgModal=t},expression:"showOrgModal"}},[s("div",{staticClass:"app-search"},[s("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"搜索"},on:{"on-search":e.orgFilter},model:{value:e.searchOrgValue,callback:function(t){e.searchOrgValue=t},expression:"searchOrgValue"}}),e._v(" "),s("p",{staticClass:"app-search-icon",on:{click:e.orgFilter}},[s("Button",{attrs:{type:"primary",size:"small"}},[e._v("查询")])],1)],1),e._v(" "),s("Table",{ref:"orgTable",attrs:{height:"400",stripe:"",size:"small",loading:e.orgLoading,columns:e.orgColumns,data:e.orgData},on:{"on-select-cancel":e.selectOrgCancel,"on-select-all":e.onOrgSelectAll,"on-selection-change":e.selectOrgClick}}),e._v(" "),s("div",{staticClass:"user-page"},[s("div",{staticStyle:{float:"right"}},[s("Page",{attrs:{total:e.orgTotal,current:e.orgCurrentPage,"page-size":e.pageSize,size:"small","show-total":""},on:{"on-change":e.onOrgPageChange}})],1)]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.orgSelection[0],expression:"orgSelection[0] "}],staticClass:"page-selection-warp"},e._l(e.orgSelection,function(t,a){return s("Tag",{key:t.id,attrs:{closable:"",type:"border",color:"primary",size:"small"},on:{"on-close":function(s){e.deleteSelectOrg(t,a)}}},[e._v("\n        "+e._s(t.name)+"\n      ")])}))],1)],1)},staticRenderFns:[]};var S=s("VU/8")(f,g,!1,function(e){s("rcPB")},null,null).exports,v={name:"RoleSelector",components:{},props:{showRoleSelector:{type:Boolean}},data:function(){return{searchDepValue:"",depTotal:0,depCurrentPage:1,pageSize:10,depLoading:!0,showDepartmentModal:!1,departmentColumns:[{type:"selection",width:60,align:"center"},{title:"名称",key:"name"}],departmentData:[],departmentSelectData:[],departmentSelection:[]}},watch:{showRoleSelector:function(e){e&&(this.showDepartmentModal=e,this.selectPositionModal(),this.departmentSelection=[],this.departmentSelectData=[])}},methods:{depFilter:function(){var e=d()([{operator:"like",value:this.searchDepValue,property:"name"}]);this.selectPositionModal(e,1)},selectPositionModal:function(e,t){var s=this;this.depLoading=!0,Object(a.p)(t||this.depCurrentPage,this.pageSize,e).then(function(e){s.departmentData=e.tableContent,s.depTotal=e.dataCount,s.depLoading=!1,s.departmentSelection.length>0&&s.departmentData.map(function(e){s.departmentSelection.map(function(t){e.id==t.id&&(e._checked=!0)})})})},selectDepartmentClick:function(e,t){if(0===e.length){var s=this.$refs.roleTable.data,a=this.departmentSelection;s.map(function(e){a=a.filter(function(t){return t.id!==e.id})}),this.departmentSelection=a}else{var o,i={};(o=this.departmentSelection).push.apply(o,c()(e)),this.departmentSelection=this.departmentSelection.reduce(function(e,t){return!i[t.id]&&(i[t.id]=e.push(t)),e},[])}},onRoleSelectAll:function(e){var t,s={};(t=this.departmentSelection).push.apply(t,c()(e)),this.departmentSelection=this.departmentSelection.reduce(function(e,t){return!s[t.id]&&(s[t.id]=e.push(t)),e},[])},selectDepCancel:function(e,t){var s=this;this.departmentSelection.forEach(function(e,a){e.id===t.id&&s.departmentSelection.splice(a,1)})},deleteSelectRole:function(e,t){var s=this;this.departmentSelection.splice(t,1),this.$refs.roleTable.data.forEach(function(t,a){e.id===t.id&&s.$refs.roleTable.toggleSelect(a)})},cancelSelectDep:function(){this.departmentSelection=this.departmentSelectData},confirmDepartment:function(){var e={};this.departmentSelectData=this.departmentSelection.reduce(function(t,s){return!e[s.id]&&(e[s.id]=t.push(s)),t},[]),this.$emit("roleModalData",this.departmentSelectData)},modalVisibleChange:function(e){e||this.$emit("emitRoleModal",{modal:!1})},onDepPageChange:function(e){var t=d()([{operator:"like",value:this.searchDepValue,property:"name"}]);this.depCurrentPage=e,this.selectPositionModal(t)}},mounted:function(){}},D={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Modal",{attrs:{title:"职位选择","mask-closable":!1,styles:{top:"15px"}},on:{"on-ok":e.confirmDepartment,"on-cancel":e.cancelSelectDep,"on-visible-change":e.modalVisibleChange},model:{value:e.showDepartmentModal,callback:function(t){e.showDepartmentModal=t},expression:"showDepartmentModal"}},[s("div",{staticClass:"app-search"},[s("Input",{staticStyle:{width:"300px"},attrs:{search:!0,placeholder:"搜索"},on:{"on-search":e.depFilter},model:{value:e.searchDepValue,callback:function(t){e.searchDepValue=t},expression:"searchDepValue"}}),e._v(" "),s("p",{staticClass:"app-search-icon",on:{click:e.depFilter}},[s("Button",{attrs:{type:"primary",size:"small"}},[e._v("查询")])],1)],1),e._v(" "),s("Table",{ref:"roleTable",attrs:{height:"400",stripe:"",size:"small",loading:e.depLoading,columns:e.departmentColumns,data:e.departmentData},on:{"on-select-cancel":e.selectDepCancel,"on-select-all":e.onRoleSelectAll,"on-selection-change":e.selectDepartmentClick}}),e._v(" "),s("div",{staticClass:"user-page"},[s("div",{staticStyle:{float:"right"}},[s("Page",{attrs:{total:e.depTotal,current:e.depCurrentPage,"page-size":e.pageSize,size:"small","show-total":""},on:{"on-change":e.onDepPageChange}})],1)]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.departmentSelection[0],expression:"departmentSelection[0] "}],staticClass:"page-selection-warp"},e._l(e.departmentSelection,function(t,a){return s("Tag",{key:t.id,attrs:{closable:"",type:"border",color:"primary",size:"small"},on:{"on-close":function(s){e.deleteSelectRole(t,a)}}},[e._v("\n        "+e._s(t.name)+"\n      ")])}))],1)],1)},staticRenderFns:[]};var w=s("VU/8")(v,D,!1,function(e){s("xAJY")},null,null).exports,b={name:"ReportModal",components:{UserSelector:m,GroupSelector:S,RoleSelector:w},props:{modalStatis:{type:Boolean},permissionId:{type:[String,Number]},permissionData:{type:Array}},data:function(){return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,userSelectData:[],orgSelectData:[],departmentSelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(e,t){var s=this;this.showPermissionModal=e,this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[],e&&(this.orgSelectData=this.permissionData.filter(function(e){return"group"===e.type}),this.departmentSelectData=this.permissionData.filter(function(e){return"role"===e.type}),this.permissionData.forEach(function(e){"user"===e.type&&s.userSelectData.push({nickname:e.name,userId:e.id,type:e.type})}))},userSelectData:function(e){e.length>0?this.isModalDisabled=!1:this.orgSelectData.length>0||this.departmentSelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(e){e.length>0?this.isModalDisabled=!1:this.departmentSelectData.length>0||this.userSelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(e){e.length>0?this.isModalDisabled=!1:this.orgSelectData.length>0||this.userSelectData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},getUserModalData:function(e){if(this.userSelectData.length>0){var t,s={};(t=this.userSelectData).push.apply(t,c()(e)),this.userSelectData=this.userSelectData.reduce(function(e,t){return!s[t.userId]&&(s[t.userId]=e.push(t)),e},[])}else this.userSelectData=e},getGroupModalData:function(e){if(this.orgSelectData.length>0){var t,s={};(t=this.orgSelectData).push.apply(t,c()(e)),this.orgSelectData=this.orgSelectData.reduce(function(e,t){return!s[t.id]&&(s[t.id]=e.push(t)),e},[])}else this.orgSelectData=e},getRoleModalData:function(e){if(this.departmentSelectData.length>0){var t,s={};(t=this.departmentSelectData).push.apply(t,c()(e)),this.departmentSelectData=this.departmentSelectData.reduce(function(e,t){return!s[t.id]&&(s[t.id]=e.push(t)),e},[])}else this.departmentSelectData=e},cancelAddPermission:function(){this.showPermissionModal=!1},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},deleteUser:function(e){var t=e.target.parentElement.getAttribute("userid");this.userSelectData=this.userSelectData.filter(function(e){return e.userId!=t}),this.userSelection=this.userSelection.filter(function(e){return e.userId!=t})},deleteOrg:function(e){var t=e.target.parentElement.getAttribute("orgid");this.orgSelectData=this.orgSelectData.filter(function(e){return e.id!=t}),this.orgSelection=this.orgSelection.filter(function(e){return e.id!=t})},deleteDepartment:function(e){var t=e.target.parentElement.getAttribute("depid");this.departmentSelectData=this.departmentSelectData.filter(function(e){return e.id!=t}),this.departmentSelection=this.departmentSelection.filter(function(e){return e.id!=t})},submitPermission:function(){var e=this,t=this.userSelectData.map(function(e){return e.userId}).join(","),s=this.orgSelectData.map(function(e){return e.id}).join(","),o=this.departmentSelectData.map(function(e){return e.id}).join(",");Object(a.W)(this.permissionId,t,s,o).then(function(t){if(t.success){e.showPermissionModal=!1,e.$Message.success(t.message);var s=e.emitChange++;e.$emit("reGetData",s)}else e.$Message.error(t.message)})},modalVisibleChange:function(e){e||this.$emit("emitPermissionModal",{modal:!1})}}},M={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{transfer:!1,title:"视图权限",width:"600","mask-closable":!1},on:{"on-visible-change":e.modalVisibleChange},model:{value:e.showPermissionModal,callback:function(t){e.showPermissionModal=t},expression:"showPermissionModal"}},[s("div",[s("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[s("Col",{attrs:{span:"8"}},[s("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectUserModal}},[e._v("选择用户")])],1),e._v(" "),s("Col",{attrs:{span:"8"}},[s("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectGroupModal}},[e._v("选择组织")])],1),e._v(" "),s("Col",{attrs:{span:"8"}},[s("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectRoleModal}},[e._v("选择职位")])],1)],1),e._v(" "),s("Row",{attrs:{gutter:8}},[s("Col",{staticClass:"permission-tab",attrs:{span:"24"}},[s("Row",{staticStyle:{"margin-top":"10px"}},[s("Col",{attrs:{span:"3"}},[s("b",{staticClass:"permission-title"},[e._v("用户")])]),e._v(" "),s("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.userSelectData,function(t,a){return s("Tag",{key:a,attrs:{userId:t.userId,closable:"",color:"warning"},on:{"on-close":e.deleteUser}},[e._v("\n          "+e._s(t.nickname)+"\n        ")])}))],1),e._v(" "),s("Row",{staticClass:"permission-line"}),e._v(" "),s("Row",[s("Col",{attrs:{span:"3"}},[s("b",{staticClass:"permission-title"},[e._v("组织")])]),e._v(" "),s("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.orgSelectData,function(t,a){return s("Tag",{key:a,attrs:{orgId:t.id,closable:"",color:"success"},on:{"on-close":e.deleteOrg}},[e._v("\n          "+e._s(t.name)+"\n        ")])}))],1),e._v(" "),s("Row",{staticClass:"permission-line"}),e._v(" "),s("Row",[s("Col",{attrs:{span:"3"}},[s("b",{staticClass:"permission-title"},[e._v("职位")])]),e._v(" "),s("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.departmentSelectData,function(t,a){return s("Tag",{key:a,attrs:{depId:t.id,closable:"",color:"primary"},on:{"on-close":e.deleteDepartment}},[e._v("\n          "+e._s(t.name)+"\n        ")])}))],1)],1)],1),e._v(" "),s("user-selector",{attrs:{showUserSelector:e.showSelector.showUserSelector},on:{emitUserModal:e.emitUserModal,userModalData:e.getUserModalData}}),e._v(" "),s("group-selector",{attrs:{showGroupSelector:e.showSelector.showGroupSelector},on:{emitGroupModal:e.emitGroupModal,groupModalData:e.getGroupModalData}}),e._v(" "),s("role-selector",{attrs:{showRoleSelector:e.showSelector.showRoleSelector},on:{emitRoleModal:e.emitRoleModal,roleModalData:e.getRoleModalData}})],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"default"},on:{click:e.cancelAddPermission}},[e._v("取消")]),e._v(" "),s("Button",{attrs:{type:"primary",disabled:e.isModalDisabled},on:{click:e.submitPermission}},[e._v("确定")])],1)])},staticRenderFns:[]};var _={name:"reportSource",components:{ReportModal:s("VU/8")(b,M,!1,function(e){s("yKKk")},null,null).exports},props:{appType:String,isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,showReportModal:!1,permissionId:"",columns:[],reportSources:[],permissionData:[]}},watch:{isAdmin:function(e){this.setColumns()},deep:!0},methods:{emitPermissionModal:function(){this.showReportModal=!1},goCreateView:function(){window.top.location.href="/Site/index.html#appSetting/"+this.listId+"/"+this.appType+"/viewTypes"},reGetData:function(){this.getViewsData()},getViewsData:function(){var e=this;Object(a.G)(this.listId).then(function(t){t.forEach(function(e){e.users||(e.users=[]),e.roles||(e.roles=[]),e.groups||(e.groups=[]),e.permissionList=[].concat(c()(e.groups),c()(e.roles),c()(e.users))}),e.reportSources=t})},deleteViews:function(e,t){var s=this;if(1===this.reportSources.length)this.$Message.warning("不可删除唯一视图！");else if(1===e.row.isDefault){var o={viewId:e.row.viewId,listId:this.listId};this.$Modal.confirm({title:"确认",content:"确认删除此视图？",onOk:function(){Object(a.h)(o).then(function(e){if(e.success){s.reportSources.splice(t,1);var o={viewId:s.reportSources[0].viewId,listId:s.listId};Object(a.V)(o).then(function(e){e.success&&s.reloadViewData()})}})}})}else{var i={viewId:e.row.viewId,listId:this.listId};this.$Modal.confirm({title:"确认",content:"确认删除此视图？",onOk:function(){Object(a.h)(i).then(function(e){e.success&&(s.reportSources.splice(t,1),s.$Message.success(e.message))})}})}},reloadViewData:function(){var e=this;Object(a.G)(this.listId).then(function(t){t.forEach(function(e){e.permissionList=[].concat(c()(e.groups),c()(e.roles),c()(e.users))}),e.reportSources=t})},onClickDefaultView:function(e){var t=this;this.$Modal.confirm({title:"确认",content:"确认设置此视图为默认视图？",onOk:function(){t.setDefaultViews(e)},onCancel:function(){t.reloadViewData()}})},setDefaultViews:function(e){var t=this,s={viewId:e.row.viewId,listId:this.listId};Object(a.V)(s).then(function(e){e.success&&(t.$Message.success(e.message),t.reloadViewData())})},setColumns:function(){var e=this,t=[{title:"报表名称",key:"title"},{title:"已授权用户、组织或职位",key:"permissionList",render:function(e,t){var s=t.row.permissionList,a=[];if(s.length>0)return s.forEach(function(t,s){var o=e("span",{style:{margin:"0px 5px"}},t.name);a.push(o)}),e("div",a)}}],s=[{title:"默认视图",key:"isDefault",align:"center",render:function(t,s){var a=!1;return 1===s.row.isDefault&&(a=!0),t("Radio",{props:{value:a,disabled:!e.isAdmin},on:{"on-change":function(t){e.onClickDefaultView(s)}}})}}],a=[{title:"操作",key:"list",align:"center",render:function(t,s){return console.log(e.appType),t("div",[t("a",{on:{click:function(){e.deleteViews(s,s.index)}},style:{display:"subject"!==e.appType?"inline-block":"none"}},"删除"),t("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px",display:"subject"!==e.appType?"inline":"none"}}),t("a",{on:{click:function(){var t="/Site/index.html#appSetting/viewConfig/"+e.listId+"/"+s.row.viewId;window.top.location.href=t}},style:{display:"subject"!==e.appType?"inline-block":"none"}},"修改"),t("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px",display:"subject"!==e.appType?"inline":"none"}}),t("a",{on:{click:function(){e.permissionId=s.row.permissionId,e.showReportModal=!0,e.permissionData=s.row.permissionList}}},"授权")])}}];this.isAdmin&&"subject"!==this.appType?this.columns=t.concat(s).concat(a):this.isAdmin?this.columns=t.concat(a):this.columns=t}},mounted:function(){this.setColumns(),this.getViewsData()}},C={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-report"},[s("Row",{staticClass:"app-report-title"},[s("h3",[e._v("报表 "),e.isAdmin&&"subject"!=e.appType?s("a",{on:{click:e.goCreateView}},[e._v("添加报表")]):e._e()]),e._v(" "),s("span",{staticClass:"warning-color marlr"},[e._v("用户默认拥有此应用默认报表的权限")])]),e._v(" "),s("Row",{staticClass:"app-report-table"},[s("Table",{attrs:{columns:e.columns,data:e.reportSources,size:"small"}})],1),e._v(" "),s("report-modal",{attrs:{modalStatis:e.showReportModal,permissionId:e.permissionId,permissionData:e.permissionData},on:{emitPermissionModal:e.emitPermissionModal,reGetData:e.reGetData}})],1)},staticRenderFns:[]};var y=s("VU/8")(_,C,!1,function(e){s("e9eA")},"data-v-a806903c",null).exports,k={name:"formSource",components:{},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId}},methods:{setForm:function(){window.open("/Form/index.html?viewDesign=true&list="+this.listId)}},created:function(){},mounted:function(){}},I={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"app-form"},[t("Row",{staticClass:"app-form-title"},[t("h3",[this._v("表单 "),this.isAdmin?t("a",{on:{click:this.setForm}},[this._v("表单设置")]):this._e()])])],1)},staticRenderFns:[]};var R=s("VU/8")(k,I,!1,function(e){s("FxqG")},"data-v-682736de",null).exports,A={name:"workflowSource",components:{},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isOperationShow:!0,isCreateShow:!0,isUpdateShow:!0,deleteRelationWorkflow:-1,columns:[],workflows:[]}},watch:{isAdmin:function(e){this.setColumns()}},methods:{getRelativeWorkflowData:function(){var e=this;Object(a.H)(this.listId).then(function(t){var s=[];e.workflows=t,e.workflows.length>0&&(e.workflows.forEach(function(e){s.push(e.triggerType)}),/create/.test(s)&&/update/.test(s)?(e.isOperationShow=!0,e.isCreateShow=!0,e.isUpdateShow=!0):/create/.test(s)?(e.isOperationShow=!0,e.isCreateShow=!0,e.isUpdateShow=!1):/update/.test(s)?(e.isOperationShow=!0,e.isCreateShow=!1,e.isUpdateShow=!0):e.isOperationShow=!1)})},deleteWorkflow:function(e,t){var s=this;this.$Modal.confirm({title:"确认",content:"确认删除此工作流？",onOk:function(){Object(a.m)(null,null,e.id).then(function(e){e.success&&(s.$Message.success(e.message),s.getRelativeWorkflowData(),s.deleteRelationWorkflow++)})}})},addWorkflow:function(){this.getRelativeWorkflowData()},goCreateWorkflow:function(){window.open("/myflow/createWorkFlow.html?listId="+this.listId+"&triggerType=create")},updateWorkFlowStaus:function(e){var t=this,s=e.row,o="";o=1===s.status?"确认禁用该工作流？":"确认启用该工作流？",this.$Modal.confirm({title:"系统提示",content:o,onOk:function(){1===s.status?Object(a.m)(null,s.id).then(function(e){e.success&&(t.$Message.success(e.message),t.getRelativeWorkflowData())}):Object(a.m)(s.id).then(function(e){e.success&&(t.$Message.success(e.message),t.getRelativeWorkflowData())})}})},createWorkflow:function(e){window.open("/myflow/createWorkFlow.html?listId="+this.listId+"&triggerType="+e)},setColumns:function(){var e=this,t=[{title:"工作流名称",key:"processName",align:"left"},{title:"触发动作",key:"triggerType",align:"left",render:function(e,t){return"create"===t.row.triggerType?e("span",{},"创建实例"):e("span",{},"修改实例")}},{title:"启用",key:"status",align:"left",render:function(t,s){return t("Checkbox",{props:{value:1===s.row.status,disabled:!e.isAdmin},on:{"on-change":function(t){e.updateWorkFlowStaus(s)}}})}}],s=[{title:"操作",key:"list",align:"center",render:function(t,s){return t("div",[t("a",{on:{click:function(){e.deleteWorkflow(s.row,s.index)}}},"删除"),t("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px"}}),t("a",{on:{click:function(){window.open("/myflow/viewFlow.html?processId="+s.row.processId+"&listId="+e.listId+"&processCode="+s.row.processCode)}}},"修改")])}}];this.isAdmin?this.columns=t.concat(s):this.columns=t}},created:function(){this.setColumns(),this.getRelativeWorkflowData()}},U={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-workflow"},[s("Row",{staticClass:"app-workflow-title"},[s("h3",[e._v("工作流\n        "),e.isAdmin&&0===e.workflows.length?s("span",{staticClass:"app-workflow-create",on:{click:e.goCreateWorkflow}},[e._v("新建")]):e._e()])]),e._v(" "),s("Row",{staticClass:"app-workflow-table"},[s("Table",{attrs:{columns:e.columns,data:e.workflows,size:"small"}})],1)],1)},staticRenderFns:[]};var O=s("VU/8")(A,U,!1,function(e){s("ArOu")},"data-v-06acb780",null).exports,P={name:"permissionModal",components:{UserSelector:m,GroupSelector:S,RoleSelector:w},props:{modalStatis:Boolean,modalName:String},data:function(){return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,allPermissionData:[],permissionSelectDatas:[],allPermissionColumns:[{type:"selection",width:60,align:"center"},{title:"动作名称",key:"name",width:100},{title:"说明",key:"desc"}],userSelectData:[],orgSelectData:[],departmentSelectData:[],companySelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(e,t){this.showPermissionModal=e,this.permissionSelectDatas=[],this.showPermissionModal&&this.getData(),this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[]},permissionSelectDatas:function(e){e.length>0&&(this.userSelectData.length>0||this.orgSelectData.length>0||this.departmentSelectData.length>0||this.companySelectData.length>0)?this.isModalDisabled=!1:this.isModalDisabled=!0},userSelectData:function(e){e.length>0?this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.departmentSelectData.length>0)&&this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(e){e.length>0?this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.userSelectData.length>0||this.departmentSelectData.length>0)&&this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(e){e.length>0?this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.userSelectData.length>0)&&this.permissionSelectDatas.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},getUserModalData:function(e){if(this.userSelectData.length>0){var t,s={};(t=this.userSelectData).push.apply(t,c()(e)),this.userSelectData=this.userSelectData.reduce(function(e,t){return!s[t.userId]&&(s[t.userId]=e.push(t)),e},[])}else this.userSelectData=e},getGroupModalData:function(e){if(this.orgSelectData.length>0){var t,s={};(t=this.orgSelectData).push.apply(t,c()(e)),this.orgSelectData=this.orgSelectData.reduce(function(e,t){return!s[t.id]&&(s[t.id]=e.push(t)),e},[])}else this.orgSelectData=e},getRoleModalData:function(e){if(this.departmentSelectData.length>0){var t,s={};(t=this.departmentSelectData).push.apply(t,c()(e)),this.departmentSelectData=this.departmentSelectData.reduce(function(e,t){return!s[t.id]&&(s[t.id]=e.push(t)),e},[])}else this.departmentSelectData=e},cancelAddPermission:function(){this.showPermissionModal=!1},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},deleteUser:function(e){var t=this,s=e.target.parentElement.getAttribute("userid"),o=[];this.permissionSelectDatas.forEach(function(e){o.push(e.id)}),Object(a.e)("sys_user_permission",s,o.join(",")).then(function(e){e.success&&(t.userSelectData=t.userSelectData.filter(function(e){return e.userId!=s}),t.userSelection=t.userSelection.filter(function(e){return e.userId!=s}))})},deleteOrg:function(e){var t=this,s=e.target.parentElement.getAttribute("orgid"),o=[];this.permissionSelectDatas.forEach(function(e){o.push(e.id)}),Object(a.e)("sys_group_permission",s,o.join(",")).then(function(e){e.success&&(t.orgSelectData=t.orgSelectData.filter(function(e){return e.id!=s}),t.orgSelection=t.orgSelection.filter(function(e){return e.id!=s}))})},deleteDepartment:function(e,t){var s=this,o=event.target.parentElement.getAttribute("depid"),i=[];this.permissionSelectDatas.forEach(function(e){i.push(e.id)}),Object(a.e)("sys_role_permission",o,i.join(",")).then(function(e){e.success&&(s.departmentSelectData=s.departmentSelectData.filter(function(e){return e.id!=o}),s.departmentSelection=s.departmentSelection.filter(function(e){return e.id!=o}))})},deleteCompany:function(e,t){var s=this,o=event.target.parentElement.getAttribute("comid"),i=[];this.permissionSelectDatas.forEach(function(e){i.push(e.id)}),Object(a.e)("sys_group_permission",o,i.join(",")).then(function(e){e.success&&(s.companySelectData=s.companySelectData.filter(function(e){return e.groupId!=o}),s.companySelectData=s.companySelectData.filter(function(e){return e.groupId!=o}))})},permissionSelectChange:function(e,t){this.permissionSelectDatas=e},submitPermission:function(){var e=this,t=this.userSelectData.map(function(e){return e.userId}),s=this.orgSelectData.map(function(e){return e.id}),o=this.departmentSelectData.map(function(e){return e.id}),i=this.companySelectData.map(function(e){return e.groupId}),n=this.permissionSelectDatas.map(function(e){return e.id}),r={userId:t.join(","),roleId:o.join(","),groupId:s.join(","),companyId:i.join(","),permissionId:n.join(",")};r&&Object(a.b)(r).then(function(t){if(t.success){e.$Message.success(t.message),e.showPermissionModal=!1;var s=e.emitChange++;e.$emit("reGetData",s)}})},modalVisibleChange:function(e){e||this.$emit("emitPermissionModal",{modal:!1})},getData:function(){var e=this.appListId;"action"===this.modalName?this.getActionPerData(e):this.getResPerData(e)},getActionPerData:function(e){var t=this;Object(a.r)(e).then(function(e){t.allPermissionData=e.tableContent,t.allPermissionData.map(function(e){e.desc=o.a[e.resourceName]})})},getResPerData:function(e){var t=this;Object(a.s)(e).then(function(e){t.allPermissionData=e.tableContent,t.allPermissionData.map(function(e){e.desc=o.a[e.resourceName]})})}},mounted:function(){this.getData()}},x={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{transfer:!1,title:"应用权限",width:"1000",styles:{top:"15px"},"mask-closable":!1},on:{"on-visible-change":e.modalVisibleChange},model:{value:e.showPermissionModal,callback:function(t){e.showPermissionModal=t},expression:"showPermissionModal"}},[s("div",[s("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectUserModal}},[e._v("选择用户")])],1),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectGroupModal}},[e._v("选择组织")])],1),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectRoleModal}},[e._v("选择职位")])],1),e._v(" "),e._e()],1),e._v(" "),s("Row",{attrs:{gutter:8}},[s("Col",{staticClass:"permission-tab",attrs:{span:"12"}},[s("Row",{staticStyle:{"margin-top":"10px"}},[s("Col",{attrs:{span:"3"}},[s("b",{staticClass:"permission-title"},[e._v("用户")])]),e._v(" "),s("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.userSelectData,function(t,a){return s("Tag",{key:a,attrs:{userId:t.userId,closable:"",color:"warning"},on:{"on-close":e.deleteUser}},[e._v("\n              "+e._s(t.nickname)+"\n            ")])}))],1),e._v(" "),s("Row",{staticClass:"permission-line"}),e._v(" "),s("Row",[s("Col",{attrs:{span:"3"}},[s("b",{staticClass:"permission-title"},[e._v("组织")])]),e._v(" "),s("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.orgSelectData,function(t,a){return s("Tag",{key:a,attrs:{orgId:t.id,closable:"",color:"success"},on:{"on-close":e.deleteOrg}},[e._v("\n            "+e._s(t.name)+"\n          ")])}))],1),e._v(" "),s("Row",{staticClass:"permission-line"}),e._v(" "),s("Row",[s("Col",{attrs:{span:"3"}},[s("b",{staticClass:"permission-title"},[e._v("职位")])]),e._v(" "),s("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.departmentSelectData,function(t,a){return s("Tag",{key:a,attrs:{depId:t.id,closable:"",color:"primary"},on:{"on-close":e.deleteDepartment}},[e._v("\n            "+e._s(t.name)+"\n          ")])}))],1),e._v(" "),e._e()],1),e._v(" "),s("Col",{attrs:{span:"12"}},[s("Table",{ref:"actionRef",attrs:{stripe:"",height:"350",columns:e.allPermissionColumns,size:"small",data:e.allPermissionData},on:{"on-selection-change":e.permissionSelectChange}})],1)],1),e._v(" "),s("user-selector",{attrs:{showUserSelector:e.showSelector.showUserSelector},on:{emitUserModal:e.emitUserModal,userModalData:e.getUserModalData}}),e._v(" "),s("group-selector",{attrs:{showGroupSelector:e.showSelector.showGroupSelector},on:{emitGroupModal:e.emitGroupModal,groupModalData:e.getGroupModalData}}),e._v(" "),s("role-selector",{attrs:{showRoleSelector:e.showSelector.showRoleSelector},on:{emitRoleModal:e.emitRoleModal,roleModalData:e.getRoleModalData}})],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"default"},on:{click:e.cancelAddPermission}},[e._v("取消")]),e._v(" "),s("Button",{attrs:{type:"primary",disabled:e.isModalDisabled},on:{click:e.submitPermission}},[e._v("确定")])],1)])},staticRenderFns:[]};var j=s("VU/8")(P,x,!1,function(e){s("hROt")},null,null).exports,$={name:"permissionSource",components:{ActionModal:j},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,showActionModal:!1,isModalConfirm:1e3,actionData:[],modalName:"action",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getActionData()},isAdmin:function(e){this.setColumns()}},methods:{reGetData:function(e){this.isModalConfirm=e},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=""},emitPermissionModal:function(){this.showActionModal=!1},getActionData:function(){var e=this;Object(a.v)("action",this.listId).then(function(t){e.userSources=t.tableContent})},deleteAllPermission:function(e,t){var s=this,o=this;o.$Modal.confirm({title:"确认",content:"确认删除此权限？",onOk:function(){var t,i=[],n=[],r=[],l=[],c=[];e.row.action.forEach(function(e){for(var t in e)i.push(t)}),e.row.objNames.forEach(function(e){"user"===e.type?n.push(e.id):"group"===e.type?r.push(e.id):"role"===e.type?l.push(e.id):c.push(e.id)}),t={user:n.join(","),group:r.join(","),role:l.join(","),company:c.join(","),multi:i.join(",")},Object(a.k)(t).then(function(e){e.success&&(o.$Message.success(e.message),s.getActionData())})}})},setColumns:function(){var e=this,t=[{title:"已授权用户、组织或职位",key:"objNames",render:function(e,t){var s=t.row.objNames,a=[];if(s.length>0)return s.forEach(function(t,s){var o;o=e("span",{},t.name+"; "),a.push(o)}),e("div",a)}},{title:"动作",key:"source",render:function(t,s){var o=[],i=[];return s.row.action.forEach(function(e,t){for(var s in e)i.push(s)}),e.actionData.forEach(function(n,r){var l,c=void 0;i.forEach(function(e){e==n.id&&(c=n.id)}),l=t("span",{style:{marginLeft:"5px"}},[t("Checkbox",{props:{value:c,trueValue:n.id,falseValue:n.id+"_false",disabled:!e.isAdmin},on:{"on-change":function(t){var o=void 0,i=void 0,n=void 0,r=void 0,l=void 0;"sys_role_permission"===s.row.list?n=s.row.objId:"sys_user_permission"===s.row.list?o=s.row.objId:"sys_group_permission"===s.row.list?i=s.row.objId:r=s.row.objId,/_/.test(t)?(l=0,t=t.split("_")[0]):l=1,Object(a._2)(o,n,i,r,t,e.listId,l).then(function(t){t.success&&e.$Message.success(t.message)})}}}),t("span",{},n.name)]),o.push(l)}),t("div",o)}}],s=[{title:"操作",key:"list",align:"center",render:function(t,s){return t("div",[t("a",{on:{click:function(){e.deleteAllPermission(s,s.row.list)}}},"删除")])}}];this.isAdmin?this.columns=t.concat(s):this.columns=t}},created:function(){var e=this;Object(a.r)(this.listId).then(function(t){e.actionData=t.tableContent})},mounted:function(){this.setColumns(),this.getActionData()}},T={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[s("Row",{staticClass:"app-action"},[s("Row",{staticClass:"app-action-title"},[s("h3",[e._v("动作"),e.isAdmin?s("a",{staticClass:"app-action-title-add",on:{click:e.showModal}},[e._v("授权")]):e._e()]),e._v(" "),s("span",{staticClass:"warning-color marlr"},[e._v("授予用户、组织或职位当前应用动作的权限")])]),e._v(" "),s("div",{staticClass:"app-action-source"},[s("Row",[s("Table",{attrs:{columns:e.columns,data:e.userSources,size:"small"}})],1)],1)],1),e._v(" "),s("action-modal",{attrs:{modalStatis:e.showActionModal,modalName:e.modalName},on:{reGetData:e.reGetData,emitPermissionModal:e.emitPermissionModal}})],1)},staticRenderFns:[]};var V=s("VU/8")($,T,!1,function(e){s("v8Y1")},"data-v-59bd22d2",null).exports,E={name:"permissionSourceData",components:{ActionModal:j},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,showActionModal:!1,isModalConfirm:1e3,resourceData:[],modalName:"resource",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getResourceData()},isAdmin:function(e){this.setColumns()}},methods:{reGetData:function(e){this.isModalConfirm=e},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=""},emitPermissionModal:function(){this.showActionModal=!1},getResourceData:function(){var e=this;Object(a.v)("resource",this.listId).then(function(t){e.userSources=t.tableContent})},deleteAllPermission:function(e,t){var s=this,o=this;o.$Modal.confirm({title:"确认",content:"确认删除此权限？",onOk:function(){var t,i=[],n=[],r=[],l=[],c=[];e.row.resource.forEach(function(e){for(var t in e)i.push(t)}),e.row.objNames.forEach(function(e){"user"===e.type?n.push(e.id):"group"===e.type?r.push(e.id):"role"===e.type?l.push(e.id):c.push(e.id)}),t={user:n.join(","),group:r.join(","),role:l.join(","),company:c.join(","),multi:i.join(",")},Object(a.k)(t).then(function(e){e.success&&(o.$Message.success(e.message),s.getResourceData())})}})},setColumns:function(){var e=this,t=[{title:"已授权用户、用户组",key:"objNames",render:function(e,t){var s=t.row.objNames,a=[];if(s.length>0)return s.forEach(function(t,s){var o;o=e("span",{},t.name+"; "),a.push(o)}),e("div",a)}},{title:"数据源",key:"source",render:function(t,s){var o=[],i=[];return s.row.resource.forEach(function(e,t){for(var s in e)i.push(s)}),e.resourceData.forEach(function(n,r){var l,c=void 0;i.forEach(function(e){e==n.id&&(c=n.id)}),l=t("span",{style:{marginLeft:"10px"}},[t("Checkbox",{props:{value:c,trueValue:n.id,falseValue:n.id+"_false",disabled:!e.isAdmin},on:{"on-change":function(t){var o=void 0,i=void 0,n=void 0,r=void 0,l=void 0;"sys_role_permission"===s.row.list?n=s.row.objId:"sys_user_permission"===s.row.list?o=s.row.objId:"sys_group_permission"===s.row.list?i=s.row.objId:r=s.row.objId,/_/.test(t)?(l=0,t=t.split("_")[0]):l=1,Object(a._2)(o,n,i,r,t,e.listId,l).then(function(t){t.success&&e.$Message.success(t.message)})}}}),t("span",{},n.name)]),o.push(l)}),t("div",o)}}],s=[{title:"操作",key:"list",align:"center",render:function(t,s){return t("div",[t("a",{on:{click:function(){e.deleteAllPermission(s,s.row.list)}}},"删除")])}}];this.isAdmin?this.columns=t.concat(s):this.columns=t}},created:function(){var e=this;Object(a.s)(this.listId).then(function(t){e.resourceData=t.tableContent})},mounted:function(){this.setColumns(),this.getResourceData()}},G={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[s("Row",{staticClass:"app-action"},[s("Row",{staticClass:"app-action-title"},[s("h3",[e._v("数据源"),e.isAdmin?s("a",{staticClass:"app-action-title-add",on:{click:e.showModal}},[e._v("授权")]):e._e()]),e._v(" "),s("span",{staticClass:"warning-color marlr"},[e._v("用户默认可查看我创建的实例、我经办的实例、我负责的组织经办的实例")])]),e._v(" "),s("div",{staticClass:"app-action-source"},[s("Row",[s("Table",{attrs:{columns:e.columns,data:e.userSources,size:"small"}})],1)],1)],1),e._v(" "),s("action-modal",{attrs:{modalStatis:e.showActionModal,modalName:e.modalName},on:{reGetData:e.reGetData,emitPermissionModal:e.emitPermissionModal}})],1)},staticRenderFns:[]};var F=s("VU/8")(E,G,!1,function(e){s("8dhD")},"data-v-540991e2",null).exports,B={name:"permissionModal",components:{UserSelector:m,GroupSelector:S,RoleSelector:w},props:{modalStatis:Boolean,resourceId:String,isEdit:Boolean},data:function(){var e=this;return{appListId:this.$route.params.listId,emitChange:0,showPermissionModal:!1,isModalDisabled:!0,fieldData:[],allFieldData:[],fieldColumns:[{title:"字段",key:"fieldName",render:function(t,s){var a=[];return e.allFieldData.forEach(function(e){a.push(t("Option",{props:{value:e.fieldCode,parentCode:e.parentCode}},e.fieldName))}),t("div",[t("Select",{props:{value:s.row.fieldCode},on:{"on-change":function(t){e.fieldData[s.index].fieldCode=t}}},a)])}},{title:"规则",key:"rule",render:function(t,s){var a=[];return[{name:"大于",value:"gt"},{name:"小于",value:"lt"},{name:"等于",value:"eq"},{name:"小于等于",value:"le"},{name:"大于等于",value:"ge"},{name:"不等于",value:"ne"},{name:"包含",value:"like"},{name:"不包含",value:"nlike"}].forEach(function(e){a.push(t("Option",{props:{value:e.value}},e.name))}),t("div",[t("Select",{props:{value:s.row.operator},on:{"on-change":function(t){e.fieldData[s.index].operator=t}}},a)])}},{title:"值",key:"value",render:function(t,s){return t("div",[t("Input",{props:{value:s.row.value},on:{"on-blur":function(t){e.fieldData[s.index].value=t.target.value}}})])}},{title:"且/或",key:"or",render:function(t,s){var a=[];return[{name:"且",value:"and"},{name:"或",value:"or"}].forEach(function(e){a.push(t("Option",{props:{value:e.value}},e.name))}),t("div",[t("Select",{props:{value:s.row.logicOperator},on:{"on-change":function(t){e.fieldData[s.index].logicOperator=t}}},a)])}},{title:"操作",key:"list",align:"center",render:function(t,s){return t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.fieldData.splice(s.index,1)}}},"删除")}}],userSelectData:[],orgSelectData:[],departmentSelectData:[],companySelectData:[],showSelector:{showUserSelector:!1,showGroupSelector:!1,showRoleSelector:!1}}},watch:{modalStatis:function(e,t){var s=this;this.isEdit?(this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[],Object(a.L)(this.appListId,this.resourceId).then(function(e){s.fieldData=e.resource,e.instance.forEach(function(e){var t={};"U"===e.substanceType?(t.nickname=e.substanceName,t.userId=e.substanceId,s.userSelectData.push(t)):"G"===e.substanceType?(t.name=e.substanceName,t.id=e.substanceId,s.orgSelectData.push(t)):"R"===e.substanceType&&(t.name=e.substanceName,t.id=e.substanceId,s.departmentSelectData.push(t))})})):(this.fieldData=[],this.userSelectData=[],this.orgSelectData=[],this.departmentSelectData=[]),this.showPermissionModal=e},fieldData:function(e){e.length>0&&(this.userSelectData.length>0||this.orgSelectData.length>0||this.departmentSelectData.length>0||this.companySelectData.length>0)?this.isModalDisabled=!1:this.isModalDisabled=!0},userSelectData:function(e){e.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.departmentSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},orgSelectData:function(e){e.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.userSelectData.length>0||this.departmentSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0},departmentSelectData:function(e){e.length>0?this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0:(this.orgSelectData.length>0||this.userSelectData.length>0)&&this.fieldData.length>0?this.isModalDisabled=!1:this.isModalDisabled=!0}},methods:{emitUserModal:function(){this.showSelector.showUserSelector=!1},emitGroupModal:function(){this.showSelector.showGroupSelector=!1},emitRoleModal:function(){this.showSelector.showRoleSelector=!1},addNewField:function(){this.fieldData.push({fieldName:"",parentCode:"",fieldCode:"",operator:"",value:"",logicOperator:""})},cancelAddPermission:function(){this.showPermissionModal=!1},submitPermission:function(){var e=this,t=this.userSelectData.map(function(e){return e.userId}),s=this.orgSelectData.map(function(e){return e.id}),o=this.departmentSelectData.map(function(e){return e.id}),i=(this.companySelectData.map(function(e){return e.groupId}),{user:t,role:o,group:s,listId:this.appListId,resourceId:this.resourceId,resource:this.fieldData});i&&(this.isEdit?Object(a._1)(d()(i)).then(function(t){if(t.success){e.$Message.success(t.message),e.showPermissionModal=!1;var s=e.emitChange++;e.$emit("reGetData",s)}}).catch(function(t){e.$Message.error(t.data.message)}):Object(a.U)(d()(i)).then(function(t){if(t.success){e.$Message.success(t.message),e.showPermissionModal=!1;var s=e.emitChange++;e.$emit("reGetData",s)}}).catch(function(t){e.$Message.error(t.data.message)}))},modalVisibleChange:function(e){e||this.$emit("emitPermissionModal",{modal:!1})},selectUserModal:function(){this.showSelector.showUserSelector=!0},selectGroupModal:function(){this.showSelector.showGroupSelector=!0},selectRoleModal:function(){this.showSelector.showRoleSelector=!0},getUserModalData:function(e){if(this.userSelectData.length>0){var t,s={};(t=this.userSelectData).push.apply(t,c()(e)),this.userSelectData=this.userSelectData.reduce(function(e,t){return!s[t.userId]&&(s[t.userId]=e.push(t)),e},[])}else this.userSelectData=e},getGroupModalData:function(e){if(this.orgSelectData.length>0){var t,s={};(t=this.orgSelectData).push.apply(t,c()(e)),this.orgSelectData=this.orgSelectData.reduce(function(e,t){return!s[t.id]&&(s[t.id]=e.push(t)),e},[])}else this.orgSelectData=e},getRoleModalData:function(e){if(this.departmentSelectData.length>0){var t,s={};(t=this.departmentSelectData).push.apply(t,c()(e)),this.departmentSelectData=this.departmentSelectData.reduce(function(e,t){return!s[t.id]&&(s[t.id]=e.push(t)),e},[])}else this.departmentSelectData=e},deleteUser:function(e){var t=e.target.parentElement.getAttribute("userid");this.userSelectData=this.userSelectData.filter(function(e){return e.userId!=t})},deleteOrg:function(e){var t=e.target.parentElement.getAttribute("orgid");this.orgSelectData=this.orgSelectData.filter(function(e){return e.id!=t})},deleteDepartment:function(e,t){var s=event.target.parentElement.getAttribute("depid");this.departmentSelectData=this.departmentSelectData.filter(function(e){return e.id!=s})}},created:function(){var e=this;Object(a.D)(this.appListId).then(function(t){e.allFieldData=t})},mounted:function(){}},z={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{title:"自定义数据源",width:"1000",transfer:!1,styles:{top:"15px"},"mask-closable":!1},on:{"on-visible-change":e.modalVisibleChange},model:{value:e.showPermissionModal,callback:function(t){e.showPermissionModal=t},expression:"showPermissionModal"}},[s("div",[s("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[s("Button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"info",shape:"circle"},on:{click:e.addNewField}},[e._v("新增字段")]),e._v(" "),s("Table",{ref:"actionRef",attrs:{stripe:"",height:"200",columns:e.fieldColumns,size:"small","no-data-text":"请添加新字段",data:e.fieldData}})],1),e._v(" "),s("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:8}},[s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectUserModal}},[e._v("选择用户")])],1),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectGroupModal}},[e._v("选择组织")])],1),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"info",shape:"circle"},on:{click:e.selectRoleModal}},[e._v("选择职位")])],1),e._v(" "),e._e()],1),e._v(" "),s("Row",{attrs:{gutter:8}},[s("Col",{staticClass:"permission-tab",attrs:{span:"24"}},[s("Row",{staticStyle:{"margin-top":"10px"}},[s("Col",{attrs:{span:"3"}},[s("b",{staticClass:"permission-title"},[e._v("用户")])]),e._v(" "),s("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.userSelectData,function(t,a){return s("Tag",{key:a,attrs:{userId:t.userId,closable:"",color:"warning"},on:{"on-close":e.deleteUser}},[e._v("\n              "+e._s(t.nickname)+"\n            ")])}))],1),e._v(" "),s("Row",{staticClass:"permission-line"}),e._v(" "),s("Row",[s("Col",{attrs:{span:"3"}},[s("b",{staticClass:"permission-title"},[e._v("组织")])]),e._v(" "),s("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.orgSelectData,function(t,a){return s("Tag",{key:a,attrs:{orgId:t.id,closable:"",color:"success"},on:{"on-close":e.deleteOrg}},[e._v("\n            "+e._s(t.name)+"\n          ")])}))],1),e._v(" "),s("Row",{staticClass:"permission-line"}),e._v(" "),s("Row",[s("Col",{attrs:{span:"3"}},[s("b",{staticClass:"permission-title"},[e._v("职位")])]),e._v(" "),s("Col",{staticClass:"member-body",attrs:{span:"21"}},e._l(e.departmentSelectData,function(t,a){return s("Tag",{key:a,attrs:{depId:t.id,closable:"",color:"primary"},on:{"on-close":e.deleteDepartment}},[e._v("\n            "+e._s(t.name)+"\n          ")])}))],1),e._v(" "),e._e()],1)],1),e._v(" "),s("user-selector",{attrs:{showUserSelector:e.showSelector.showUserSelector},on:{emitUserModal:e.emitUserModal,userModalData:e.getUserModalData}}),e._v(" "),s("group-selector",{attrs:{showGroupSelector:e.showSelector.showGroupSelector},on:{emitGroupModal:e.emitGroupModal,groupModalData:e.getGroupModalData}}),e._v(" "),s("role-selector",{attrs:{showRoleSelector:e.showSelector.showRoleSelector},on:{emitRoleModal:e.emitRoleModal,roleModalData:e.getRoleModalData}})],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"default"},on:{click:e.cancelAddPermission}},[e._v("取消")]),e._v(" "),s("Button",{attrs:{type:"primary",disabled:e.isModalDisabled},on:{click:e.submitPermission}},[e._v("确定")])],1)])},staticRenderFns:[]};var N={name:"CustomDatasource",components:{CustomDatasourceModal:s("VU/8")(B,z,!1,function(e){s("Xisp")},null,null).exports},props:{isAdmin:Boolean},data:function(){return{listId:this.$route.params.listId,isEdit:!1,resourceId:"",showActionModal:!1,isModalConfirm:1e3,actionData:[],modalName:"action",columns:[],userSources:[]}},watch:{isModalConfirm:function(){this.getResourceData()},isAdmin:function(e){this.setColumns()}},methods:{reGetData:function(e){this.isModalConfirm=e},showModal:function(){this.editActionData={},this.showActionModal=!0,this.isEdit=!1},emitPermissionModal:function(){this.showActionModal=!1},getResourceData:function(){var e=this;Object(a.K)(this.listId).then(function(t){e.userSources=t})},deleteDataSource:function(e){var t=this;this.$Modal.confirm({title:"确认",content:"确认删除此数据源权限？",onOk:function(){Object(a.i)(e).then(function(e){e.success&&(t.$Message.success(e.message),t.getResourceData())})}})},setColumns:function(){var e=this,t=[{title:"字段过滤",key:"expression",render:function(e,t){var s=[];return t.row.expression.split("br").forEach(function(t){s.push(e("div",{},t))}),e("div",s)}},{title:"已授权用户、组织或职位",key:"instance"}],s=[{title:"操作",key:"list",align:"center",render:function(t,s){return t("div",[t("a",{on:{click:function(){e.deleteDataSource(s.row.resourceId)}}},"删除"),t("span",{style:{height:"20px",borderLeft:"1px solid #39f",margin:"0px 5px"}}),t("a",{on:{click:function(){e.isEdit=!0,e.resourceId=s.row.resourceId,e.showActionModal=!0}}},"修改")])}}];this.isAdmin?this.columns=t.concat(s):this.columns=t}},created:function(){},mounted:function(){this.setColumns(),this.getResourceData()}},L={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app",staticStyle:{"margin-top":"15px"}},[s("Row",{staticClass:"app-action"},[s("Row",{staticClass:"app-action-title"},[s("h3",[e._v("自定义数据源"),e.isAdmin?s("a",{staticClass:"app-action-title-add",on:{click:e.showModal}},[e._v("添加")]):e._e()]),e._v(" "),s("span",{staticClass:"warning-color marlr"},[e._v("自定义应用字段过滤条件以及授权给用户或用户组")])]),e._v(" "),s("div",{staticClass:"app-action-source"},[s("Row",[s("Table",{attrs:{columns:e.columns,data:e.userSources,size:"small"}})],1)],1)],1),e._v(" "),s("custom-datasource-modal",{attrs:{modalStatis:e.showActionModal,isEdit:e.isEdit,resourceId:e.resourceId},on:{reGetData:e.reGetData,emitPermissionModal:e.emitPermissionModal}})],1)},staticRenderFns:[]};var W={name:"permissionSource",components:{OperationManage:r,ReportView:y,AppForm:R,WorkFlow:O,ActionManage:V,PermissionDataSource:F,CustomDatasource:s("VU/8")(N,L,!1,function(e){s("oAod")},"data-v-7ba07e2a",null).exports},props:{listId:String,appType:String,enabledForbidden:Number,isAdmin:Boolean,isAddress:Boolean},data:function(){return{}},mounted:function(){}},q={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-permission"},[s("operation-manage",{attrs:{enabledForbidden:e.enabledForbidden,isAdmin:e.isAdmin}}),e._v(" "),s("action-manage",{attrs:{isAdmin:e.isAdmin}}),e._v(" "),"subject"!==e.appType?s("permission-data-source",{attrs:{isAdmin:e.isAdmin}}):e._e(),e._v(" "),s("custom-datasource",{attrs:{isAdmin:e.isAdmin}}),e._v(" "),s("report-view",{attrs:{appType:e.appType,isAdmin:e.isAdmin}}),e._v(" "),e.isAddress||"subject"===e.appType?e._e():s("app-form",{attrs:{isAdmin:e.isAdmin}}),e._v(" "),e.isAddress||"subject"===e.appType?e._e():s("work-flow",{attrs:{isAdmin:e.isAdmin}})],1)},staticRenderFns:[]};var K=s("VU/8")(W,q,!1,function(e){s("lWOn")},"data-v-dd554cc4",null);t.default=K.exports},"8dhD":function(e,t){},ArOu:function(e,t){},FxqG:function(e,t){},Xisp:function(e,t){},btsz:function(e,t){},e9eA:function(e,t){},hROt:function(e,t){},lWOn:function(e,t){},oAod:function(e,t){},rcPB:function(e,t){},v8Y1:function(e,t){},xAJY:function(e,t){},xSr9:function(e,t){},yKKk:function(e,t){}});